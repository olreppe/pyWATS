# Documentation Code Standards - MANDATORY

**Context:** When writing ANY code in documentation (examples, guides, API docs, docstrings)

**Priority:** P0 - NEVER ship non-type-safe documentation code

---

## ðŸš¨ CRITICAL RULES - NO EXCEPTIONS

### 1. Type Safety - ALWAYS

```python
# âŒ NEVER - Dict with Any
def get_report(id: str) -> dict:
    return {"id": id, "status": "passed"}

# âŒ NEVER - Untyped
def get_report(id):
    return some_api_call(id)

# âœ… ALWAYS - Typed with model
from pywats.models import Report

def get_report(id: str) -> Report:
    return wats.report.get(id)

# âœ… ALWAYS - Optional when nullable
def get_report(id: str) -> Optional[Report]:
    return wats.report.get(id)
```

### 2. Return Types - ALWAYS Objects

```python
# âŒ NEVER - Return dict
def create_user(name: str) -> dict:
    return {"name": name, "id": 123}

# âŒ NEVER - Return Any
def create_user(name: str) -> Any:
    return api.create(name)

# âœ… ALWAYS - Return typed model
from pywats.models import User

def create_user(name: str) -> User:
    return api.users.create(name=name)
```

### 3. Enums - ALWAYS (Unless Teaching Strings)

```python
# âŒ NEVER - String literals in production code
result = wats.report.query(status="passed")

# âŒ NEVER - Magic strings
if report.status == "passed":
    ...

# âœ… ALWAYS - Use enums
from pywats.models import ReportStatus

result = wats.report.query(status=ReportStatus.PASSED)
if report.status == ReportStatus.PASSED:
    ...

# âœ… ACCEPTABLE - When explicitly teaching that strings work
# MUST include comment explaining enum is preferred
result = wats.report.query(status="passed")  # String works, but prefer ReportStatus.PASSED
```

### 4. Imports - ALWAYS Complete

```python
# âŒ NEVER - Partial imports in examples
from pywats import WATS
wats = WATS()
report = wats.report.get("123")  # What type is report?

# âœ… ALWAYS - Import types used
from pywats import WATS
from pywats.models import Report

wats = WATS()
report: Report = wats.report.get("123")
```

### 5. Validation - ALWAYS Before Publishing

**MANDATORY CHECKS:**

1. âœ… Check function signature exists and matches
   ```python
   # Before writing: wats.report.get(id)
   # Verify in source: src/pywats/domains/report/service.py
   ```

2. âœ… Check model fields exist
   ```python
   # Before writing: report.serial_number
   # Verify in source: src/pywats/models/report.py
   ```

3. âœ… Check enum values exist
   ```python
   # Before writing: ReportStatus.PASSED
   # Verify in source: src/pywats/models/report.py or models/__init__.py
   ```

4. âœ… Run the code (if possible)
   ```python
   # Create temp file, run it, verify no errors
   ```

5. âœ… Type check with mypy (when showing full scripts)
   ```bash
   mypy example.py --strict
   ```

---

## ðŸ“‹ Pre-Publishing Checklist

Before ANY doc code goes live:

- [ ] All functions have return types
- [ ] All parameters have types
- [ ] No `dict`, `Any`, or `object` returns (unless unavoidable)
- [ ] Enums used for known values
- [ ] All imports are explicit
- [ ] Function signatures verified against source
- [ ] Model fields verified against source
- [ ] Code runs without errors (or marked as pseudocode)
- [ ] Type hints validated with IDE/mypy

---

## ðŸŽ¯ Documentation-Specific Patterns

### Docstring Examples

```python
def query_reports(
    self,
    serial_number: Optional[str] = None,
    status: Optional[ReportStatus] = None
) -> List[Report]:
    """
    Query reports with filters.
    
    Args:
        serial_number: Filter by serial number
        status: Filter by report status
        
    Returns:
        List of matching reports
        
    Example:
        >>> from pywats import WATS
        >>> from pywats.models import ReportStatus, Report
        >>> from typing import List
        >>> 
        >>> wats = WATS("https://server")
        >>> reports: List[Report] = wats.report.query_reports(
        ...     status=ReportStatus.PASSED
        ... )
        >>> for report in reports:
        ...     print(f"{report.serial_number}: {report.status}")
    """
```

### Guide/Tutorial Examples

```python
# âœ… ALWAYS - Complete runnable example with all imports
"""
Example: Query Reports by Status
=================================
"""
from typing import List
from pywats import WATS
from pywats.models import Report, ReportStatus

# Initialize client
wats = WATS(base_url="https://your-server.com")

# Query passed reports
passed_reports: List[Report] = wats.report.query_reports(
    status=ReportStatus.PASSED
)

# Process results
for report in passed_reports:
    print(f"Serial: {report.serial_number}")
    print(f"Status: {report.status.value}")  # Enum to string
    print(f"Result: {report.result}")
```

### API Reference Examples (RST)

```rst
.. code-block:: python

   from typing import List
   from pywats import WATS
   from pywats.models import Report, ReportStatus
   
   wats = WATS("https://server")
   reports: List[Report] = wats.report.query_reports(
       status=ReportStatus.PASSED
   )
```

---

## ðŸ” Validation Workflow

### 1. Before Writing
```bash
# Check function signature
grep -r "def query_reports" src/pywats/

# Check model definition
grep -r "class Report" src/pywats/models/
```

### 2. While Writing
- Use IDE autocomplete to verify fields/methods exist
- Check imports resolve correctly
- Verify enum values match source

### 3. After Writing
```python
# Create temp test file
cat > /tmp/test_doc_example.py << 'EOF'
from typing import List
from pywats import WATS
from pywats.models import Report, ReportStatus

wats = WATS("https://server")
reports: List[Report] = wats.report.query_reports(
    status=ReportStatus.PASSED
)
EOF

# Type check
mypy /tmp/test_doc_example.py --strict
```

---

## ðŸš« Common Anti-Patterns to AVOID

### Anti-Pattern 1: Lazy Typing
```python
# âŒ WRONG
data = wats.get_something()  # What is data?
items = data["items"]  # What are items?
```

### Anti-Pattern 2: String Literals
```python
# âŒ WRONG  
reports = wats.report.query(status="passed", type="uut")
```

### Anti-Pattern 3: Unvalidated Examples
```python
# âŒ WRONG - Never verified this works
report = wats.report.create({
    "serialNumber": "SN123",
    "testResult": "pass"  # Does this field exist? Is "pass" valid?
})
```

### Anti-Pattern 4: Partial Imports
```python
# âŒ WRONG
from pywats import WATS
# ... later in code ...
report.serial_number  # Where did Report type come from?
```

---

## âœ… Enforcement Strategy

### For Agents
1. **Load this file** when working on:
   - `docs/` directory
   - `examples/` directory
   - Docstrings in `src/`
   - Test documentation

2. **Verify before committing:**
   - Run examples through type checker
   - Check against source code
   - Use grep/semantic search to validate

3. **When uncertain:**
   - Read actual source code
   - Don't guess function signatures
   - Don't assume model fields exist

### For Humans (Code Review)
- Reject any doc PR with untyped examples
- Require type checking results for doc changes
- Validate examples run correctly

---

## ðŸ“ Template: New Documentation Example

```python
"""
[Title of Example]
==================

[Description]

**Type Safety:** âœ… All types verified
**Validated:** âœ… Code runs without errors
"""

# Imports - COMPLETE
from typing import List, Optional
from pywats import WATS
from pywats.models import Report, ReportStatus
from pywats.exceptions import NotFoundException

# Initialize with proper typing
wats: WATS = WATS(base_url="https://server")

# Use typed variables
try:
    reports: List[Report] = wats.report.query_reports(
        status=ReportStatus.PASSED  # Enum, not string
    )
    
    for report in reports:
        # All fields verified to exist on Report model
        serial: str = report.serial_number
        status: ReportStatus = report.status
        print(f"{serial}: {status.value}")
        
except NotFoundException as e:
    print(f"Error: {e}")
```

---

## ðŸŽ¯ Success Metrics

**Goal:** Zero type errors in documentation code

**Measure:**
```bash
# Extract all code blocks from docs
python scripts/extract_doc_code.py docs/ > doc_examples.py

# Type check
mypy doc_examples.py --strict

# Target: 0 errors
```

---

**Last Updated:** February 3, 2026  
**Applies To:** All documentation (Sphinx, guides, examples, docstrings)  
**Enforcement:** Mandatory for all commits touching docs/
