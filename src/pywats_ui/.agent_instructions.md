# pyWATS GUI Framework - Agent Instructions (P2 - Directory-Specific)

**Status:** EXPERIMENTAL - Not approved for production release  
**Priority:** P2 (Directory-specific overlay)  
**Last Updated:** February 4, 2026

---

## üö® CRITICAL CONSTRAINTS - READ FIRST

### 1. Platform Independence (NON-NEGOTIABLE)
- **DO NOT** alter `src/pywats_client/` in this session
- **DO NOT** touch `src/pywats_client/service/` or `src/pywats_client/__main__.py`
- The existing client/service implementation is platform-independent and MUST remain untouched
- Analyze existing framework patterns and use as soft limits
- Ask user before extending beyond existing patterns

### 2. Technology & Scope (REVISED - Equivalent Framework)
- **Target:** EQUIVALENT to current GUI (`src/pywats_client/gui/`), NOT lighter/minimal
- **Core Stack:** PySide6 (Qt 6.x), qasync (Qt-asyncio bridge), AsyncWATS API (SAME as current)
- **Patterns:** AsyncAPIRunner, ErrorHandlingMixin, BasePage, IPC client, QSS themes (COPY from current)
- **Use Cases:** Configurator (copy of current), AI Chat, AI-assisted SPC, station monitoring, operator UIs (inspections/repairs)
- **Strategy:** REUSE core infrastructure, COPY GUI patterns, KEEP ALL capabilities
- **Reference:** See `ARCHITECTURAL_ANALYSIS.md` for what to reuse vs copy

### 3. Experimental Status
- **DO NOT deprecate** `src/pywats_client/gui/` - old GUI stays functional
- **DO NOT add** user-facing documentation to `docs/guides/` or `docs/api/`
- **DO NOT add** examples to `examples/` folder
- **DO NOT include** in release flow (pyproject.toml, CHANGELOG, etc.)
- User must be able to revert to old GUI at any time without migration

### 4. Release Isolation
- Entry points (`pywats-configurator`, `pywats-aichat`) are OK for testing
- Do NOT add to pre-release checklist
- Do NOT update CHANGELOG until concept approved
- Keep all GUI code in `src/pywats_ui/` (isolated from main package)

---

## üìÅ Directory Structure

```
src/pywats_ui/
‚îú‚îÄ‚îÄ framework/          # Minimal base classes (BaseApplication, BaseMainWindow)
‚îú‚îÄ‚îÄ apps/              # Experimental applications
‚îÇ   ‚îú‚îÄ‚îÄ aichat/        # AI Chat (Six Sigma assistant)
‚îÇ   ‚îú‚îÄ‚îÄ configurator/  # Client Configurator (experimental)
‚îÇ   ‚îî‚îÄ‚îÄ ...            # Future simple apps
‚îî‚îÄ‚îÄ template/          # Scaffolding template for new apps
```

**Forbidden Areas (Do NOT Touch):**
- `src/pywats_client/` - Existing client (platform-independent)
- `src/pywats_client/service/` - Service framework
- `src/pywats_client/gui/` - Old GUI (stays as-is)
- `docs/` - User-facing documentation
- `examples/` - Shipped examples

---

## üéØ Framework Design Principles (REVISED - Equivalent Framework)

### Reuse Strategy (Import from pywats_client.core)
- ‚úÖ **AsyncTaskRunner** - IMPORT from `pywats_client.core.async_runner` (527 lines, proven)
- ‚úÖ **EventBus** - IMPORT from `pywats_client.core.event_bus` (app-wide events)
- ‚úÖ **InstanceManager** - IMPORT from `pywats_client.core.instance_manager` (multi-instance)
- ‚úÖ **ConnectionConfig** - IMPORT from `pywats_client.core.connection_config` (shared config)

### Copy Strategy (Adapt from pywats_client.gui)
- ‚úÖ **AsyncAPIRunner** - COPY/ADAPT from `gui/async_api_runner.py` (402 lines, API integration)
- ‚úÖ **ErrorHandlingMixin** - COPY from `gui/error_mixin.py` (Qt MessageBox helpers)
- ‚úÖ **BasePage** - COPY/ADAPT from `gui/pages/base.py` (351 lines, page base class)
- ‚úÖ **Styles** - COPY from `gui/styles.py` (405 lines, dark theme QSS)
- ‚úÖ **ScriptEditor** - COPY from `gui/widgets/script_editor.py` (1106 lines, converter editing)
- ‚úÖ **StatusIndicator** - COPY from `gui/pages/dashboard.py` (visual status widget)
- ‚úÖ **LoginWindow** - COPY from `gui/login_window.py` (authentication)
### Import vs Copy vs Adapt Pattern

**IMPORT (from pywats_client.core - already shared):**
```python
from pywats_client.core.async_runner import AsyncTaskRunner, TaskResult
from pywats_client.core.event_bus import event_bus, AppEvent
from pywats_client.core.instance_manager import InstanceManager
from pywats_client.core.connection_config import ConnectionConfig, ConnectionState
```

**COPY (from pywats_client.gui - move to pywats_ui):**
- `gui/async_api_runner.py` ‚Üí `pywats_ui/framework/async_api_runner.py`
- `gui/error_mixin.py` ‚Üí `pywats_ui/framework/error_mixin.py`
- `gui/pages/base.py` ‚Üí `pywats_ui/framework/base_page.py`
- `gui/styles.py` ‚Üí `pywats_ui/framework/styles.py`
- `gui/widgets/script_editor.py` ‚Üí `pywats_ui/widgets/script_editor.py`
- `gui/widgets/new_converter_dialog.py` ‚Üí `pywats_ui/widgets/new_converter_dialog.py`
- `gui/login_window.py` ‚Üí `pywats_ui/dialogs/login_window.py`
- `gui/settings_dialog.py` ‚Üí `pywats_ui/dialogs/settings_dialog.py`

**ADAPT (from pywats_client.gui - copy app.py patterns):**
- `gui/app.py` ‚Üí `pywats_ui/framework/base_application.py` (qasync setup, single-instance)
- `gui/main_window.py` ‚Üí `pywats_ui/framework/base_main_window.py` (sidebar, pages, IPC)

**DO NOT SIMPLIFY** - Keep full capabilities from current GUI!
- **Styles (DARK_STYLESHEET)** ‚Üí Reuse QSS themes
- **IPC Client** ‚Üí Use AsyncIPCClient as-is for service communication
- **Single-Instance** ‚Üí Reuse QLocalSocket/QLocalServer pattern

**Analyze before implementing:**
- Check if current GUI already has the component
- Reuse existing patterns (don't reinvent)
- Simplify for config/alarming use case~/.pywats/{app_name}/`
5. Optional: Custom widgets, dialogs (keep simple)

### Platform Independence Pattern
**Analyze existing `pywats_client/` before implementing features:**
- Check how service control is abstracted
- Check how configuration is handled
- Check how platform-specific code is isolated
- Follow same patterns in GUI apps

---

## üîç Code Review Checklist
Reused existing GUI patterns where possible (qasync, AsyncAPIRunner, ErrorHandlingMixin)
7. ‚úÖ Apps use same technology stack as current GUI (PySide6, qasync, AsyncWATS**
1. ‚úÖ Did NOT modify `src/pywats_client/` (except entry points in pyproject.toml)
2. ‚úÖ Did NOT deprecate old GUI (`src/pywats_client/gui/`)
3. ‚úÖ Did NOT add to `docs/guides/` or `docs/api/`
4. ‚úÖ Did NOT add to `examples/`
5. ‚úÖ Did NOT update `CHANGELOG.md`
6. ‚úÖ Framework stays minimal (no advanced features)
7. ‚úÖ Apps are simple (config/alarming only)
8. ‚úÖ Platform independence maintained

**Allowed Changes:**
- Add entry points to `pyproject.toml` for testing
- Create files in `src/pywats_ui/` only
- Add tests in `tests/client/ui/` (optional, not required)
- Update GUI project files in `projects/active/gui-client-separation.project/`

---

## üöÄ Testing Commands

**Launch apps (for testing only):**
```powershell
# New GUI apps (experimental)
pywats-configurator
pywats-aichat

# Old GUI (production - DO NOT BREAK)
pywats-client  # Must still work!
```

**Verification:**
- Old GUI must still launch without errors
- New GUIs are standalone (don't affect old GUI)
- No shared state between old/new GUIs

---

## üìä Current Status

**Completed:**
- ‚úÖ Framework base classes (BaseApplication, BaseMainWindow)
- ‚úÖ Application template scaffold
- ‚úÖ AI Chat hello world
- ‚úÖ Configurator experimental version

**NOT Done (and NOT allowed yet):**
- ‚ùå Documentation in `docs/`
- ‚ùå Examples in `examples/`
- ‚ùå CHANGELOG updates
- ‚ùå Deprecation of old GUI
- ‚ùå Advanced framework features

**Pending Approval:**
- Framework concept validation
- App usefulness assessment
- Migration strategy (if approved)
- Production release timeline

---

## üé® Naming Conventions

- **User-Facing Names:** "pyWATS" (not "WATS") to differentiate from .NET
- **Package Names:** `pywats_ui`, `pywats.apps.configurator`
- **Entry Points:** `pywats-{appname}` (e.g., `pywats-configurator`)
- **Config Folders:** `~/.pywats/{appname}/`

---

## ü§ñ Agent Behavior

**When Asked to Extend Framework:**
1. First check if current GUI (`src/pywats_client/gui/`) already has the component
2. Reuse existing patterns (AsyncAPIRunner, ErrorHandlingMixin, etc.)
3. Simplify for config/alarming use cases
4. Ask user if unsure about scope
5. Reference `CURRENT_GUI_TECHNOLOGY_ANALYSIS.md` for existing components

**When Asked to Add Features:**
1. Check if it's simple config/alarming (in scope)
2. Check if it's advanced (out of scope - ask first)
3. Verify platform independence maintained
4. Keep old GUI untouched

**When Asked to Document:**
1. Project docs (`projects/active/`) - OK
2. Internal docs (`docs/internal_documentation/`) - OK
3. User guides (`docs/guides/`) - NOT ALLOWED
4. Examples (`examples/`) - NOT ALLOWED

---

**Reference:** See `.github/copilot-instructions.md` for base instructions  
**Priority:** P2 - Directory-specific overlay (loads when working in `src/pywats_ui/`)
