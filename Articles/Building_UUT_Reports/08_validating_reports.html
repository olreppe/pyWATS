<!-- KEYWORDS: validation, ValidateForSubmit, ValidationMode, AutoTruncate, Strict, validate, check, error handling -->

<h2 id="h_01K9QH8A1B2C3D4E5F6G7H8I9J">Validating Reports Before Submission</h2>
<p>
    Before submitting a UUT report to the WATS server, it's good practice to validate it. Validation checks for common
    issues like missing required fields, invalid data, or data that exceeds database limits.
</p>

<h2 id="h_01K9QH8A1B2C3D4E5F6G7H8I9K">Using ValidateForSubmit()</h2>
<p>
    The <code>ValidateForSubmit()</code> method checks if a UUT report is ready for submission:
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">using Virinco.WATS.Interface;

// Create and populate UUT report
UUTReport uut = api.CreateUUTReport(/* parameters */);
// ... add steps ...

// Validate before submission
bool isValid = api.ValidateForSubmit(uut);

if (!isValid)
{
    Console.WriteLine("UUT report failed validation!");
    // Handle validation errors
}
else
{
    Console.WriteLine("UUT report is valid and ready for submission");
    api.Submit(uut);
}</code></pre>

<h2 id="h_01K9QH8A1B2C3D4E5F6G7H8I9L">Validation Mode Settings</h2>
<p>
    The <code>ValidationMode</code> property controls how the API handles validation issues:
</p>

<h3 id="h_01K9QH8A1B2C3D4E5F6G7H8I9M">AutoTruncate Mode (Recommended)</h3>
<pre class="wysiwyg-code-block"><code class="language-auto">// Automatically truncate strings that exceed database limits
api.ValidationMode = ValidationModeType.AutoTruncate;

// Example: If a step name exceeds 255 characters, it will be truncated
SequenceCall rootSeq = uut.GetRootSequenceCall();
string veryLongName = new string('A', 300); // 300 characters
NumericLimitStep step = rootSeq.AddNumericLimitStep(veryLongName);
// Name will be automatically truncated to 255 characters

api.Submit(uut); // Succeeds without error</code></pre>

<h3 id="h_01K9QH8A1B2C3D4E5F6G7H8I9N">Strict Mode</h3>
<pre class="wysiwyg-code-block"><code class="language-auto">// Throw exception if data exceeds database limits
api.ValidationMode = ValidationModeType.Strict;

try
{
    SequenceCall rootSeq = uut.GetRootSequenceCall();
    string veryLongName = new string('A', 300);
    NumericLimitStep step = rootSeq.AddNumericLimitStep(veryLongName);

    api.Submit(uut);
}
catch (Exception ex)
{
    Console.WriteLine($"Validation error: {ex.Message}");
    // Handle the error (e.g., truncate manually, log warning)
}</code></pre>

<h2 id="h_01K9QH8A1B2C3D4E5F6G7H8I9O">Common Validation Issues</h2>
<p>
    Here are common issues that validation detects:
</p>

<h3 id="h_01K9QH8A1B2C3D4E5F6G7H8I9P">Missing Required Fields</h3>
<pre class="wysiwyg-code-block"><code class="language-auto">// These fields are required
UUTReport uut = api.CreateUUTReport(
    operatorName: "John",      // Required
    partNumber: "PCB-123",      // Required
    partRevision: "A",          // Required
    serialNumber: "SN001",      // Required
    operationType: opType,      // Required (must be valid)
    sequenceFileName: "Test",   // Required
    sequenceFileVersion: "1.0"  // Required
);

// Also required (must be set before submission)
uut.StartDateTime = DateTime.Now;  // Required
uut.Status = UUTStatusType.Passed; // Required</code></pre>

<h3 id="h_01K9QH8A1B2C3D4E5F6G7H8I9Q">String Length Limits</h3>
<p>
    Common database field length limits:
</p>
<ul>
    <li>Serial Number: 50 characters</li>
    <li>Part Number: 50 characters</li>
    <li>Part Revision: 10 characters</li>
    <li>Operator Name: 128 characters</li>
    <li>Step Names: 255 characters</li>
    <li>Report Text/Comments: 4000 characters</li>
    <li>Units: 20 characters</li>
</ul>

<h3 id="h_01K9QH8A1B2C3D4E5F6G7H8I9R">Invalid Operation Type</h3>
<pre class="wysiwyg-code-block"><code class="language-auto">// Always check if GetOperationType() returns null
OperationType? opType = api.GetOperationType("99");

if (opType == null)
{
    throw new Exception("Operation type '99' not found in WATS database!");
}

// Use the validated operation type
UUTReport uut = api.CreateUUTReport(
    "Operator", "PN-123", "A", "SN001",
    opType,  // Safe to use
    "Test", "1.0"
);</code></pre>

<h2 id="h_01K9QH8A1B2C3D4E5F6G7H8I9S">Validation Best Practices</h2>
<pre class="wysiwyg-code-block"><code class="language-auto">using System;
using Virinco.WATS.Interface;

public UUTReport CreateValidatedReport(TDM api, string serialNumber, string partNumber)
{
    // Set validation mode
    api.ValidationMode = ValidationModeType.AutoTruncate;

    // Validate operation type exists
    OperationType? opType = api.GetOperationType("30");
    if (opType == null)
    {
        throw new Exception("Operation type not configured");
    }

    // Validate required data
    if (string.IsNullOrWhiteSpace(serialNumber))
    {
        throw new ArgumentException("Serial number is required");
    }

    if (string.IsNullOrWhiteSpace(partNumber))
    {
        throw new ArgumentException("Part number is required");
    }

    // Truncate if needed (before creating report)
    if (serialNumber.Length > 50)
    {
        Console.WriteLine($"Warning: Serial number truncated from {serialNumber.Length} to 50 chars");
        serialNumber = serialNumber.Substring(0, 50);
    }

    if (partNumber.Length > 50)
    {
        Console.WriteLine($"Warning: Part number truncated from {partNumber.Length} to 50 chars");
        partNumber = partNumber.Substring(0, 50);
    }

    // Create UUT report
    UUTReport uut = api.CreateUUTReport(
        "Auto", partNumber, "A", serialNumber,
        opType, "Test", "1.0"
    );

    // Set required fields
    uut.StartDateTime = DateTime.Now;
    uut.StationName = Environment.MachineName;

    // Build test sequence
    // ... (add steps)

    // Final validation before returning
    if (!api.ValidateForSubmit(uut))
    {
        throw new Exception("UUT report failed validation");
    }

    return uut;
}</code></pre>

<h2 id="h_01K9QH8A1B2C3D4E5F6G7H8I9T">Validation Checklist</h2>
<p>
    Before submitting a UUT report, verify:
</p>
<ul>
    <li>✓ Operation type retrieved successfully from server</li>
    <li>✓ Serial number is not empty and ≤ 50 characters</li>
    <li>✓ Part number is not empty and ≤ 50 characters</li>
    <li>✓ StartDateTime is set to a valid date/time</li>
    <li>✓ UUT status is set (Passed, Failed, etc.)</li>
    <li>✓ All step names ≤ 255 characters</li>
    <li>✓ All units ≤ 20 characters</li>
    <li>✓ Comments/ReportText ≤ 4000 characters</li>
    <li>✓ ValidationMode is set appropriately</li>
    <li>✓ ValidateForSubmit() returns true</li>
</ul>