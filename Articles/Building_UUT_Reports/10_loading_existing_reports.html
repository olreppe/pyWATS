<!-- KEYWORDS: load UUT, GetUUT, SearchUUT, retrieve report, find UUT, failed step, repair, UUR, query -->

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9J">Loading Existing UUT Reports from WATS</h2>
<p>
    After submitting a UUT report to WATS, you may need to retrieve it later for analysis, repair correlation, or
    additional processing. The WATS Client API provides methods to load existing reports by ID or search criteria.
</p>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9K">Loading a UUT by ID</h2>
<p>
    If you know the UUT ID (returned after submission), you can load the complete report:
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">using Virinco.WATS.Interface;

// Load UUT by ID
long uutId = 12345; // ID returned from previous submission

UUTReport? loadedUUT = api.GetUUT(uutId);

if (loadedUUT != null)
{
    Console.WriteLine($"Loaded UUT: {loadedUUT.SerialNumber}");
    Console.WriteLine($"Status: {loadedUUT.Status}");
    Console.WriteLine($"Test Date: {loadedUUT.StartDateTime}");
    Console.WriteLine($"Part Number: {loadedUUT.PartNumber}");
}
else
{
    Console.WriteLine($"UUT with ID {uutId} not found");
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9L">Finding UUT by Serial Number</h2>
<p>
    Search for a UUT using its serial number:
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">string serialNumber = "SN123456789";

// Search for UUTs with this serial number
UUTReport[] foundUUTs = api.SearchUUT(serialNumber);

if (foundUUTs.Length > 0)
{
    Console.WriteLine($"Found {foundUUTs.Length} UUT(s) with serial {serialNumber}:");

    foreach (var uut in foundUUTs)
    {
        Console.WriteLine($"  - ID: {uut.UUTId}, Date: {uut.StartDateTime}, Status: {uut.Status}");
    }

    // Get the most recent one
    UUTReport latestUUT = foundUUTs.OrderByDescending(u => u.StartDateTime).First();
    Console.WriteLine($"Latest test: {latestUUT.StartDateTime}");
}
else
{
    Console.WriteLine($"No UUT found with serial number: {serialNumber}");
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9M">Accessing Test Steps from Loaded UUT</h2>
<p>
    Once you've loaded a UUT, you can access its test sequence and steps:
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">// Load UUT
UUTReport? uut = api.GetUUT(12345);

if (uut != null)
{
    // Get the root sequence
    SequenceCall rootSeq = uut.GetRootSequenceCall();

    // Access steps (example: find failed steps)
    var failedSteps = FindFailedSteps(rootSeq);

    foreach (var step in failedSteps)
    {
        Console.WriteLine($"Failed step: {step.StepName}");
        Console.WriteLine($"  Details: {step.ReportText}");
    }
}

// Helper method to recursively find failed steps
List<Step> FindFailedSteps(SequenceCall sequence)
{
    List<Step> failedSteps = new List<Step>();

    foreach (var step in sequence.Steps)
    {
        if (step.Status == StepStatusType.Failed)
        {
            failedSteps.Add(step);
        }

        // Check nested sequences
        if (step is SequenceCall nestedSeq)
        {
            failedSteps.AddRange(FindFailedSteps(nestedSeq));
        }
    }

    return failedSteps;
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9N">Finding the Step That Caused Failure</h2>
<p>
    For failed UUTs, you can find the specific step that caused the failure:
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">UUTReport? uut = api.GetUUT(12345);

if (uut != null && uut.Status == UUTStatusType.Failed)
{
    // Get the step that caused the UUT to fail
    Step? failedStep = uut.GetStepCausedUUTFail();

    if (failedStep != null)
    {
        Console.WriteLine($"UUT failed at step: {failedStep.StepName}");
        Console.WriteLine($"Step type: {failedStep.GetType().Name}");
        Console.WriteLine($"Report text: {failedStep.ReportText}");

        // If it's a numeric step, show the measurement
        if (failedStep is NumericLimitStep numStep)
        {
            Console.WriteLine($"Measurement: {numStep.Value} {numStep.Unit}");
            Console.WriteLine($"Limits: {numStep.LowLimit} to {numStep.HighLimit}");
        }
    }
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9O">Using Loaded Reports for Repair (UUR)</h2>
<p>
    Loaded UUT reports are commonly used to create repair reports (UUR):
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">// Load the failed UUT
UUTReport? failedUUT = api.GetUUT(12345);

if (failedUUT != null && failedUUT.Status == UUTStatusType.Failed)
{
    // Get repair type
    RepairType repairType = api.GetRepairType(failedUUT.OperationType.Id);

    // Create UUR linked to the failed UUT
    UURReport uur = api.CreateUURReport("RepairTech", repairType, failedUUT);

    // Get the failed step
    Step? failedStep = failedUUT.GetStepCausedUUTFail();

    // Add repair information
    FailCode? failCode = /* get appropriate fail code */;
    uur.AddFailure(failCode, "Action taken", "Replaced component",
                   failedStep?.StepOrderNumber ?? 0);

    // Submit repair
    api.Submit(uur);

    Console.WriteLine($"Repair created for failed UUT {failedUUT.SerialNumber}");
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9P">Searching with Filters</h2>
<p>
    Search for UUTs with specific criteria:
</p>
<pre class="wysiwyg-code-block"><code class="language-auto">// Search for all failed UUTs for a specific part number in last 7 days
DateTime startDate = DateTime.Now.AddDays(-7);
DateTime endDate = DateTime.Now;

UUTReport[] failedUUTs = api.SearchUUT(
    partNumber: "PCB-1234",
    startDate: startDate,
    endDate: endDate,
    status: UUTStatusType.Failed
);

Console.WriteLine($"Found {failedUUTs.Length} failed UUTs for PCB-1234 in last 7 days");

foreach (var uut in failedUUTs)
{
    Console.WriteLine($"  {uut.SerialNumber} - {uut.StartDateTime}");

    Step? failedStep = uut.GetStepCausedUUTFail();
    if (failedStep != null)
    {
        Console.WriteLine($"    Failed at: {failedStep.StepName}");
    }
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9Q">Complete Example: Retry Failed UUT</h2>
<pre class="wysiwyg-code-block"><code class="language-auto">using System;
using System.Linq;
using Virinco.WATS.Interface;

public void RetryFailedUnit(TDM api, string serialNumber)
{
    // Find the most recent failed UUT
    UUTReport[] uuts = api.SearchUUT(serialNumber);

    UUTReport? failedUUT = uuts
        .Where(u => u.Status == UUTStatusType.Failed)
        .OrderByDescending(u => u.StartDateTime)
        .FirstOrDefault();

    if (failedUUT == null)
    {
        Console.WriteLine($"No failed UUT found for {serialNumber}");
        return;
    }

    Console.WriteLine($"Found failed UUT from {failedUUT.StartDateTime}");

    // Get the failed step
    Step? failedStep = failedUUT.GetStepCausedUUTFail();
    if (failedStep != null)
    {
        Console.WriteLine($"Previous failure: {failedStep.StepName}");
        Console.WriteLine($"Details: {failedStep.ReportText}");
    }

    // Now run a new test on the repaired unit
    Console.WriteLine("Running retest...");

    // Create new UUT report for retest
    UUTReport retestUUT = api.CreateUUTReport(
        "Auto",
        failedUUT.PartNumber,
        failedUUT.PartRevision,
        serialNumber,
        failedUUT.OperationType,
        "Retest",
        "1.0"
    );

    retestUUT.StartDateTime = DateTime.Now;
    retestUUT.Purpose = $"Retest after failure {failedUUT.UUTId}";

    // Run tests and submit
    // ... (build test sequence)

    api.Submit(retestUUT);

    Console.WriteLine($"Retest completed with status: {retestUUT.Status}");
}</code></pre>

<h2 id="h_01K9QHAA1B2C3D4E5F6G7H8I9R">Best Practices</h2>
<ul>
    <li>Always check if loaded UUT is null before accessing properties</li>
    <li>Store UUT IDs when submitting for easy retrieval later</li>
    <li>Use GetStepCausedUUTFail() to find root cause of failures</li>
    <li>Link repair reports (UUR) to original failed UUTs for traceability</li>Use date range filters to limit search
    results and improve performance</li>
    <li>Cache frequently accessed UUTs to reduce server queries</li>
</ul>