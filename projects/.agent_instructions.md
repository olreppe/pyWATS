# Agent Workflow Instructions for pyWATS Projects

**CRITICAL:** All AI agents working on pyWATS projects MUST follow this workflow.

---

## üéØ Project Lifecycle Overview

```
1. User requests new feature/improvement
2. Agent creates project folder with structured docs
3. Agent follows micro-sprint workflow
4. On completion, agent moves to docs/internal_documentation/completed/{quarter}/
5. Agent commits and pushes changes
```

---

## üìÅ Project Structure (REQUIRED)

When starting ANY new project, create this structure in `projects/{project-name}/`:

```
projects/
‚îî‚îÄ‚îÄ {project-name}/
    ‚îú‚îÄ‚îÄ README.md                    # Project overview, status, quick links
    ‚îú‚îÄ‚îÄ 01_ANALYSIS.md              # Problem analysis, requirements, constraints
    ‚îú‚îÄ‚îÄ 02_IMPLEMENTATION_PLAN.md   # Step-by-step implementation plan
    ‚îú‚îÄ‚îÄ 03_PROGRESS.md              # Real-time progress tracking
    ‚îú‚îÄ‚îÄ 04_TODO.md                  # Task checklist (‚úÖ ‚úó üöß)
    ‚îú‚îÄ‚îÄ tests/                      # Project-specific tests
    ‚îú‚îÄ‚îÄ scripts/                    # Automation scripts
    ‚îî‚îÄ‚îÄ notes/                      # Working notes, discoveries
```

---

## üìù Document Templates

### README.md Template
```markdown
# {Project Name}

**Created:** {Date}  
**Status:** üöß In Progress | ‚úÖ Complete | ‚ùå Cancelled  
**Priority:** HIGH | MEDIUM | LOW

---

## Quick Links
- [Analysis](01_ANALYSIS.md)
- [Implementation Plan](02_IMPLEMENTATION_PLAN.md)
- [Progress Tracker](03_PROGRESS.md)
- [TODO List](04_TODO.md)

---

## Objective
{One paragraph describing what this project aims to achieve}

---

## Success Criteria
- [ ] Criterion 1
- [ ] Criterion 2

---

## Current Status
{Brief status update - what's done, what's next}
```

### 01_ANALYSIS.md Template
```markdown
# Analysis: {Project Name}

**Related Docs:**
- [README](README.md) | [Plan](02_IMPLEMENTATION_PLAN.md) | [Progress](03_PROGRESS.md) | [TODO](04_TODO.md)

---

## Problem Statement
{What problem are we solving?}

## Requirements
### Functional
- Requirement 1
- Requirement 2

### Non-Functional
- Performance: {criteria}
- Compatibility: {criteria}

## Constraints
- Technical limitations
- Time constraints
- Breaking change considerations

## Research Findings
{Any technical research, existing solutions, architecture review}

## Architecture Impact
{How does this affect existing code?}

## Risk Assessment
- **HIGH**: {risks}
- **MEDIUM**: {risks}
- **LOW**: {risks}
```

### 02_IMPLEMENTATION_PLAN.md Template
```markdown
# Implementation Plan: {Project Name}

**Related Docs:**
- [README](README.md) | [Analysis](01_ANALYSIS.md) | [Progress](03_PROGRESS.md) | [TODO](04_TODO.md)

---

## Phase 1: {Phase Name}
### Step 1.1: {Step Name}
**File(s):** `path/to/file.py`  
**Action:** {What to do}  
**Verification:** {How to verify it works}

### Step 1.2: {Step Name}
...

## Phase 2: {Phase Name}
...

---

## Testing Strategy
- Unit tests for: {components}
- Integration tests for: {workflows}
- Verification commands: `pytest ...`

---

## Rollback Plan
{How to revert if something goes wrong}
```

### 03_PROGRESS.md Template
```markdown
# Progress Tracker: {Project Name}

**Related Docs:**
- [README](README.md) | [Analysis](01_ANALYSIS.md) | [Plan](02_IMPLEMENTATION_PLAN.md) | [TODO](04_TODO.md)

---

## Current Session: {Date}

### ‚úÖ Completed This Session
- [x] {Timestamp} - {Task description} - {Result/Outcome}

### üöß In Progress
- [ ] {Task description} - {Current status/blocker}

### üîç Discoveries
- {Important findings, bugs found, design decisions}

---

## Previous Sessions

### Session {Date}
- Completed: {summary}
- Issues: {any problems encountered}

---

## Metrics
- Files Modified: {count}
- Tests Added: {count}
- Tests Passing: {X/Y}
```

### 04_TODO.md Template
```markdown
# TODO: {Project Name}

**Related Docs:**
- [README](README.md) | [Analysis](01_ANALYSIS.md) | [Plan](02_IMPLEMENTATION_PLAN.md) | [Progress](03_PROGRESS.md)

---

## ‚úÖ Completed
- [x] {Task description}

## üöß In Progress
- [ ] {Task description} - **CURRENT**

## üß† Planned
- [ ] {Task description}
- [ ] {Task description}

## ‚è∏Ô∏è Blocked/Deferred
- [ ] {Task description} - **REASON:** {why blocked}

---

**Last Updated:** {Timestamp}
```

---

## ü§ñ Agent Workflow (STEP-BY-STEP)

### When User Requests a New Project:

**STEP 1: Create Project Structure**
```
1. Create folder: projects/{project-name}/
2. Generate all 4 required markdown files from templates
3. Create tests/, scripts/, notes/ subdirectories
4. Confirm with user before proceeding
```

**STEP 2: Analysis Phase**
```
1. Populate 01_ANALYSIS.md with research
2. Ask clarifying questions if needed
3. Document requirements, constraints, risks
4. Get user approval on analysis
```

**STEP 3: Planning Phase**
```
1. Break work into phases and steps in 02_IMPLEMENTATION_PLAN.md
2. Create initial TODO.md with all tasks
3. Estimate complexity and time
4. Identify potential issues early
```

**STEP 4: Implementation Phase**
```
FOR EACH TASK:
  1. Mark task as üöß In Progress in TODO.md
  2. Implement the change
  3. Update PROGRESS.md with what was done
  4. Mark task as ‚úÖ Completed in TODO.md
  5. Run tests and verify
  6. Update README.md status if phase complete
```

**STEP 5: Testing & Verification**
```
1. Run all tests
2. Document results in PROGRESS.md
3. Fix any failures
4. Update TODO.md with any new tasks discovered
```

**STEP 6: Completion**
```
1. Update README.md status to "‚úÖ Complete"
2. Create COMPLETION_SUMMARY.md with final stats
3. Move entire folder to docs/internal_documentation/completed/{quarter}/
4. Update projects/README.md to remove from active list
5. Commit with descriptive message
6. Push to remote
```

---

## üé® Agent Prompt Patterns (USE THESE)

### Starting a New Task
```
"Based on 02_IMPLEMENTATION_PLAN.md, I will now implement Phase 1, Step 1.2: {task name}.
I will update 04_TODO.md to mark this task as in-progress."
```

### After Completing a Task
```
"Completed: {task description}
Files modified: {list files}
Tests passing: {X/Y}

Updating:
- 03_PROGRESS.md with completion entry
- 04_TODO.md to mark task complete

Next task: {next task from TODO.md}"
```

### When Stuck/Blocked
```
"Current task blocked: {task name}
Reason: {explanation}
Moving to 04_TODO.md ‚è∏Ô∏è Blocked section.
Proceeding with next unblocked task: {task name}"
```

### Before Asking User for Clarification
```
"Analysis shows {situation}. Before proceeding, I need clarification:
1. {Question 1}
2. {Question 2}

Documenting this in 01_ANALYSIS.md under 'Open Questions' section."
```

---

## üîÄ Alternative: GitHub Issues Workflow (For Larger Projects)

**When to use GitHub Issues instead:**
- Project spans multiple weeks
- Multiple developers involved
- Requires external collaboration
- Needs milestone tracking
- Customer-facing feature

**Hybrid Approach:**
1. Start with project folder + docs (analysis, planning)
2. Promote major features to GitHub Issues
3. Link Issues in TODO.md: `- [ ] Implement X (see #123)`
4. Update both TODO.md AND Issue status
5. Reference Issues in commits: `fixes #123`

**GitHub Issue Template:**
```markdown
## Summary
{One-line description}

## Analysis
See [analysis doc](link to 01_ANALYSIS.md in repo)

## Implementation Plan
- [ ] Step 1
- [ ] Step 2

## Acceptance Criteria
- [ ] Criterion 1
- [ ] Tests pass

**Related Project:** `projects/{project-name}/`
```

---

## ‚ö†Ô∏è CRITICAL RULES FOR AGENTS

### DO:
‚úÖ Always create all 4 required markdown files  
‚úÖ Update TODO.md after EVERY task  
‚úÖ Update PROGRESS.md with timestamps  
‚úÖ Cross-link documents at the top  
‚úÖ Ask for clarification when requirements unclear  
‚úÖ Run tests after each implementation step  
‚úÖ Commit frequently with descriptive messages  
‚úÖ Move completed projects to docs/internal_documentation/completed/  

### DON'T:
‚ùå Skip the analysis phase  
‚ùå Start coding before creating TODO.md  
‚ùå Forget to update progress after completing tasks  
‚ùå Mix multiple unrelated changes in one commit  
‚ùå Leave projects in limbo (mark as complete or cancelled)  
‚ùå Delete project folders (move to completed or archive)  

---

## üìä Project Status Values

Use these EXACT status indicators:

| Status | Icon | When to Use |
|--------|------|-------------|
| In Progress | üöß | Active development |
| Complete | ‚úÖ | All success criteria met, tests passing |
| Blocked | ‚è∏Ô∏è | Waiting on external dependency |
| Cancelled | ‚ùå | Project abandoned/superseded |
| On Hold | üî∂ | Temporarily paused |

---

## üì¶ Completion Checklist

Before moving a project to `completed/`, follow this detailed workflow:

### 1Ô∏è‚É£ Code Integration
- [ ] All tasks in TODO.md marked complete
- [ ] All tests passing (run full test suite)
- [ ] Code reviewed for quality, style consistency
- [ ] Type hints added/verified (run mypy if applicable)
- [ ] Error handling implemented

### 2Ô∏è‚É£ Test Suite Integration ‚ö†Ô∏è CRITICAL
- [ ] **Move tests to active suite**: Copy tests from `projects/{name}/tests/` to appropriate `tests/` directory
  - Unit tests ‚Üí `tests/cross_cutting/` or `tests/domains/{domain}/`
  - Integration tests ‚Üí `tests/integration/`
  - Client tests ‚Üí `tests/client/`
- [ ] **Verify discovery**: Run `pytest --collect-only -q | Measure-Object -Line` to confirm tests are found
- [ ] **Run new tests**: Execute `pytest tests/{path}/test_{name}.py -v` and verify all pass
- [ ] **Update test count**: Document new test count in PROGRESS.md and CHANGELOG.md
- [ ] **Delete project tests folder**: Remove `projects/{name}/tests/` after successful move (avoid duplication)

### 3Ô∏è‚É£ Documentation Updates
- [ ] **Main README.md**: Add feature to main project README if user-facing
- [ ] **API Documentation**: Update relevant docstrings if API changed
- [ ] **Guides**: Create or update guide in `docs/guides/` for new features
  - Use existing guides as templates (see `docs/guides/sync-vs-async.md`)
  - Include: Overview, usage examples, configuration, troubleshooting
- [ ] **Domain Health Docs**: Update domain-specific docs if applicable (`docs/domain_health/`)
- [ ] **Migration Guides**: If breaking changes, add section to MIGRATION.md
- [ ] **Internal Docs**: Update architecture reviews if structure changed

### 4Ô∏è‚É£ Examples Integration
- [ ] **Check for project examples**: Look in `projects/{name}/examples/` or `projects/{name}/scripts/`
- [ ] **Move to examples/**: Copy useful examples to appropriate `examples/` subdirectory
  - Analytics examples ‚Üí `examples/analytics/`
  - Report examples ‚Üí `examples/report/`
  - General usage ‚Üí `examples/` (root)
- [ ] **Update example README**: Add new example to `examples/README.md` catalog
- [ ] **Verify examples run**: Test each example script executes without errors
- [ ] **Add docstrings**: Ensure examples have clear documentation

### 5Ô∏è‚É£ Changelog Updates ‚ö†Ô∏è CRITICAL
- [ ] **Update CHANGELOG.md**: Add entry under `## [Unreleased]` section
  - Use semantic categories: Added, Changed, Deprecated, Removed, Fixed, Security, Improved
  - Follow existing format (see CHANGELOG.md for examples)
  - Include: feature name, brief description, key capabilities (as bullet list)
  - Mention test count increase if significant
  - Example format:
    ```markdown
    ### Added
    - **Feature Name**: Brief description
      - **Capability 1**: Details
      - **Capability 2**: Details
      - **Tests**: X new tests added
    ```
- [ ] **Check MIGRATION.md**: If breaking changes, add migration section with examples
- [ ] **Document version**: Note target version if known (e.g., will be in 0.2.0b4)

### 6Ô∏è‚É£ Project Cleanup
- [ ] **Archive project tests**: After moving to test suite, delete `projects/{name}/tests/`
- [ ] **Archive project examples**: After moving to examples/, delete `projects/{name}/examples/`
- [ ] **Keep documentation**: Preserve README, ANALYSIS, PLAN, PROGRESS, TODO for reference
- [ ] **Create COMPLETION_SUMMARY.md**: Final stats document
  ```markdown
  # Completion Summary: {Project Name}
  
  **Completed:** {Date}
  **Duration:** {Days/Weeks}
  **Total Effort:** {Hours estimate}
  
  ## Deliverables
  - Source Files Modified: {count} files
  - Tests Added: {count} tests (all passing)
  - Documentation: {list docs created/updated}
  - Examples: {list examples created}
  
  ## Test Results
  - Total Tests: {count} (up from {previous count})
  - New Tests: {count}
  - All Passing: ‚úÖ
  
  ## Key Achievements
  - {Achievement 1}
  - {Achievement 2}
  
  ## Known Limitations
  - {Limitation 1, if any}
  
  ## Future Work
  - {Future enhancement ideas}
  ```

### 7Ô∏è‚É£ Final Verification
- [ ] **Run full test suite**: `pytest` (all tests must pass)
- [ ] **Check for errors**: `get_errors()` or language-specific linting
- [ ] **Verify examples**: Run 2-3 key examples to ensure they work
- [ ] **Review git status**: No unintended changes or leftover files
- [ ] **Update README.md status**: Change to "‚úÖ Complete"

### 8Ô∏è‚É£ Commit and Archive
- [ ] **Commit all changes**: Descriptive commit message with scope
  ```bash
  git add -A
  git commit -m "feat(scope): Brief description

  - Detailed change 1
  - Detailed change 2
  - Tests: X new tests, all passing
  - Docs: Updated guides and examples"
  ```
- [ ] **Push to remote**: `git push`
- [ ] **Move project folder**: 
  ```bash
  mv projects/{name}/ docs/internal_documentation/completed/{quarter}/{name}.project/
  ```
- [ ] **Update projects/README.md**: Remove from active projects list
- [ ] **Final commit**: Commit the project move
  ```bash
  git add -A
  git commit -m "docs: Archive {project-name} to completed/{quarter}"
  git push
  ```

---

## üéØ Quick Completion Workflow

**TL;DR - Essential Steps:**
1. ‚úÖ All tests passing
2. üìã Move tests from `projects/{name}/tests/` ‚Üí `tests/`
3. üìñ Move examples from `projects/{name}/examples/` ‚Üí `examples/`
4. üìù Update CHANGELOG.md under `[Unreleased]`
5. üóëÔ∏è Delete project `tests/` and `examples/` folders (already moved)
6. üìÑ Create COMPLETION_SUMMARY.md
7. üíæ Commit, push, move to `completed/{quarter}/`

**Time estimate:** 30-60 minutes for proper completion workflow

---

## üéØ Example: Complete Project Lifecycle

```bash
# 1. User requests feature
User: "Add support for custom validators in report steps"

# 2. Agent creates structure
Agent creates: projects/custom_validators/
  - README.md (status: üöß In Progress)
  - 01_ANALYSIS.md (requirements, constraints, research)
  - 02_IMPLEMENTATION_PLAN.md (3 phases, 8 steps)
  - 03_PROGRESS.md (empty, ready to track)
  - 04_TODO.md (8 tasks, all üß† Planned)

# 3. Agent works through plan
Agent implements Phase 1, Step 1:
  - Updates TODO.md: marks task üöß
  - Implements code in src/pywats/domains/report/validators.py
  - Updates PROGRESS.md: "‚úÖ Created Validator base class"
  - Updates TODO.md: marks task ‚úÖ
  - Runs tests: 5/5 passing

# 4. Agent completes project
Agent finishes all 8 tasks:
  - Updates README.md: status = "‚úÖ Complete"
  - Creates COMPLETION_SUMMARY.md
  - Moves to: docs/internal_documentation/completed/2026-q1/custom_validators/
  - Commits: "feat(validators): Add custom validator support"
  - Pushes to GitHub
```

---

## üÜò Troubleshooting

**Q: User request is vague?**  
A: Create analysis doc, document assumptions, ask clarifying questions before implementation plan.

**Q: Project grows too large?**  
A: Break into multiple sub-projects or promote to GitHub Issues workflow.

**Q: Need to pause project?**  
A: Update README status to "üî∂ On Hold", document reason, commit changes.

**Q: Project cancelled mid-way?**  
A: Update README status to "‚ùå Cancelled", document why, move to archive/.

---

**Last Updated:** February 1, 2026  
**Version:** 1.0
