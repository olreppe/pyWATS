<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pyWATS Documentation</title>
    <style>
        /* Reset and base */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        
        /* Typography */
        h1 {
            color: #1a5276;
            border-bottom: 3px solid #1a5276;
            padding-bottom: 10px;
            margin-top: 40px;
            page-break-before: always;
        }
        
        h1:first-of-type {
            page-break-before: avoid;
        }
        
        h2 {
            color: #2874a6;
            border-bottom: 1px solid #2874a6;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        
        h3 {
            color: #3498db;
            margin-top: 25px;
        }
        
        h4, h5, h6 {
            color: #555;
            margin-top: 20px;
        }
        
        /* Cover page */
        .cover {
            text-align: center;
            padding: 100px 20px;
            page-break-after: always;
        }
        
        .cover h1 {
            font-size: 3em;
            border: none;
            margin-bottom: 20px;
            page-break-before: avoid;
        }
        
        .cover .subtitle {
            font-size: 1.5em;
            color: #666;
            margin-bottom: 40px;
        }
        
        .cover .version {
            font-size: 1.2em;
            color: #888;
        }
        
        .cover .date {
            margin-top: 60px;
            color: #999;
        }
        
        /* Table of Contents */
        .toc {
            page-break-after: always;
        }
        
        .toc h2 {
            border: none;
            text-align: center;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc > ul > li {
            margin: 15px 0;
        }
        
        .toc > ul > li > a {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .toc ul ul {
            padding-left: 25px;
            margin-top: 5px;
        }
        
        .toc ul ul li {
            margin: 5px 0;
        }
        
        .toc a {
            color: #2874a6;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        /* Section dividers */
        .section-header {
            background: #1a5276;
            color: white;
            padding: 30px;
            margin: 40px -20px;
            text-align: center;
            page-break-before: always;
        }
        
        .section-header h1 {
            color: white;
            border: none;
            margin: 0;
            page-break-before: avoid;
        }
        
        /* Code blocks */
        pre {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        /* Tables */
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            font-size: 0.95em;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px 12px;
            text-align: left;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1a5276;
        }
        
        tr:nth-child(even) {
            background: #fafafa;
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid #3498db;
            margin: 20px 0;
            padding: 10px 20px;
            background: #f8f9fa;
            color: #555;
        }
        
        /* Links */
        a {
            color: #2874a6;
        }
        
        /* Lists */
        ul, ol {
            padding-left: 25px;
        }
        
        li {
            margin: 5px 0;
        }
        
        /* Images */
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Horizontal rule */
        hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 30px 0;
        }
        
        /* Document separator */
        .doc-separator {
            border-top: 2px dashed #ccc;
            margin: 40px 0;
            padding-top: 20px;
        }
        
        .doc-source {
            color: #999;
            font-size: 0.8em;
            font-style: italic;
            margin-bottom: 20px;
        }
        
        /* Print styles */
        @media print {
            body {
                max-width: none;
                padding: 0;
                font-size: 11pt;
            }
            
            pre {
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            
            .section-header {
                margin: 0;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            a {
                color: #333;
                text-decoration: none;
            }
            
            h1, h2, h3, h4 {
                page-break-after: avoid;
            }
            
            pre, table, blockquote {
                page-break-inside: avoid;
            }
        }
        
        /* Syntax highlighting basic */
        .highlight .k { color: #008000; font-weight: bold; }
        .highlight .s { color: #ba2121; }
        .highlight .c { color: #408080; font-style: italic; }
        .highlight .n { color: #333; }
        .highlight .o { color: #666; }

    </style>
</head>
<body>
    <!-- Cover Page -->
    <div class="cover">
        <h1>pyWATS</h1>
        <div class="subtitle">Python API for WATS Test Data Management</div>
        <div class="version">Official Documentation</div>
        <div class="date">Generated: 2026-01-26</div>
    </div>
    
    <!-- Table of Contents -->
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#introduction-overview">Overview</a></li>
</ul>
</li>
<li><a href="#getting-started">Getting Started</a>
<ul>
<li><a href="#getting-started-getting-started">Getting Started</a></li>
<li><a href="#getting-started-quick-reference">Quick Reference</a></li>
</ul>
</li>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#installation-overview">Overview</a></li>
<li><a href="#installation-api">Api</a></li>
<li><a href="#installation-client">Client</a></li>
<li><a href="#installation-gui">Gui</a></li>
<li><a href="#installation-docker">Docker</a></li>
<li><a href="#installation-windows-service">Windows Service</a></li>
<li><a href="#installation-linux-service">Linux Service</a></li>
<li><a href="#installation-macos-service">Macos Service</a></li>
</ul>
</li>
<li><a href="#architecture">Architecture</a>
<ul>
<li><a href="#architecture-architecture">Architecture</a></li>
<li><a href="#architecture-client-architecture">Client Architecture</a></li>
<li><a href="#architecture-integration-patterns">Integration Patterns</a></li>
</ul>
</li>
<li><a href="#domain-modules">Domain Modules</a>
<ul>
<li><a href="#domain-modules-overview">Overview</a></li>
<li><a href="#domain-modules-report">Report</a></li>
<li><a href="#domain-modules-asset">Asset</a></li>
<li><a href="#domain-modules-process">Process</a></li>
<li><a href="#domain-modules-product">Product</a></li>
<li><a href="#domain-modules-production">Production</a></li>
<li><a href="#domain-modules-analytics">Analytics</a></li>
<li><a href="#domain-modules-rootcause">Rootcause</a></li>
<li><a href="#domain-modules-software">Software</a></li>
<li><a href="#domain-modules-scim">Scim</a></li>
<li><a href="#domain-modules-events">Events</a></li>
</ul>
</li>
<li><a href="#usage-guides">Usage Guides</a>
<ul>
<li><a href="#usage-guides-report-module">Report Module</a></li>
<li><a href="#usage-guides-report-builder">Report Builder</a></li>
<li><a href="#usage-guides-asset-module">Asset Module</a></li>
<li><a href="#usage-guides-process-module">Process Module</a></li>
<li><a href="#usage-guides-product-module">Product Module</a></li>
<li><a href="#usage-guides-production-module">Production Module</a></li>
<li><a href="#usage-guides-rootcause-module">Rootcause Module</a></li>
<li><a href="#usage-guides-software-module">Software Module</a></li>
<li><a href="#usage-guides-box-build-guide">Box Build Guide</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a>
<ul>
<li><a href="#reference-env-variables">Env Variables</a></li>
<li><a href="#reference-error-catalog">Error Catalog</a></li>
<li><a href="#reference-wats-domain-knowledge">Wats Domain Knowledge</a></li>
<li><a href="#reference-llm-converter-guide">Llm Converter Guide</a></li>
</ul>
</li>
</ul>
    </div>
    
    <!-- Content -->
    
<div class="section-header" id="introduction">
    <h1>Introduction</h1>
</div>


<div class="doc-separator" id="introduction-overview">
    <div class="doc-source">Source: docs/README.md</div>
    <h1 id="documentation-folder-structure">Documentation Folder Structure</h1>
<p>This folder contains <strong>official, user-facing documentation</strong> that ships with <code>pip install pywats-api</code>.</p>
<h2 id="published-documentation-in-this-folder">üìö Published Documentation (in this folder)</h2>
<h3 id="getting-started">Getting Started</h3>
<ul>
<li><strong><a href="getting-started.md">getting-started.md</a></strong> - Complete installation, configuration, logging, and error handling guide</li>
<li><strong><a href="INDEX.md">INDEX.md</a></strong> - Documentation index and navigation</li>
</ul>
<h3 id="installation-guides">Installation Guides</h3>
<p>Choose by component and use case:</p>
<ul>
<li><strong><a href="installation/">installation/</a></strong> - Installation overview with decision tree</li>
<li><strong><a href="installation/api.md">installation/api.md</a></strong> - Python SDK only</li>
<li><strong><a href="installation/client.md">installation/client.md</a></strong> - Client service with queue</li>
<li><strong><a href="installation/gui.md">installation/gui.md</a></strong> - Desktop GUI application</li>
<li><strong><a href="installation/docker.md">installation/docker.md</a></strong> - Container deployment</li>
<li><strong><a href="installation/windows-service.md">installation/windows-service.md</a></strong> - Windows service</li>
<li><strong><a href="installation/linux-service.md">installation/linux-service.md</a></strong> - Linux systemd</li>
<li><strong><a href="installation/macos-service.md">installation/macos-service.md</a></strong> - macOS launchd</li>
</ul>
<h3 id="domain-api-documentation">Domain API Documentation</h3>
<p>These files are included in the PyPI package:</p>
<ul>
<li><strong><a href="modules/product.md">modules/product.md</a></strong> - Product domain API reference</li>
<li><strong><a href="modules/asset.md">modules/asset.md</a></strong> - Asset domain API reference</li>
<li><strong><a href="modules/production.md">modules/production.md</a></strong> - Production domain API reference</li>
<li><strong><a href="modules/report.md">modules/report.md</a></strong> - Report domain API reference</li>
<li><strong><a href="modules/analytics.md">modules/analytics.md</a></strong> - Analytics domain API reference</li>
<li><strong><a href="modules/software.md">modules/software.md</a></strong> - Software domain API reference</li>
<li><strong><a href="modules/rootcause.md">modules/rootcause.md</a></strong> - RootCause domain API reference</li>
<li><strong><a href="modules/process.md">modules/process.md</a></strong> - Process domain API reference</li>
</ul>
<h3 id="module-usage-guides">Module Usage Guides</h3>
<p>Detailed guides with comprehensive examples:</p>
<ul>
<li><strong><a href="usage/">usage/</a></strong> - Detailed module guides (report-module.md, product-module.md, etc.)</li>
<li>Detailed usage patterns</li>
<li>Advanced examples</li>
<li>Factory method documentation</li>
</ul>
<h3 id="documentation-examples">Documentation Examples</h3>
<p>Code snippets and examples embedded in documentation:</p>
<ul>
<li><strong><a href="examples/">examples/</a></strong> - Example code referenced in documentation</li>
<li><code>basic_usage.py</code> - Getting started example</li>
</ul>
<h2 id="internal-documentation-not-published">üîí Internal Documentation (NOT published)</h2>
<p>The following folders are <strong>excluded from the pip package</strong> and only available in the GitHub repository:</p>
<ul>
<li><code>internal_documentation/</code> - Architecture, design docs, AI agent knowledge, internal guides</li>
<li><code>domain_health/</code> - Domain health tracking and scoring (maintainer use only)</li>
</ul>
<p>These folders are for internal development use only.</p>
<h2 id="folder-structure">üìÅ Folder Structure</h2>
<div class="codehilite"><pre><span></span><code>docs/
‚îú‚îÄ‚îÄ INDEX.md              ‚úÖ Published - Documentation index
‚îú‚îÄ‚îÄ README.md             ‚úÖ Published - This file
‚îú‚îÄ‚îÄ getting-started.md    ‚úÖ Published - Getting started guide
‚îú‚îÄ‚îÄ architecture.md       ‚úÖ Published - System architecture
‚îú‚îÄ‚îÄ error-catalog.md      ‚úÖ Published - Error reference
‚îú‚îÄ‚îÄ modules/              ‚úÖ Published - Domain API docs
‚îÇ   ‚îú‚îÄ‚îÄ product.md
‚îÇ   ‚îú‚îÄ‚îÄ asset.md
‚îÇ   ‚îú‚îÄ‚îÄ report.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ usage/                ‚úÖ Published - Detailed module guides
‚îÇ   ‚îú‚îÄ‚îÄ report-module.md
‚îÇ   ‚îú‚îÄ‚îÄ product-module.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ installation/         ‚úÖ Published - Installation guides
‚îÇ   ‚îú‚îÄ‚îÄ client.md
‚îÇ   ‚îú‚îÄ‚îÄ docker.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ internal_documentation/  ‚ùå NOT Published - Internal docs
‚îÇ   ‚îú‚îÄ‚îÄ archived/
‚îÇ   ‚îú‚îÄ‚îÄ WIP/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ domain_health/        ‚ùå NOT Published - Health tracking
</code></pre></div>

<h2 id="rule-of-thumb">‚úÖ Rule of Thumb</h2>
<ul>
<li><strong>Files/folders in <code>docs/</code> root</strong> ‚Üí Published with pip package</li>
<li><strong>Folders: <code>usage/</code>, <code>modules/</code>, <code>installation/</code></strong> ‚Üí Published (user-facing)</li>
<li><strong>Folders: <code>internal_documentation/</code>, <code>domain_health/</code></strong> ‚Üí NOT Published (GitHub only)</li>
</ul>
<h2 id="moving-documents">üîÑ Moving Documents</h2>
<p>When creating new documentation:</p>
<ul>
<li><strong>User-facing API docs</strong> ‚Üí Put in <code>docs/modules/</code></li>
<li><strong>Detailed usage guides</strong> ‚Üí Put in <code>docs/usage/</code></li>
<li><strong>Installation guides</strong> ‚Üí Put in <code>docs/installation/</code></li>
<li><strong>Internal architecture/design</strong> ‚Üí Put in <code>docs/internal_documentation/</code></li>
</ul>
<h2 id="packaging">üì¶ Packaging</h2>
<p>Controlled by <code>MANIFEST.in</code> in the project root:<br />
- <strong>Includes:</strong> <code>docs/*.md</code>, <code>docs/usage/</code>, <code>docs/modules/</code>, <code>docs/installation/</code><br />
- <strong>Excludes:</strong> <code>docs/internal_documentation/</code>, <code>docs/domain_health/</code></p>
</div>


<div class="section-header" id="getting-started">
    <h1>Getting Started</h1>
</div>


<div class="doc-separator" id="getting-started-getting-started">
    <div class="doc-source">Source: docs/getting-started.md</div>
    <h1 id="getting-started-guide">Getting Started Guide</h1>
<p>Complete guide to installing, configuring, and initializing pyWATS.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#api-initialization">API Initialization</a></li>
<li><a href="#async-usage">Async Usage</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#logging-configuration">Logging Configuration</a></li>
<li><a href="#exception-handling">Exception Handling</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#internal-api-usage">Internal API Usage</a></li>
<li><a href="#client-installation">Client Installation</a></li>
<li><a href="#batch-operations--pagination">Batch Operations &amp; Pagination</a></li>
</ul>
<hr />
<h2 id="installation">Installation</h2>
<h3 id="library-only-api-access">Library Only (API Access)</h3>
<p>For Python scripts and applications using the WATS API:</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api
</code></pre></div>

<h3 id="with-gui-client">With GUI Client</h3>
<p>For desktop applications with Qt-based GUI (Windows, macOS, Linux):</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>
</code></pre></div>

<h3 id="headless-client">Headless Client</h3>
<p>For servers, Raspberry Pi, and embedded systems (no Qt/GUI):</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client-headless<span class="o">]</span>
</code></pre></div>

<h3 id="development-installation">Development Installation</h3>
<p>From source for development:</p>
<div class="codehilite"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/olreppe/pyWATS.git
<span class="nb">cd</span><span class="w"> </span>pyWATS
python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate<span class="w">  </span><span class="c1"># Linux/Mac</span>
.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate<span class="w">     </span><span class="c1"># Windows</span>
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;.[dev]&quot;</span>
</code></pre></div>

<hr />
<h2 id="api-initialization">API Initialization</h2>
<h3 id="basic-initialization">Basic Initialization</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize with credentials</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_base64_token&quot;</span>  <span class="c1"># Base64 of &quot;username:password&quot;</span>
<span class="p">)</span>

<span class="c1"># Test connection</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">test_connection</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected! Server version: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="using-environment-variables">Using Environment Variables</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Set environment variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;WATS_BASE_URL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://your-wats-server.com&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;WATS_AUTH_TOKEN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;your_base64_token&#39;</span>

<span class="c1"># Initialize from environment</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">()</span>  <span class="c1"># Automatically reads from environment</span>
</code></pre></div>

<p>Or create a <code>.env</code> file:</p>
<div class="codehilite"><pre><span></span><code>WATS_BASE_URL=https://your-wats-server.com
WATS_AUTH_TOKEN=your_base64_token
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">load_dotenv</span><span class="p">()</span>  <span class="c1"># Load from .env file</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">()</span>
</code></pre></div>

<h3 id="configuration-options">Configuration Options</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">RetryConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorMode</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>

    <span class="c1"># Optional: Custom timeout (default: 30 seconds)</span>
    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>

    <span class="c1"># Optional: Process cache refresh interval (default: 300 seconds)</span>
    <span class="n">process_refresh_interval</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>

    <span class="c1"># Optional: Error handling mode (default: STRICT)</span>
    <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span><span class="p">,</span>  <span class="c1"># or ErrorMode.LENIENT</span>

    <span class="c1"># Optional: Retry configuration (default: enabled with 3 attempts)</span>
    <span class="n">retry_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set to False to disable</span>
    <span class="c1"># Or for advanced configuration:</span>
    <span class="c1"># retry_config=RetryConfig(max_attempts=5, base_delay=2.0)</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="automatic-retry">Automatic Retry</h3>
<p>The library automatically retries requests that fail due to transient errors:</p>
<ul>
<li><strong>Connection errors</strong> - Network unavailable, DNS failures</li>
<li><strong>Timeout errors</strong> - Server took too long to respond</li>
<li><strong>HTTP 429</strong> - Too Many Requests (respects <code>Retry-After</code> header)</li>
<li><strong>HTTP 500/502/503/504</strong> - Server errors, often transient during deployments</li>
</ul>
<p>Retry uses <strong>exponential backoff with jitter</strong> to avoid thundering herd:</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Delay (approx)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0-1 second</td>
</tr>
<tr>
<td>2</td>
<td>0-2 seconds</td>
</tr>
<tr>
<td>3</td>
<td>0-4 seconds</td>
</tr>
<tr>
<td>(fail)</td>
<td>Exception raised</td>
</tr>
</tbody>
</table>
<p><strong>Important:</strong> Only idempotent methods (GET, PUT, DELETE) are retried. POST is never retried automatically to prevent duplicate creates.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">RetryConfig</span>

<span class="c1"># Disable retry entirely</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">retry_enabled</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Custom retry configuration</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">RetryConfig</span><span class="p">(</span>
    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>      <span class="c1"># Try up to 5 times</span>
    <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>      <span class="c1"># Start with 2 second delay</span>
    <span class="n">max_delay</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>      <span class="c1"># Cap delay at 60 seconds</span>
    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Add randomness to avoid thundering herd</span>
<span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">retry_config</span><span class="o">=</span><span class="n">config</span>
<span class="p">)</span>

<span class="c1"># Check retry statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">retry_config</span><span class="o">.</span><span class="n">stats</span><span class="p">)</span>
<span class="c1"># {&#39;total_retries&#39;: 3, &#39;total_retry_time&#39;: 4.5}</span>
</code></pre></div>

<h3 id="error-handling-modes">Error Handling Modes</h3>
<p>The library supports two error handling modes that control how missing data and 404 responses are handled:</p>
<h4 id="strict-mode-default-recommended-for-production">STRICT Mode (Default - Recommended for Production)</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorMode</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>
    <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span>  <span class="c1"># Default, can be omitted</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Behavior:</strong><br />
- <strong>404 errors</strong> ‚Üí Raises <code>NotFoundError</code><br />
- <strong>Empty responses</strong> (200 with no data) ‚Üí Raises <code>EmptyResponseError</code><br />
- <strong>All 4xx/5xx errors</strong> ‚Üí Raises appropriate exception<br />
- <strong>If no exception</strong> ‚Üí You have valid data (guaranteed)</p>
<p><strong>Use STRICT when:</strong><br />
- Writing production code that needs certainty<br />
- Validating data existence<br />
- Critical operations where failures must be explicit<br />
- You want type safety (no None checks needed)</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotFoundError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
    <span class="c1"># If we reach here, product is DEFINITELY valid</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product doesn&#39;t exist - handle explicitly&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="lenient-mode-recommended-for-scriptsexploration">LENIENT Mode (Recommended for Scripts/Exploration)</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorMode</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>
    <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">LENIENT</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Behavior:</strong><br />
- <strong>404 errors</strong> ‚Üí Returns <code>None</code> (no exception)<br />
- <strong>Empty responses</strong> ‚Üí Returns <code>None</code> (no exception)<br />
- <strong>Actual errors</strong> (5xx, 400, 401, 403, 409) ‚Üí Still raises exceptions<br />
- <strong>Must check for None</strong> before using returned data</p>
<p><strong>Use LENIENT when:</strong><br />
- Writing exploratory scripts<br />
- Querying optional data<br />
- Batch processing where some items may not exist<br />
- You want simpler code with less try/except boilerplate</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Simpler code - no try/except needed for missing data</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product doesn&#39;t exist&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="mode-comparison">Mode Comparison</h4>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>STRICT Mode</th>
<th>LENIENT Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>404 Response</strong></td>
<td>Raises <code>NotFoundError</code></td>
<td>Returns <code>None</code></td>
</tr>
<tr>
<td><strong>Empty Response</strong></td>
<td>Raises <code>EmptyResponseError</code></td>
<td>Returns <code>None</code></td>
</tr>
<tr>
<td><strong>Server Error (5xx)</strong></td>
<td>Raises <code>ServerError</code></td>
<td>Raises <code>ServerError</code></td>
</tr>
<tr>
<td><strong>Validation Error (400)</strong></td>
<td>Raises <code>ValidationError</code></td>
<td>Raises <code>ValidationError</code></td>
</tr>
<tr>
<td><strong>Auth Error (401)</strong></td>
<td>Raises <code>AuthenticationError</code></td>
<td>Raises <code>AuthenticationError</code></td>
</tr>
<tr>
<td><strong>Permission Error (403)</strong></td>
<td>Raises <code>AuthorizationError</code></td>
<td>Raises <code>AuthorizationError</code></td>
</tr>
<tr>
<td><strong>Conflict (409)</strong></td>
<td>Raises <code>ConflictError</code></td>
<td>Raises <code>ConflictError</code></td>
</tr>
<tr>
<td><strong>Return Type</strong></td>
<td><code>Model</code> or raises</td>
<td><code>Model | None</code></td>
</tr>
<tr>
<td><strong>None Checks</strong></td>
<td>Not needed</td>
<td>Required</td>
</tr>
<tr>
<td><strong>Best For</strong></td>
<td>Production code</td>
<td>Scripts/exploration</td>
</tr>
</tbody>
</table>
<h4 id="choosing-the-right-mode">Choosing the Right Mode</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Production code - use STRICT for explicit error handling</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorMode</span>

<span class="n">api_prod</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api_prod</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>
    <span class="c1"># Guaranteed to have valid product here</span>
    <span class="n">process_product</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">log_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product not found: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">send_alert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">log_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Exploratory script - use LENIENT for simpler code</span>
<span class="n">api_explore</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">LENIENT</span><span class="p">)</span>

<span class="k">for</span> <span class="n">part_number</span> <span class="ow">in</span> <span class="n">candidate_parts</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api_explore</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">product</span><span class="p">:</span>  <span class="c1"># Simple None check</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Missing products are silently skipped</span>
</code></pre></div>

<h3 id="station-configuration">Station Configuration</h3>
<p>Configure test station identity:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">Station</span><span class="p">,</span> <span class="n">StationConfig</span><span class="p">,</span> <span class="n">Purpose</span>

<span class="c1"># Configure station</span>
<span class="n">station</span> <span class="o">=</span> <span class="n">Station</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">StationConfig</span><span class="p">(</span>
        <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;ICT-01&quot;</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Production Line A&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Initialize with station</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>
    <span class="n">station</span><span class="o">=</span><span class="n">station</span>
<span class="p">)</span>

<span class="c1"># Station is automatically used in reports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools.test_uut</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestUUT</span>

<span class="n">uut</span> <span class="o">=</span> <span class="n">TestUUT</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
    <span class="n">purpose</span><span class="o">=</span><span class="n">Purpose</span><span class="o">.</span><span class="n">TEST</span>  <span class="c1"># or 10</span>
<span class="p">)</span>
<span class="c1"># Station info automatically filled from api.station</span>
</code></pre></div>

<hr />
<h2 id="async-usage">Async Usage</h2>
<p>pyWATS supports both synchronous and asynchronous usage patterns. The library is designed <br />
with an <strong>async-first architecture</strong> where all business logic lives in async services, <br />
and sync services are thin wrappers.</p>
<h3 id="synchronous-usage-default">Synchronous Usage (Default)</h3>
<p>The standard synchronous API is the easiest way to use pyWATS:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="c1"># Synchronous calls - simple and blocking</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For high-performance applications, use the async API directly:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Create async client</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Async calls - non-blocking</span>
        <span class="n">products</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

        <span class="c1"># Concurrent requests</span>
        <span class="n">product</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<h3 id="using-run_sync-for-mixed-code">Using run_sync() for Mixed Code</h3>
<p>When you have async code but need to call it from sync context:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.sync_runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_sync</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>

<span class="c1"># Call async code from sync context</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">run_sync</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">())</span>
</code></pre></div>

<h3 id="service-architecture">Service Architecture</h3>
<p>All domains follow the same pattern:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AsyncXxxService</code></td>
<td>Source of truth - all business logic</td>
</tr>
<tr>
<td><code>XxxService</code></td>
<td>Thin sync wrapper using <code>run_sync()</code></td>
</tr>
<tr>
<td><code>AsyncXxxRepository</code></td>
<td>Async data access layer</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1"># Both use the same underlying logic</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product.service</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductService</span>           <span class="c1"># Sync</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product.async_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProductService</span>  <span class="c1"># Async</span>
</code></pre></div>

<hr />
<h2 id="authentication">Authentication</h2>
<h3 id="token-generation">Token Generation</h3>
<p>pyWATS uses Base64-encoded credentials:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;your_username&quot;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;your_password&quot;</span>

<span class="c1"># Create token</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="using-in-api">Using in API</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="n">token</span>  <span class="c1"># Use generated token</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="token-security">Token Security</h3>
<p><strong>Best Practices:</strong></p>
<ol>
<li><strong>Never hardcode credentials</strong> in source code</li>
<li><strong>Use environment variables</strong> for production</li>
<li><strong>Use .env files</strong> for development (add to .gitignore)</li>
<li><strong>Rotate tokens</strong> regularly</li>
<li><strong>Use separate tokens</strong> for different environments</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚ùå DON&#39;T DO THIS</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;dXNlcjpwYXNz&quot;</span><span class="p">)</span>

<span class="c1"># ‚úÖ DO THIS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_BASE_URL&#39;</span><span class="p">),</span>
    <span class="n">token</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_AUTH_TOKEN&#39;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="logging-configuration">Logging Configuration</h2>
<h3 id="quick-debug-mode">Quick Debug Mode</h3>
<p>Enable detailed logging for troubleshooting:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">enable_debug_logging</span>

<span class="c1"># Enable debug logging before creating API instance</span>
<span class="n">enable_debug_logging</span><span class="p">()</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</code></pre></div>

<p>This shows:<br />
- HTTP requests and responses<br />
- API calls to WATS server<br />
- Data serialization/deserialization<br />
- Repository and service operations</p>
<h3 id="custom-logging-configuration">Custom Logging Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Configure logging your way</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;pywats.log&#39;</span><span class="p">),</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Set pyWATS logger to DEBUG</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pywats&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Or be more specific</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pywats.http_client&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pywats.domains.product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="log-levels">Log Levels</h3>
<table>
<thead>
<tr>
<th>Level</th>
<th>Use Case</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEBUG</td>
<td>Development, troubleshooting</td>
<td>All details including HTTP requests</td>
</tr>
<tr>
<td>INFO</td>
<td>Normal operation</td>
<td>Important operations and status</td>
</tr>
<tr>
<td>WARNING</td>
<td>Production monitoring</td>
<td>Warnings and potential issues</td>
</tr>
<tr>
<td>ERROR</td>
<td>Minimal logging</td>
<td>Errors only</td>
</tr>
</tbody>
</table>
<h3 id="example-log-output">Example Log Output</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">2026</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">08</span><span class="w"> </span><span class="mf">14</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">15</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pywats</span><span class="mf">.</span><span class="n">http_client</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kr">GET</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">wats</span><span class="mf">.</span><span class="n">example</span><span class="mf">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">Product</span><span class="o">/</span><span class="mf">1234</span>
<span class="mf">2026</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">08</span><span class="w"> </span><span class="mf">14</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">15</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pywats</span><span class="mf">.</span><span class="n">http_client</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Response</span><span class="p">:</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="n">OK</span><span class="w"> </span><span class="p">(</span><span class="mf">1234</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span>
<span class="mf">2026</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">08</span><span class="w"> </span><span class="mf">14</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">15</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pywats</span><span class="mf">.</span><span class="n">domains</span><span class="mf">.</span><span class="n">product</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Retrieved</span><span class="w"> </span><span class="n">product</span><span class="p">:</span><span class="w"> </span><span class="n">WIDGET</span><span class="o">-</span><span class="mf">001</span>
</code></pre></div>

<h3 id="disable-logging">Disable Logging</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="c1"># Disable all pyWATS logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pywats&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="exception-handling">Exception Handling</h2>
<h3 id="exception-hierarchy">Exception Hierarchy</h3>
<p>pyWATS provides a comprehensive exception hierarchy for precise error handling:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">PyWATSError</span><span class="w">                      </span>#<span class="w"> </span><span class="nv">Base</span><span class="w"> </span><span class="nv">exception</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">pyWATS</span><span class="w"> </span><span class="nv">errors</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">AuthenticationError</span><span class="w">          </span>#<span class="w"> </span><span class="nv">Authentication</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="ss">(</span><span class="mi">401</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">AuthorizationError</span><span class="w">           </span>#<span class="w"> </span><span class="nv">Permission</span><span class="w"> </span><span class="nv">denied</span><span class="w"> </span><span class="ss">(</span><span class="mi">403</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">NotFoundError</span><span class="w">                </span>#<span class="w"> </span><span class="nv">Resource</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">found</span><span class="w"> </span><span class="ss">(</span><span class="mi">404</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ValidationError</span><span class="w">              </span>#<span class="w"> </span><span class="nv">Invalid</span><span class="w"> </span><span class="nv">request</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="ss">(</span><span class="mi">400</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ConflictError</span><span class="w">                </span>#<span class="w"> </span><span class="nv">Resource</span><span class="w"> </span><span class="nv">conflict</span><span class="w"> </span><span class="ss">(</span><span class="mi">409</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">EmptyResponseError</span><span class="w">           </span>#<span class="w"> </span><span class="nv">Empty</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">STRICT</span><span class="w"> </span><span class="nv">mode</span><span class="w"> </span><span class="ss">(</span><span class="mi">200</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">data</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ServerError</span><span class="w">                  </span>#<span class="w"> </span><span class="nv">Server</span><span class="o">-</span><span class="nv">side</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="ss">(</span><span class="mi">5</span><span class="nv">xx</span><span class="ss">)</span>
‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ConnectionError</span><span class="w">              </span>#<span class="w"> </span><span class="nv">Network</span><span class="o">/</span><span class="nv">connection</span><span class="w"> </span><span class="nv">failure</span>
‚îî‚îÄ‚îÄ<span class="w"> </span><span class="nv">TimeoutError</span><span class="w">                 </span>#<span class="w"> </span><span class="nv">Request</span><span class="w"> </span><span class="nb">timeout</span>
</code></pre></div>

<p>All exceptions include:<br />
- <strong>message</strong>: Human-readable error description<br />
- <strong>operation</strong>: Name of the operation that failed (e.g., "get_product")<br />
- <strong>details</strong>: Additional context without HTTP internals<br />
- <strong>cause</strong>: Original exception if wrapping another error</p>
<h3 id="basic-error-handling">Basic Error Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">PyWATSError</span><span class="p">,</span> <span class="n">AuthenticationError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">AuthenticationError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid credentials - check your token&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WATS API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">operation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="comprehensive-exception-handling">Comprehensive Exception Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">pyWATS</span><span class="p">,</span> 
    <span class="n">AuthenticationError</span><span class="p">,</span>
    <span class="n">AuthorizationError</span><span class="p">,</span>
    <span class="n">NotFoundError</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">ConflictError</span><span class="p">,</span>
    <span class="n">EmptyResponseError</span><span class="p">,</span>
    <span class="n">ServerError</span><span class="p">,</span>
    <span class="ne">ConnectionError</span><span class="p">,</span>
    <span class="ne">TimeoutError</span><span class="p">,</span>
    <span class="n">PyWATSError</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">AuthenticationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 401 - Invalid credentials</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Verify token, re-authenticate</span>

<span class="k">except</span> <span class="n">AuthorizationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 403 - No permission</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permission denied: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Check user permissions, request access</span>

<span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 404 - Resource doesn&#39;t exist (STRICT mode only)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not found: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Verify identifier, create resource</span>

<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 400 - Invalid request data</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">field</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Field: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Value: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Fix input data, check API documentation</span>

<span class="k">except</span> <span class="n">ConflictError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 409 - Resource conflict</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflict: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Resolve conflict, retry with updated data</span>

<span class="k">except</span> <span class="n">EmptyResponseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 200 with empty body (STRICT mode only)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empty response: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Verify query parameters, switch to LENIENT mode</span>

<span class="k">except</span> <span class="n">ServerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 5xx - Server-side error</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Retry, contact support if persistent</span>

<span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Network failure</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection failed: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Check network, verify URL</span>

<span class="k">except</span> <span class="ne">TimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Request timeout</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request timed out: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Action: Increase timeout, check network</span>

<span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Catch-all for other errors</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WATS error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">operation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="error-mode-impact-on-exceptions">Error Mode Impact on Exceptions</h3>
<p>The <code>error_mode</code> parameter affects which exceptions are raised:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">NotFoundError</span><span class="p">,</span> <span class="n">EmptyResponseError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorMode</span>

<span class="c1"># STRICT mode - raises exceptions for missing data</span>
<span class="n">api_strict</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api_strict</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NotFoundError</span><span class="p">:</span>
    <span class="c1"># This WILL be raised in STRICT mode</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product not found&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api_strict</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;EMPTY-RESULT&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">EmptyResponseError</span><span class="p">:</span>
    <span class="c1"># This WILL be raised in STRICT mode</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Query returned no data&quot;</span><span class="p">)</span>

<span class="c1"># LENIENT mode - returns None for missing data</span>
<span class="n">api_lenient</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">LENIENT</span><span class="p">)</span>

<span class="n">product</span> <span class="o">=</span> <span class="n">api_lenient</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span>
<span class="c1"># Returns None - no NotFoundError raised</span>

<span class="k">if</span> <span class="n">product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product not found or empty&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Exception Matrix by Mode:</strong></p>
<table>
<thead>
<tr>
<th>Error Type</th>
<th>STRICT Mode</th>
<th>LENIENT Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>404 Not Found</td>
<td>Raises <code>NotFoundError</code></td>
<td>Returns <code>None</code></td>
</tr>
<tr>
<td>Empty Response</td>
<td>Raises <code>EmptyResponseError</code></td>
<td>Returns <code>None</code></td>
</tr>
<tr>
<td>400 Validation</td>
<td>Raises <code>ValidationError</code></td>
<td>Raises <code>ValidationError</code></td>
</tr>
<tr>
<td>401 Auth</td>
<td>Raises <code>AuthenticationError</code></td>
<td>Raises <code>AuthenticationError</code></td>
</tr>
<tr>
<td>403 Permission</td>
<td>Raises <code>AuthorizationError</code></td>
<td>Raises <code>AuthorizationError</code></td>
</tr>
<tr>
<td>409 Conflict</td>
<td>Raises <code>ConflictError</code></td>
<td>Raises <code>ConflictError</code></td>
</tr>
<tr>
<td>5xx Server Error</td>
<td>Raises <code>ServerError</code></td>
<td>Raises <code>ServerError</code></td>
</tr>
<tr>
<td>Network Failure</td>
<td>Raises <code>ConnectionError</code></td>
<td>Raises <code>ConnectionError</code></td>
</tr>
<tr>
<td>Timeout</td>
<td>Raises <code>TimeoutError</code></td>
<td>Raises <code>TimeoutError</code></td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1">### Retry Logic</span>

<span class="err">```</span><span class="n">python</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">ServerError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_product_with_retry</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get product with automatic retry on network errors&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">ServerError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span>  <span class="c1"># Exponential backoff</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retry </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2">s...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>  <span class="c1"># Re-raise on final attempt</span>

    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Use it</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">get_product_with_retry</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed after retries: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="validation-errors">Validation Errors</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools.test_uut</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestUUT</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Invalid data</span>
    <span class="n">uut</span> <span class="o">=</span> <span class="n">TestUUT</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty part number - will raise ValidationError</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
    <span class="p">)</span>

<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Handle gracefully - prompt user, use defaults, etc.</span>
</code></pre></div>

<hr />
<h2 id="client-installation">Client Installation</h2>
<h3 id="gui-client-desktop">GUI Client (Desktop)</h3>
<h4 id="prerequisites">Prerequisites</h4>
<ul>
<li>Python 3.10 or later</li>
<li>Qt6 support (Windows, macOS, Linux with display)</li>
</ul>
<h4 id="installation_1">Installation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install with client support</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Launch GUI</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client
</code></pre></div>

<p>Or from command line:</p>
<div class="codehilite"><pre><span></span><code>pywats-client
</code></pre></div>

<h4 id="first-time-setup">First-Time Setup</h4>
<ol>
<li>Launch the client</li>
<li>Go to <strong>Setup</strong> tab</li>
<li>Configure:</li>
<li>Server URL: <code>https://your-wats-server.com</code></li>
<li>API Token: Your Base64 token</li>
<li>Station Name: <code>YOUR-STATION-01</code></li>
<li>Click <strong>Save</strong></li>
<li>Click <strong>Test Connection</strong></li>
</ol>
<p>See <strong><a href="../src/pywats_client/GUI_CONFIGURATION.md">GUI Configuration Guide</a></strong> for detailed setup.</p>
<h4 id="using-the-file-menu">Using the File Menu</h4>
<p>The GUI includes helpful controls in the <strong>File</strong> menu:</p>
<p><strong>Restart GUI</strong> (Ctrl+R)<br />
- Restarts only the GUI application<br />
- Service continues running in the background<br />
- Configuration is reloaded automatically<br />
- Useful after GUI code changes during development</p>
<p><strong>Stop Service</strong> (Ctrl+Shift+S)<br />
- Sends stop command to the service process<br />
- Stops all file watching and converter workers<br />
- GUI remains open but shows [Disconnected] status<br />
- Useful before making service code changes</p>
<p><strong>Exit</strong> (Alt+F4)<br />
- Closes the GUI application<br />
- Service continues running if started separately</p>
<p><strong>Window Title Status:</strong><br />
- Shows <code>[Connected]</code> when service is running<br />
- Shows <code>[Disconnected]</code> when service is not reachable</p>
<hr />
<h3 id="headless-client-no-gui">Headless Client (No GUI)</h3>
<p>For servers, Raspberry Pi, and embedded systems.</p>
<h4 id="installation_2">Installation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install headless client (no Qt)</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client-headless<span class="o">]</span>
</code></pre></div>

<h4 id="initialize-configuration">Initialize Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Interactive setup</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>init

<span class="c1"># Or non-interactive</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--server-url<span class="w"> </span>https://wats.example.com<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--api-token<span class="w"> </span>YOUR_TOKEN<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--station-name<span class="w"> </span>RASPBERRY-PI-01<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--non-interactive
</code></pre></div>

<h4 id="test-connection">Test Connection</h4>
<div class="codehilite"><pre><span></span><code>pywats-client<span class="w"> </span>test-connection
</code></pre></div>

<h4 id="start-service">Start Service</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Foreground (for testing)</span>
pywats-client<span class="w"> </span>start

<span class="c1"># With HTTP API for remote management</span>
pywats-client<span class="w"> </span>start<span class="w"> </span>--api<span class="w"> </span>--api-port<span class="w"> </span><span class="m">8765</span>

<span class="c1"># As daemon (Linux/Unix)</span>
pywats-client<span class="w"> </span>start<span class="w"> </span>--daemon
</code></pre></div>

<h4 id="configuration-file">Configuration File</h4>
<p>Location:<br />
- <strong>Windows:</strong> <code>%APPDATA%\pyWATS_Client\config.json</code><br />
- <strong>Linux/Mac:</strong> <code>~/.config/pywats_client/config.json</code></p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;service_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;api_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RASPBERRY-PI-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;log_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="cli-commands">CLI Commands</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configuration</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>show
pywats-client<span class="w"> </span>config<span class="w"> </span>get<span class="w"> </span>station_name
pywats-client<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>log_level<span class="w"> </span>DEBUG

<span class="c1"># Service control</span>
pywats-client<span class="w"> </span>status
pywats-client<span class="w"> </span>start
pywats-client<span class="w"> </span>stop

<span class="c1"># Converters</span>
pywats-client<span class="w"> </span>converters<span class="w"> </span>list
pywats-client<span class="w"> </span>converters<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>my_converter
</code></pre></div>

<p>See <strong><a href="../src/pywats_client/control/HEADLESS_GUIDE.md">Headless Operation Guide</a></strong> for complete documentation.</p>
<hr />
<h2 id="complete-example">Complete Example</h2>
<p>Putting it all together:</p>
<div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Complete example of pyWATS initialization with logging and error handling</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">pyWATS</span><span class="p">,</span>
    <span class="n">enable_debug_logging</span><span class="p">,</span>
    <span class="n">PyWATSError</span><span class="p">,</span>
    <span class="n">AuthenticationError</span><span class="p">,</span>
    <span class="n">Station</span><span class="p">,</span>
    <span class="n">StationConfig</span><span class="p">,</span>
    <span class="n">Purpose</span>
<span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">initialize_api</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize pyWATS API with proper configuration&quot;&quot;&quot;</span>

    <span class="c1"># Load environment variables</span>
    <span class="n">load_dotenv</span><span class="p">()</span>

    <span class="c1"># Enable debug logging if in debug mode</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">enable_debug_logging</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Configure INFO level logging</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="c1"># Get credentials from environment</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_BASE_URL&#39;</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_AUTH_TOKEN&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;WATS_BASE_URL and WATS_AUTH_TOKEN must be set&quot;</span><span class="p">)</span>

    <span class="c1"># Configure station</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">Station</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">StationConfig</span><span class="p">(</span>
            <span class="n">station_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_STATION_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;DEFAULT-STATION&#39;</span><span class="p">),</span>
            <span class="n">location</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_LOCATION&#39;</span><span class="p">,</span> <span class="s1">&#39;Default Location&#39;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Initialize API</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
            <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
            <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span>
            <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;WATS_TIMEOUT&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Test connection</span>
        <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">test_connection</span><span class="p">():</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to WATS server version: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">api</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Connection test failed&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">AuthenticationError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Authentication failed - check credentials&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize WATS API: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

<span class="c1"># Use it</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">initialize_api</span><span class="p">()</span>

        <span class="c1"># Now use the API</span>
        <span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span><span class="si">}</span><span class="s2"> products&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Application error&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="performance-optimization">Performance Optimization</h2>
<p>pyWATS includes several performance optimizations to make your applications faster and more efficient:</p>
<h3 id="enhanced-ttl-caching">Enhanced TTL Caching</h3>
<p>Cache static data automatically with TTL (Time To Live) expiration:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncTTLCache</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Process service has built-in caching</span>
        <span class="c1"># First call - fetches from server</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>

        <span class="c1"># Second call - returns cached data (100x faster!)</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>

        <span class="c1"># Check cache statistics</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">cache_stats</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hit_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># e.g., 95.0%</span>

        <span class="c1"># Clear cache when needed</span>
        <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>

<span class="c1"># Create your own caches for any data</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">AsyncTTLCache</span><span class="p">[</span><span class="nb">str</span><span class="p">](</span>
    <span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">default_ttl</span><span class="o">=</span><span class="mf">300.0</span>  <span class="c1"># 5 minutes</span>
<span class="p">)</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">cache</span><span class="p">:</span>
    <span class="c1"># Cache a value</span>
    <span class="k">await</span> <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>  <span class="c1"># Custom TTL</span>

    <span class="c1"># Get a value</span>
    <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>

    <span class="c1"># Check statistics</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hit rate: </span><span class="si">{</span><span class="n">cache</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hits: </span><span class="si">{</span><span class="n">cache</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">hits</span><span class="si">}</span><span class="s2">, Misses: </span><span class="si">{</span><span class="n">cache</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">misses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Performance Impact:</strong> 95% reduction in server calls for static data, 100x faster cache hits vs server calls.</p>
<h3 id="connection-pooling">Connection Pooling</h3>
<p>HTTP/2 connection pooling is automatically enabled for all API calls:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
    <span class="c1"># All requests automatically use connection pooling</span>
    <span class="c1"># - Reuses connections (faster, less overhead)</span>
    <span class="c1"># - HTTP/2 multiplexing (multiple requests on one connection)</span>
    <span class="c1"># - Up to 100 max connections</span>
    <span class="c1"># - 20 keepalive connections</span>

    <span class="c1"># Concurrent requests are much faster</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
    <span class="n">products</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">(),</span>
        <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>

<p><strong>Performance Impact:</strong> 3-5x faster for bulk operations, automatic connection reuse.</p>
<h3 id="request-batching">Request Batching</h3>
<p>Process multiple items efficiently with built-in batching utilities:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.batching</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChunkedBatcher</span><span class="p">,</span> <span class="n">batch_map</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="n">serial_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;SN-</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

        <span class="c1"># Method 1: ChunkedBatcher for size-based batching</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">ChunkedBatcher</span><span class="p">(</span>
            <span class="n">processor</span><span class="o">=</span><span class="k">lambda</span> <span class="n">sns</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_units_batch</span><span class="p">(</span><span class="n">sns</span><span class="p">),</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Process 50 at a time</span>
            <span class="n">max_concurrent</span><span class="o">=</span><span class="mi">5</span>  <span class="c1"># Up to 5 concurrent batches</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">batcher</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="k">await</span> <span class="n">batcher</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">serial_numbers</span><span class="p">)</span>

        <span class="c1"># Method 2: batch_map for simple concurrent mapping</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_unit</span><span class="p">(</span><span class="n">sn</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

        <span class="n">units</span> <span class="o">=</span> <span class="k">await</span> <span class="n">batch_map</span><span class="p">(</span>
            <span class="n">items</span><span class="o">=</span><span class="n">serial_numbers</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="n">fetch_unit</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">max_concurrent</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetched </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<p><strong>Performance Impact:</strong> 5-10x faster for bulk operations, automatic concurrency control.</p>
<h3 id="messagepack-serialization">MessagePack Serialization</h3>
<p>Use MessagePack for faster, smaller payloads (optional):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># First, install MessagePack support</span>
<span class="c1"># pip install msgpack</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.performance</span><span class="w"> </span><span class="kn">import</span> <span class="n">Serializer</span>

<span class="c1"># Create serializer with MessagePack</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;msgpack&#39;</span><span class="p">)</span>

<span class="c1"># Serialize data</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Deserialize</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="c1"># Compare formats</span>
<span class="n">json_serializer</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<span class="n">msgpack_serializer</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;msgpack&#39;</span><span class="p">)</span>

<span class="n">json_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">json_serializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">msgpack_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msgpack_serializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON: </span><span class="si">{</span><span class="n">json_size</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MessagePack: </span><span class="si">{</span><span class="n">msgpack_size</span><span class="si">}</span><span class="s2"> bytes (</span><span class="si">{</span><span class="n">msgpack_size</span><span class="o">/</span><span class="n">json_size</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> size)&quot;</span><span class="p">)</span>
<span class="c1"># Output: MessagePack: 50% size of JSON</span>

<span class="c1"># Benchmark serialization speed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.performance</span><span class="w"> </span><span class="kn">import</span> <span class="n">benchmark_serialization</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">benchmark_serialization</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="k">for</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;ops_per_sec&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> ops/sec&quot;</span><span class="p">)</span>
<span class="c1"># MessagePack is typically 3x faster than JSON</span>
</code></pre></div>

<p><strong>Performance Impact:</strong> 50% smaller payloads, 3x faster serialization, graceful fallback to JSON if not installed.</p>
<h3 id="combined-performance-pattern">Combined Performance Pattern</h3>
<p>Use all optimizations together for maximum performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncTTLCache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.batching</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_map</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_production_data</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># 1. Use built-in caching for static data</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>  <span class="c1"># Cached automatically</span>

        <span class="c1"># 2. Create custom cache for frequently accessed data</span>
        <span class="n">product_cache</span> <span class="o">=</span> <span class="n">AsyncTTLCache</span><span class="p">[</span><span class="nb">dict</span><span class="p">](</span><span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">default_ttl</span><span class="o">=</span><span class="mf">600.0</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">product_cache</span><span class="p">:</span>
            <span class="c1"># 3. Batch process units with connection pooling</span>
            <span class="n">serial_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;SN-</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

            <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_cache</span><span class="p">(</span><span class="n">sn</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Check cache first</span>
                <span class="n">cached</span> <span class="o">=</span> <span class="k">await</span> <span class="n">product_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">cached</span>

                <span class="c1"># Fetch from API (uses connection pooling automatically)</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

                <span class="c1"># Cache result</span>
                <span class="k">await</span> <span class="n">product_cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">unit</span>

            <span class="c1"># Process in batches with concurrency control</span>
            <span class="n">units</span> <span class="o">=</span> <span class="k">await</span> <span class="n">batch_map</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="n">serial_numbers</span><span class="p">,</span>
                <span class="n">func</span><span class="o">=</span><span class="n">fetch_with_cache</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                <span class="n">max_concurrent</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache hit rate: </span><span class="si">{</span><span class="n">product_cache</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Expect 95%+ hit rate on subsequent runs</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">process_production_data</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="internal-api-usage">Internal API Usage</h2>
<h3 id="understanding-internal-vs-public-apis">Understanding Internal vs Public APIs</h3>
<p>pyWATS provides access to both <strong>public</strong> and <strong>internal</strong> WATS API endpoints:</p>
<p><strong>Public APIs</strong> (Stable):<br />
- Documented and stable endpoints (e.g., <code>/api/Product</code>, <code>/api/Report</code>)<br />
- Accessed through standard modules: <code>api.product</code>, <code>api.report</code>, <code>api.asset</code>, etc.<br />
- <strong>Guaranteed stability</strong> - Will not change without notice<br />
- <strong>Recommended</strong> for production code</p>
<p><strong>Internal APIs</strong> (Unstable):<br />
- Undocumented endpoints used by WATS frontend (e.g., <code>/api/internal/UnitFlow</code>)<br />
- Accessed through the same domain accessor: <code>api.product</code>, <code>api.analytics</code>, etc.<br />
- Methods are marked with <code>‚ö†Ô∏è INTERNAL API</code> in docstrings<br />
- <strong>‚ö†Ô∏è MAY CHANGE WITHOUT NOTICE</strong> - Subject to breaking changes<br />
- <strong>Use with caution</strong> - Only when public APIs don't provide needed functionality</p>
<h3 id="when-to-use-internal-apis">When to Use Internal APIs</h3>
<p>Internal APIs fill gaps where public endpoints don't yet exist:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Method</th>
<th>Why Internal?</th>
</tr>
</thead>
<tbody>
<tr>
<td>Unit Flow Analysis</td>
<td><code>api.analytics.get_unit_flow()</code></td>
<td>No public Unit Flow endpoints yet</td>
</tr>
<tr>
<td>Box Build Templates</td>
<td><code>api.product.get_box_build_template()</code></td>
<td>No public box build management</td>
</tr>
<tr>
<td>Asset File Operations</td>
<td><code>api.asset.upload_blob()</code></td>
<td>No public file upload/download</td>
</tr>
<tr>
<td>Unit Phases (MES)</td>
<td><code>api.production.get_all_unit_phases()</code></td>
<td>MES integration not in public API</td>
</tr>
<tr>
<td>Process Details</td>
<td><code>api.process.get_all_processes()</code></td>
<td>Full process info not in public API</td>
</tr>
</tbody>
</table>
<h3 id="using-internal-apis-safely">Using Internal APIs Safely</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="c1"># ‚úÖ Public API - Use this when available</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>

<span class="c1"># ‚ö†Ô∏è Internal API - Use only when necessary</span>
<span class="c1"># This uses internal endpoints that may change (see docstring for warning)</span>
<span class="n">box_build</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Best Practices:</strong></p>
<ol>
<li><strong>Prefer Public APIs</strong>: Always use public APIs when available</li>
<li><strong>Isolate Internal Calls</strong>: Wrap internal API calls in your own functions</li>
<li><strong>Add Error Handling</strong>: Internal APIs may fail differently than public ones</li>
<li><strong>Document Usage</strong>: Note which parts of your code use internal APIs</li>
<li><strong>Monitor for Changes</strong>: Subscribe to pyWATS updates for breaking changes</li>
</ol>
<p><strong>Example - Isolated Internal API Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_unit_flow_safely</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">date_from</span><span class="p">,</span> <span class="n">date_to</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get unit flow data using internal API.</span>

<span class="sd">    ‚ö†Ô∏è INTERNAL API: This function uses internal WATS endpoints</span>
<span class="sd">    that may change without notice.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitFlowFilter</span>

        <span class="n">filter_data</span> <span class="o">=</span> <span class="n">UnitFlowFilter</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
            <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
            <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span>
        <span class="p">)</span>

        <span class="c1"># Internal API call - wrapped for safety</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_unit_flow</span><span class="p">(</span><span class="n">filter_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c1"># API may have changed</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Unit Flow API has changed. &quot;</span>
            <span class="s2">&quot;Please update pyWATS to the latest version.&quot;</span>
        <span class="p">)</span>

<span class="c1"># Use the wrapped function</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">flow</span> <span class="o">=</span> <span class="n">get_unit_flow_safely</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="n">date_from</span><span class="p">,</span> <span class="n">date_to</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Handle API change gracefully</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit Flow not available: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Fall back to alternative approach</span>
</code></pre></div>

<h3 id="deprecation-warnings">Deprecation Warnings</h3>
<p>Some internal API methods will emit deprecation warnings:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># This method is deprecated and will show a warning</span>
<span class="n">bom_xml</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="c1"># DeprecationWarning: ProductRepository.get_bom() uses an internal API endpoint...</span>

<span class="c1"># Use the unified API method instead</span>
<span class="n">bom_items</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom_items</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</code></pre></div>

<p>To suppress these warnings during testing (not recommended for production):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="n">bom</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="future-proofing-your-code">Future-Proofing Your Code</h3>
<p>As public APIs become available, migrate away from internal APIs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Current unified API - Internal methods are marked in docstrings</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_box_build_template</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">revision</span><span class="p">):</span>
    <span class="c1"># ‚ö†Ô∏è INTERNAL API (see docstring) - may change</span>
    <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">revision</span><span class="p">)</span>

<span class="c1"># When endpoint becomes public, docstring warning will be removed</span>
<span class="c1"># Your code continues to work with no changes required</span>
</code></pre></div>

<p><strong>Migration Checklist:</strong></p>
<ul>
<li>‚úÖ Monitor pyWATS release notes for new public endpoints</li>
<li>‚úÖ Test your code with each new pyWATS version</li>
<li>‚úÖ Keep internal API usage isolated and documented</li>
<li>‚úÖ Have fallback strategies for critical workflows</li>
</ul>
<hr />
<h2 id="batch-operations-pagination">Batch Operations &amp; Pagination</h2>
<h3 id="batch-operations">Batch Operations</h3>
<p>Execute multiple API calls concurrently for better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_execute</span><span class="p">,</span> <span class="n">collect_successes</span><span class="p">,</span> <span class="n">collect_failures</span>

<span class="c1"># Fetch multiple products in parallel</span>
<span class="n">part_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-002&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-003&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-004&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-005&quot;</span><span class="p">]</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">batch_execute</span><span class="p">(</span>
    <span class="n">keys</span><span class="o">=</span><span class="n">part_numbers</span><span class="p">,</span>
    <span class="n">operation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pn</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">pn</span><span class="p">),</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span>  <span class="c1"># Concurrent threads (default: 10)</span>
<span class="p">)</span>

<span class="c1"># Extract successful results</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">collect_successes</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetched </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span><span class="si">}</span><span class="s2"> products successfully&quot;</span><span class="p">)</span>

<span class="c1"># Check for failures</span>
<span class="n">failures</span> <span class="o">=</span> <span class="n">collect_failures</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">failures</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Domain-specific batch methods are also available:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Product domain batch methods</span>
<span class="n">product_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products_batch</span><span class="p">([</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-002&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-003&quot;</span><span class="p">])</span>

<span class="c1"># Fetch multiple revisions</span>
<span class="n">revision_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;PN-002&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)]</span>
<span class="n">revision_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions_batch</span><span class="p">(</span><span class="n">revision_pairs</span><span class="p">)</span>
</code></pre></div>

<h3 id="pagination">Pagination</h3>
<p>Iterate over large datasets efficiently without loading everything into memory:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># SCIM: Iterate over all users</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">iter_users</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">user_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># With a limit</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">iter_users</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_users</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">process_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="c1"># With progress tracking</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">,</span> <span class="n">items_so_far</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">items_so_far</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> users&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">iter_users</span><span class="p">(</span><span class="n">on_page</span><span class="o">=</span><span class="n">on_page</span><span class="p">):</span>
    <span class="n">sync_to_external_system</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<p>For custom pagination needs, use the core utilities directly:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">paginate</span><span class="p">,</span> <span class="n">Paginator</span>

<span class="c1"># Custom pagination with any API</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">some_api</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_index</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">paginate</span><span class="p">(</span>
    <span class="n">fetch_page</span><span class="o">=</span><span class="n">fetch_page</span><span class="p">,</span>
    <span class="n">get_items</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
    <span class="n">get_total</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">total_count</span><span class="p">,</span>
    <span class="n">page_size</span><span class="o">=</span><span class="mi">50</span>
<span class="p">):</span>
    <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="INDEX.md">Domain Guides</a> - API documentation for each domain</li>
<li><a href="../src/pywats_client/GUI_CONFIGURATION.md">GUI Configuration</a> - GUI client setup</li>
<li><a href="../src/pywats_client/control/HEADLESS_GUIDE.md">Headless Operation</a> - Headless client setup</li>
<li><a href="../examples/">Examples</a> - Working code examples</li>
</ul>
</div>


<div class="doc-separator" id="getting-started-quick-reference">
    <div class="doc-source">Source: docs/quick-reference.md</div>
    <h1 id="quick-reference-pywats-api-client">Quick Reference: pyWATS API &amp; Client</h1>
<h2 id="api-features">API Features</h2>
<h3 id="core-library">‚úÖ Core Library</h3>
<ul>
<li><strong>Async-First Architecture</strong> - Built on <code>httpx</code> with native async support</li>
<li><strong>Sync Compatibility</strong> - Full sync API via thin wrappers</li>
<li><strong>9 Domain Services</strong> - Product, Asset, Report, Production, Analytics, Software, RootCause, Process, SCIM</li>
<li><strong>170+ API Endpoints</strong> - Centralized route management</li>
<li><strong>Structured Logging</strong> - Configurable verbosity with debug support</li>
</ul>
<h3 id="performance-optimizations">‚úÖ Performance Optimizations ‚ö°</h3>
<ul>
<li><strong>Enhanced TTL Caching</strong> - 100x faster cache hits, automatic expiration with background cleanup</li>
<li><strong>Connection Pooling</strong> - HTTP/2 multiplexing, 3-5x faster bulk operations</li>
<li><strong>Request Batching</strong> - 5-10x faster processing, 95% reduction in server calls</li>
<li><strong>MessagePack Serialization</strong> - 50% smaller payloads, 3x faster (optional)</li>
</ul>
<h3 id="offline-queue">‚úÖ Offline Queue</h3>
<ul>
<li><strong>File-Based Queue</strong> - WSJF format as standard, WSXF/WSTF/ATML conversion</li>
<li><strong>Automatic Retry</strong> - Configurable max attempts with exponential backoff</li>
<li><strong>Statistics Tracking</strong> - Metadata tracking for queue operations</li>
</ul>
<h2 id="client-features">Client Features</h2>
<h3 id="new-components-created">New Components Created</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>pyWATSApplication</strong></td>
<td><code>src/pywats_client/app.py</code></td>
<td>Base application without GUI</td>
</tr>
<tr>
<td><strong>SettingsManager</strong></td>
<td><code>src/pywats_client/services/settings_manager.py</code></td>
<td>Persistent settings storage</td>
</tr>
<tr>
<td><strong>SerialNumberManager</strong></td>
<td><code>src/pywats_client/services/serial_manager.py</code></td>
<td>Offline serial management</td>
</tr>
<tr>
<td><strong>FileMonitor</strong></td>
<td><code>src/pywats_client/services/file_monitor.py</code></td>
<td>Folder watching &amp; monitoring</td>
</tr>
<tr>
<td><strong>ServiceApplication</strong></td>
<td><code>src/pywats_client/examples/service_application.py</code></td>
<td>Complete integration example</td>
</tr>
</tbody>
</table>
<h3 id="lines-of-code-added">Lines of Code Added</h3>
<ul>
<li><strong>Application Layer</strong>: 720 lines</li>
<li><strong>Settings Manager</strong>: 480 lines</li>
<li><strong>Serial Manager</strong>: 360 lines</li>
<li><strong>File Monitor</strong>: 340 lines</li>
<li><strong>Example</strong>: 400 lines</li>
<li><strong>Documentation</strong>: 1000+ lines</li>
<li><strong>Total</strong>: ~2,850 lines of new code</li>
</ul>
<h2 id="how-to-use">How to Use</h2>
<h3 id="1-simple-service-no-gui">1. Simple Service (No GUI)</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATSApplication</span><span class="p">,</span> <span class="n">ClientConfig</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">pyWATSApplication</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># Runs until interrupted</span>
</code></pre></div>

<h3 id="2-full-service-with-all-features">2. Full Service with All Features</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.examples.service_application</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceApplication</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">ServiceApplication</span><span class="p">(</span><span class="n">config_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./config&quot;</span><span class="p">))</span>
<span class="n">service</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<h3 id="3-async-usage">3. Async Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATSApplication</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">pyWATSApplication</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c1"># Use app...</span>
    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<h2 id="key-features">Key Features</h2>
<h3 id="base-application-pywatsapplication">‚úÖ Base Application (<code>pyWATSApplication</code>)</h3>
<ul>
<li>Lifecycle management (start, stop, restart)</li>
<li>Service orchestration</li>
<li>Status tracking &amp; callbacks</li>
<li>Error handling &amp; callbacks</li>
<li>Multi-instance support</li>
</ul>
<h3 id="settings-management">‚úÖ Settings Management</h3>
<ul>
<li>JSON file storage</li>
<li>Validation</li>
<li>Auto-backup</li>
<li>Monitor folder config</li>
<li>Converter config</li>
</ul>
<h3 id="serial-management">‚úÖ Serial Management</h3>
<ul>
<li>Reserve serials offline</li>
<li>Persistent storage</li>
<li>Pool statistics</li>
<li>Usage tracking</li>
<li>Auto-replenish indicators</li>
</ul>
<h3 id="file-monitoring">‚úÖ File Monitoring</h3>
<ul>
<li>Watch folders for files</li>
<li>Multiple rules</li>
<li>Auto-conversion</li>
<li>Debouncing</li>
<li>Callback events</li>
</ul>
<h2 id="architecture">Architecture</h2>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GUI (Optional)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ pyWATSApplication   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ              ‚îÇ          ‚îÇ          ‚îÇ
  Settings      Serials    Monitor    Services
  Manager       Manager    Monitor    Layer
    ‚îÇ              ‚îÇ          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí WATS API
</code></pre></div>

<h2 id="configuration-settingsjson">Configuration (settings.json)</h2>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;server_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://python.wats.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;api_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-token&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;auto_upload_reports&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;auto_upload_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;monitor_folders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./uploads&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;converter_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;csv&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;auto_upload&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;delete_after_convert&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="git-branch">Git Branch</h2>
<div class="codehilite"><pre><span></span><code><span class="n">Branch</span><span class="o">:</span><span class="w"> </span><span class="n">pyWATS_Service</span><span class="o">-</span><span class="n">and</span><span class="o">-</span><span class="n">Client</span>
<span class="n">Commits</span><span class="o">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">commits</span>
<span class="n">Status</span><span class="o">:</span><span class="w"> </span><span class="n">Ready</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">review</span>
</code></pre></div>

<h3 id="latest-commits">Latest Commits</h3>
<ol>
<li>‚úÖ <strong>4041c20</strong> - Phase 1 status and next steps documentation</li>
<li>‚úÖ <strong>0ab8ea8</strong> - Complete service application example</li>
<li>‚úÖ <strong>14ec311</strong> - Core refactoring with all new components</li>
</ol>
<h2 id="whats-next">What's Next</h2>
<h3 id="phase-2-error-handling">Phase 2: Error Handling</h3>
<ul>
<li>Integrate WATS API ErrorHandler/ErrorMode</li>
<li>Better error tracking and recovery</li>
</ul>
<h3 id="phase-3-gui-update">Phase 3: GUI Update</h3>
<ul>
<li>Refactor GUI to use pyWATSApplication</li>
<li>Remove business logic duplication</li>
</ul>
<h3 id="phase-4-system-integration">Phase 4: System Integration</h3>
<ul>
<li>Windows Service wrapper</li>
<li>systemd service configuration</li>
<li>Docker setup</li>
</ul>
<h3 id="phase-5-testing">Phase 5: Testing</h3>
<ul>
<li>Unit tests for new services</li>
<li>Integration tests</li>
<li>End-to-end scenarios</li>
</ul>
<h3 id="phase-6-packaging">Phase 6: Packaging</h3>
<ul>
<li>Installable packages</li>
<li>Cross-platform builds</li>
<li>Release distribution</li>
</ul>
<h2 id="file-structure">File Structure</h2>
<div class="codehilite"><pre><span></span><code><span class="k">New</span><span class="o">/</span><span class="n">Modified</span><span class="w"> </span><span class="nl">Files</span><span class="p">:</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">pywats_client</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">py</span><span class="w">                              </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">__init__</span><span class="p">.</span><span class="n">py</span><span class="w">                         </span><span class="o">[</span><span class="n">UPDATED</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">services</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">settings_manager</span><span class="p">.</span><span class="n">py</span><span class="w">             </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">serial_manager</span><span class="p">.</span><span class="n">py</span><span class="w">               </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">file_monitor</span><span class="p">.</span><span class="n">py</span><span class="w">                 </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">service_application</span><span class="p">.</span><span class="n">py</span><span class="w">          </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">ARCHITECTURE_REFACTORING</span><span class="p">.</span><span class="n">md</span><span class="w">             </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">CLIENT_SERVICE_REFACTORING_STATUS</span><span class="p">.</span><span class="n">md</span><span class="w">    </span><span class="o">[</span><span class="n">NEW</span><span class="o">]</span>
</code></pre></div>

<h2 id="documentation">Documentation</h2>
<ul>
<li><strong>Detailed Architecture</strong>: See <code>ARCHITECTURE_REFACTORING.md</code></li>
<li><strong>Phase Status</strong>: See <code>CLIENT_SERVICE_REFACTORING_STATUS.md</code></li>
<li><strong>API Docs</strong>: See docstrings in source files</li>
<li><strong>Examples</strong>: See <code>src/pywats_client/examples/service_application.py</code></li>
</ul>
<h2 id="key-design-principles">Key Design Principles</h2>
<ol>
<li><strong>Separation of Concerns</strong> - Base app has no GUI dependencies</li>
<li><strong>Async-First</strong> - All I/O is async</li>
<li><strong>Callback-Based Events</strong> - Decoupled components</li>
<li><strong>Persistent State</strong> - Settings and serials stored locally</li>
<li><strong>Error Resilient</strong> - Auto-reconnection and graceful degradation</li>
</ol>
<h2 id="test-status">Test Status</h2>
<p>‚úÖ All 90 existing tests still pass<br />
‚úÖ Zero errors in new code<br />
‚úÖ Backward compatible</p>
<h2 id="deployment-options">Deployment Options</h2>
<h3 id="1-servicedaemon">1. Service/Daemon</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client.gui.app<span class="w"> </span>--headless
</code></pre></div>

<h3 id="2-windows-service">2. Windows Service</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Wrapper coming in Phase 4</span>
</code></pre></div>

<h3 id="3-systemd-service">3. systemd Service</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configuration coming in Phase 4</span>
</code></pre></div>

<h3 id="4-docker-container">4. Docker Container</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Dockerfile coming in Phase 4</span>
</code></pre></div>

<h3 id="5-custom-application">5. Custom Application</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATSApplication</span>
<span class="c1"># ... integrate as needed</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="application-wont-start">Application won't start</h3>
<ul>
<li>Check <code>settings.json</code> is valid</li>
<li>Check <code>server_url</code> is accessible</li>
<li>Check instance not already running</li>
</ul>
<h3 id="files-not-being-converted">Files not being converted</h3>
<ul>
<li>Check <code>monitor_folders</code> configured</li>
<li>Check folder path exists</li>
<li>Check converter_type is correct</li>
<li>Look at logs for errors</li>
</ul>
<h3 id="serials-depleted">Serials depleted</h3>
<ul>
<li>Check <code>auto_reserve_serials</code> is enabled</li>
<li>Ensure online to replenish</li>
<li>Check <code>reserve_count</code> setting</li>
</ul>
<h2 id="support-resources">Support Resources</h2>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>Architecture</td>
<td><code>ARCHITECTURE_REFACTORING.md</code></td>
</tr>
<tr>
<td>Status</td>
<td><code>CLIENT_SERVICE_REFACTORING_STATUS.md</code></td>
</tr>
<tr>
<td>Examples</td>
<td><code>src/pywats_client/examples/service_application.py</code></td>
</tr>
<tr>
<td>API Reference</td>
<td>Docstrings in source files</td>
</tr>
<tr>
<td>Tests</td>
<td><code>tests/test_*.py</code> files</td>
</tr>
</tbody>
</table>
<h2 id="summary">Summary</h2>
<p>‚úÖ <strong>Phase 1 Complete</strong><br />
- Base application layer fully implemented<br />
- Settings persistence working<br />
- Serial number management ready<br />
- File monitoring operational<br />
- Complete example application provided<br />
- Comprehensive documentation created<br />
- All tests passing<br />
- Ready for review and Phase 2</p>
<hr />
<p><strong>Branch</strong>: <code>pyWATS_Service-and-Client</code><br />
<strong>Status</strong>: ‚úÖ Complete and Ready<br />
<strong>Next</strong>: Error Handling Integration (Phase 2)</p>
</div>


<div class="section-header" id="installation">
    <h1>Installation</h1>
</div>


<div class="doc-separator" id="installation-overview">
    <div class="doc-source">Source: docs/installation/README.md</div>
    <h1 id="installation-deployment-documentation">Installation &amp; Deployment Documentation</h1>
<p>This directory contains guides for installing PyWATS components and deploying the client service.</p>
<h2 id="what-do-you-need">üéØ What Do You Need?</h2>
<p>Use this decision tree to find the right installation guide:</p>
<div class="codehilite"><pre><span></span><code><span class="n">What</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">building</span><span class="vm">?</span>
<span class="err">‚îÇ</span>
<span class="err">‚îú‚îÄ‚ñ∫</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">automation</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="k">Only</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Install</span><span class="p">:</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">pywats</span><span class="o">-</span><span class="n">api</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Guide</span><span class="p">:</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="n">md</span>
<span class="err">‚îÇ</span>
<span class="err">‚îú‚îÄ‚ñ∫</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">station</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">queue</span><span class="o">/</span><span class="n">converters</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚ñ∫</span><span class="w"> </span><span class="k">With</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">GUI</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GUI</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Install</span><span class="p">:</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">pywats</span><span class="o">-</span><span class="n">api</span><span class="o">[</span><span class="n">client</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Guides</span><span class="p">:</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">md</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gui</span><span class="p">.</span><span class="n">md</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚ñ∫</span><span class="w"> </span><span class="n">Headless</span><span class="o">/</span><span class="n">server</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="n">Service</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Install</span><span class="p">:</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">pywats</span><span class="o">-</span><span class="n">api</span><span class="o">[</span><span class="n">client-headless</span><span class="o">]</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Guide</span><span class="p">:</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">md</span>
<span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚ñ∫</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="k">System</span><span class="w"> </span><span class="n">Service</span>
<span class="w">    </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nf">Choose</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="nl">platform</span><span class="p">:</span>
<span class="w">        </span><span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="nl">Windows</span><span class="p">:</span><span class="w"> </span><span class="n">windows</span><span class="o">-</span><span class="n">service</span><span class="p">.</span><span class="n">md</span>
<span class="w">        </span><span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="nl">Linux</span><span class="p">:</span><span class="w"> </span><span class="n">linux</span><span class="o">-</span><span class="n">service</span><span class="p">.</span><span class="n">md</span>
<span class="w">        </span><span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="nl">macOS</span><span class="p">:</span><span class="w"> </span><span class="n">macos</span><span class="o">-</span><span class="n">service</span><span class="p">.</span><span class="n">md</span>
<span class="w">        </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nl">Docker</span><span class="p">:</span><span class="w"> </span><span class="n">docker</span><span class="p">.</span><span class="n">md</span>
</code></pre></div>

<hr />
<h2 id="installation-by-component">üì¶ Installation by Component</h2>
<h3 id="api-library">API Library</h3>
<p><strong><a href="api.md">API Installation</a></strong> - Python SDK for direct WATS integration<br />
- pip package only (~5 MB)<br />
- No background services<br />
- Use from scripts and applications</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api
</code></pre></div>

<h3 id="client-service">Client Service</h3>
<p><strong><a href="client.md">Client Service</a></strong> - Background service with queue and converters<br />
- Report queue with retry<br />
- File watching and converters<br />
- Offline support</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># With GUI</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Headless (no GUI)</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client-headless<span class="o">]</span>
</code></pre></div>

<h3 id="gui-application">GUI Application</h3>
<p><strong><a href="gui.md">GUI Application</a></strong> - Desktop app for monitoring and configuration<br />
- Real-time queue monitoring<br />
- Configuration interface<br />
- Log viewer</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>
</code></pre></div>

<hr />
<h2 id="service-deployment">üñ•Ô∏è Service Deployment</h2>
<p>Install the client as a system service for automatic startup:</p>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Guide</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Windows</strong></td>
<td><a href="windows-service.md">windows-service.md</a></td>
<td>NSSM / sc.exe</td>
</tr>
<tr>
<td><strong>Linux</strong></td>
<td><a href="linux-service.md">linux-service.md</a></td>
<td>systemd</td>
</tr>
<tr>
<td><strong>macOS</strong></td>
<td><a href="macos-service.md">macos-service.md</a></td>
<td>launchd</td>
</tr>
<tr>
<td><strong>Docker</strong></td>
<td><a href="docker.md">docker.md</a></td>
<td>Container</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="quick-comparison">üìä Quick Comparison</h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>API Only</th>
<th>Client Headless</th>
<th>Client + GUI</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Size</strong></td>
<td>~5 MB</td>
<td>~8 MB</td>
<td>~150 MB</td>
</tr>
<tr>
<td><strong>Python SDK</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
</tr>
<tr>
<td><strong>Report Queue</strong></td>
<td>-</td>
<td>‚úì</td>
<td>‚úì</td>
</tr>
<tr>
<td><strong>Converters</strong></td>
<td>-</td>
<td>‚úì</td>
<td>‚úì</td>
</tr>
<tr>
<td><strong>File Watching</strong></td>
<td>-</td>
<td>‚úì</td>
<td>‚úì</td>
</tr>
<tr>
<td><strong>GUI</strong></td>
<td>-</td>
<td>-</td>
<td>‚úì</td>
</tr>
<tr>
<td><strong>Use Case</strong></td>
<td>Scripts</td>
<td>Servers, Pi</td>
<td>Desktop</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="quick-start">üöÄ Quick Start</h2>
<h3 id="developersintegrators">Developers/Integrators</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="test-stations-desktop">Test Stations (Desktop)</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w">  </span><span class="c1"># In another terminal</span>
</code></pre></div>

<h3 id="test-stations-headless">Test Stations (Headless)</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client-headless<span class="o">]</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>init
pywats-client<span class="w"> </span>start
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="../INDEX.md">../INDEX.md</a></strong> - Main documentation index</li>
<li><strong><a href="../getting-started.md">../getting-started.md</a></strong> - Complete tutorial</li>
<li><strong><a href="../client-architecture.md">../client-architecture.md</a></strong> - Client service internals</li>
<li><strong><a href="../env-variables.md">../env-variables.md</a></strong> - Environment variable reference</li>
</ul>
</div>


<div class="doc-separator" id="installation-api">
    <div class="doc-source">Source: docs/installation/api.md</div>
    <h1 id="pywats-api-installation">PyWATS API Installation</h1>
<p>Install the core PyWATS API library for direct integration with WATS from your Python applications.</p>
<h2 id="overview">Overview</h2>
<p>The API package provides:<br />
- Python SDK for all WATS domains (Report, Product, Production, Asset, etc.)<br />
- Sync and async client support<br />
- Data validation with Pydantic 2.0+<br />
- No GUI dependencies</p>
<p><strong>Best for:</strong> Scripts, automation, server-side integrations, custom applications.</p>
<hr />
<h2 id="installation">Installation</h2>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api
</code></pre></div>

<p><strong>Requirements:</strong><br />
- Python 3.10+<br />
- ~5 MB disk space</p>
<p><strong>Dependencies (automatically installed):</strong><br />
- <code>httpx</code> - HTTP client<br />
- <code>pydantic</code> - Data validation<br />
- <code>python-dateutil</code> - Date utilities</p>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="basic-connection">Basic Connection</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize client</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-server.wats.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_base64_encoded_token&quot;</span>
<span class="p">)</span>

<span class="c1"># Test connection</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">test_connection</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected to WATS!&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="using-environment-variables">Using Environment Variables</h3>
<p>Set credentials once, use everywhere:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Windows</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">PYWATS_SERVER_URL</span><span class="o">=</span>https://your-server.wats.com
<span class="nb">set</span><span class="w"> </span><span class="nv">PYWATS_API_TOKEN</span><span class="o">=</span>your_base64_encoded_token

<span class="c1"># Linux/macOS</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYWATS_SERVER_URL</span><span class="o">=</span>https://your-server.wats.com
<span class="nb">export</span><span class="w"> </span><span class="nv">PYWATS_API_TOKEN</span><span class="o">=</span>your_base64_encoded_token
</code></pre></div>

<p>Then in Python:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Reads from environment automatically</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">()</span>
</code></pre></div>

<h3 id="async-client">Async Client</h3>
<p>For high-performance applications:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">async_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="n">products</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span><span class="si">}</span><span class="s2"> products&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="api-domains">API Domains</h2>
<p>The API is organized into domain modules:</p>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Import</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Report</strong></td>
<td><code>api.report</code></td>
<td>Create/query test reports (UUT/UUR)</td>
</tr>
<tr>
<td><strong>Product</strong></td>
<td><code>api.product</code></td>
<td>Manage products, revisions, BOMs</td>
</tr>
<tr>
<td><strong>Production</strong></td>
<td><code>api.production</code></td>
<td>Serial numbers, unit lifecycle</td>
</tr>
<tr>
<td><strong>Asset</strong></td>
<td><code>api.asset</code></td>
<td>Equipment tracking, calibration</td>
</tr>
<tr>
<td><strong>Analytics</strong></td>
<td><code>api.analytics</code></td>
<td>Yield analysis, statistics</td>
</tr>
<tr>
<td><strong>Software</strong></td>
<td><code>api.software</code></td>
<td>Package distribution</td>
</tr>
<tr>
<td><strong>RootCause</strong></td>
<td><code>api.rootcause</code></td>
<td>Issue tracking, defects</td>
</tr>
<tr>
<td><strong>Process</strong></td>
<td><code>api.process</code></td>
<td>Operation types, processes</td>
</tr>
<tr>
<td><strong>SCIM</strong></td>
<td><code>api.scim</code></td>
<td>User provisioning</td>
</tr>
</tbody>
</table>
<h3 id="example-create-a-test-report">Example: Create a Test Report</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">()</span>

<span class="c1"># Create report</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCB-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN12345&quot;</span><span class="p">,</span>
    <span class="n">operation_code</span><span class="o">=</span><span class="s2">&quot;ICT&quot;</span><span class="p">,</span>
    <span class="n">result</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># Add a numeric measurement</span>
<span class="n">report</span><span class="o">.</span><span class="n">add_numeric_limit_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voltage Check&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">3.3</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report ID: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="authentication">Authentication</h2>
<h3 id="token-generation">Token Generation</h3>
<ol>
<li>Log into WATS web interface</li>
<li>Navigate to <strong>Settings ‚Üí API Access</strong></li>
<li>Generate a new API token</li>
<li>Copy the base64-encoded token</li>
</ol>
<h3 id="token-format">Token Format</h3>
<p>The token is a base64-encoded string containing your credentials:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="c1"># Create token from username:password</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="s2">&quot;username:password&quot;</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>  <span class="c1"># dXNlcm5hbWU6cGFzc3dvcmQ=</span>
</code></pre></div>

<hr />
<h2 id="configuration-options">Configuration Options</h2>
<h3 id="client-initialization">Client Initialization</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-server.wats.com&quot;</span><span class="p">,</span>  <span class="c1"># WATS server URL</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>                               <span class="c1"># Auth token</span>
    <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>                                <span class="c1"># Request timeout (seconds)</span>
    <span class="n">verify_ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                           <span class="c1"># SSL certificate verification</span>
    <span class="n">async_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                          <span class="c1"># Use async client</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="environment-variables">Environment Variables</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PYWATS_SERVER_URL</code></td>
<td>WATS server base URL</td>
<td>Required</td>
</tr>
<tr>
<td><code>PYWATS_API_TOKEN</code></td>
<td>Base64-encoded auth token</td>
<td>Required</td>
</tr>
<tr>
<td><code>PYWATS_TIMEOUT</code></td>
<td>Request timeout (seconds)</td>
<td>30</td>
</tr>
<tr>
<td><code>PYWATS_VERIFY_SSL</code></td>
<td>Verify SSL certificates</td>
<td>true</td>
</tr>
<tr>
<td><code>PYWATS_LOG_LEVEL</code></td>
<td>Logging level</td>
<td>INFO</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="upgrading">Upgrading</h2>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pywats-api
</code></pre></div>

<p>Check current version:</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>show<span class="w"> </span>pywats-api
</code></pre></div>

<p>Or in Python:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pywats</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pywats</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="import-errors">Import Errors</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify installation</span>
pip<span class="w"> </span>show<span class="w"> </span>pywats-api

<span class="c1"># Check Python version</span>
python<span class="w"> </span>--version<span class="w">  </span><span class="c1"># Should be 3.10+</span>

<span class="c1"># Reinstall</span>
pip<span class="w"> </span>uninstall<span class="w"> </span>pywats-api
pip<span class="w"> </span>install<span class="w"> </span>pywats-api
</code></pre></div>

<h3 id="connection-issues">Connection Issues</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-server.wats.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span>
<span class="p">)</span>

<span class="c1"># Enable debug logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Test connection</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">test_connection</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="ssl-certificate-errors">SSL Certificate Errors</h3>
<p>For development/testing only:</p>
<div class="codehilite"><pre><span></span><code><span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">verify_ssl</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># ‚ö†Ô∏è Not for production!</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><strong><a href="../getting-started.md">Getting Started Guide</a></strong> - Comprehensive tutorial</li>
<li><strong><a href="../quick-reference.md">Quick Reference</a></strong> - Common patterns and snippets</li>
<li><strong><a href="../modules/">Domain Documentation</a></strong> - Detailed API reference</li>
</ul>
<hr />
<h2 id="need-more">Need More?</h2>
<table>
<thead>
<tr>
<th>If you need...</th>
<th>Install...</th>
<th>Guide</th>
</tr>
</thead>
<tbody>
<tr>
<td>Background service with queue</td>
<td><code>pip install pywats-api[client-headless]</code></td>
<td><a href="client.md">Service Guide</a></td>
</tr>
<tr>
<td>Desktop GUI for monitoring</td>
<td><code>pip install pywats-api[client]</code></td>
<td><a href="gui.md">GUI Guide</a></td>
</tr>
<tr>
<td>Development tools</td>
<td><code>pip install pywats-api[dev]</code></td>
<td><a href="../getting-started.md">Getting Started</a></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="../INDEX.md">../INDEX.md</a></strong> - Main documentation index</li>
<li><strong><a href="../architecture.md">../architecture.md</a></strong> - System architecture overview</li>
<li><strong><a href="../env-variables.md">../env-variables.md</a></strong> - Environment variable reference</li>
</ul>
</div>


<div class="doc-separator" id="installation-client">
    <div class="doc-source">Source: docs/installation/client.md</div>
    <h1 id="pywats-client-service">PyWATS Client Service</h1>
<p>The PyWATS Client Service is a background process that handles automated test report processing, queuing, and upload to WATS.</p>
<h2 id="overview">Overview</h2>
<p>The client service provides:<br />
- <strong>Report Queue</strong> - Reliable queuing with retry on failure<br />
- <strong>Offline Support</strong> - Queue reports when disconnected, upload when online<br />
- <strong>Converters</strong> - Transform test equipment output to WATS format<br />
- <strong>File Watching</strong> - Auto-detect new reports in watch folders<br />
- <strong>Multi-Instance</strong> - Run separate instances for different stations</p>
<p><strong>Best for:</strong> Test station automation, production environments, embedded systems.</p>
<hr />
<h2 id="installation">Installation</h2>
<h3 id="with-gui-desktop-stations">With GUI (Desktop Stations)</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>
</code></pre></div>

<p>Includes desktop GUI for configuration and monitoring. See <a href="gui.md">GUI Guide</a>.</p>
<h3 id="headless-servers-embedded">Headless (Servers, Embedded)</h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client-headless<span class="o">]</span>
</code></pre></div>

<p>No GUI dependencies - CLI and HTTP API only. Ideal for:<br />
- Linux servers<br />
- Raspberry Pi<br />
- Embedded systems<br />
- Docker containers</p>
<p><strong>Requirements:</strong><br />
- Python 3.10+<br />
- ~8 MB disk space (headless) / ~150 MB (with GUI)</p>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="start-the-service">Start the Service</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Default instance</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service

<span class="c1"># Named instance</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service<span class="w"> </span>--instance-id<span class="w"> </span>station1
</code></pre></div>

<h3 id="first-time-configuration">First-Time Configuration</h3>
<p><strong>Interactive setup:</strong></p>
<div class="codehilite"><pre><span></span><code>pywats-client<span class="w"> </span>config<span class="w"> </span>init
</code></pre></div>

<p><strong>Non-interactive:</strong></p>
<div class="codehilite"><pre><span></span><code>pywats-client<span class="w"> </span>config<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--server-url<span class="w"> </span>https://wats.yourcompany.com<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--username<span class="w"> </span>your-username<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--password<span class="w"> </span>your-password<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--station-name<span class="w"> </span>ICT-STATION-01<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--non-interactive
</code></pre></div>

<h3 id="verify-connection">Verify Connection</h3>
<div class="codehilite"><pre><span></span><code>pywats-client<span class="w"> </span>status
</code></pre></div>

<hr />
<h2 id="architecture">Architecture</h2>
<h3 id="background-services">Background Services</h3>
<p>The client runs several background services:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Connection Monitor</strong></td>
<td>Watches WATS server connectivity</td>
</tr>
<tr>
<td><strong>Queue Manager</strong></td>
<td>Manages report queue lifecycle</td>
</tr>
<tr>
<td><strong>File Watcher</strong></td>
<td>Detects new files in watch folders</td>
</tr>
<tr>
<td><strong>Upload Service</strong></td>
<td>Sends reports to WATS</td>
</tr>
<tr>
<td><strong>Software Service</strong></td>
<td>Downloads software packages (optional)</td>
</tr>
</tbody>
</table>
<h3 id="report-processing-flow">Report Processing Flow</h3>
<div class="codehilite"><pre><span></span><code><span class="n">Test</span><span class="w"> </span><span class="n">Equipment</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="p">[</span><span class="n">File</span><span class="w"> </span><span class="n">Created</span><span class="p">]</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="p">[</span><span class="n">File</span><span class="w"> </span><span class="n">Watcher</span><span class="p">]</span>
<span class="w">                                       </span><span class="err">‚Üì</span>
<span class="w">                                 </span><span class="p">[</span><span class="n">Converter</span><span class="p">]</span>
<span class="w">                                       </span><span class="err">‚Üì</span>
<span class="w">                                   </span><span class="p">[</span><span class="n">Queue</span><span class="p">]</span>
<span class="w">                                       </span><span class="err">‚Üì</span>
<span class="w">                             </span><span class="p">[</span><span class="n">Upload</span><span class="w"> </span><span class="n">Service</span><span class="p">]</span>
<span class="w">                                       </span><span class="err">‚Üì</span>
<span class="w">                              </span><span class="p">[</span><span class="n">WATS</span><span class="w"> </span><span class="n">Server</span><span class="p">]</span>
</code></pre></div>

<hr />
<h2 id="file-organization">File Organization</h2>
<h3 id="data-directories">Data Directories</h3>
<p><strong>Windows (Production):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">C</span><span class="p">:</span>\<span class="n">ProgramData</span>\<span class="n">Virinco</span>\<span class="n">pyWATS</span>\
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">config</span><span class="o">.</span><span class="n">json</span><span class="w">              </span><span class="c1"># Configuration</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">logs</span>\<span class="w">                    </span><span class="c1"># Service logs</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">queue</span>\<span class="w">                   </span><span class="c1"># Report queue</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">pending</span>\<span class="w">            </span><span class="c1"># Waiting for upload</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">processing</span>\<span class="w">         </span><span class="c1"># Currently uploading</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">completed</span>\<span class="w">          </span><span class="c1"># Successfully uploaded</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">failed</span>\<span class="w">             </span><span class="c1"># Failed uploads</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">converters</span>\<span class="w">              </span><span class="c1"># Custom converters</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">data</span>\<span class="w">                    </span><span class="c1"># Software packages</span>
</code></pre></div>

<p><strong>Windows (User Development):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">%APPDATA%\pyWATS_Client\</span>
</code></pre></div>

<p><strong>Linux/macOS:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="o">~/.</span><span class="n">config</span><span class="o">/</span><span class="n">pywats_client</span><span class="o">/</span><span class="w">     </span><span class="c1"># User</span>
<span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pywats</span><span class="o">/</span><span class="w">             </span><span class="c1"># System service</span>
</code></pre></div>

<h3 id="queue-folder-contents">Queue Folder Contents</h3>
<table>
<thead>
<tr>
<th>Folder</th>
<th>Purpose</th>
<th>Auto-Cleanup</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pending/</code></td>
<td>Reports waiting for upload</td>
<td>No</td>
</tr>
<tr>
<td><code>processing/</code></td>
<td>Currently uploading</td>
<td>No</td>
</tr>
<tr>
<td><code>completed/</code></td>
<td>Successfully uploaded</td>
<td>After 7 days</td>
</tr>
<tr>
<td><code>failed/</code></td>
<td>Failed uploads</td>
<td>After 30 days</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="configuration">Configuration</h2>
<h3 id="configuration-file">Configuration File</h3>
<p><code>config.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;server_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://wats.yourcompany.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;api_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;station_location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Production Line A&quot;</span><span class="p">,</span>

<span class="w">  </span><span class="nt">&quot;queue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;watch_folders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;C:\\TestReports&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;upload_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;retry_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;retry_delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;WATSStandardXMLConverter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TeradyneICTConverter&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;auto_detect&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="nt">&quot;logging&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_size_mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;backup_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="cli-configuration">CLI Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># View all settings</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>show

<span class="c1"># Get specific value</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>get<span class="w"> </span>queue.upload_interval

<span class="c1"># Set value</span>
pywats-client<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>queue.upload_interval<span class="w"> </span><span class="m">30</span>

<span class="c1"># Add watch folder</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>add-watch-folder<span class="w"> </span><span class="s2">&quot;C:\TestReports\Station1&quot;</span>
</code></pre></div>

<h3 id="environment-variables">Environment Variables</h3>
<p>Override config via environment:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PYWATS_SERVER_URL</code></td>
<td>WATS server URL</td>
</tr>
<tr>
<td><code>PYWATS_API_TOKEN</code></td>
<td>Auth token</td>
</tr>
<tr>
<td><code>PYWATS_STATION_NAME</code></td>
<td>Station identifier</td>
</tr>
<tr>
<td><code>PYWATS_LOG_LEVEL</code></td>
<td>Logging level</td>
</tr>
<tr>
<td><code>PYWATS_WATCH_FOLDERS</code></td>
<td>Colon-separated paths</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="converters">Converters</h2>
<p>Converters transform test equipment output into WATS format.</p>
<h3 id="built-in-converters">Built-in Converters</h3>
<p><strong>WATS Standard Formats:</strong></p>
<table>
<thead>
<tr>
<th>Converter</th>
<th>Format</th>
<th>File Patterns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WATSStandardXMLConverter</code></td>
<td>WSXF/WRML</td>
<td><code>*.xml</code></td>
</tr>
<tr>
<td><code>WATSStandardJsonConverter</code></td>
<td>WSJF</td>
<td><code>*.json</code></td>
</tr>
<tr>
<td><code>WATSStandardTextConverter</code></td>
<td>WSTF</td>
<td><code>*.txt</code></td>
</tr>
</tbody>
</table>
<p><strong>Industry Standards:</strong></p>
<table>
<thead>
<tr>
<th>Converter</th>
<th>Standard</th>
<th>File Patterns</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ATMLConverter</code></td>
<td>IEEE ATML (1671/1636.1)</td>
<td><code>*.xml</code>, <code>*.atml</code></td>
<td>ATML 2.02, 5.00, 6.01 + TestStand AddOn</td>
</tr>
</tbody>
</table>
<p><strong>Test Equipment:</strong></p>
<table>
<thead>
<tr>
<th>Converter</th>
<th>Equipment</th>
<th>File Patterns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TeradyneICTConverter</code></td>
<td>Teradyne i3070</td>
<td><code>*.txt</code>, <code>*.log</code></td>
</tr>
<tr>
<td><code>TeradyneSpectrumICTConverter</code></td>
<td>Teradyne Spectrum</td>
<td><code>*.txt</code>, <code>*.log</code></td>
</tr>
<tr>
<td><code>SeicaXMLConverter</code></td>
<td>Seica Flying Probe</td>
<td><code>*.xml</code></td>
</tr>
<tr>
<td><code>KlippelConverter</code></td>
<td>Klippel Audio/Acoustic</td>
<td><code>*.txt</code> + data folder</td>
</tr>
<tr>
<td><code>SPEAConverter</code></td>
<td>SPEA ATE</td>
<td><code>*.txt</code></td>
</tr>
<tr>
<td><code>XJTAGConverter</code></td>
<td>XJTAG Boundary Scan</td>
<td><code>*.zip</code></td>
</tr>
</tbody>
</table>
<p><strong>Special:</strong></p>
<table>
<thead>
<tr>
<th>Converter</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AIConverter</code></td>
<td>Auto-detects file type and delegates to best matching converter</td>
</tr>
</tbody>
</table>
<h3 id="custom-converters">Custom Converters</h3>
<p>Place custom converters in the converters folder:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># converters/my_converter.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseConverter</span><span class="p">,</span> <span class="n">ConverterInfo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyConverter</span><span class="p">(</span><span class="n">BaseConverter</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConverterInfo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ConverterInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyConverter&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Converts my test equipment output&quot;</span><span class="p">,</span>
            <span class="n">file_patterns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.myext&quot;</span><span class="p">],</span>
            <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UUTReport</span><span class="p">:</span>
        <span class="c1"># Parse file and create report</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
            <span class="n">operation_code</span><span class="o">=</span><span class="s2">&quot;TEST&quot;</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">report</span>
</code></pre></div>

<p>See <a href="../llm-converter-guide.md">LLM Converter Guide</a> for detailed examples.</p>
<hr />
<h2 id="queue-management">Queue Management</h2>
<h3 id="cli-commands">CLI Commands</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># View queue status</span>
pywats-client<span class="w"> </span>queue<span class="w"> </span>status

<span class="c1"># List pending reports</span>
pywats-client<span class="w"> </span>queue<span class="w"> </span>list

<span class="c1"># Retry failed reports</span>
pywats-client<span class="w"> </span>queue<span class="w"> </span>retry-failed

<span class="c1"># Clear completed reports</span>
pywats-client<span class="w"> </span>queue<span class="w"> </span>clear-completed

<span class="c1"># Manual upload</span>
pywats-client<span class="w"> </span>upload<span class="w"> </span>--file<span class="w"> </span>/path/to/report.xml
</code></pre></div>

<h3 id="queue-api">Queue API</h3>
<p>For programmatic access:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.core.queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportQueue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">ReportQueue</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>

<span class="c1"># Add report</span>
<span class="n">queue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;path/to/report.xml&quot;</span><span class="p">)</span>

<span class="c1"># Get status</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pending: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">pending_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Process queue</span>
<span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">process_all</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="multi-instance-support">Multi-Instance Support</h2>
<p>Run separate instances for different stations:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Instance 1</span>
pywats-client<span class="w"> </span>--instance<span class="w"> </span>station1<span class="w"> </span>config<span class="w"> </span>init
pywats-client<span class="w"> </span>--instance<span class="w"> </span>station1<span class="w"> </span>service

<span class="c1"># Instance 2</span>
pywats-client<span class="w"> </span>--instance<span class="w"> </span>station2<span class="w"> </span>config<span class="w"> </span>init<span class="w">  </span>
pywats-client<span class="w"> </span>--instance<span class="w"> </span>station2<span class="w"> </span>service
</code></pre></div>

<p>Each instance has separate:<br />
- Configuration file<br />
- Queue folder<br />
- Log file<br />
- Watch folders</p>
<hr />
<h2 id="headless-mode">Headless Mode</h2>
<h3 id="cli-control">CLI Control</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start foreground</span>
pywats-client<span class="w"> </span>start

<span class="c1"># Start as daemon (Linux/macOS)</span>
pywats-client<span class="w"> </span>start<span class="w"> </span>--daemon

<span class="c1"># Check status</span>
pywats-client<span class="w"> </span>status

<span class="c1"># Stop daemon</span>
pywats-client<span class="w"> </span>stop

<span class="c1"># Restart</span>
pywats-client<span class="w"> </span>restart
</code></pre></div>

<h3 id="http-api-control">HTTP API Control</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start with HTTP API</span>
pywats-client<span class="w"> </span>start<span class="w"> </span>--api<span class="w"> </span>--api-port<span class="w"> </span><span class="m">8765</span>
</code></pre></div>

<p>Available endpoints:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/status</code></td>
<td>GET</td>
<td>Service status</td>
</tr>
<tr>
<td><code>/queue</code></td>
<td>GET</td>
<td>Queue status</td>
</tr>
<tr>
<td><code>/queue/pending</code></td>
<td>GET</td>
<td>List pending reports</td>
</tr>
<tr>
<td><code>/restart</code></td>
<td>POST</td>
<td>Restart service</td>
</tr>
<tr>
<td><code>/stop</code></td>
<td>POST</td>
<td>Stop service</td>
</tr>
<tr>
<td><code>/config</code></td>
<td>GET</td>
<td>View configuration</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1"># Examples</span>
curl<span class="w"> </span>http://localhost:8765/status
curl<span class="w"> </span>http://localhost:8765/queue
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8765/restart
</code></pre></div>

<hr />
<h2 id="running-as-system-service">Running as System Service</h2>
<p>For production deployments, run as a system service:</p>
<ul>
<li><strong><a href="windows-service.md">Windows Service</a></strong> - NSSM setup, auto-start</li>
<li><strong><a href="linux-service.md">Linux Service</a></strong> - Systemd configuration</li>
<li><strong><a href="macos-service.md">macOS Service</a></strong> - Launchd daemon</li>
<li><strong><a href="docker.md">Docker</a></strong> - Container deployment</li>
</ul>
<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="service-wont-start">Service Won't Start</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check Python version</span>
python<span class="w"> </span>--version<span class="w">  </span><span class="c1"># Should be 3.10+</span>

<span class="c1"># Check installation</span>
pip<span class="w"> </span>show<span class="w"> </span>pywats-api

<span class="c1"># View logs</span>
cat<span class="w"> </span>~/.config/pywats_client/pywats_client.log
</code></pre></div>

<h3 id="reports-not-uploading">Reports Not Uploading</h3>
<ol>
<li>
<p><strong>Check connection:</strong><br />
<code>bash
   pywats-client status</code></p>
</li>
<li>
<p><strong>Check queue:</strong><br />
<code>bash
   pywats-client queue status</code></p>
</li>
<li>
<p><strong>Enable debug logging:</strong><br />
<code>bash
   pywats-client config set logging.level DEBUG
   pywats-client restart</code></p>
</li>
<li>
<p><strong>Manual upload test:</strong><br />
<code>bash
   pywats-client upload --file /path/to/report.xml --verbose</code></p>
</li>
</ol>
<h3 id="converter-not-detecting-files">Converter Not Detecting Files</h3>
<ol>
<li>
<p><strong>Check watch folders:</strong><br />
<code>bash
   pywats-client config get queue.watch_folders</code></p>
</li>
<li>
<p><strong>Check file patterns:</strong><br />
<code>bash
   pywats-client converters list</code></p>
</li>
<li>
<p><strong>Test converter manually:</strong><br />
<code>bash
   pywats-client convert --file /path/to/file.txt --converter MyConverter</code></p>
</li>
</ol>
<h3 id="finding-configuration">Finding Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Show config path</span>
pywats-client<span class="w"> </span>config<span class="w"> </span>show<span class="w"> </span>--format<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>config_path

<span class="c1"># Or check default locations:</span>
<span class="c1"># Windows: %APPDATA%\pyWATS_Client\config.json</span>
<span class="c1"># Linux/macOS: ~/.config/pywats_client/config.json</span>
</code></pre></div>

<hr />
<h2 id="security">Security</h2>
<h3 id="credential-storage">Credential Storage</h3>
<ul>
<li>Passwords encrypted using platform-specific encryption</li>
<li><strong>Windows</strong>: DPAPI (Data Protection API)</li>
<li><strong>Linux/macOS</strong>: System keyring or file encryption</li>
</ul>
<h3 id="network-security">Network Security</h3>
<ul>
<li>All WATS communication uses HTTPS</li>
<li>Credentials never logged</li>
<li>API tokens rotated on password change</li>
</ul>
<h3 id="file-permissions">File Permissions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Linux/macOS - restrict config access</span>
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.config/pywats_client/config.json
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="api.md">API Installation</a></strong> - SDK-only installation</li>
<li><strong><a href="gui.md">GUI Guide</a></strong> - Desktop application</li>
<li><strong><a href="../client-architecture.md">../client-architecture.md</a></strong> - Architecture details</li>
<li><strong><a href="../llm-converter-guide.md">../llm-converter-guide.md</a></strong> - Writing converters</li>
<li><strong><a href="../getting-started.md">../getting-started.md</a></strong> - Complete tutorial</li>
</ul>
</div>


<div class="doc-separator" id="installation-gui">
    <div class="doc-source">Source: docs/installation/gui.md</div>
    <h1 id="pywats-gui-application">PyWATS GUI Application</h1>
<p>The PyWATS GUI provides a desktop application for monitoring and configuring your WATS client service.</p>
<h2 id="overview">Overview</h2>
<p>The GUI application offers:<br />
- <strong>Real-time Monitoring</strong> - View queue status, upload progress, connection state<br />
- <strong>Configuration Interface</strong> - Configure server, converters, and settings<br />
- <strong>Log Viewer</strong> - Monitor application and service logs<br />
- <strong>Converter Management</strong> - Enable/disable and configure converters</p>
<p><strong>Important:</strong> The GUI is a companion application for the <a href="client.md">client service</a>. The service handles the actual work (queue processing, uploads); the GUI provides visibility and configuration.</p>
<hr />
<h2 id="installation">Installation</h2>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>
</code></pre></div>

<p><strong>Requirements:</strong><br />
- Python 3.10+<br />
- Display/monitor (X11/Wayland on Linux)<br />
- ~150 MB disk space</p>
<p><strong>Dependencies (automatically installed):</strong><br />
- <code>PySide6</code> - Qt6 GUI framework<br />
- <code>watchdog</code> - File monitoring<br />
- <code>aiofiles</code> - Async file operations<br />
- Plus all API dependencies</p>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="starting-the-service-and-gui">Starting the Service and GUI</h3>
<p>The recommended workflow is to run the service first, then connect the GUI:</p>
<p><strong>Step 1: Start the service</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service<span class="w"> </span>--instance-id<span class="w"> </span>default
</code></pre></div>

<p><strong>Step 2: Launch GUI</strong> (in another terminal)</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--instance-id<span class="w"> </span>default
</code></pre></div>

<p>The GUI will connect to the running service via IPC.</p>
<h3 id="first-time-setup">First-Time Setup</h3>
<ol>
<li>Launch the GUI</li>
<li>Go to <strong>Setup</strong> tab</li>
<li>Enter your WATS server details:</li>
<li><strong>Server URL</strong>: <code>https://your-server.wats.com</code></li>
<li><strong>Username</strong>: Your WATS username</li>
<li><strong>Password</strong>: Your WATS password</li>
<li><strong>Station Name</strong>: Identifier for this test station</li>
<li>Click <strong>Test Connection</strong></li>
<li>Click <strong>Save</strong></li>
</ol>
<hr />
<h2 id="gui-tabs">GUI Tabs</h2>
<h3 id="dashboard">üìä Dashboard</h3>
<p>Main overview showing:<br />
- Connection status (connected/disconnected)<br />
- Queue statistics (pending, processing, completed, failed)<br />
- Recent uploads with timestamps<br />
- Service health indicators</p>
<h3 id="setup">‚öôÔ∏è Setup</h3>
<p>Configure WATS server connection:<br />
- Server URL<br />
- Credentials<br />
- Station name and location<br />
- Connection test button</p>
<h3 id="queue">üìÅ Queue</h3>
<p>View and manage the report queue:<br />
- Pending reports waiting for upload<br />
- Processing status<br />
- Failed reports with error details<br />
- Retry/delete options</p>
<h3 id="converters">üîÑ Converters</h3>
<p>Manage report converters:<br />
- View installed converters<br />
- Enable/disable converters<br />
- Configure converter settings<br />
- View converter status and errors</p>
<h3 id="logs">üìã Logs</h3>
<p>Real-time log viewer:<br />
- Filter by log level (DEBUG, INFO, WARNING, ERROR)<br />
- Search functionality<br />
- Auto-scroll toggle<br />
- Export logs</p>
<h3 id="software">üì¶ Software</h3>
<p>Software distribution panel (if enabled):<br />
- Available packages<br />
- Download status<br />
- Version information</p>
<hr />
<h2 id="configuration">Configuration</h2>
<h3 id="gui-settings">GUI Settings</h3>
<p>The GUI stores its own settings separately from the service:</p>
<p><strong>Windows:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">%APPDATA%\pyWATS_Client\gui_settings.json</span>
</code></pre></div>

<p><strong>Linux/macOS:</strong></p>
<div class="codehilite"><pre><span></span><code>~/.config/pywats_client/gui_settings.json
</code></pre></div>

<h3 id="customizable-options">Customizable Options</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;window_geometry&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;width&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;theme&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;system&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;log_viewer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;auto_scroll&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;show_timestamps&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;refresh_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;notifications&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;upload_complete&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;upload_failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;connection_lost&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="themes">Themes</h3>
<p>The GUI supports system theme detection:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Force light theme</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--theme<span class="w"> </span>light

<span class="c1"># Force dark theme  </span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--theme<span class="w"> </span>dark

<span class="c1"># Use system preference (default)</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--theme<span class="w"> </span>system
</code></pre></div>

<hr />
<h2 id="command-line-options">Command Line Options</h2>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>

Options:
<span class="w">  </span>--instance-id<span class="w"> </span>TEXT<span class="w">    </span>Client<span class="w"> </span>instance<span class="w"> </span>to<span class="w"> </span>connect<span class="w"> </span>to<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="o">)</span>
<span class="w">  </span>--config-path<span class="w"> </span>PATH<span class="w">    </span>Path<span class="w"> </span>to<span class="w"> </span>config<span class="w"> </span>file
<span class="w">  </span>--theme<span class="w"> </span>TEXT<span class="w">          </span>Theme:<span class="w"> </span>light,<span class="w"> </span>dark,<span class="w"> </span>system
<span class="w">  </span>--minimized<span class="w">           </span>Start<span class="w"> </span>minimized<span class="w"> </span>to<span class="w"> </span>system<span class="w"> </span>tray
<span class="w">  </span>--help<span class="w">               </span>Show<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message
</code></pre></div>

<h3 id="examples">Examples</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Connect to default instance</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui

<span class="c1"># Connect to specific instance</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--instance-id<span class="w"> </span>station2

<span class="c1"># Start minimized</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--minimized

<span class="c1"># Custom config location</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--config-path<span class="w"> </span>/path/to/config.json
</code></pre></div>

<hr />
<h2 id="system-tray">System Tray</h2>
<p>The GUI can minimize to the system tray:</p>
<ul>
<li><strong>Double-click</strong> tray icon to restore window</li>
<li><strong>Right-click</strong> for context menu:</li>
<li>Show/Hide window</li>
<li>View status</li>
<li>Open logs folder</li>
<li>Exit</li>
</ul>
<h3 id="tray-notifications">Tray Notifications</h3>
<p>When minimized, the GUI shows notifications for:<br />
- Upload completed<br />
- Upload failed<br />
- Connection lost/restored<br />
- Service stopped</p>
<p>Notifications can be disabled in settings.</p>
<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="gui-wont-start">GUI Won't Start</h3>
<p><strong>Check Qt installation:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from PySide6 import QtWidgets; print(&#39;Qt OK&#39;)&quot;</span>
</code></pre></div>

<p><strong>If import fails:</strong></p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>uninstall<span class="w"> </span>PySide6
pip<span class="w"> </span>install<span class="w"> </span>PySide6
</code></pre></div>

<p><strong>Linux: Check display server:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$DISPLAY</span><span class="w">  </span><span class="c1"># Should show :0 or similar</span>
</code></pre></div>

<h3 id="gui-cant-connect-to-service">GUI Can't Connect to Service</h3>
<ol>
<li>
<p><strong>Verify service is running:</strong><br />
<code>bash
   python -m pywats_client status --instance-id default</code></p>
</li>
<li>
<p><strong>Start service if needed:</strong><br />
<code>bash
   python -m pywats_client service --instance-id default</code></p>
</li>
<li>
<p><strong>Check instance ID matches:</strong><br />
<code>bash
   # Both must use same instance-id
   python -m pywats_client service --instance-id mystation
   python -m pywats_client gui --instance-id mystation</code></p>
</li>
</ol>
<h3 id="blank-or-frozen-ui">Blank or Frozen UI</h3>
<ol>
<li>Check log file for errors:</li>
<li>Windows: <code>%APPDATA%\pyWATS_Client\pywats_client.log</code></li>
<li>
<p>Linux: <code>~/.config/pywats_client/pywats_client.log</code></p>
</li>
<li>
<p>Try resetting GUI settings:<br />
<code>bash
   # Remove GUI settings (will use defaults)
   rm ~/.config/pywats_client/gui_settings.json</code></p>
</li>
</ol>
<h3 id="high-dpi-display-issues">High DPI Display Issues</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Force DPI scaling</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">QT_AUTO_SCREEN_SCALE_FACTOR</span><span class="o">=</span><span class="m">1</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui

<span class="c1"># Or set specific scale</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">QT_SCALE_FACTOR</span><span class="o">=</span><span class="m">1</span>.5
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui
</code></pre></div>

<hr />
<h2 id="keyboard-shortcuts">Keyboard Shortcuts</h2>
<table>
<thead>
<tr>
<th>Shortcut</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Ctrl+Q</code></td>
<td>Quit application</td>
</tr>
<tr>
<td><code>Ctrl+L</code></td>
<td>Focus log search</td>
</tr>
<tr>
<td><code>Ctrl+R</code></td>
<td>Refresh all panels</td>
</tr>
<tr>
<td><code>Ctrl+,</code></td>
<td>Open settings</td>
</tr>
<tr>
<td><code>F5</code></td>
<td>Refresh queue</td>
</tr>
<tr>
<td><code>F11</code></td>
<td>Toggle fullscreen</td>
</tr>
<tr>
<td><code>Ctrl+M</code></td>
<td>Minimize to tray</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="without-gui-headless-alternative">Without GUI (Headless Alternative)</h2>
<p>If you don't need a GUI, install the headless version instead:</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client-headless<span class="o">]</span>
</code></pre></div>

<p>This provides all service functionality via CLI and HTTP API:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check status</span>
pywats-client<span class="w"> </span>status

<span class="c1"># View queue</span>
pywats-client<span class="w"> </span>queue<span class="w"> </span>list

<span class="c1"># Control via HTTP API</span>
curl<span class="w"> </span>http://localhost:8765/status
</code></pre></div>

<p>See <a href="client.md">Client Service Guide</a> for headless operation.</p>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="client.md">Client Service Guide</a></strong> - Background service documentation</li>
<li><strong><a href="windows-service.md">Windows Service</a></strong> - Auto-start on Windows</li>
<li><strong><a href="linux-service.md">Linux Service</a></strong> - Systemd service setup</li>
<li><strong><a href="../getting-started.md">../getting-started.md</a></strong> - Complete tutorial</li>
<li><strong><a href="../client-architecture.md">../client-architecture.md</a></strong> - Architecture details</li>
</ul>
</div>


<div class="doc-separator" id="installation-docker">
    <div class="doc-source">Source: docs/installation/docker.md</div>
    <h1 id="docker-deployment-guide-for-pywats">Docker Deployment Guide for pyWATS</h1>
<p>This guide covers deploying pyWATS using Docker for various use cases.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#available-images">Available Images</a></li>
<li><a href="#production-deployment">Production Deployment</a></li>
<li><a href="#development-setup">Development Setup</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#monitoring--troubleshooting">Monitoring &amp; Troubleshooting</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="1-prerequisites">1. Prerequisites</h3>
<ul>
<li>Docker 20.10+ and Docker Compose 2.0+</li>
<li>WATS server credentials</li>
</ul>
<h3 id="2-initial-setup">2. Initial Setup</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clone the repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/olreppe/pyWATS.git
<span class="nb">cd</span><span class="w"> </span>pyWATS

<span class="c1"># Create environment file</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env

<span class="c1"># Edit .env and add your WATS credentials</span>
nano<span class="w"> </span>.env
</code></pre></div>

<h3 id="3-create-required-directories">3. Create Required Directories</h3>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>watch<span class="w"> </span>output<span class="w"> </span>archive<span class="w"> </span>config
</code></pre></div>

<h3 id="4-create-client-configuration">4. Create Client Configuration</h3>
<p>Create <code>config/client_config.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;wats&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;base_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://wats.yourcompany.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_base64_token&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;xml&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;watch_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/watch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/output&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;archive_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/archive&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;logging&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/logs/pywats_client.log&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="5-start-the-client">5. Start the Client</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start headless client</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>client

<span class="c1"># View logs</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>client

<span class="c1"># Check status</span>
docker-compose<span class="w"> </span>ps
</code></pre></div>

<hr />
<h2 id="available-images">Available Images</h2>
<p>The Dockerfile provides multiple build targets:</p>
<h3 id="1-api-only-api">1. API Only (<code>api</code>)</h3>
<p>Minimal image with just the pyWATS API library.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Build</span>
docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>api<span class="w"> </span>-t<span class="w"> </span>pywats-api<span class="w"> </span>.

<span class="c1"># Run Python with pyWATS</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>pywats-api<span class="w"> </span>python
</code></pre></div>

<p><strong>Use Cases:</strong><br />
- Python scripts that use pyWATS API<br />
- Custom applications<br />
- Lambda/serverless functions</p>
<h3 id="2-headless-client-client-headless">2. Headless Client (<code>client-headless</code>)</h3>
<p>Client without GUI for servers and embedded systems.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Build</span>
docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>client-headless<span class="w"> </span>-t<span class="w"> </span>pywats-client<span class="w"> </span>.

<span class="c1"># Run with config</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/config:/app/config:ro<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/watch:/app/watch<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/output:/app/output<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">WATS_BASE_URL</span><span class="o">=</span>https://wats.example.com<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">WATS_TOKEN</span><span class="o">=</span>your_token<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>pywats-client
</code></pre></div>

<p><strong>Use Cases:</strong><br />
- Production test data ingestion<br />
- Automated test report uploads<br />
- Headless test stations<br />
- Raspberry Pi deployments</p>
<h3 id="3-development-dev">3. Development (<code>dev</code>)</h3>
<p>Full development environment with all dependencies.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start dev container</span>
docker-compose<span class="w"> </span>--profile<span class="w"> </span>dev<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>dev

<span class="c1"># Attach to container</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>dev<span class="w"> </span>bash

<span class="c1"># Run tests</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>dev<span class="w"> </span>pytest

<span class="c1"># Build docs</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>dev<span class="w"> </span>sphinx-build<span class="w"> </span>docs/api<span class="w"> </span>docs/_build/html
</code></pre></div>

<hr />
<h2 id="production-deployment">Production Deployment</h2>
<h3 id="docker-compose-recommended">Docker Compose (Recommended)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Configure environment</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env
nano<span class="w"> </span>.env

<span class="c1"># 2. Create config</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>config<span class="w"> </span>watch<span class="w"> </span>output<span class="w"> </span>archive
nano<span class="w"> </span>config/client_config.json

<span class="c1"># 3. Start services</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>client

<span class="c1"># 4. Verify</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>client
docker-compose<span class="w"> </span>ps
</code></pre></div>

<h3 id="kubernetes">Kubernetes</h3>
<p>Example deployment:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-client</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-client</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-client</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-client:latest</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WATS_BASE_URL</span>
<span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">            </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-secrets</span>
<span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base-url</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WATS_TOKEN</span>
<span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">            </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-secrets</span>
<span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/config</span>
<span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/watch</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/output</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/logs</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1Gi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-config</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-watch</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-output</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
<span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-logs</span>
</code></pre></div>

<h3 id="docker-swarm">Docker Swarm</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Initialize swarm</span>
docker<span class="w"> </span>swarm<span class="w"> </span>init

<span class="c1"># Deploy stack</span>
docker<span class="w"> </span>stack<span class="w"> </span>deploy<span class="w"> </span>-c<span class="w"> </span>docker-compose.yml<span class="w"> </span>pywats

<span class="c1"># Scale service</span>
docker<span class="w"> </span>service<span class="w"> </span>scale<span class="w"> </span><span class="nv">pywats_client</span><span class="o">=</span><span class="m">3</span>

<span class="c1"># View logs</span>
docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>pywats_client
</code></pre></div>

<hr />
<h2 id="configuration">Configuration</h2>
<h3 id="environment-variables">Environment Variables</h3>
<h4 id="required">Required</h4>
<ul>
<li><code>WATS_BASE_URL</code> - WATS server URL</li>
<li><code>WATS_TOKEN</code> - Base64-encoded credentials</li>
</ul>
<h4 id="optional">Optional</h4>
<ul>
<li><code>PYWATS_LOG_LEVEL</code> - Logging level (DEBUG, INFO, WARNING, ERROR)</li>
<li><code>PYWATS_HEADLESS</code> - Run in headless mode (default: 1 in Docker)</li>
<li><code>PYWATS_CONFIG_DIR</code> - Configuration directory (default: /app/config)</li>
<li><code>PYWATS_DATA_DIR</code> - Data directory (default: /app/data)</li>
<li><code>PYWATS_LOG_DIR</code> - Log directory (default: /app/logs)</li>
</ul>
<h3 id="volume-mounts">Volume Mounts</h3>
<table>
<thead>
<tr>
<th>Mount Point</th>
<th>Purpose</th>
<th>Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/app/config</code></td>
<td>Configuration files</td>
<td>Read-only in production</td>
</tr>
<tr>
<td><code>/app/watch</code></td>
<td>Incoming test data</td>
<td>Writable</td>
</tr>
<tr>
<td><code>/app/output</code></td>
<td>Converted reports</td>
<td>Writable</td>
</tr>
<tr>
<td><code>/app/archive</code></td>
<td>Processed files</td>
<td>Writable</td>
</tr>
<tr>
<td><code>/app/logs</code></td>
<td>Application logs</td>
<td>Persistent volume</td>
</tr>
<tr>
<td><code>/app/data</code></td>
<td>State/queue data</td>
<td>Persistent volume</td>
</tr>
</tbody>
</table>
<h3 id="health-checks">Health Checks</h3>
<p>All images include health checks:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check container health</span>
docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.State.Health.Status}}&#39;</span><span class="w"> </span>pywats-client

<span class="c1"># View health check logs</span>
docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{range .State.Health.Log}}{{.Output}}{{end}}&#39;</span><span class="w"> </span>pywats-client
</code></pre></div>

<hr />
<h2 id="monitoring-troubleshooting">Monitoring &amp; Troubleshooting</h2>
<h3 id="view-logs">View Logs</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Real-time logs</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>client

<span class="c1"># Last 100 lines</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>--tail<span class="o">=</span><span class="m">100</span><span class="w"> </span>client

<span class="c1"># Specific time range</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>--since<span class="w"> </span><span class="m">2024</span>-01-01T00:00:00<span class="w"> </span>client
</code></pre></div>

<h3 id="check-status">Check Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Container status</span>
docker-compose<span class="w"> </span>ps

<span class="c1"># Resource usage</span>
docker<span class="w"> </span>stats<span class="w"> </span>pywats-client

<span class="c1"># Health status</span>
docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.State.Health.Status}}&#39;</span><span class="w"> </span>pywats-client
</code></pre></div>

<h3 id="common-issues">Common Issues</h3>
<h4 id="container-exits-immediately">Container exits immediately</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check logs</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>client

<span class="c1"># Common causes:</span>
<span class="c1"># 1. Missing WATS_BASE_URL or WATS_TOKEN</span>
<span class="c1"># 2. Invalid configuration in config/client_config.json</span>
<span class="c1"># 3. Permission issues on mounted directories</span>
</code></pre></div>

<h4 id="cannot-connect-to-wats-server">Cannot connect to WATS server</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test network connectivity</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>client<span class="w"> </span>ping<span class="w"> </span>wats.yourcompany.com

<span class="c1"># Test WATS API</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>client<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">from pywats import pyWATS</span>
<span class="s2">api = pyWATS(base_url=&#39;https://wats.example.com&#39;, token=&#39;...&#39;)</span>
<span class="s2">print(api.test_connection())</span>
<span class="s2">&quot;</span>
</code></pre></div>

<h4 id="permission-denied-errors">Permission denied errors</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fix directory permissions (host)</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>watch<span class="w"> </span>output<span class="w"> </span>archive<span class="w"> </span>logs

<span class="c1"># Or run with specific user ID</span>
docker-compose<span class="w"> </span>run<span class="w"> </span>--user<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span>client
</code></pre></div>

<h3 id="debugging">Debugging</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start interactive shell</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>client<span class="w"> </span>bash

<span class="c1"># Or start new container with shell</span>
docker-compose<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>client<span class="w"> </span>bash

<span class="c1"># Run Python interactively</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>client<span class="w"> </span>python
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="multi-stage-builds">Multi-Stage Builds</h3>
<p>Build only what you need:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># API only (smallest)</span>
docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>api<span class="w"> </span>-t<span class="w"> </span>pywats-api:latest<span class="w"> </span>.

<span class="c1"># Headless client</span>
docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>client-headless<span class="w"> </span>-t<span class="w"> </span>pywats-client:latest<span class="w"> </span>.

<span class="c1"># Development (largest)</span>
docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>dev<span class="w"> </span>-t<span class="w"> </span>pywats-dev:latest<span class="w"> </span>.
</code></pre></div>

<h3 id="custom-configuration">Custom Configuration</h3>
<p>Override defaults with <code>docker-compose.override.yml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">client</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">PYWATS_LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/custom/watch:/app/watch</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/custom/output:/app/output</span>
</code></pre></div>

<h3 id="resource-limits">Resource Limits</h3>
<p>Adjust in <code>docker-compose.yml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">deploy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;4&#39;</span><span class="w">      </span><span class="c1"># Max CPUs</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2G</span><span class="w">     </span><span class="c1"># Max memory</span>
<span class="w">    </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="w">      </span><span class="c1"># Min CPUs</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span><span class="w">   </span><span class="c1"># Min memory</span>
</code></pre></div>

<h3 id="network-configuration">Network Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create custom network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>--driver<span class="w"> </span>bridge<span class="w"> </span>pywats-net

<span class="c1"># Run with custom network</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>pywats-net<span class="w"> </span>pywats-client
</code></pre></div>

<h3 id="cicd-integration">CI/CD Integration</h3>
<p>GitHub Actions example:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Docker Image</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build image</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build --target client-headless -t pywats-client:latest .</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test image</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">docker run --rm pywats-client python -c &quot;import pywats; print(&#39;OK&#39;)&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Push to registry</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">echo &quot;${{ secrets.DOCKER_PASSWORD }}&quot; | docker login -u &quot;${{ secrets.DOCKER_USERNAME }}&quot; --password-stdin</span>
<span class="w">          </span><span class="no">docker push pywats-client:latest</span>
</code></pre></div>

<hr />
<h2 id="security-considerations">Security Considerations</h2>
<ol>
<li><strong>Never commit <code>.env</code> files</strong> - Use secrets management</li>
<li><strong>Use read-only config mounts</strong> - Prevent container from modifying config</li>
<li><strong>Run as non-root</strong> - All images use non-root user (uid 1000)</li>
<li><strong>Scan images</strong> - <code>docker scan pywats-client</code></li>
<li><strong>Use HTTPS</strong> - Always use TLS for WATS connections</li>
<li><strong>Rotate credentials</strong> - Update <code>WATS_TOKEN</code> regularly</li>
<li><strong>Network isolation</strong> - Use Docker networks to restrict access</li>
</ol>
<hr />
<h2 id="support">Support</h2>
<ul>
<li><strong>Documentation:</strong> https://github.com/olreppe/pyWATS/tree/main/docs</li>
<li><strong>Issues:</strong> https://github.com/olreppe/pyWATS/issues</li>
<li><strong>Email:</strong> support@virinco.com</li>
</ul>
<hr />
<p><strong>Last Updated:</strong> January 23, 2026<br />
<strong>Version:</strong> 0.1.0b34</p>
</div>


<div class="doc-separator" id="installation-windows-service">
    <div class="doc-source">Source: docs/installation/windows-service.md</div>
    <h1 id="windows-service-installation">Windows Service Installation</h1>
<p>This guide explains how to install pyWATS Client as a Windows Service that auto-starts on system boot.</p>
<h2 id="overview">Overview</h2>
<p>The pyWATS Client can run as a Windows Service in the background, automatically starting when Windows boots. This is the recommended setup for production environments.</p>
<p><strong>Folder Structure:</strong><br />
- <strong>Installation</strong>: <code>C:\Program Files\Virinco\pyWATS\</code> (binaries)<br />
- <strong>Data/Config</strong>: <code>C:\ProgramData\Virinco\pyWATS\</code> (configuration, logs, queues)<br />
- <strong>Service Name</strong>: <code>pyWATS_Service</code> (appears in Task Manager/Services)</p>
<p>This matches the existing WATS Client installation pattern.</p>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="required">Required</h3>
<ul>
<li>Windows 10/11 or Windows Server 2016+</li>
<li>Python 3.10 or later</li>
<li>Administrator privileges</li>
</ul>
<h3 id="recommended-nssm-non-sucking-service-manager">Recommended: NSSM (Non-Sucking Service Manager)</h3>
<p>NSSM provides the best Windows Service experience with:<br />
- Easy service installation/removal<br />
- Automatic log rotation<br />
- Crash recovery<br />
- Better process management</p>
<p><strong>Download NSSM:</strong><br />
1. Visit: https://nssm.cc/download<br />
2. Download the latest version (2.24+)<br />
3. Extract <code>nssm.exe</code> to <code>C:\Program Files\NSSM\</code> or any PATH location</p>
<p><strong>Alternative:</strong> The installer can use <code>sc.exe</code> (built into Windows), but this has limitations.</p>
<h2 id="installation">Installation</h2>
<h3 id="option-1-using-nssm-recommended">Option 1: Using NSSM (Recommended)</h3>
<ol>
<li>
<p><strong>Install pyWATS Client</strong> (if not already installed):<br />
<code>powershell
   pip install pywats-api[client]</code></p>
</li>
<li>
<p><strong>Install the service</strong> (run as Administrator):<br />
<code>powershell
   python -m pywats_client install-service</code></p>
</li>
</ol>
<p>This will:<br />
   - Create service <code>pyWATS_Service</code><br />
   - Set auto-start on boot<br />
   - Configure logging to <code>C:\ProgramData\Virinco\pyWATS\logs\</code><br />
   - Use default configuration</p>
<ol>
<li><strong>Start the service</strong>:<br />
<code>powershell
   net start pyWATS_Service</code><br />
   or<br />
<code>powershell
   nssm start pyWATS_Service</code></li>
</ol>
<h3 id="option-2-native-windows-service-recommended-for-enterprise">Option 2: Native Windows Service (Recommended for Enterprise)</h3>
<p>The native Windows service uses pywin32 and provides:<br />
- <strong>Appears in Task Manager</strong> ‚Üí Services tab<br />
- <strong>Automatic restart on failure</strong> (5s/5s/30s delays)<br />
- <strong>Delayed auto-start</strong> (waits for network services)<br />
- <strong>Windows Event Log integration</strong> (events in Event Viewer)</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Install native service (run as Administrator)</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-native</span>

<span class="c"># Start the service</span>
<span class="n">net</span> <span class="nb">start </span><span class="n">pyWATS_Service</span>
</code></pre></div>

<p><strong>Features automatically configured:</strong><br />
- Service recovery: restarts after 5s on first two failures, 30s thereafter<br />
- Delayed start: waits for network to be ready before starting<br />
- Event logging: service events written to Windows Event Log</p>
<h3 id="option-3-using-scexe-fallback">Option 3: Using sc.exe (Fallback)</h3>
<p>If NSSM is not available:</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-use-sc</span>
<span class="n">net</span> <span class="nb">start </span><span class="n">pyWATS_Service</span>
</code></pre></div>

<p><strong>Note:</strong> <code>sc.exe</code> has limitations (no automatic log rotation, limited crash recovery).</p>
<h2 id="multi-instance-installation">Multi-Instance Installation</h2>
<p>For multi-station setups where you need multiple services (one per test station):</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Install service for Station A</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">station_a</span> <span class="p">-</span><span class="n">-config</span> <span class="s2">&quot;C:\ProgramData\Virinco\pyWATS\config_station_a.json&quot;</span>

<span class="c"># Install service for Station B</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">station_b</span> <span class="p">-</span><span class="n">-config</span> <span class="s2">&quot;C:\ProgramData\Virinco\pyWATS\config_station_b.json&quot;</span>
</code></pre></div>

<p>Each instance will have:<br />
- Service name: <code>pyWATS_Service_station_a</code>, <code>pyWATS_Service_station_b</code><br />
- Separate logs: <code>pyWATS_Service_station_a.log</code>, <code>pyWATS_Service_station_b.log</code><br />
- Independent configuration files</p>
<h2 id="service-management">Service Management</h2>
<h3 id="check-service-status">Check Service Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Using sc.exe</span>
<span class="nb">sc </span><span class="n">query</span> <span class="n">pyWATS_Service</span>

<span class="c"># Using NSSM</span>
<span class="n">nssm</span> <span class="n">status</span> <span class="n">pyWATS_Service</span>

<span class="c"># Using services.msc GUI</span>
<span class="n">services</span><span class="p">.</span><span class="n">msc</span>
</code></pre></div>

<h3 id="startstoprestart">Start/Stop/Restart</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Start</span>
<span class="n">net</span> <span class="nb">start </span><span class="n">pyWATS_Service</span>

<span class="c"># Stop</span>
<span class="n">net</span> <span class="n">stop</span> <span class="n">pyWATS_Service</span>

<span class="c"># Restart</span>
<span class="n">net</span> <span class="n">stop</span> <span class="n">pyWATS_Service</span> <span class="p">&amp;&amp;</span> <span class="n">net</span> <span class="nb">start </span><span class="n">pyWATS_Service</span>

<span class="c"># Or with NSSM</span>
<span class="n">nssm</span> <span class="n">restart</span> <span class="n">pyWATS_Service</span>
</code></pre></div>

<h3 id="view-logs">View Logs</h3>
<p>Logs are written to <code>C:\ProgramData\Virinco\pyWATS\logs\</code>:<br />
- <code>pyWATS_Service.log</code> - Standard output<br />
- <code>pyWATS_Service_error.log</code> - Error output</p>
<div class="codehilite"><pre><span></span><code><span class="c"># View latest logs</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\ProgramData\Virinco\pyWATS\logs\pyWATS_Service.log&quot;</span> <span class="n">-Tail</span> <span class="n">50</span>

<span class="c"># Monitor live</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\ProgramData\Virinco\pyWATS\logs\pyWATS_Service.log&quot;</span> <span class="n">-Wait</span>
</code></pre></div>

<h3 id="uninstall-service">Uninstall Service</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Stop and remove</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">uninstall-service</span>

<span class="c"># For specific instance</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">uninstall-service</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">station_a</span>
</code></pre></div>

<h2 id="configuration">Configuration</h2>
<h3 id="default-configuration">Default Configuration</h3>
<p>The service uses configuration from:<br />
- Default: <code>C:\ProgramData\Virinco\pyWATS\config.json</code><br />
- Custom: Specify with <code>--config</code> during installation</p>
<h3 id="changing-configuration">Changing Configuration</h3>
<p><strong>Option 1: Using GUI</strong><br />
1. Run the pyWATS Client GUI<br />
2. It will discover the running service<br />
3. Make configuration changes in the GUI<br />
4. Changes are sent via IPC to the service</p>
<p><strong>Option 2: Edit config.json</strong><br />
1. Stop the service: <code>net stop pyWATS_Service</code><br />
2. Edit: <code>C:\ProgramData\Virinco\pyWATS\config.json</code><br />
3. Start the service: <code>net start pyWATS_Service</code></p>
<p><strong>Option 3: Reinstall with new config</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">uninstall-service</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-config</span> <span class="s2">&quot;C:\path\to\new\config.json&quot;</span>
<span class="n">net</span> <span class="nb">start </span><span class="n">pyWATS_Service</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="service-wont-start">Service Won't Start</h3>
<ol>
<li>
<p><strong>Check logs</strong>:<br />
<code>powershell
   Get-Content "C:\ProgramData\Virinco\pyWATS\logs\pyWATS_Service_error.log"</code></p>
</li>
<li>
<p><strong>Test service command manually</strong>:<br />
<code>powershell
   python -m pywats_client service --instance-id default</code></p>
</li>
</ol>
<p>This runs the service in foreground mode for debugging.</p>
<ol>
<li><strong>Verify Python path</strong>:<br />
<code>powershell
   where python</code></li>
</ol>
<p>NSSM uses the Python executable from your PATH. Make sure it's correct.</p>
<h3 id="permission-errors">Permission Errors</h3>
<p>The service runs under the SYSTEM account by default. If you need access to network shares or user-specific resources:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Change service account (NSSM)</span>
<span class="n">nssm</span> <span class="nb">set </span><span class="n">pyWATS_Service</span> <span class="n">ObjectName</span> <span class="s2">&quot;DOMAIN\Username&quot;</span> <span class="s2">&quot;Password&quot;</span>

<span class="c"># Or use sc.exe</span>
<span class="nb">sc </span><span class="n">config</span> <span class="n">pyWATS_Service</span> <span class="n">obj</span><span class="p">=</span> <span class="s2">&quot;DOMAIN\Username&quot;</span> <span class="n">password</span><span class="p">=</span> <span class="s2">&quot;Password&quot;</span>
</code></pre></div>

<h3 id="service-crashes">Service Crashes</h3>
<p>NSSM automatically restarts crashed services. Check logs for crash details:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">Get-Content</span> <span class="s2">&quot;C:\ProgramData\Virinco\pyWATS\logs\pyWATS_Service_error.log&quot;</span> <span class="n">-Tail</span> <span class="n">100</span>
</code></pre></div>

<p>To disable auto-restart (for debugging):</p>
<div class="codehilite"><pre><span></span><code><span class="n">nssm</span> <span class="nb">set </span><span class="n">pyWATS_Service</span> <span class="n">AppExit</span> <span class="k">Default</span> <span class="n">Exit</span>
</code></pre></div>

<h3 id="multiple-instances-conflict">Multiple Instances Conflict</h3>
<p>If you see errors about ports or IPC endpoints already in use:</p>
<ol>
<li>Each instance needs a unique <code>--instance-id</code></li>
<li>
<p>Check running services:<br />
<code>powershell
   sc query type= service state= all | findstr "pyWATS"</code></p>
</li>
<li>
<p>Stop conflicting instances:<br />
<code>powershell
   net stop pyWATS_Service
   net stop pyWATS_Service_station_a</code></p>
</li>
</ol>
<h2 id="silent-installation-it-deployment">Silent Installation (IT Deployment)</h2>
<p>For scripted deployment via GPO, SCCM, or automation tools:</p>
<h3 id="basic-silent-install">Basic Silent Install</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Install silently with native service</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-native</span> <span class="p">-</span><span class="n">-silent</span>

<span class="c"># Check exit code</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$LASTEXITCODE</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Error</span> <span class="s2">&quot;Installation failed with exit code $LASTEXITCODE&quot;</span>
    <span class="n">exit</span> <span class="n">1</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="silent-install-with-configuration">Silent Install with Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-native</span> <span class="p">-</span><span class="n">-silent</span> <span class="p">`</span>
    <span class="p">-</span><span class="n">-server-url</span> <span class="s2">&quot;https://wats.company.com&quot;</span> <span class="p">`</span>
    <span class="p">-</span><span class="n">-api-token</span> <span class="s2">&quot;your-api-token&quot;</span> <span class="p">`</span>
    <span class="p">-</span><span class="n">-watch-folder</span> <span class="s2">&quot;C:\TestReports&quot;</span>
</code></pre></div>

<h3 id="exit-codes">Exit Codes</h3>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Success</td>
</tr>
<tr>
<td>1</td>
<td>General error</td>
</tr>
<tr>
<td>2</td>
<td>Missing requirements (Python version, pywin32)</td>
</tr>
<tr>
<td>10</td>
<td>Service already installed</td>
</tr>
<tr>
<td>11</td>
<td>Service not installed (uninstall)</td>
</tr>
<tr>
<td>14</td>
<td>Permission denied (need Administrator)</td>
</tr>
<tr>
<td>41</td>
<td>Server unreachable</td>
</tr>
</tbody>
</table>
<h3 id="example-deployment-script">Example Deployment Script</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># deploy_pywats.ps1 - Silent deployment script</span>

<span class="k">param</span><span class="p">(</span>
    <span class="no">[string]</span><span class="nv">$ServerUrl</span> <span class="p">=</span> <span class="s2">&quot;https://wats.company.com&quot;</span><span class="p">,</span>
    <span class="no">[string]</span><span class="nv">$ApiToken</span><span class="p">,</span>
    <span class="no">[string]</span><span class="nv">$WatchFolder</span> <span class="p">=</span> <span class="s2">&quot;C:\TestReports&quot;</span>
<span class="p">)</span>

<span class="c"># Ensure admin privileges</span>
<span class="k">if</span> <span class="p">(</span><span class="o">-NOT</span> <span class="p">(</span><span class="no">[Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]</span><span class="p">::</span><span class="n">GetCurrent</span><span class="p">()).</span><span class="n">IsInRole</span><span class="p">(</span><span class="no">[Security.Principal.WindowsBuiltInRole]</span> <span class="s2">&quot;Administrator&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">Write-Error</span> <span class="s2">&quot;Administrator privileges required&quot;</span>
    <span class="n">exit</span> <span class="n">14</span>
<span class="p">}</span>

<span class="c"># Install Python package (if needed)</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pywats-api</span><span class="no">[client]</span> <span class="p">-</span><span class="n">-quiet</span>

<span class="c"># Install service</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-native</span> <span class="p">-</span><span class="n">-silent</span> <span class="p">`</span>
    <span class="p">-</span><span class="n">-server-url</span> <span class="nv">$ServerUrl</span> <span class="p">`</span>
    <span class="p">-</span><span class="n">-api-token</span> <span class="nv">$ApiToken</span> <span class="p">`</span>
    <span class="p">-</span><span class="n">-watch-folder</span> <span class="nv">$WatchFolder</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$LASTEXITCODE</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Error</span> <span class="s2">&quot;Service installation failed: exit code $LASTEXITCODE&quot;</span>
    <span class="n">exit</span> <span class="nv">$LASTEXITCODE</span>
<span class="p">}</span>

<span class="c"># Start service</span>
<span class="n">net</span> <span class="nb">start </span><span class="n">pyWATS_Service</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;pyWATS Service installed and started successfully&quot;</span>
</code></pre></div>

<h2 id="event-log">Event Log</h2>
<p>When using <code>--native</code>, the service writes to Windows Event Log:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># View pyWATS events in Event Viewer</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Application</span> <span class="n">-Source</span> <span class="s2">&quot;pyWATS&quot;</span> <span class="n">-Newest</span> <span class="n">20</span>
</code></pre></div>

<p>Events include:<br />
- Service installation/uninstallation<br />
- Service start/stop<br />
- Errors and warnings</p>
<h2 id="advanced-configuration">Advanced Configuration</h2>
<h3 id="custom-service-name">Custom Service Name</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Edit WindowsServiceInstaller.SERVICE_NAME in:</span>
<span class="c"># src/pywats_client/control/windows_service.py</span>
</code></pre></div>

<h3 id="environment-variables">Environment Variables</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Set environment variables for the service</span>
<span class="n">nssm</span> <span class="nb">set </span><span class="n">pyWATS_Service</span> <span class="n">AppEnvironmentExtra</span> <span class="n">PYTHONPATH</span><span class="p">=</span><span class="n">C</span><span class="p">:\</span><span class="n">custom</span><span class="p">\</span><span class="n">path</span>
</code></pre></div>

<h3 id="delayed-start">Delayed Start</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Start service 2 minutes after boot</span>
<span class="nb">sc </span><span class="n">config</span> <span class="n">pyWATS_Service</span> <span class="n">start</span><span class="p">=</span> <span class="n">delayed-auto</span>
</code></pre></div>

<h2 id="gui-discovery">GUI Discovery</h2>
<p>When you open the pyWATS Client GUI:</p>
<ol>
<li><strong>Discovery</strong>: GUI scans for running service instances</li>
<li><strong>Instance Selector</strong>: Shows all discovered services</li>
<li><strong>Connect</strong>: Select an instance to view/configure</li>
<li><strong>Status</strong>: Live status updates via IPC</li>
</ol>
<p>The GUI never auto-starts services - they must be started separately (manually or via Windows Service).</p>
<h2 id="comparison-with-manual-start">Comparison with Manual Start</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Auto-Start</th>
<th>Survives Reboot</th>
<th>Crash Recovery</th>
<th>Service Management</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Windows Service</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì (NSSM)</td>
<td>services.msc, sc.exe</td>
</tr>
<tr>
<td><strong>Manual (GUI)</strong></td>
<td>‚úó</td>
<td>‚úó</td>
<td>‚úó</td>
<td>Task Manager</td>
</tr>
<tr>
<td><strong>Task Scheduler</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úó</td>
<td>taskschd.msc</td>
</tr>
<tr>
<td><strong>Startup Folder</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úó</td>
<td>Manual</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation:</strong> Use Windows Service for production environments.</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../getting-started.md">Getting Started</a> - Basic client usage</li>
<li><a href="client.md">Client Installation</a> - Installation guide</li>
<li><a href="https://nssm.cc/usage">NSSM Documentation</a> - Full NSSM options</li>
</ul>
</div>


<div class="doc-separator" id="installation-linux-service">
    <div class="doc-source">Source: docs/installation/linux-service.md</div>
    <h1 id="linux-systemd-service-installation">Linux systemd Service Installation</h1>
<p>This guide explains how to install pyWATS Client as a Linux systemd service that auto-starts on system boot.</p>
<h2 id="overview">Overview</h2>
<p>The pyWATS Client can run as a systemd service in the background, automatically starting when Linux boots. This is the recommended setup for production environments.</p>
<p><strong>System Compatibility:</strong><br />
- Ubuntu 16.04+ / Debian 8+<br />
- RHEL/CentOS 7+<br />
- Fedora 15+<br />
- Any systemd-based Linux distribution</p>
<p><strong>Folder Structure:</strong><br />
- <strong>System-wide</strong>: <code>/var/lib/pywats/</code> (configuration, logs, queues)<br />
- <strong>User-specific</strong>: <code>~/.config/pywats_client/</code><br />
- <strong>Service files</strong>: <code>/etc/systemd/system/</code></p>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="required">Required</h3>
<ul>
<li>Linux with systemd (check: <code>systemctl --version</code>)</li>
<li>Python 3.10 or later</li>
<li>Root privileges (for system-wide installation)</li>
</ul>
<h3 id="check-systemd">Check systemd</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify systemd is running</span>
systemctl<span class="w"> </span>--version

<span class="c1"># Should show systemd version (e.g., systemd 245)</span>
</code></pre></div>

<h2 id="installation">Installation</h2>
<h3 id="system-wide-installation-recommended">System-Wide Installation (Recommended)</h3>
<p>Installs service that runs at boot, before user login.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install pyWATS Client</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Install as systemd service (requires sudo)</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service

<span class="c1"># Start the service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service

<span class="c1"># Check status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pywats-service
</code></pre></div>

<p>This creates:<br />
- Service: <code>pywats-service.service</code><br />
- Auto-start: Enabled<br />
- Logs: <code>journalctl -u pywats-service</code><br />
- Data directory: <code>/var/lib/pywats/</code></p>
<h3 id="user-level-installation">User-Level Installation</h3>
<p>Installs service that runs when specific user logs in.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install pyWATS Client</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Install as user service (specify your username)</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span>--user<span class="w"> </span><span class="nv">$USER</span>

<span class="c1"># Start the service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service

<span class="c1"># Check status</span>
systemctl<span class="w"> </span>status<span class="w"> </span>pywats-service
</code></pre></div>

<p>This creates:<br />
- Service runs as your user account<br />
- Data directory: <code>~/.config/pywats_client/</code><br />
- User-specific permissions</p>
<h2 id="multi-instance-installation">Multi-Instance Installation</h2>
<p>For multi-station setups where you need multiple services (one per test station):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create separate config files</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/pywats
sudo<span class="w"> </span>cp<span class="w"> </span>config.json<span class="w"> </span>/var/lib/pywats/config_station_a.json
sudo<span class="w"> </span>cp<span class="w"> </span>config.json<span class="w"> </span>/var/lib/pywats/config_station_b.json

<span class="c1"># Install service for Station A</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--instance-id<span class="w"> </span>station_a<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>/var/lib/pywats/config_station_a.json<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--user<span class="w"> </span>pywats

<span class="c1"># Install service for Station B</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--instance-id<span class="w"> </span>station_b<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>/var/lib/pywats/config_station_b.json<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--user<span class="w"> </span>pywats

<span class="c1"># Start both services</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service@station_a
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service@station_b
</code></pre></div>

<p>Each instance will have:<br />
- Service name: <code>pywats-service@station_a.service</code>, <code>pywats-service@station_b.service</code><br />
- Separate configurations<br />
- Independent logging</p>
<h2 id="service-management">Service Management</h2>
<h3 id="check-service-status">Check Service Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pywats-service

<span class="c1"># Check if enabled</span>
systemctl<span class="w"> </span>is-enabled<span class="w"> </span>pywats-service

<span class="c1"># Check if running</span>
systemctl<span class="w"> </span>is-active<span class="w"> </span>pywats-service
</code></pre></div>

<h3 id="startstoprestart">Start/Stop/Restart</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service

<span class="c1"># Stop</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>pywats-service

<span class="c1"># Restart</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>pywats-service

<span class="c1"># Reload configuration (without restart)</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>pywats-service
</code></pre></div>

<h3 id="enabledisable-auto-start">Enable/Disable Auto-Start</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable (auto-start on boot)</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>pywats-service

<span class="c1"># Disable (don&#39;t auto-start)</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>pywats-service

<span class="c1"># Check status</span>
systemctl<span class="w"> </span>is-enabled<span class="w"> </span>pywats-service
</code></pre></div>

<h3 id="view-logs">View Logs</h3>
<p>systemd logs all service output to the journal:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View all logs</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service

<span class="c1"># Follow logs (live)</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>-f

<span class="c1"># Last 50 lines</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span>

<span class="c1"># Since last boot</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>-b

<span class="c1"># Last hour</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;1 hour ago&quot;</span>

<span class="c1"># With timestamps</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>-o<span class="w"> </span>short-iso
</code></pre></div>

<h3 id="uninstall-service">Uninstall Service</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop and remove</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service

<span class="c1"># For specific instance</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service<span class="w"> </span>--instance-id<span class="w"> </span>station_a

<span class="c1"># Verify removal</span>
systemctl<span class="w"> </span>list-units<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats
</code></pre></div>

<h2 id="silent-installation-it-deployment">Silent Installation (IT Deployment)</h2>
<p>For automated deployment via Ansible, Puppet, Chef, or shell scripts, use silent mode with exit codes.</p>
<h3 id="silent-mode-parameters">Silent Mode Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--silent</code></td>
<td>Suppress all output (exit codes only)</td>
</tr>
<tr>
<td><code>--server-url URL</code></td>
<td>Pre-configure WATS server URL</td>
</tr>
<tr>
<td><code>--api-token TOKEN</code></td>
<td>Pre-configure API token</td>
</tr>
<tr>
<td><code>--watch-folder PATH</code></td>
<td>Pre-configure watch folder path</td>
</tr>
<tr>
<td><code>--skip-preflight</code></td>
<td>Skip connectivity checks</td>
</tr>
<tr>
<td><code>--instance-id ID</code></td>
<td>Create named instance</td>
</tr>
<tr>
<td><code>--user USERNAME</code></td>
<td>Run service as specific user</td>
</tr>
</tbody>
</table>
<h3 id="exit-codes">Exit Codes</h3>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Success</td>
</tr>
<tr>
<td>1</td>
<td>General error</td>
</tr>
<tr>
<td>2</td>
<td>Missing requirements (systemd not available)</td>
</tr>
<tr>
<td>10</td>
<td>Service already installed</td>
</tr>
<tr>
<td>11</td>
<td>Service not installed (uninstall)</td>
</tr>
<tr>
<td>14</td>
<td>Permission denied (not running as root)</td>
</tr>
<tr>
<td>20-22</td>
<td>Configuration errors</td>
</tr>
<tr>
<td>30</td>
<td>Server unreachable</td>
</tr>
</tbody>
</table>
<h3 id="bash-deployment-script">Bash Deployment Script</h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># deploy_pywats.sh - Silent deployment for Ubuntu/Debian</span>

<span class="nb">set</span><span class="w"> </span>-e

<span class="nv">WATS_SERVER</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span>
<span class="nv">API_TOKEN</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="nv">WATCH_FOLDER</span><span class="o">=</span><span class="s2">&quot;/data/reports&quot;</span>
<span class="nv">SERVICE_USER</span><span class="o">=</span><span class="s2">&quot;pywats&quot;</span>

<span class="c1"># Create service user if not exists</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SERVICE_USER</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>useradd<span class="w"> </span>-r<span class="w"> </span>-m<span class="w"> </span>-d<span class="w"> </span>/var/lib/pywats<span class="w"> </span>-s<span class="w"> </span>/bin/false<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SERVICE_USER</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="c1"># Create directories</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/pywats<span class="w"> </span>/var/log/pywats<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$WATCH_FOLDER</span><span class="s2">&quot;</span>
chown<span class="w"> </span>-R<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SERVICE_USER</span><span class="s2">:</span><span class="nv">$SERVICE_USER</span><span class="s2">&quot;</span><span class="w"> </span>/var/lib/pywats<span class="w"> </span>/var/log/pywats

<span class="c1"># Install Python package</span>
pip3<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span><span class="w"> </span>--quiet

<span class="c1"># Install service silently</span>
python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--silent<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--server-url<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$WATS_SERVER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--api-token<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$API_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--watch-folder<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$WATCH_FOLDER</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--user<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SERVICE_USER</span><span class="s2">&quot;</span>

<span class="nv">EXIT_CODE</span><span class="o">=</span><span class="nv">$?</span>

<span class="k">case</span><span class="w"> </span><span class="nv">$EXIT_CODE</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="m">0</span><span class="o">)</span><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Installation successful&quot;</span>
<span class="w">        </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="m">10</span><span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Already installed, restarting...&quot;</span>
<span class="w">        </span>systemctl<span class="w"> </span>restart<span class="w"> </span>pywats-service
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="m">14</span><span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Must run as root&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Installation failed (code </span><span class="nv">$EXIT_CODE</span><span class="s2">)&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="c1"># Verify service is running</span>
systemctl<span class="w"> </span>is-active<span class="w"> </span>pywats-service
</code></pre></div>

<h3 id="ansible-playbook">Ansible Playbook</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># deploy_pywats.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy pyWATS Client</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_stations</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">wats_server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://wats.example.com&quot;</span>
<span class="w">    </span><span class="nt">api_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_api_token</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">watch_folder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/data/reports&quot;</span>
<span class="w">    </span><span class="nt">service_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pywats&quot;</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create service user</span>
<span class="w">      </span><span class="nt">user</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">service_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">system</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">        </span><span class="nt">home</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/pywats</span>
<span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/false</span>
<span class="w">        </span><span class="nt">create_home</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create directories</span>
<span class="w">      </span><span class="nt">file</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">service_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">service_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0755&#39;</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/pywats</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/pywats</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">watch_folder</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install pyWATS</span>
<span class="w">      </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-api[client]</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install service</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">        </span><span class="no">python3 -m pywats_client install-service</span>
<span class="w">        </span><span class="no">--silent</span>
<span class="w">        </span><span class="no">--server-url {{ wats_server }}</span>
<span class="w">        </span><span class="no">--api-token {{ api_token }}</span>
<span class="w">        </span><span class="no">--watch-folder {{ watch_folder }}</span>
<span class="w">        </span><span class="no">--user {{ service_user }}</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install_result</span>
<span class="w">      </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install_result.rc == 0</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install_result.rc not in [0, 10]</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start service</span>
<span class="w">      </span><span class="nt">systemd</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pywats-service</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div>

<h3 id="query-installation-status">Query Installation Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if service is installed</span>
python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>status<span class="w"> </span>--instance-id<span class="w"> </span>default
<span class="c1"># Returns exit code 0 if installed, 11 if not</span>

<span class="c1"># Get service status</span>
systemctl<span class="w"> </span>is-active<span class="w"> </span>pywats-service<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Stopped&quot;</span>
</code></pre></div>

<h2 id="configuration">Configuration</h2>
<h3 id="default-configuration">Default Configuration</h3>
<p>The service uses configuration from:<br />
- System-wide: <code>/var/lib/pywats/config.json</code><br />
- User-specific: <code>~/.config/pywats_client/config.json</code><br />
- Custom: Specify with <code>--config</code> during installation</p>
<h3 id="changing-configuration">Changing Configuration</h3>
<p><strong>Option 1: Using GUI</strong><br />
1. Run the pyWATS Client GUI<br />
2. It will discover the running service<br />
3. Make configuration changes in the GUI<br />
4. Changes are sent via IPC to the service</p>
<p><strong>Option 2: Edit config.json</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop the service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>pywats-service

<span class="c1"># Edit configuration</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/var/lib/pywats/config.json

<span class="c1"># Start the service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service

<span class="c1"># Verify</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>-n<span class="w"> </span><span class="m">20</span>
</code></pre></div>

<p><strong>Option 3: Reinstall with new config</strong></p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span>--config<span class="w"> </span>/path/to/new/config.json
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-service
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="service-wont-start">Service Won't Start</h3>
<ol>
<li>
<p><strong>Check logs</strong>:<br />
<code>bash
   sudo journalctl -u pywats-service -n 100 --no-pager</code></p>
</li>
<li>
<p><strong>Check service file</strong>:<br />
<code>bash
   sudo systemctl cat pywats-service</code></p>
</li>
<li>
<p><strong>Test service command manually</strong>:<br />
<code>bash
   # Run in foreground for debugging
   python -m pywats_client service --instance-id default</code></p>
</li>
<li>
<p><strong>Verify Python path</strong>:<br />
<code>bash
   which python
   python --version</code></p>
</li>
<li>
<p><strong>Check permissions</strong>:<br />
<code>bash
   ls -la /var/lib/pywats/
   sudo chown -R pywats:pywats /var/lib/pywats/</code></p>
</li>
</ol>
<h3 id="permission-errors">Permission Errors</h3>
<p>If the service can't access files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create dedicated user</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-s<span class="w"> </span>/bin/false<span class="w"> </span>pywats

<span class="c1"># Set ownership</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>pywats:pywats<span class="w"> </span>/var/lib/pywats/

<span class="c1"># Reinstall with user</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span>--user<span class="w"> </span>pywats
</code></pre></div>

<h3 id="service-keeps-restarting">Service Keeps Restarting</h3>
<p>The service is configured to automatically restart on failure. Check why it's failing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View recent crashes</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pywats-service<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;10 minutes ago&quot;</span>

<span class="c1"># Disable auto-restart temporarily</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>edit<span class="w"> </span>pywats-service
<span class="c1"># Add:</span>
<span class="c1"># [Service]</span>
<span class="c1"># Restart=no</span>

sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>pywats-service
</code></pre></div>

<h3 id="port-already-in-use">Port Already in Use</h3>
<p>If you see "Address already in use" errors:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check what&#39;s using the port</span>
sudo<span class="w"> </span>netstat<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8765

<span class="c1"># Or with ss</span>
sudo<span class="w"> </span>ss<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8765

<span class="c1"># Kill the conflicting process or change port in config</span>
</code></pre></div>

<h3 id="multiple-instances-conflict">Multiple Instances Conflict</h3>
<p>If you see errors about IPC endpoints already in use:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># List all pyWATS services</span>
systemctl<span class="w"> </span>list-units<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats

<span class="c1"># Check each one</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pywats-service
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pywats-service@station_a

<span class="c1"># Ensure each has unique instance-id</span>
</code></pre></div>

<h2 id="advanced-configuration">Advanced Configuration</h2>
<h3 id="custom-user-and-group">Custom User and Group</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create dedicated user</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-m<span class="w"> </span>-d<span class="w"> </span>/var/lib/pywats<span class="w"> </span>-s<span class="w"> </span>/bin/false<span class="w"> </span>pywats

<span class="c1"># Install with custom user</span>
sudo<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span>--user<span class="w"> </span>pywats
</code></pre></div>

<h3 id="environment-variables">Environment Variables</h3>
<p>Edit the service file:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>edit<span class="w"> </span>pywats-service<span class="w"> </span>--full
</code></pre></div>

<p>Add environment variables:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[Service]</span>
<span class="na">Environment</span><span class="o">=</span><span class="s">&quot;PYTHONPATH=/custom/path&quot;</span>
<span class="na">Environment</span><span class="o">=</span><span class="s">&quot;PYWATS_LOG_LEVEL=DEBUG&quot;</span>
</code></pre></div>

<p>Then reload:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>pywats-service
</code></pre></div>

<h3 id="resource-limits">Resource Limits</h3>
<p>The service unit file includes production-hardened defaults:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[Service]</span>
<span class="c1"># Memory and CPU limits</span>
<span class="na">MemoryMax</span><span class="o">=</span><span class="s">512M</span>
<span class="na">CPUQuota</span><span class="o">=</span><span class="s">80%</span>
<span class="na">LimitNOFILE</span><span class="o">=</span><span class="s">65535</span>
<span class="na">LimitNPROC</span><span class="o">=</span><span class="s">4096</span>

<span class="c1"># Watchdog (service health monitoring)</span>
<span class="na">Type</span><span class="o">=</span><span class="s">notify</span>
<span class="na">WatchdogSec</span><span class="o">=</span><span class="s">60s</span>

<span class="c1"># Security hardening</span>
<span class="na">NoNewPrivileges</span><span class="o">=</span><span class="s">true</span>
<span class="na">PrivateTmp</span><span class="o">=</span><span class="s">true</span>
<span class="na">ProtectSystem</span><span class="o">=</span><span class="s">strict</span>
<span class="na">ProtectHome</span><span class="o">=</span><span class="s">read-only</span>
<span class="na">PrivateDevices</span><span class="o">=</span><span class="s">true</span>
<span class="na">ProtectKernelTunables</span><span class="o">=</span><span class="s">true</span>
<span class="na">ProtectKernelModules</span><span class="o">=</span><span class="s">true</span>
<span class="na">ProtectControlGroups</span><span class="o">=</span><span class="s">true</span>

<span class="c1"># Capability restrictions</span>
<span class="na">CapabilityBoundingSet</span><span class="o">=</span><span class="s">CAP_NET_BIND_SERVICE</span>

<span class="c1"># System call filtering</span>
<span class="na">SystemCallArchitectures</span><span class="o">=</span><span class="s">native</span>
<span class="na">SystemCallFilter</span><span class="o">=</span><span class="s">@system-service</span>
</code></pre></div>

<p>To customize limits, override with:</p>
<h3 id="network-dependencies">Network Dependencies</h3>
<p>If pyWATS needs specific network services:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>edit<span class="w"> </span>pywats-service<span class="w"> </span>--full
</code></pre></div>

<p>Add dependencies:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">After</span><span class="o">=</span><span class="s">network-online.target postgresql.service</span>
<span class="na">Requires</span><span class="o">=</span><span class="s">network-online.target</span>
</code></pre></div>

<h2 id="gui-discovery">GUI Discovery</h2>
<p>When you open the pyWATS Client GUI on Linux:</p>
<ol>
<li><strong>Discovery</strong>: GUI scans for running service instances via IPC</li>
<li><strong>Instance Selector</strong>: Shows all discovered services</li>
<li><strong>Connect</strong>: Select an instance to view/configure</li>
<li><strong>Status</strong>: Live status updates via IPC</li>
</ol>
<p>The GUI never auto-starts services - they must be started separately via systemd.</p>
<h2 id="comparison-with-other-methods">Comparison with Other Methods</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Auto-Start</th>
<th>Survives Reboot</th>
<th>Crash Recovery</th>
<th>Service Management</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>systemd</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
<td>systemctl, journalctl</td>
</tr>
<tr>
<td><strong>Manual (GUI)</strong></td>
<td>‚úó</td>
<td>‚úó</td>
<td>‚úó</td>
<td>Terminal</td>
</tr>
<tr>
<td><strong>cron @reboot</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úó</td>
<td>crontab</td>
</tr>
<tr>
<td><strong>init.d script</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úó</td>
<td>service command</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation:</strong> Use systemd for production environments.</p>
<h2 id="ubuntu-specific-notes">Ubuntu Specific Notes</h2>
<h3 id="ubuntu-2204-lts-jammy">Ubuntu 22.04 LTS (Jammy)</h3>
<p>Fully supported. systemd 249.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python3<span class="w"> </span>python3-pip
pip3<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service
</code></pre></div>

<h3 id="ubuntu-2004-lts-focal">Ubuntu 20.04 LTS (Focal)</h3>
<p>Fully supported. systemd 245.</p>
<h3 id="ubuntu-1804-lts-bionic">Ubuntu 18.04 LTS (Bionic)</h3>
<p>Supported. systemd 237.</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../getting-started.md">Getting Started</a> - Basic client usage</li>
<li><a href="client.md">Client Installation</a> - Installation guide</li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd documentation</a></li>
</ul>
</div>


<div class="doc-separator" id="installation-macos-service">
    <div class="doc-source">Source: docs/installation/macos-service.md</div>
    <h1 id="macos-launchd-service-installation">macOS launchd Service Installation</h1>
<p>This guide explains how to install pyWATS Client as a macOS launchd service that auto-starts on system boot.</p>
<h2 id="overview">Overview</h2>
<p>The pyWATS Client can run as a launchd daemon/agent in the background, automatically starting when macOS boots or when you log in.</p>
<p><strong>Service Types:</strong><br />
- <strong>Launch Daemon</strong>: Starts at boot (system-wide, requires sudo)<br />
- <strong>Launch Agent</strong>: Starts at login (user-specific, no sudo required)</p>
<p><strong>Folder Structure:</strong><br />
- <strong>Daemons</strong>: <code>/Library/LaunchDaemons/</code> (system-wide)<br />
- <strong>Agents</strong>: <code>/Library/LaunchAgents/</code> (user-level)<br />
- <strong>Data (Daemon)</strong>: <code>/var/lib/pywats/</code><br />
- <strong>Data (Agent)</strong>: <code>~/.config/pywats_client/</code><br />
- <strong>Logs (Daemon)</strong>: <code>/var/log/pywats/</code><br />
- <strong>Logs (Agent)</strong>: <code>~/Library/Logs/pyWATS/</code></p>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="required">Required</h3>
<ul>
<li>macOS 10.10 (Yosemite) or later</li>
<li>Python 3.10 or later</li>
<li>Administrator privileges (for Launch Daemon)</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="option-1-launch-daemon-system-wide-recommended">Option 1: Launch Daemon (System-Wide, Recommended)</h3>
<p>Runs at boot, before any user logs in. Best for production test stations.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install pyWATS Client</span>
pip3<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Install as Launch Daemon (requires sudo)</span>
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service

<span class="c1"># Service starts automatically after installation</span>
<span class="c1"># Or start manually:</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>start<span class="w"> </span>com.virinco.pywats.service
</code></pre></div>

<p>This creates:<br />
- Plist: <code>/Library/LaunchDaemons/com.virinco.pywats.service.plist</code><br />
- Auto-start: Enabled (runs at boot)<br />
- Logs: <code>/var/log/pywats/pywats-service.log</code><br />
- Data: <code>/var/lib/pywats/</code></p>
<h3 id="option-2-launch-agent-user-level">Option 2: Launch Agent (User-Level)</h3>
<p>Runs when you log in. Good for development.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install pyWATS Client</span>
pip3<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Install as Launch Agent (no sudo needed)</span>
python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span>--user-agent

<span class="c1"># Service starts automatically at login</span>
<span class="c1"># Or start manually:</span>
launchctl<span class="w"> </span>start<span class="w"> </span>com.virinco.pywats.service
</code></pre></div>

<p>This creates:<br />
- Plist: <code>/Library/LaunchAgents/com.virinco.pywats.service.plist</code><br />
- Auto-start: At login<br />
- Logs: <code>~/Library/Logs/pyWATS/pywats-service.log</code><br />
- Data: <code>~/.config/pywats_client/</code></p>
<h2 id="multi-instance-installation">Multi-Instance Installation</h2>
<p>For multi-station setups where you need multiple services (one per test station):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create config files</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/pywats
sudo<span class="w"> </span>cp<span class="w"> </span>config.json<span class="w"> </span>/var/lib/pywats/config_station_a.json
sudo<span class="w"> </span>cp<span class="w"> </span>config.json<span class="w"> </span>/var/lib/pywats/config_station_b.json

<span class="c1"># Install service for Station A</span>
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--instance-id<span class="w"> </span>station_a<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>/var/lib/pywats/config_station_a.json

<span class="c1"># Install service for Station B</span>
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--instance-id<span class="w"> </span>station_b<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>/var/lib/pywats/config_station_b.json
</code></pre></div>

<p>Each instance will have:<br />
- Plist: <code>com.virinco.pywats.service.station_a.plist</code>, <code>com.virinco.pywats.service.station_b.plist</code><br />
- Separate configurations<br />
- Independent logging</p>
<h2 id="service-management">Service Management</h2>
<h3 id="check-service-status">Check Service Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># List all launchd services (system)</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats

<span class="c1"># List user services</span>
launchctl<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats

<span class="c1"># Check specific service</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>list<span class="w"> </span>com.virinco.pywats.service
</code></pre></div>

<h3 id="startstop">Start/Stop</h3>
<p><strong>Launch Daemon (system-wide):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>start<span class="w"> </span>com.virinco.pywats.service

<span class="c1"># Stop</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>stop<span class="w"> </span>com.virinco.pywats.service

<span class="c1"># Note: Service will auto-restart if killed</span>
<span class="c1"># To prevent restart, unload the plist</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>unload<span class="w"> </span>/Library/LaunchDaemons/com.virinco.pywats.service.plist
</code></pre></div>

<p><strong>Launch Agent (user-level):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start</span>
launchctl<span class="w"> </span>start<span class="w"> </span>com.virinco.pywats.service

<span class="c1"># Stop</span>
launchctl<span class="w"> </span>stop<span class="w"> </span>com.virinco.pywats.service

<span class="c1"># Unload</span>
launchctl<span class="w"> </span>unload<span class="w"> </span>/Library/LaunchAgents/com.virinco.pywats.service.plist
</code></pre></div>

<h3 id="view-logs">View Logs</h3>
<p><strong>Launch Daemon logs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/pywats/pywats-service.log

<span class="c1"># View errors</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/pywats/pywats-service-error.log

<span class="c1"># View with Console.app</span>
open<span class="w"> </span>-a<span class="w"> </span>Console<span class="w"> </span>/var/log/pywats/
</code></pre></div>

<p><strong>Launch Agent logs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>~/Library/Logs/pyWATS/pywats-service.log

<span class="c1"># View errors</span>
tail<span class="w"> </span>-f<span class="w"> </span>~/Library/Logs/pyWATS/pywats-service-error.log

<span class="c1"># View with Console.app</span>
open<span class="w"> </span>-a<span class="w"> </span>Console<span class="w"> </span>~/Library/Logs/pyWATS/
</code></pre></div>

<h3 id="uninstall-service">Uninstall Service</h3>
<p><strong>Launch Daemon:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop and remove</span>
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service

<span class="c1"># For specific instance</span>
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service<span class="w"> </span>--instance-id<span class="w"> </span>station_a

<span class="c1"># Verify removal</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats
</code></pre></div>

<p><strong>Launch Agent:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop and remove</span>
python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service<span class="w"> </span>--user-agent

<span class="c1"># Verify removal</span>
launchctl<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats
</code></pre></div>

<h2 id="configuration">Configuration</h2>
<h3 id="default-configuration">Default Configuration</h3>
<p>The service uses configuration from:<br />
- Daemon: <code>/var/lib/pywats/config.json</code><br />
- Agent: <code>~/.config/pywats_client/config.json</code><br />
- Custom: Specify with <code>--config</code> during installation</p>
<h3 id="changing-configuration">Changing Configuration</h3>
<p><strong>Option 1: Using GUI</strong><br />
1. Run the pyWATS Client GUI<br />
2. It will discover the running service<br />
3. Make configuration changes in the GUI<br />
4. Changes are sent via IPC to the service</p>
<p><strong>Option 2: Edit config.json</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop the service</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>stop<span class="w"> </span>com.virinco.pywats.service

<span class="c1"># Edit configuration (Daemon)</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/var/lib/pywats/config.json

<span class="c1"># Or for Agent</span>
nano<span class="w"> </span>~/.config/pywats_client/config.json

<span class="c1"># Restart the service</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>start<span class="w"> </span>com.virinco.pywats.service
</code></pre></div>

<p><strong>Option 3: Reinstall with new config</strong></p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>uninstall-service
sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>install-service<span class="w"> </span>--config<span class="w"> </span>/path/to/new/config.json
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="service-wont-start">Service Won't Start</h3>
<ol>
<li>
<p><strong>Check if plist is loaded</strong>:<br />
<code>bash
   sudo launchctl list | grep pywats</code></p>
</li>
<li>
<p><strong>Check logs</strong>:<br />
<code>bash
   sudo tail -100 /var/log/pywats/pywats-service-error.log</code></p>
</li>
<li>
<p><strong>Test service command manually</strong>:<br />
<code>bash
   # Run in foreground for debugging
   python3 -m pywats_client service --instance-id default</code></p>
</li>
<li>
<p><strong>Verify Python path</strong>:<br />
<code>bash
   which python3
   python3 --version</code></p>
</li>
<li>
<p><strong>Check plist syntax</strong>:<br />
<code>bash
   plutil /Library/LaunchDaemons/com.virinco.pywats.service.plist</code></p>
</li>
</ol>
<h3 id="permission-errors">Permission Errors</h3>
<p>If the service can't access files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check ownership (Daemon)</span>
ls<span class="w"> </span>-la<span class="w"> </span>/var/lib/pywats/

<span class="c1"># Fix permissions</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>root:wheel<span class="w"> </span>/var/lib/pywats/
sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">755</span><span class="w"> </span>/var/lib/pywats/

<span class="c1"># For Agent</span>
ls<span class="w"> </span>-la<span class="w"> </span>~/.config/pywats_client/
</code></pre></div>

<h3 id="service-keeps-restarting">Service Keeps Restarting</h3>
<p>The service is configured to auto-restart on failure. Check why it's failing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View recent errors</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-100<span class="w"> </span>/var/log/pywats/pywats-service-error.log

<span class="c1"># Check system logs</span>
log<span class="w"> </span>show<span class="w"> </span>--predicate<span class="w"> </span><span class="s1">&#39;subsystem == &quot;com.apple.launchd&quot;&#39;</span><span class="w"> </span>--last<span class="w"> </span>10m<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pywats

<span class="c1"># Disable auto-restart temporarily</span>
sudo<span class="w"> </span>launchctl<span class="w"> </span>unload<span class="w"> </span>/Library/LaunchDaemons/com.virinco.pywats.service.plist
</code></pre></div>

<h3 id="port-already-in-use">Port Already in Use</h3>
<p>If you see "Address already in use" errors:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check what&#39;s using the port</span>
sudo<span class="w"> </span>lsof<span class="w"> </span>-i<span class="w"> </span>:8765

<span class="c1"># Kill the conflicting process or change port in config</span>
</code></pre></div>

<h3 id="service-doesnt-auto-start-at-boot">Service Doesn't Auto-Start at Boot</h3>
<ol>
<li>
<p><strong>Verify plist location</strong>:<br />
<code>bash
   ls -l /Library/LaunchDaemons/com.virinco.pywats.service.plist</code></p>
</li>
<li>
<p><strong>Check RunAtLoad</strong>:<br />
<code>bash
   plutil -p /Library/LaunchDaemons/com.virinco.pywats.service.plist | grep RunAtLoad
   # Should show: "RunAtLoad" =&gt; 1</code></p>
</li>
<li>
<p><strong>Reload plist</strong>:<br />
<code>bash
   sudo launchctl unload /Library/LaunchDaemons/com.virinco.pywats.service.plist
   sudo launchctl load /Library/LaunchDaemons/com.virinco.pywats.service.plist</code></p>
</li>
</ol>
<h2 id="advanced-configuration">Advanced Configuration</h2>
<h3 id="custom-environment-variables">Custom Environment Variables</h3>
<p>Edit the plist file:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/Library/LaunchDaemons/com.virinco.pywats.service.plist
</code></pre></div>

<p>Add environment variables:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;key&gt;</span>EnvironmentVariables<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="w">    </span><span class="nt">&lt;key&gt;</span>PYTHONPATH<span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;string&gt;</span>/custom/path<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;key&gt;</span>PYWATS_LOG_LEVEL<span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;string&gt;</span>DEBUG<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
</code></pre></div>

<p>Then reload:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>launchctl<span class="w"> </span>unload<span class="w"> </span>/Library/LaunchDaemons/com.virinco.pywats.service.plist
sudo<span class="w"> </span>launchctl<span class="w"> </span>load<span class="w"> </span>/Library/LaunchDaemons/com.virinco.pywats.service.plist
</code></pre></div>

<h3 id="run-on-schedule">Run on Schedule</h3>
<p>Instead of continuous running, run periodically:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;key&gt;</span>StartCalendarInterval<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="w">    </span><span class="nt">&lt;key&gt;</span>Hour<span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;integer&gt;</span>8<span class="nt">&lt;/integer&gt;</span>
<span class="w">    </span><span class="nt">&lt;key&gt;</span>Minute<span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;integer&gt;</span>0<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
</code></pre></div>

<h3 id="resource-limits">Resource Limits</h3>
<p>Add limits to prevent runaway processes:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;key&gt;</span>SoftResourceLimits<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="w">    </span><span class="nt">&lt;key&gt;</span>NumberOfFiles<span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;integer&gt;</span>1024<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>

<span class="nt">&lt;key&gt;</span>HardResourceLimits<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="w">    </span><span class="nt">&lt;key&gt;</span>NumberOfFiles<span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;integer&gt;</span>2048<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
</code></pre></div>

<h3 id="network-dependency">Network Dependency</h3>
<p>Ensure network is available before starting:</p>
<p>The default plist already includes this via <code>StandardOutPath</code> and <code>StandardErrorPath</code>, which ensures the filesystem is ready.</p>
<h2 id="gui-discovery">GUI Discovery</h2>
<p>When you open the pyWATS Client GUI on macOS:</p>
<ol>
<li><strong>Discovery</strong>: GUI scans for running service instances via IPC</li>
<li><strong>Instance Selector</strong>: Shows all discovered services</li>
<li><strong>Connect</strong>: Select an instance to view/configure</li>
<li><strong>Status</strong>: Live status updates via IPC</li>
</ol>
<p>The GUI never auto-starts services - they must be started separately via launchd.</p>
<h2 id="comparison-with-other-methods">Comparison with Other Methods</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Auto-Start</th>
<th>Survives Reboot</th>
<th>Crash Recovery</th>
<th>Service Management</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>launchd Daemon</strong></td>
<td>‚úì (boot)</td>
<td>‚úì</td>
<td>‚úì</td>
<td>launchctl</td>
</tr>
<tr>
<td><strong>launchd Agent</strong></td>
<td>‚úì (login)</td>
<td>‚úì</td>
<td>‚úì</td>
<td>launchctl</td>
</tr>
<tr>
<td><strong>Manual (GUI)</strong></td>
<td>‚úó</td>
<td>‚úó</td>
<td>‚úó</td>
<td>Terminal</td>
</tr>
<tr>
<td><strong>Login Item</strong></td>
<td>‚úì (login)</td>
<td>‚úì</td>
<td>‚úó</td>
<td>System Preferences</td>
</tr>
<tr>
<td><strong>cron @reboot</strong></td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úó</td>
<td>crontab</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation:</strong> Use Launch Daemon for production test stations.</p>
<h2 id="macos-version-notes">macOS Version Notes</h2>
<h3 id="macos-13-ventura">macOS 13+ (Ventura)</h3>
<p>Fully supported. May require additional privacy permissions.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Grant Full Disk Access if needed</span>
System<span class="w"> </span>Settings<span class="w"> </span>‚Üí<span class="w"> </span>Privacy<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Security<span class="w"> </span>‚Üí<span class="w"> </span>Full<span class="w"> </span>Disk<span class="w"> </span>Access
</code></pre></div>

<h3 id="macos-12-monterey">macOS 12 (Monterey)</h3>
<p>Fully supported.</p>
<h3 id="macos-11-big-sur">macOS 11 (Big Sur)</h3>
<p>Fully supported.</p>
<h3 id="macos-1015-catalina">macOS 10.15 (Catalina)</h3>
<p>Supported. May prompt for security approval on first run.</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../getting-started.md">Getting Started</a> - Basic client usage</li>
<li><a href="client.md">Client Installation</a> - Installation guide</li>
<li><a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html">Apple launchd documentation</a></li>
</ul>
</div>


<div class="section-header" id="architecture">
    <h1>Architecture</h1>
</div>


<div class="doc-separator" id="architecture-architecture">
    <div class="doc-source">Source: docs/architecture.md</div>
    <h1 id="pywats-system-architecture">pyWATS System Architecture</h1>
<p><strong>Version:</strong> 1.3.0<br />
<strong>Last Updated:</strong> January 2026<br />
<strong>Audience:</strong> Developers, integrators, contributors</p>
<hr />
<h2 id="overview">Overview</h2>
<p>pyWATS is a <strong>three-layer Python system</strong> for connecting manufacturing test stations to WATS (Web-based Automatic Test System) servers. It provides both a programmatic API for test automation and a client application for test station deployment.</p>
<div class="codehilite"><pre><span></span><code><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                    </span><span class="nx">pyWATS</span><span class="w"> </span><span class="nx">Client</span><span class="w"> </span><span class="nx">GUI</span><span class="w">                           </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="p">(</span><span class="nx">PySide6</span><span class="o">/</span><span class="nx">Qt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Optional</span><span class="w"> </span><span class="nx">Desktop</span><span class="w"> </span><span class="nx">Application</span><span class="p">)</span><span class="w">                   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">configuration</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">monitoring</span><span class="w">             </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">System</span><span class="w"> </span><span class="nx">tray</span><span class="w"> </span><span class="nx">integration</span><span class="w">                                     </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Multi</span><span class="o">-</span><span class="nx">page</span><span class="w"> </span><span class="nx">navigation</span><span class="w">                                       </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                              </span><span class="err">‚Üï</span><span class="w"> </span><span class="nx">IPC</span><span class="w"> </span><span class="p">(</span><span class="nx">LocalSocket</span><span class="p">)</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                    </span><span class="nx">pyWATS</span><span class="w"> </span><span class="nx">Client</span><span class="w"> </span><span class="nx">Service</span><span class="w">                       </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="p">(</span><span class="nx">pywats_client</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Headless</span><span class="o">-</span><span class="nx">capable</span><span class="w"> </span><span class="nx">background</span><span class="w"> </span><span class="nx">service</span><span class="p">)</span><span class="w">         </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">File</span><span class="w"> </span><span class="nx">monitoring</span><span class="w"> </span><span class="p">(</span><span class="nx">Watchdog</span><span class="p">)</span><span class="w">                                  </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Converter</span><span class="w"> </span><span class="nx">processing</span><span class="w">                                        </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Offline</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="nx">queue</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">retry</span><span class="w">                             </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Multi</span><span class="o">-</span><span class="nx">instance</span><span class="w"> </span><span class="nx">support</span><span class="w">                                      </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                              </span><span class="err">‚Üì</span><span class="w"> </span><span class="nx">Uses</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                       </span><span class="nx">pyWATS</span><span class="w"> </span><span class="nx">API</span><span class="w">                               </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="p">(</span><span class="nx">pywats</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Core</span><span class="w"> </span><span class="kn">library</span><span class="p">)</span><span class="w">                                       </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Async</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">sync</span><span class="w"> </span><span class="nx">HTTP</span><span class="w"> </span><span class="nx">client</span><span class="w">                                    </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">domain</span><span class="w"> </span><span class="nx">services</span><span class="w"> </span><span class="p">(</span><span class="nx">Report</span><span class="p">,</span><span class="w"> </span><span class="nx">Product</span><span class="p">,</span><span class="w"> </span><span class="nx">Asset</span><span class="p">,</span><span class="w"> </span><span class="nx">etc</span><span class="p">.)</span><span class="w">            </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Pydantic</span><span class="w"> </span><span class="nx">models</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">validation</span><span class="w">                                </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Ä¢</span><span class="w"> </span><span class="nx">Rate</span><span class="w"> </span><span class="nx">limiting</span><span class="p">,</span><span class="w"> </span><span class="nx">retry</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w">                        </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                              </span><span class="err">‚Üì</span><span class="w"> </span><span class="nx">HTTPS</span><span class="o">/</span><span class="nx">REST</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                      </span><span class="nx">WATS</span><span class="w"> </span><span class="nx">Server</span><span class="w">                               </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="p">(</span><span class="nx">Cloud</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">On</span><span class="o">-</span><span class="nx">Premise</span><span class="p">)</span><span class="w">                                         </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
</code></pre></div>

<p><strong>Key Features:</strong><br />
- <strong>Dual API modes:</strong> Async (<code>AsyncWATS</code>) for high-performance concurrent operations, Sync (<code>pyWATS</code>) for simple scripting<br />
- <strong>Headless operation:</strong> Client runs without GUI on servers, Raspberry Pi, embedded systems<br />
- <strong>Offline resilience:</strong> Queue and retry reports when network is unavailable<br />
- <strong>Multi-instance:</strong> Run multiple clients on same machine with separate configurations<br />
- <strong>Extensible:</strong> Custom converters, custom domains, plugin architecture</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#system-layers">System Layers</a></li>
<li><a href="#pywats-api-layer">pyWATS API Layer</a></li>
<li><a href="#pywats-client-layer">pyWATS Client Layer</a></li>
<li><a href="#pywats-gui-layer">pyWATS GUI Layer</a></li>
<li><a href="#configuration-management">Configuration Management</a></li>
<li><a href="#async-vs-sync-usage">Async vs Sync Usage</a></li>
<li><a href="#extension-points">Extension Points</a></li>
<li><a href="#deployment-modes">Deployment Modes</a></li>
<li><a href="#dependencies">Dependencies</a></li>
</ol>
<hr />
<h2 id="system-layers">System Layers</h2>
<h3 id="layer-1-pywats-api-srcpywats">Layer 1: pyWATS API (<code>src/pywats/</code>)</h3>
<p><strong>Purpose:</strong> Foundation library for REST API communication with WATS servers</p>
<p><strong>Responsibility:</strong><br />
- HTTP/HTTPS communication with authentication<br />
- Domain-specific business logic (8 domains)<br />
- Pydantic model validation<br />
- Rate limiting and retry logic<br />
- Error handling and responses</p>
<p><strong>Used by:</strong> Test automation scripts, client service, custom integrations</p>
<p><strong>Entry point:</strong> <code>pyWATS</code> (sync) or <code>AsyncWATS</code> (async)</p>
<h3 id="layer-2-pywats-client-service-srcpywats_client">Layer 2: pyWATS Client Service (<code>src/pywats_client/</code>)</h3>
<p><strong>Purpose:</strong> Background service for test station automation</p>
<p><strong>Responsibility:</strong><br />
- File system monitoring (Watchdog)<br />
- Converter execution (file ‚Üí report transformation)<br />
- Offline queue management with persistence<br />
- Connection health monitoring<br />
- Process/product data synchronization<br />
- Multi-instance coordination</p>
<p><strong>Modes:</strong> Headless daemon, Windows/Linux/macOS service, foreground process</p>
<p><strong>Entry point:</strong> <code>python -m pywats_client service</code></p>
<h3 id="layer-3-pywats-gui-srcpywats_clientgui">Layer 3: pyWATS GUI (<code>src/pywats_client/gui/</code>)</h3>
<p><strong>Purpose:</strong> Optional desktop application for client configuration</p>
<p><strong>Responsibility:</strong><br />
- User-friendly configuration interface<br />
- Visual status monitoring<br />
- Log viewing and troubleshooting<br />
- System tray integration</p>
<p><strong>Technology:</strong> PySide6 (Qt6 for Python)</p>
<p><strong>Entry point:</strong> <code>python -m pywats_client gui</code></p>
<hr />
<h2 id="pywats-api-layer">pyWATS API Layer</h2>
<h3 id="architecture-pattern">Architecture Pattern</h3>
<p>Each domain follows a <strong>three-layer pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Service Layer                            ‚îÇ
‚îÇ  (Business logic, orchestration, validation)                ‚îÇ
‚îÇ  Example: ReportService, ProductService                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Repository Layer                           ‚îÇ
‚îÇ  (Data access, HTTP calls, error handling)                  ‚îÇ
‚îÇ  Example: ReportRepository, ProductRepository               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HttpClient                               ‚îÇ
‚îÇ  (Low-level HTTP, rate limiting, retry)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<h3 id="core-components">Core Components</h3>
<h4 id="httpclient-coreclientpy">HttpClient (<code>core/client.py</code>)</h4>
<p><strong>Both sync and async implementations:</strong><br />
- <code>HttpClient</code> - Synchronous (uses <code>requests</code>)<br />
- <code>AsyncHttpClient</code> - Asynchronous (uses <code>httpx</code>)</p>
<p><strong>Features:</strong><br />
- Basic authentication (username + API token)<br />
- Automatic response wrapping with <code>Response</code> model<br />
- JSON serialization/deserialization<br />
- No exception raising for HTTP errors (repositories handle errors)<br />
- Built-in rate limiting integration<br />
- Automatic retry for transient failures</p>
<p><strong>Response Model:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Response</span><span class="p">:</span>
    <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span>              <span class="c1"># Parsed JSON</span>
    <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">raw</span><span class="p">:</span> <span class="nb">bytes</span>

    <span class="c1"># Computed properties</span>
    <span class="n">is_success</span><span class="p">:</span> <span class="nb">bool</span>       <span class="c1"># 2xx</span>
    <span class="n">is_client_error</span><span class="p">:</span> <span class="nb">bool</span>  <span class="c1"># 4xx</span>
    <span class="n">is_server_error</span><span class="p">:</span> <span class="nb">bool</span>  <span class="c1"># 5xx</span>
    <span class="n">is_not_found</span><span class="p">:</span> <span class="nb">bool</span>     <span class="c1"># 404</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

<h4 id="rate-limiting-corethrottlepy">Rate Limiting (<code>core/throttle.py</code>)</h4>
<p><strong>Thread-safe sliding window rate limiter:</strong><br />
- Default: 500 requests per 60 seconds<br />
- Configurable via <code>configure_throttling()</code><br />
- Automatic wait when limit reached<br />
- Statistics tracking (total requests, throttle count, wait time)</p>
<p><strong>Configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.throttle</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_throttling</span>

<span class="n">configure_throttling</span><span class="p">(</span>
    <span class="n">max_requests</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">window_seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="retry-logic-coreretrypy">Retry Logic (<code>core/retry.py</code>)</h4>
<p><strong>Automatic retry with exponential backoff:</strong><br />
- Default: 3 attempts, 1s base delay, 30s max delay<br />
- Retries on: <code>ConnectionError</code>, <code>TimeoutError</code>, HTTP 429/5xx<br />
- Respects <code>Retry-After</code> header for HTTP 429<br />
- Does NOT retry: POST (not idempotent), HTTP 4xx errors<br />
- Configurable per client instance</p>
<p><strong>Configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">RetryConfig</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">RetryConfig</span><span class="p">(</span>
    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">max_delay</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">retry_config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

<h4 id="error-handling-coreexceptionspy-sharedresultpy">Error Handling (<code>core/exceptions.py</code>, <code>shared/result.py</code>)</h4>
<p><strong>Two error handling modes:</strong></p>
<ol>
<li><strong>ErrorMode.STRICT</strong> (default) - Raises exceptions</li>
<li><code>NotFoundError</code> for HTTP 404</li>
<li><code>ValidationError</code> for HTTP 400</li>
<li><code>AuthenticationError</code> for HTTP 401</li>
<li><code>AuthorizationError</code> for HTTP 403</li>
<li>
<p><code>ServerError</code> for HTTP 5xx</p>
</li>
<li>
<p><strong>ErrorMode.LENIENT</strong> - Returns <code>None</code> for errors</p>
</li>
<li>No exceptions raised</li>
<li>Repository methods return <code>None</code> on 404</li>
<li>Suitable for optional data fetching</li>
</ol>
<p><strong>Result Pattern (advanced):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.shared.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">Result</span>

<span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_async</span><span class="p">(</span><span class="s2">&quot;PRODUCT-123&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Product object</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>  <span class="c1"># ErrorCode.NOT_FOUND</span>
</code></pre></div>

<h3 id="domain-services">Domain Services</h3>
<p><strong>8 domains available:</strong></p>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Service</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Report</strong></td>
<td><code>ReportService</code></td>
<td>Submit test reports (UUT/UUR), query results</td>
</tr>
<tr>
<td><strong>Product</strong></td>
<td><code>ProductService</code></td>
<td>Manage products, revisions, BOMs</td>
</tr>
<tr>
<td><strong>Asset</strong></td>
<td><code>AssetService</code></td>
<td>Track equipment, calibration, maintenance</td>
</tr>
<tr>
<td><strong>Production</strong></td>
<td><code>ProductionService</code></td>
<td>Unit lifecycle, serial numbers, assembly</td>
</tr>
<tr>
<td><strong>Analytics</strong></td>
<td><code>AnalyticsService</code></td>
<td>Yield analysis, measurements, Cpk</td>
</tr>
<tr>
<td><strong>Software</strong></td>
<td><code>SoftwareService</code></td>
<td>Package management, distribution</td>
</tr>
<tr>
<td><strong>RootCause</strong></td>
<td><code>RootCauseService</code></td>
<td>Issue tracking, defect management</td>
</tr>
<tr>
<td><strong>Process</strong></td>
<td><code>ProcessService</code></td>
<td>Test/repair operations, caching</td>
</tr>
</tbody>
</table>
<p><strong>Access pattern:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Access services</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;PRODUCT-123&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">allocate_serial_numbers</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="station-identity-corestationpy">Station Identity (<code>core/station.py</code>)</h3>
<p><strong>Station concept for report attribution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.station</span><span class="w"> </span><span class="kn">import</span> <span class="n">Station</span>

<span class="n">station</span> <span class="o">=</span> <span class="n">Station</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;STATION-ICT-01&quot;</span><span class="p">,</span>      <span class="c1"># machineName in reports</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Building A&quot;</span><span class="p">,</span>
    <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;Production&quot;</span>         <span class="c1"># or &quot;Development&quot;</span>
<span class="p">)</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">)</span>
</code></pre></div>

<p><strong>Multi-station support (hub mode):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.station</span><span class="w"> </span><span class="kn">import</span> <span class="n">StationRegistry</span>

<span class="n">registry</span> <span class="o">=</span> <span class="n">StationRegistry</span><span class="p">()</span>
<span class="n">registry</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ict&quot;</span><span class="p">,</span> <span class="n">Station</span><span class="p">(</span><span class="s2">&quot;ICT-01&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">))</span>
<span class="n">registry</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;fct&quot;</span><span class="p">,</span> <span class="n">Station</span><span class="p">(</span><span class="s2">&quot;FCT-01&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">))</span>

<span class="n">registry</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="s2">&quot;ict&quot;</span><span class="p">)</span>
<span class="n">current</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>  <span class="c1"># Station(&quot;ICT-01&quot;, ...)</span>
</code></pre></div>

<hr />
<h2 id="pywats-client-layer">pyWATS Client Layer</h2>
<h3 id="service-architecture-new-in-v13">Service Architecture (New in v1.3)</h3>
<p>The client has been refactored into <strong>separate service and GUI</strong> with IPC communication:</p>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Client Service                            ‚îÇ
‚îÇ  (Background process, headless-capable)                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇClientService ‚îÇ  ‚îÇPendingWatcher‚îÇ  ‚îÇ ConverterPool‚îÇ      ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ‚Ä¢ Lifecycle   ‚îÇ  ‚îÇ‚Ä¢ File monitor‚îÇ  ‚îÇ‚Ä¢ Workers     ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ‚Ä¢ Status      ‚îÇ  ‚îÇ‚Ä¢ Periodic    ‚îÇ  ‚îÇ‚Ä¢ Converters  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ‚Ä¢ API client  ‚îÇ  ‚îÇ‚Ä¢ Submit queue‚îÇ  ‚îÇ‚Ä¢ Queue       ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ              PersistentQueue                     ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SQLite-backed queue                           ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Crash recovery                                ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Retry logic (3 attempts)                      ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ               IPCServer                          ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Qt LocalSocket server                         ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ JSON command/response protocol                ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Commands: get_status, get_config, stop, etc.  ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üï IPC
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      GUI Process                             ‚îÇ
‚îÇ  (Optional, separate process)                                ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ             ServiceIPCClient                     ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Connects to service via LocalSocket           ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Sends commands, receives updates              ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<p><strong>Key components:</strong></p>
<ol>
<li><strong>ClientService</strong> - Main service controller</li>
<li>ServiceStatus states: STOPPED, START_PENDING, RUNNING, STOP_PENDING, PAUSED</li>
<li>
<p>Manages lifecycle and coordinates components</p>
</li>
<li>
<p><strong>PendingWatcher</strong> - Report queue manager</p>
</li>
<li>Monitors pending reports directory</li>
<li>Periodic check (5 minutes) + file system events</li>
<li>
<p>Submission lock to prevent concurrent uploads</p>
</li>
<li>
<p><strong>ConverterPool</strong> - Converter worker management</p>
</li>
<li>1-50 workers (configurable, default: 10)</li>
<li>
<p>Manages converter list and pending queue</p>
</li>
<li>
<p><strong>PersistentQueue</strong> - SQLite-backed queue</p>
</li>
<li>States: pending, processing, completed, failed</li>
<li>Automatic crash recovery (processing ‚Üí pending on restart)</li>
<li>
<p>Retry logic with configurable attempts</p>
</li>
<li>
<p><strong>IPCServer</strong> - Inter-process communication</p>
</li>
<li>Socket name: <code>pyWATS_Service_{instance_id}</code></li>
<li>JSON protocol for commands and responses</li>
<li>Service/GUI separation enables headless mode</li>
</ol>
<h3 id="core-services">Core Services</h3>
<h4 id="file-monitor-servicefile_monitorpy">File Monitor (<code>service/file_monitor.py</code>)</h4>
<p><strong>File system watching using Watchdog:</strong><br />
- Monitors configured watch folders<br />
- Pattern matching (<code>*.csv</code>, <code>*.xml</code>, etc.)<br />
- Debouncing (waits for file write completion)<br />
- Async event processing<br />
- Callbacks for file events</p>
<p><strong>Monitor rules:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MonitorRule</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>                    <span class="c1"># Folder to watch</span>
    <span class="n">converter_type</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># Which converter to use</span>
    <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span>              <span class="c1"># Watch subdirectories</span>
    <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span>            <span class="c1"># Glob pattern</span>
    <span class="n">delete_after_convert</span><span class="p">:</span> <span class="nb">bool</span>   <span class="c1"># Auto-cleanup</span>
</code></pre></div>

<h4 id="converter-system-converters">Converter System (<code>converters/</code>)</h4>
<p><strong>Three converter types:</strong></p>
<ol>
<li><strong>FileConverter</strong> - One file ‚Üí one report</li>
<li><strong>FolderConverter</strong> - Entire folder ‚Üí one report (batch processing)</li>
<li><strong>ScheduledConverter</strong> - Timer-based execution</li>
</ol>
<p><strong>Base classes:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileConverter</span><span class="p">,</span> <span class="n">ConverterSource</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;My Test Converter&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">file_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;*.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;*.txt&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConverterResult</span><span class="p">:</span>
        <span class="c1"># Parse file</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_file</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

        <span class="c1"># Build report using ReportBuilder</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">],</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
                <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</code></pre></div>

<p><strong>Converter lifecycle:</strong><br />
1. File created/modified event detected<br />
2. Debounce wait (ensure write complete)<br />
3. Pattern match check<br />
4. Load converter module dynamically<br />
5. Call <code>convert(source, context)</code><br />
6. Submit result to queue or upload directly<br />
7. Post-processing (move/delete/archive based on config)</p>
<h4 id="configuration-configpy">Configuration (<code>config.py</code>)</h4>
<p><strong>ClientConfig structure:</strong><br />
- Instance identity (ID, name)<br />
- Server connection (URL, token, username)<br />
- Station identification<br />
- Serial number handler settings<br />
- Proxy configuration<br />
- Sync settings (interval, enabled)<br />
- Offline queue settings<br />
- Converter configurations<br />
- GUI tab visibility<br />
- Logging configuration</p>
<p><strong>Encryption:</strong><br />
- API tokens encrypted with machine-specific key<br />
- Uses <code>cryptography.fernet</code> (symmetric encryption)<br />
- Machine ID from system (Windows Registry, <code>/etc/machine-id</code>, IOPlatformUUID)<br />
- Tokens cannot be moved between machines</p>
<p><strong>Configuration locations:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Windows</span><span class="p">:</span><span class="w"> </span><span class="o">%</span><span class="n">APPDATA</span><span class="o">%</span>\<span class="n">pyWATS_Client</span>\
<span class="n">Linux</span><span class="p">:</span><span class="w">   </span><span class="o">~/.</span><span class="n">config</span><span class="o">/</span><span class="n">pywats_client</span><span class="o">/</span>
<span class="n">macOS</span><span class="p">:</span><span class="w">   </span><span class="o">~/</span><span class="n">Library</span><span class="o">/</span><span class="n">Application</span><span class="w"> </span><span class="n">Support</span><span class="o">/</span><span class="n">pywats_client</span><span class="o">/</span>

<span class="n">Structure</span><span class="p">:</span>
<span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">json</span><span class="w">                 </span><span class="c1"># Default instance</span>
<span class="w">  </span><span class="n">config_</span><span class="p">{</span><span class="n">instance_id</span><span class="p">}</span><span class="o">.</span><span class="n">json</span><span class="w">   </span><span class="c1"># Named instances</span>
<span class="w">  </span><span class="n">client</span><span class="o">.</span><span class="n">log</span><span class="w">                  </span><span class="c1"># Application log</span>
<span class="w">  </span><span class="n">cache</span><span class="o">/</span>
<span class="w">    </span><span class="n">processes_cache</span><span class="o">.</span><span class="n">json</span><span class="w">      </span><span class="c1"># Synced reference data</span>
<span class="w">  </span><span class="n">reports</span><span class="o">/</span>
<span class="w">    </span><span class="n">pending</span><span class="o">/</span><span class="w">                  </span><span class="c1"># Queued for upload</span>
<span class="w">    </span><span class="n">processing</span><span class="o">/</span><span class="w">               </span><span class="c1"># Currently uploading</span>
<span class="w">    </span><span class="n">completed</span><span class="o">/</span><span class="w">                </span><span class="c1"># Successfully uploaded</span>
<span class="w">    </span><span class="n">failed</span><span class="o">/</span><span class="w">                   </span><span class="c1"># Max retries exceeded</span>
</code></pre></div>

<h4 id="instance-management-serviceinstance_managerpy">Instance Management (<code>service/instance_manager.py</code>)</h4>
<p><strong>Multi-instance support:</strong><br />
- File-based locking (<code>.lock</code> files in temp directory)<br />
- Lock contains: instance_id, name, PID, started timestamp<br />
- Stale lock detection (checks if PID still running)<br />
- Each instance has separate:<br />
  - Configuration file<br />
  - Queue directory<br />
  - Log file<br />
  - IPC socket name</p>
<p><strong>Use case:</strong> Multiple test processes on same machine (e.g., ICT + FCT + EOL on one PC)</p>
<hr />
<h2 id="pywats-gui-layer">pyWATS GUI Layer</h2>
<h3 id="application-structure">Application Structure</h3>
<div class="codehilite"><pre><span></span><code>src/pywats_client/gui/
‚îú‚îÄ‚îÄ app.py                 # Main entry point, QApplication setup
‚îú‚îÄ‚îÄ login_window.py        # Pre-authentication dialog
‚îú‚îÄ‚îÄ main_window.py         # Main application window
‚îú‚îÄ‚îÄ settings_dialog.py     # Settings configuration
‚îú‚îÄ‚îÄ styles.py              # Dark theme stylesheet
‚îú‚îÄ‚îÄ pages/                 # Stacked widget pages
‚îÇ   ‚îú‚îÄ‚îÄ base.py           # BasePage abstract class
‚îÇ   ‚îú‚îÄ‚îÄ setup.py          # Initial configuration
‚îÇ   ‚îú‚îÄ‚îÄ connection.py     # Server connection status
‚îÇ   ‚îú‚îÄ‚îÄ converters.py     # Converter management
‚îÇ   ‚îú‚îÄ‚îÄ sn_handler.py     # Serial number handling
‚îÇ   ‚îú‚îÄ‚îÄ software.py       # Software distribution
‚îÇ   ‚îú‚îÄ‚îÄ about.py          # Version info
‚îÇ   ‚îî‚îÄ‚îÄ log.py            # Application logs
‚îî‚îÄ‚îÄ widgets/              # Reusable UI components
</code></pre></div>

<h3 id="communication-with-service">Communication with Service</h3>
<p><strong>IPC Protocol (Qt LocalSocket):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># GUI ‚Üí Service (Commands)</span>
<span class="p">{</span>
    <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;get_status&quot;</span> <span class="o">|</span> <span class="s2">&quot;get_config&quot;</span> <span class="o">|</span> <span class="s2">&quot;start&quot;</span> <span class="o">|</span> <span class="s2">&quot;stop&quot;</span> <span class="o">|</span> <span class="s2">&quot;ping&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Service ‚Üí GUI (Responses)</span>
<span class="p">{</span>
    <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>ServiceIPCClient</strong> in GUI connects to <strong>IPCServer</strong> in service using socket name <code>pyWATS_Service_{instance_id}</code>.</p>
<h3 id="user-workflow">User Workflow</h3>
<ol>
<li><strong>First launch:</strong></li>
<li>LoginWindow shown (no stored credentials)</li>
<li>Enter server URL + password/token</li>
<li>Authenticate ‚Üí token encrypted and saved</li>
<li>
<p>MainWindow opens</p>
</li>
<li>
<p><strong>Subsequent launches:</strong></p>
</li>
<li>Auto-connect using stored encrypted token</li>
<li>MainWindow opens directly if valid</li>
<li>
<p>LoginWindow only if authentication fails</p>
</li>
<li>
<p><strong>Main window:</strong></p>
</li>
<li>Sidebar navigation (Setup, Converters, S/N Handler, etc.)</li>
<li>Page content area (QStackedWidget)</li>
<li>Status bar (connection status, instance info)</li>
<li>System tray icon (minimize to tray option)</li>
</ol>
<hr />
<h2 id="configuration-management">Configuration Management</h2>
<h3 id="configuration-hierarchy">Configuration Hierarchy</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Environment</span><span class="w"> </span><span class="n">Variables</span><span class="w"> </span><span class="p">(</span><span class="n">highest</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span>
<span class="w">   </span><span class="n">PYWATS_SERVER_URL</span>
<span class="w">   </span><span class="n">PYWATS_API_TOKEN</span>
<span class="w">   </span><span class="n">PYWATS_INSTANCE_ID</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Command</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">Arguments</span>
<span class="w">   </span><span class="o">--</span><span class="n">server</span><span class="o">-</span><span class="n">url</span>
<span class="w">   </span><span class="o">--</span><span class="n">instance</span><span class="o">-</span><span class="n">id</span>
<span class="w">   </span><span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="n">file</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="mf">.</span><span class="n">json</span><span class="p">)</span>
<span class="w">   </span><span class="n">All</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">JSON</span>

<span class="mf">4.</span><span class="w"> </span><span class="kd">Def</span><span class="n">aults</span><span class="w"> </span><span class="p">(</span><span class="n">hardcoded</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kd">data</span><span class="n">classes</span><span class="p">)</span>
</code></pre></div>

<h3 id="dynamic-configuration">Dynamic Configuration</h3>
<p><strong>Runtime credential override:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In ClientConfig</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_runtime_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check environment variables for debug/override&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PYWATS_SERVER_URL&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_address</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PYWATS_API_TOKEN&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span>
    <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">token</span>
</code></pre></div>

<p><strong>Use case:</strong> Development/testing without modifying config files</p>
<hr />
<h2 id="async-vs-sync-usage">Async vs Sync Usage</h2>
<h3 id="sync-api-pywats">Sync API (<code>pyWATS</code>)</h3>
<p><strong>Best for:</strong><br />
- Simple scripts<br />
- Sequential operations<br />
- Learning/prototyping<br />
- Single-threaded applications</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Blocking calls</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;PRODUCT-123&quot;</span><span class="p">)</span>
<span class="n">reports</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_reports</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<h3 id="async-api-asyncwats">Async API (<code>AsyncWATS</code>)</h3>
<p><strong>Best for:</strong><br />
- High-performance applications<br />
- Concurrent operations<br />
- Batch processing<br />
- Server applications</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Concurrent requests</span>
    <span class="n">products</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_async</span><span class="p">(</span><span class="s2">&quot;PROD-1&quot;</span><span class="p">),</span>
        <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_async</span><span class="p">(</span><span class="s2">&quot;PROD-2&quot;</span><span class="p">),</span>
        <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_async</span><span class="p">(</span><span class="s2">&quot;PROD-3&quot;</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<p><strong>Performance benefit:</strong> 5-100x speedup for batch operations</p>
<h3 id="when-to-use-each">When to Use Each</h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLI tool</td>
<td>Sync (<code>pyWATS</code>)</td>
</tr>
<tr>
<td>Test automation script</td>
<td>Sync (<code>pyWATS</code>)</td>
</tr>
<tr>
<td>Web server integration</td>
<td>Async (<code>AsyncWATS</code>)</td>
</tr>
<tr>
<td>Batch data migration</td>
<td>Async (<code>AsyncWATS</code>)</td>
</tr>
<tr>
<td>Processing 1000s of reports</td>
<td>Async (<code>AsyncWATS</code>)</td>
</tr>
<tr>
<td>Simple report submission</td>
<td>Sync (<code>pyWATS</code>)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="extension-points">Extension Points</h2>
<h3 id="1-custom-converters">1. Custom Converters</h3>
<p><strong>Create custom file format converter:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileConverter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Custom Format Converter&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">file_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;*.custom&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_custom_format</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;part&quot;</span><span class="p">],</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sn&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Add steps...</span>
        <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</code></pre></div>

<p><strong>Register in config:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My Custom Converter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;module_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;converters.my_custom_converter.MyCustomConverter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;watch_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Custom&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file_patterns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.custom&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-custom-domains">2. Custom Domains</h3>
<p><strong>Extend pyWATS API with custom domain:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.base_repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseRepository</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomRepository</span><span class="p">(</span><span class="n">BaseRepository</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_custom_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/Custom/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="o">.</span><span class="n">handle_response</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_custom_data&quot;</span>
        <span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="n">CustomRepository</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repo</span> <span class="o">=</span> <span class="n">repository</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repo</span><span class="o">.</span><span class="n">get_custom_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

<span class="c1"># Register with pyWATS</span>
<span class="n">api</span><span class="o">.</span><span class="n">custom</span> <span class="o">=</span> <span class="n">CustomService</span><span class="p">(</span><span class="n">CustomRepository</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
</code></pre></div>

<h3 id="3-custom-report-steps">3. Custom Report Steps</h3>
<p><strong>Create domain-specific step types:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Custom step with specialized validation</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_custom_step</span><span class="p">(</span>
    <span class="n">step_type</span><span class="o">=</span><span class="s2">&quot;SpecializedTest&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;custom_field_1&quot;</span><span class="p">:</span> <span class="n">value1</span><span class="p">,</span>
        <span class="s2">&quot;custom_field_2&quot;</span><span class="p">:</span> <span class="n">value2</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="4-scheduled-tasks">4. Scheduled Tasks</h3>
<p><strong>Implement periodic data sync:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScheduledConverter</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataSyncConverter</span><span class="p">(</span><span class="n">ScheduledConverter</span><span class="p">):</span>
    <span class="n">schedule_interval_seconds</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># Every 5 minutes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="c1"># Fetch data from external source</span>
        <span class="c1"># Build report</span>
        <span class="c1"># Return result</span>
        <span class="k">pass</span>
</code></pre></div>

<hr />
<h2 id="deployment-modes">Deployment Modes</h2>
<h3 id="1-gui-mode-desktop">1. <strong>GUI Mode</strong> (Desktop)</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui
<span class="c1"># or</span>
pywats-client
</code></pre></div>

<p><strong>Use case:</strong> Lab stations, operator-facing stations</p>
<h3 id="2-headless-service-mode">2. <strong>Headless Service Mode</strong></h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service<span class="w"> </span>--daemon
</code></pre></div>

<p><strong>Use case:</strong> Production servers, headless test stations</p>
<h3 id="3-docker-container">3. <strong>Docker Container</strong></h3>
<div class="codehilite"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/path/to/config:/app/config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/path/to/data:/app/data<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/olreppe/pywats:latest
</code></pre></div>

<p><strong>Use case:</strong> Cloud deployments, Kubernetes, server racks</p>
<h3 id="4-windows-service">4. <strong>Windows Service</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="n">pywats-client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">production</span>
</code></pre></div>

<p><strong>Use case:</strong> Auto-start on boot, production environments</p>
<h3 id="5-linux-systemd">5. <strong>Linux systemd</strong></h3>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>pywats-client@default
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-client@default
</code></pre></div>

<p><strong>Use case:</strong> Server deployments, Raspberry Pi, embedded Linux</p>
<h3 id="6-macos-launchd">6. <strong>macOS launchd</strong></h3>
<div class="codehilite"><pre><span></span><code>launchctl<span class="w"> </span>load<span class="w"> </span>~/Library/LaunchAgents/com.pywats.client.plist
</code></pre></div>

<p><strong>Use case:</strong> Mac-based test stations</p>
<h3 id="7-programmatic-api">7. <strong>Programmatic API</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>

<p><strong>Use case:</strong> Test automation scripts, custom applications</p>
<hr />
<h2 id="dependencies">Dependencies</h2>
<h3 id="core-dependencies">Core Dependencies</h3>
<p><strong>pyWATS API:</strong><br />
- <code>httpx</code> (async HTTP client)<br />
- <code>requests</code> (sync HTTP client)<br />
- <code>pydantic</code> (data validation)<br />
- <code>pydantic-settings</code> (configuration management)</p>
<p><strong>pyWATS Client:</strong><br />
- All API dependencies<br />
- <code>watchdog</code> (file system monitoring)<br />
- <code>cryptography</code> (token encryption)<br />
- <code>apscheduler</code> (scheduled tasks)</p>
<p><strong>pyWATS GUI:</strong><br />
- All client dependencies<br />
- <code>PySide6</code> (Qt6 for Python)</p>
<h3 id="optional-dependencies">Optional Dependencies</h3>
<p><strong>Performance:</strong><br />
- <code>orjson</code> or <code>msgpack</code> (faster serialization)<br />
- <code>uvloop</code> (faster async event loop on Linux/Mac)</p>
<p><strong>Packaging:</strong><br />
- <code>PyInstaller</code> (standalone executables)<br />
- <code>pyinstaller-versionfile</code> (Windows version info)</p>
<p><strong>Development:</strong><br />
- <code>pytest</code> (testing)<br />
- <code>pytest-asyncio</code> (async test support)<br />
- <code>pytest-cov</code> (coverage reporting)</p>
<hr />
<h2 id="design-principles">Design Principles</h2>
<ol>
<li><strong>Separation of Concerns</strong></li>
<li>API layer: communication only</li>
<li>Service layer: business logic</li>
<li>Repository layer: data access</li>
<li>
<p>GUI layer: presentation</p>
</li>
<li>
<p><strong>Offline-First</strong></p>
</li>
<li>Queue reports when network unavailable</li>
<li>Local caching of reference data</li>
<li>
<p>Persistent storage with crash recovery</p>
</li>
<li>
<p><strong>Configurability</strong></p>
</li>
<li>Everything configurable via JSON</li>
<li>Environment variable overrides</li>
<li>
<p>Command-line arguments</p>
</li>
<li>
<p><strong>Extensibility</strong></p>
</li>
<li>Custom converters via Python modules</li>
<li>Custom domains via inheritance</li>
<li>
<p>Plugin architecture for future enhancements</p>
</li>
<li>
<p><strong>Reliability</strong></p>
</li>
<li>Automatic retry with exponential backoff</li>
<li>Rate limiting to prevent server overload</li>
<li>Error handling with detailed diagnostics</li>
<li>
<p>Health monitoring and auto-reconnection</p>
</li>
<li>
<p><strong>Performance</strong></p>
</li>
<li>Async support for concurrent operations</li>
<li>Connection pooling</li>
<li>Optional MessagePack for faster serialization</li>
<li>Batch operations where possible</li>
</ol>
<hr />
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><strong><a href="getting-started.md">Getting Started Guide</a></strong> - Installation and basic usage</li>
<li><strong><a href="client-architecture.md">Client Architecture</a></strong> - Detailed client design</li>
<li><strong><a href="integration-patterns.md">Integration Patterns</a></strong> - Common scenarios and workflows</li>
<li><strong><a href="error-catalog.md">Error Catalog</a></strong> - Error codes and remediation</li>
<li><strong><a href="installation/docker.md">Docker Deployment</a></strong> - Container deployment guide</li>
<li><strong>Domain Guides:</strong> <a href="modules/report.md">Report</a>, <a href="modules/product.md">Product</a>, <a href="modules/asset.md">Asset</a>, etc.</li>
</ul>
<hr />
<p><strong>Last Updated:</strong> January 26, 2026<br />
<strong>Version:</strong> 1.3.0 (separate service/GUI architecture)</p>
</div>


<div class="doc-separator" id="architecture-client-architecture">
    <div class="doc-source">Source: docs/client-architecture.md</div>
    <h1 id="pywats-client-architecture">pyWATS Client Architecture</h1>
<p><strong>Version:</strong> 1.3.0 (Service/GUI Separation)<br />
<strong>Last Updated:</strong> January 2026<br />
<strong>Audience:</strong> Client developers, advanced users, troubleshooters</p>
<hr />
<h2 id="overview">Overview</h2>
<p>The pyWATS Client is a <strong>background service</strong> with optional <strong>GUI frontend</strong> for managing test station automation. Starting with v1.3.0, the client uses a <strong>separate service and GUI architecture</strong> with inter-process communication (IPC), enabling true headless operation and better reliability.</p>
<p><strong>Key Features:</strong><br />
- <strong>Headless operation:</strong> Service runs independently without GUI<br />
- <strong>IPC communication:</strong> GUI communicates with service via Qt LocalSocket<br />
- <strong>Multi-instance:</strong> Run multiple isolated clients on same machine<br />
- <strong>Crash resilience:</strong> Service continues running even if GUI crashes<br />
- <strong>Platform support:</strong> Windows, Linux, macOS, Docker</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#architecture-overview">Architecture Overview</a></li>
<li><a href="#service-components">Service Components</a></li>
<li><a href="#ipc-communication">IPC Communication</a></li>
<li><a href="#queue-system">Queue System</a></li>
<li><a href="#converter-system">Converter System</a></li>
<li><a href="#file-monitoring">File Monitoring</a></li>
<li><a href="#instance-management">Instance Management</a></li>
<li><a href="#configuration-system">Configuration System</a></li>
<li><a href="#service-modes">Service Modes</a></li>
<li><a href="#testing-architecture">Testing Architecture</a></li>
</ol>
<hr />
<h2 id="architecture-overview">Architecture Overview</h2>
<h3 id="layered-design">Layered Design</h3>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     GUI Process (Optional)                 ‚îÇ
‚îÇ  ‚Ä¢ PySide6/Qt application                                  ‚îÇ
‚îÇ  ‚Ä¢ ServiceIPCClient                                        ‚îÇ
‚îÇ  ‚Ä¢ Sends commands, receives updates                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚Üï IPC (LocalSocket)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Service Process                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              ClientService                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ServiceStatus management                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Lifecycle coordination                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ pyWATS API client                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇPendingWatcher‚îÇ  ‚îÇConverterPool ‚îÇ  ‚îÇPersistentQueue ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ‚Ä¢ File monitor‚îÇ  ‚îÇ‚Ä¢ Worker mgmt ‚îÇ  ‚îÇ‚Ä¢ SQLite DB     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ‚Ä¢ Periodic    ‚îÇ  ‚îÇ‚Ä¢ 1-50 workers‚îÇ  ‚îÇ‚Ä¢ Crash recovery‚îÇ  ‚îÇ
‚îÇ  ‚îÇ‚Ä¢ Submit queue‚îÇ  ‚îÇ‚Ä¢ Converters  ‚îÇ  ‚îÇ‚Ä¢ Retry logic   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              IPCServer                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Qt LocalSocket server                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Socket: pyWATS_Service_{instance_id}              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ JSON command/response protocol                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<h3 id="component-interactions">Component Interactions</h3>
<div class="codehilite"><pre><span></span><code>GUI                Service           Queue              WATS
 ‚îÇ                    ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ‚îÄ‚îÄStart Command‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ‚îÄ‚îÄInitialize‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ‚óÄ‚îÄQueue Ready‚îÄ‚îÄ‚îÄ‚îÇ                  ‚îÇ
 ‚îÇ‚óÄ‚îÄStatus Update‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ   [File appears in watch folder]   ‚îÇ
 ‚îÇ                    ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ‚îÄ‚îÄAdd Report‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
 ‚îÇ‚óÄ‚îÄFile Processed‚îÄ‚îÄ‚îÄ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ                ‚îÇ                  ‚îÇ
 ‚îÇ                    ‚îÇ                ‚îÇ‚îÄ‚îÄSubmit Report‚îÄ‚îÄ‚ñ∂‚îÇ
 ‚îÇ                    ‚îÇ                ‚îÇ‚óÄ‚îÄSuccess‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
 ‚îÇ                    ‚îÇ‚óÄ‚îÄComplete‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                  ‚îÇ
 ‚îÇ‚óÄ‚îÄStatus Update‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                ‚îÇ                  ‚îÇ
</code></pre></div>

<hr />
<h2 id="service-components">Service Components</h2>
<h3 id="clientservice">ClientService</h3>
<p><strong>Purpose:</strong> Main service controller and lifecycle manager</p>
<p><strong>Location:</strong> <code>src/pywats_client/service/client_service.py</code></p>
<p><strong>ServiceStatus States:</strong><br />
- <code>STOPPED</code> - Not running<br />
- <code>START_PENDING</code> - Initializing<br />
- <code>RUNNING</code> - Active and operational<br />
- <code>STOP_PENDING</code> - Shutting down<br />
- <code>PAUSED</code> - Temporarily paused (reserved for future use)</p>
<p><strong>Key Responsibilities:</strong><br />
1. Initialize and coordinate all components<br />
2. Manage service lifecycle<br />
3. Provide pyWATS API client access<br />
4. Track connection status<br />
5. Handle start/stop/pause commands</p>
<p><strong>Code Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ClientService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ClientConfig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ServiceStatus</span><span class="o">.</span><span class="n">STOPPED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pyWATS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pending_watcher</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PendingWatcher</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_converter_pool</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConverterPool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the service and all components&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ServiceStatus</span><span class="o">.</span><span class="n">START_PENDING</span>

        <span class="c1"># Initialize API client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_api_client</span><span class="p">()</span>

        <span class="c1"># Start queue watcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pending_watcher</span> <span class="o">=</span> <span class="n">PendingWatcher</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_watcher</span><span class="o">.</span><span class="n">async_init</span><span class="p">()</span>

        <span class="c1"># Start converter pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_converter_pool</span> <span class="o">=</span> <span class="n">ConverterPool</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ServiceStatus</span><span class="o">.</span><span class="n">RUNNING</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the service gracefully&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ServiceStatus</span><span class="o">.</span><span class="n">STOP_PENDING</span>

        <span class="c1"># Stop components in reverse order</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_watcher</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_watcher</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ServiceStatus</span><span class="o">.</span><span class="n">STOPPED</span>
</code></pre></div>

<p><strong>API Status Tracking:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_api_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current API connection status&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Disconnected&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Test connection with quick API call</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;Online&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Offline&quot;</span>
</code></pre></div>

<h3 id="pendingwatcher">PendingWatcher</h3>
<p><strong>Purpose:</strong> Monitor and submit queued reports</p>
<p><strong>Location:</strong> <code>src/pywats_client/service/pending_watcher.py</code></p>
<p><strong>Key Features:</strong><br />
1. <strong>File system monitoring:</strong> Watches pending reports directory<br />
2. <strong>Periodic checking:</strong> Timer-based check every 5 minutes<br />
3. <strong>Submission lock:</strong> Prevents concurrent uploads<br />
4. <strong>Async initialization:</strong> Non-blocking startup</p>
<p><strong>Workflow:</strong></p>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Pending Directory   ‚îÇ
‚îÇ - report1.json      ‚îÇ
‚îÇ - report2.json      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  File System Event  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Submission Lock  ‚îÇ
‚îÇ  or Periodic Timer  ‚îÇ      ‚îÇ (Prevent overlap)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                           ‚îÇ
          ‚ñº                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Read Report JSON    ‚îÇ      ‚îÇ  Submit to WATS  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                           ‚îÇ
          ‚ñº                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Move to Processing  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  On Success:     ‚îÇ
‚îÇ                     ‚îÇ      ‚îÇ  Move to Complete‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<p><strong>Code Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PendingWatcher</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">api_client</span><span class="p">:</span> <span class="n">pyWATS</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_dir</span> <span class="o">=</span> <span class="n">queue_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="o">=</span> <span class="n">api_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_submission_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize file watcher and start timer&quot;&quot;&quot;</span>
        <span class="c1"># Set up file system watcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_dir</span> <span class="o">/</span> <span class="s2">&quot;pending&quot;</span><span class="p">),</span>
            <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Start periodic check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_periodic_check</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_periodic_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for pending reports every 5 minutes&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># 5 minutes</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_submit_pending_reports</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_submit_pending_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit all pending reports with lock&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_submission_lock</span><span class="p">:</span>
            <span class="c1"># Process pending reports...</span>
            <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">dispose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean shutdown&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div>

<h3 id="converterpool">ConverterPool</h3>
<p><strong>Purpose:</strong> Manage converter workers and execution</p>
<p><strong>Location:</strong> <code>src/pywats_client/service/converter_pool.py</code></p>
<p><strong>Configuration:</strong><br />
- <code>max_converter_workers</code>: 1-50 (default: 10)<br />
- Worker count bounded to prevent resource exhaustion</p>
<p><strong>Responsibilities:</strong><br />
1. Manage worker threads/processes<br />
2. Distribute converter tasks<br />
3. Maintain converter registry<br />
4. Handle pending conversion queue</p>
<p><strong>Code Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConverterPool</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_converters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Converter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pending_queue</span><span class="p">:</span> <span class="n">Queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispose_flag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converter</span><span class="p">:</span> <span class="n">Converter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a converter&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_converters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converter</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">converter</span><span class="p">:</span> <span class="n">Converter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit file for conversion&quot;&quot;&quot;</span>
        <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_file</span><span class="p">,</span>
            <span class="n">file_path</span><span class="p">,</span>
            <span class="n">converter</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">future</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">converter</span><span class="p">:</span> <span class="n">Converter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute conversion (runs in worker thread)&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">ConverterSource</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{})</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown pool&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispose_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="ipc-communication">IPC Communication</h2>
<h3 id="protocol-overview">Protocol Overview</h3>
<p><strong>Transport:</strong> Qt LocalSocket (named pipe on Windows, Unix socket on Linux/Mac)</p>
<p><strong>Socket Name:</strong> <code>pyWATS_Service_{instance_id}</code><br />
- Example: <code>pyWATS_Service_default</code><br />
- Example: <code>pyWATS_Service_production</code></p>
<p><strong>Message Format:</strong> JSON</p>
<h3 id="command-structure">Command Structure</h3>
<p><strong>Request (GUI ‚Üí Service):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;get_status&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid-here&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;param1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value1&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Response (Service ‚Üí GUI):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;api_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Online&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;pending_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid-here&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="supported-commands">Supported Commands</h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>Args</th>
<th>Response</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get_status</code></td>
<td>None</td>
<td>ServiceStatus, API status</td>
<td>Check service state</td>
</tr>
<tr>
<td><code>get_config</code></td>
<td>None</td>
<td>ClientConfig</td>
<td>Get current configuration</td>
</tr>
<tr>
<td><code>start</code></td>
<td>None</td>
<td>Success/error</td>
<td>Start service</td>
</tr>
<tr>
<td><code>stop</code></td>
<td>None</td>
<td>Success/error</td>
<td>Stop service gracefully</td>
</tr>
<tr>
<td><code>restart</code></td>
<td>None</td>
<td>Success/error</td>
<td>Restart service</td>
</tr>
<tr>
<td><code>ping</code></td>
<td>None</td>
<td>"pong"</td>
<td>Health check</td>
</tr>
<tr>
<td><code>get_queue_stats</code></td>
<td>None</td>
<td>Pending/failed counts</td>
<td>Queue status</td>
</tr>
</tbody>
</table>
<h3 id="ipcserver-implementation">IPCServer Implementation</h3>
<p><strong>Location:</strong> <code>src/pywats_client/service/ipc_server.py</code></p>
<p><strong>Code Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">IPCServer</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="n">ClientService</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_id</span> <span class="o">=</span> <span class="n">instance_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">QLocalServer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">QLocalSocket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start IPC server&quot;&quot;&quot;</span>
        <span class="n">socket_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pyWATS_Service_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Remove stale socket</span>
        <span class="n">QLocalServer</span><span class="o">.</span><span class="n">removeServer</span><span class="p">(</span><span class="n">socket_name</span><span class="p">)</span>

        <span class="c1"># Start listening</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">socket_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">newConnection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_new_connection</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_new_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle new client connection&quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">nextPendingConnection</span><span class="p">()</span>
        <span class="n">client</span><span class="o">.</span><span class="n">readyRead</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_data_ready</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_data_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">QLocalSocket</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process incoming command&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">readAll</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Dispatch command</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_command</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1"># Send response</span>
        <span class="n">client</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">client</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute command and return response&quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;get_status&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;api_status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">get_api_status</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;ping&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">,</span>
                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># ... other commands</span>
</code></pre></div>

<h3 id="serviceipcclient-gui-side">ServiceIPCClient (GUI Side)</h3>
<p><strong>Location:</strong> <code>src/pywats_client/gui/ipc_client.py</code></p>
<p><strong>Code Structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ServiceIPCClient</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">status_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_id</span> <span class="o">=</span> <span class="n">instance_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span> <span class="o">=</span> <span class="n">QLocalSocket</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect_to_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to service IPC socket&quot;&quot;&quot;</span>
        <span class="n">socket_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pyWATS_Service_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">connectToServer</span><span class="p">(</span><span class="n">socket_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">waitForConnected</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">readyRead</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_data_ready</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send command and wait for response&quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="n">command</span><span class="p">,</span>
            <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">}</span>

        <span class="c1"># Send request</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Wait for response</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">waitForReadyRead</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="s2">&quot;No response from service&quot;</span><span class="p">)</span>

        <span class="n">response_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">readAll</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get service status&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;get_status&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="queue-system">Queue System</h2>
<h3 id="persistentqueue-architecture">PersistentQueue Architecture</h3>
<p><strong>Purpose:</strong> SQLite-backed report queue with crash recovery</p>
<p><strong>Location:</strong> <code>src/pywats_client/queue/persistent_queue.py</code></p>
<p><strong>Database Schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">reports</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">report_data</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">attempts</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">error</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="k">CHECK</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;processing&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;failed&#39;</span><span class="p">))</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">reports</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">reports</span><span class="p">(</span><span class="n">created_at</span><span class="p">);</span>
</code></pre></div>

<h3 id="queue-states">Queue States</h3>
<div class="codehilite"><pre><span></span><code><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="n">pending</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">Initial</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">awaiting</span><span class="w"> </span><span class="n">upload</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">      </span><span class="err">‚îÇ</span>
<span class="w">      </span><span class="err">‚ñº</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="n">processing</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">Currently</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">uploaded</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">      </span><span class="err">‚îÇ</span>
<span class="w">      </span><span class="err">‚îú‚îÄ</span><span class="n">Success</span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="w">      </span><span class="err">‚îÇ</span><span class="w">              </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">Successfully</span><span class="w"> </span><span class="n">uploaded</span>
<span class="w">      </span><span class="err">‚îÇ</span><span class="w">              </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">      </span><span class="err">‚îÇ</span>
<span class="w">      </span><span class="err">‚îî‚îÄ</span><span class="n">Failure</span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="w">                     </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">pending</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">Retry</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">max</span><span class="p">)</span>
<span class="w">                     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                           </span><span class="err">‚îÇ</span>
<span class="w">                           </span><span class="err">‚îî‚îÄ</span><span class="n">Max</span><span class="w"> </span><span class="n">retries</span><span class="err">‚îÄ‚îÄ‚îÄ‚ñ∂‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="w">                                            </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">Permanent</span><span class="w"> </span><span class="n">failure</span>
<span class="w">                                            </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
</code></pre></div>

<h3 id="crash-recovery">Crash Recovery</h3>
<p><strong>On service startup:</strong><br />
1. Scan database for reports in <code>processing</code> state<br />
2. Reset to <code>pending</code> state (interrupted uploads)<br />
3. Increment attempt counter<br />
4. Add to retry queue</p>
<p><strong>Implementation:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PersistentQueue</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_dir</span> <span class="o">=</span> <span class="n">queue_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">queue_dir</span> <span class="o">/</span> <span class="s2">&quot;queue.db&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_database</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recover_crashed_reports</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_recover_crashed_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset processing reports to pending on startup&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            UPDATE reports </span>
<span class="s2">            SET status = &#39;pending&#39;,</span>
<span class="s2">                attempts = attempts + 1,</span>
<span class="s2">                updated_at = ?</span>
<span class="s2">            WHERE status = &#39;processing&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),))</span>

        <span class="n">recovered</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">recovered</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recovered </span><span class="si">{</span><span class="n">recovered</span><span class="si">}</span><span class="s2"> crashed reports&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add report to queue&quot;&quot;&quot;</span>
        <span class="n">report_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            INSERT INTO reports (id, report_data, status, created_at, updated_at)</span>
<span class="s2">            VALUES (?, ?, &#39;pending&#39;, ?, ?)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">report_id</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report_data</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">report_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_pending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">QueuedReport</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get pending reports for upload&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT id, report_data, attempts</span>
<span class="s2">            FROM reports</span>
<span class="s2">            WHERE status = &#39;pending&#39;</span>
<span class="s2">            ORDER BY created_at</span>
<span class="s2">            LIMIT ?</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">limit</span><span class="p">,))</span>

        <span class="n">reports</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">QueuedReport</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">report_data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">attempts</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reports</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark report as being uploaded&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_status</span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span> <span class="s1">&#39;processing&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark report as successfully uploaded&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_status</span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark report as failed, retry if attempts &lt; max&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            UPDATE reports</span>
<span class="s2">            SET status = CASE</span>
<span class="s2">                    WHEN attempts &gt;= ? THEN &#39;failed&#39;</span>
<span class="s2">                    ELSE &#39;pending&#39;</span>
<span class="s2">                END,</span>
<span class="s2">                error = ?,</span>
<span class="s2">                attempts = attempts + 1,</span>
<span class="s2">                updated_at = ?</span>
<span class="s2">            WHERE id = ?</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">max_attempts</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">report_id</span><span class="p">))</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="retry-logic">Retry Logic</h3>
<p><strong>Configuration:</strong><br />
- <code>max_retry_attempts</code>: Default 3<br />
- <code>retry_interval_seconds</code>: Default 60</p>
<p><strong>Exponential Backoff:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_retry_delay</span><span class="p">(</span><span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate delay with exponential backoff&quot;&quot;&quot;</span>
    <span class="n">base_delay</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># 1 minute</span>
    <span class="n">max_delay</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># 1 hour</span>

    <span class="n">delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">),</span> <span class="n">max_delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delay</span>
</code></pre></div>

<hr />
<h2 id="converter-system">Converter System</h2>
<h3 id="converter-lifecycle">Converter Lifecycle</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">Load</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="n">Import</span><span class="w"> </span><span class="p">(</span><span class="n">dynamic</span><span class="p">)</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="n">Instantiation</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">Pattern</span><span class="w"> </span><span class="n">Registration</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Watch</span><span class="w"> </span><span class="n">Folder</span><span class="w"> </span><span class="n">Setup</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="p">[</span><span class="n">File</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">watch</span><span class="w"> </span><span class="n">folder</span><span class="p">]</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">6.</span><span class="w"> </span><span class="n">Event</span><span class="w"> </span><span class="n">Triggered</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">7.</span><span class="w"> </span><span class="n">Debounce</span><span class="w"> </span><span class="n">Wait</span><span class="w"> </span><span class="p">(</span><span class="mi">500</span><span class="n">ms</span><span class="p">)</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">8.</span><span class="w"> </span><span class="n">Pattern</span><span class="w"> </span><span class="n">Match</span><span class="w"> </span><span class="n">Check</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">9.</span><span class="w"> </span><span class="n">Converter</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="w"> </span><span class="n">Call</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">10.</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="n">Validation</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">11.</span><span class="w"> </span><span class="n">Queue</span><span class="w"> </span><span class="n">Submission</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">Direct</span><span class="w"> </span><span class="n">Upload</span>
<span class="w">   </span><span class="err">‚Üì</span>
<span class="mf">12.</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">Processing</span><span class="w"> </span><span class="p">(</span><span class="n">move</span><span class="o">/</span><span class="n">delete</span><span class="o">/</span><span class="n">archive</span><span class="p">)</span>
</code></pre></div>

<h3 id="fileconverter-base-class">FileConverter Base Class</h3>
<p><strong>Location:</strong> <code>src/pywats_client/converters/file_converter.py</code></p>
<p><strong>Abstract Methods:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileConverter</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converter display name&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converter version&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;1.0.0&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">file_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;File patterns to match (glob)&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConverterResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert file to report&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div>

<h3 id="converter-configuration">Converter Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CSV Converter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;module_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;converters.csv_converter.CSVConverter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;watch_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Incoming&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;done_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Done&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Error&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file_patterns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.csv&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;post_action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;move&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;delimiter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;utf-8&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="dynamic-loading">Dynamic Loading</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_converter</span><span class="p">(</span><span class="n">module_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Converter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamically load converter class&quot;&quot;&quot;</span>
    <span class="c1"># Parse module path</span>
    <span class="n">module_name</span><span class="p">,</span> <span class="n">class_name</span> <span class="o">=</span> <span class="n">module_path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Import module</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>

    <span class="c1"># Get class</span>
    <span class="n">converter_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>

    <span class="c1"># Instantiate with arguments</span>
    <span class="n">converter</span> <span class="o">=</span> <span class="n">converter_class</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">converter</span>
</code></pre></div>

<hr />
<h2 id="file-monitoring">File Monitoring</h2>
<h3 id="watchdog-integration">Watchdog Integration</h3>
<p><strong>Library:</strong> <code>watchdog</code> (cross-platform file system events)</p>
<p><strong>Event Types:</strong><br />
- <code>FileCreatedEvent</code> - New file appears<br />
- <code>FileModifiedEvent</code> - File content changed<br />
- <code>FileDeletedEvent</code> - File removed<br />
- <code>FileMovedEvent</code> - File renamed/moved</p>
<h3 id="debouncing">Debouncing</h3>
<p><strong>Problem:</strong> File system events fire multiple times during file write</p>
<p><strong>Solution:</strong> Wait for write completion before processing</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DebouncingEventHandler</span><span class="p">(</span><span class="n">FileSystemEventHandler</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>  <span class="c1"># 500ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_directory</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Cancel previous timer</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">src_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timers</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">src_path</span><span class="p">]</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="c1"># Start new timer</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_file</span><span class="p">,</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">src_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timers</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">src_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">timer</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called after debounce delay&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timers</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timers</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span>
</code></pre></div>

<hr />
<h2 id="instance-management">Instance Management</h2>
<h3 id="multi-instance-support">Multi-Instance Support</h3>
<p><strong>Use Case:</strong> Multiple test processes on same machine</p>
<p><strong>Example:</strong><br />
- Instance "ict" - ICT testing<br />
- Instance "fct" - Functional testing<br />
- Instance "eol" - End-of-line testing</p>
<h3 id="instance-isolation">Instance Isolation</h3>
<p><strong>Separate per instance:</strong><br />
- Configuration file: <code>config_{instance_id}.json</code><br />
- Queue directory: <code>reports_{instance_id}/</code><br />
- Log file: <code>client_{instance_id}.log</code><br />
- IPC socket: <code>pyWATS_Service_{instance_id}</code><br />
- Lock file: <code>instance_{instance_id}.lock</code></p>
<h3 id="lock-file-mechanism">Lock File Mechanism</h3>
<p><strong>Location:</strong> <code>%TEMP%\pyWATS_Client\instance_{id}.lock</code></p>
<p><strong>Content:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;instance_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;instance_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Production Station&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;started&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-26T10:30:00Z&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Stale Lock Detection:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_process_running</span><span class="p">(</span><span class="n">pid</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if PID is still alive&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
            <span class="c1"># Windows: Check with tasklist</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;tasklist&quot;</span><span class="p">,</span> <span class="s2">&quot;/FI&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;PID eq </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="ow">in</span> <span class="n">output</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unix: Send signal 0</span>
            <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<hr />
<h2 id="configuration-system">Configuration System</h2>
<p>See <a href="architecture.md#configuration-management">Configuration Management</a> in main architecture doc.</p>
<p><strong>Key Points:</strong><br />
- JSON-based configuration<br />
- Machine-specific encryption for API tokens<br />
- Environment variable overrides<br />
- Multi-instance support</p>
<hr />
<h2 id="service-modes">Service Modes</h2>
<h3 id="1-gui-mode-default">1. GUI Mode (Default)</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui
</code></pre></div>

<ul>
<li>Service + GUI in same process (legacy)</li>
<li>Full user interface</li>
<li>Best for: Development, troubleshooting</li>
</ul>
<h3 id="2-service-mode-headless">2. Service Mode (Headless)</h3>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service<span class="w"> </span>--daemon
</code></pre></div>

<ul>
<li>Service only, no GUI</li>
<li>Runs in background</li>
<li>Best for: Production, servers</li>
</ul>
<h3 id="3-separate-service-gui">3. Separate Service + GUI</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Terminal 1: Start service</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>service

<span class="c1"># Terminal 2: Start GUI (connects to service)</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w"> </span>--connect
</code></pre></div>

<ul>
<li>Service and GUI in separate processes</li>
<li>GUI can crash without affecting service</li>
<li>Best for: Reliability, debugging</li>
</ul>
<h3 id="4-windows-service">4. Windows Service</h3>
<div class="codehilite"><pre><span></span><code><span class="n">pywats-client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">production</span>
<span class="nb">Start-Service</span> <span class="n">pyWATS-Client-production</span>
</code></pre></div>

<ul>
<li>Installed as Windows service</li>
<li>Auto-start on boot</li>
<li>Best for: Production Windows stations</li>
</ul>
<h3 id="5-linux-systemd">5. Linux systemd</h3>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>pywats-client@production
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-client@production
</code></pre></div>

<ul>
<li>Managed by systemd</li>
<li>Auto-restart on failure</li>
<li>Best for: Production Linux stations</li>
</ul>
<h3 id="6-docker-container">6. Docker Container</h3>
<div class="codehilite"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>ghcr.io/olreppe/pywats:client-headless
</code></pre></div>

<ul>
<li>Containerized deployment</li>
<li>Reproducible environment</li>
<li>Best for: Cloud, Kubernetes, server racks</li>
</ul>
<hr />
<h2 id="testing-architecture">Testing Architecture</h2>
<h3 id="test-suite-overview">Test Suite Overview</h3>
<p><strong>Location:</strong> <code>api-tests/client/</code></p>
<p><strong>Coverage:</strong> 85 tests (100% passing)</p>
<p><strong>Test Categories:</strong><br />
1. <strong>Configuration (18 tests)</strong> - Config validation, serialization, lifecycle<br />
2. <strong>Converters (10 tests)</strong> - Base classes, validation, results<br />
3. <strong>Queue (21 tests)</strong> - Persistence, crash recovery, retry<br />
4. <strong>Service (17 tests)</strong> - ClientService, PendingWatcher, ConverterPool<br />
5. <strong>IPC (10 tests)</strong> - Communication, protocols, commands<br />
6. <strong>Integration (9 tests)</strong> - End-to-end workflows</p>
<h3 id="test-philosophy">Test Philosophy</h3>
<p><strong>Principles:</strong><br />
- Minimal mocking (use actual components where possible)<br />
- Mock PySide6 at module level (avoid Qt runtime)<br />
- Test business logic, not implementation details<br />
- Focus on public interfaces</p>
<p><strong>Example Test:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_persistent_queue_crash_recovery</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that processing reports are recovered on restart&quot;&quot;&quot;</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">PersistentQueue</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>

    <span class="c1"># Add report and mark as processing</span>
    <span class="n">report_id</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">add</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">})</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">mark_processing</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span>

    <span class="c1"># Simulate crash (create new queue instance)</span>
    <span class="n">queue2</span> <span class="o">=</span> <span class="n">PersistentQueue</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>

    <span class="c1"># Verify report reset to pending</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="n">queue2</span><span class="o">.</span><span class="n">get_pending</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">report_id</span>
    <span class="k">assert</span> <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attempts</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Incremented</span>
</code></pre></div>

<h3 id="running-tests">Running Tests</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all client tests</span>
pytest<span class="w"> </span>api-tests/client/<span class="w"> </span>-v

<span class="c1"># Run specific category</span>
pytest<span class="w"> </span>api-tests/client/test_service.py<span class="w"> </span>-v

<span class="c1"># Run with coverage</span>
pytest<span class="w"> </span>api-tests/client/<span class="w"> </span>--cov<span class="o">=</span>pywats_client<span class="w"> </span>--cov-report<span class="o">=</span>html
</code></pre></div>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="service-wont-start">Service Won't Start</h3>
<p><strong>Check lock file:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Windows</span>
dir<span class="w"> </span><span class="s2">&quot;%TEMP%\pyWATS_Client\*.lock&quot;</span>

<span class="c1"># Linux</span>
ls<span class="w"> </span>/tmp/pyWATS_Client/*.lock
</code></pre></div>

<p><strong>Remove stale lock:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>unlock<span class="w"> </span>--instance-id<span class="w"> </span>production
</code></pre></div>

<h3 id="gui-cant-connect-to-service">GUI Can't Connect to Service</h3>
<p><strong>Verify service running:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>status<span class="w"> </span>--instance-id<span class="w"> </span>production
</code></pre></div>

<p><strong>Check socket name:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Should be: pyWATS_Service_{instance_id}</span>
<span class="c1"># Windows: \\.\pipe\pyWATS_Service_production</span>
<span class="c1"># Linux: /tmp/pyWATS_Service_production</span>
</code></pre></div>

<p><strong>Test IPC manually:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.gui.ipc_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceIPCClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">ServiceIPCClient</span><span class="p">(</span><span class="s2">&quot;production&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">client</span><span class="o">.</span><span class="n">connect_to_service</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;ping&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>  <span class="c1"># Should be &quot;pong&quot;</span>
</code></pre></div>

<h3 id="queue-growing-too-large">Queue Growing Too Large</h3>
<p><strong>Check failed reports:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>queue<span class="w"> </span>stats<span class="w"> </span>--instance-id<span class="w"> </span>production
</code></pre></div>

<p><strong>Retry failed:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>queue<span class="w"> </span>retry<span class="w"> </span>--instance-id<span class="w"> </span>production
</code></pre></div>

<p><strong>Clear completed:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>queue<span class="w"> </span>clean<span class="w"> </span>--instance-id<span class="w"> </span>production
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="architecture.md">Architecture Overview</a></strong> - System-wide architecture</li>
<li><strong><a href="integration-patterns.md">Integration Patterns</a></strong> - Common workflows</li>
<li><strong><a href="installation/client.md">Client Installation</a></strong> - Installation guide</li>
<li><strong><a href="installation/windows-service.md">Service Deployment</a></strong> - Service setup</li>
</ul>
<hr />
<p><strong>Last Updated:</strong> January 26, 2026<br />
<strong>Version:</strong> 1.3.0 (Separate Service/GUI Architecture)</p>
</div>


<div class="doc-separator" id="architecture-integration-patterns">
    <div class="doc-source">Source: docs/integration-patterns.md</div>
    <h1 id="integration-patterns-common-scenarios">Integration Patterns &amp; Common Scenarios</h1>
<p><strong>Purpose:</strong> Practical guidance for integrating pyWATS into manufacturing test environments<br />
<strong>Audience:</strong> Integration engineers, test station setup technicians, developers<br />
<strong>Last Updated:</strong> January 2026</p>
<hr />
<h2 id="overview">Overview</h2>
<p>This guide provides <strong>complete workflows</strong> and <strong>proven patterns</strong> for common pyWATS integration scenarios. Each pattern includes configuration examples, code snippets, and troubleshooting tips.</p>
<p><strong>Quick Links:</strong><br />
- <a href="#complete-station-setup">Complete Station Setup</a><br />
- <a href="#multi-process-workflows">Multi-Process Workflows</a><br />
- <a href="#error-recovery-patterns">Error Recovery Patterns</a><br />
- <a href="#performance-optimization">Performance Optimization</a><br />
- <a href="#common-scenarios">Common Scenarios</a></p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#complete-station-setup">Complete Station Setup</a></li>
<li><a href="#multi-process-workflows">Multi-Process Workflows</a></li>
<li><a href="#error-recovery-patterns">Error Recovery Patterns</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#common-scenarios">Common Scenarios</a></li>
<li><a href="#troubleshooting-guide">Troubleshooting Guide</a></li>
</ol>
<hr />
<h2 id="complete-station-setup">Complete Station Setup</h2>
<h3 id="scenario-new-test-station-from-scratch">Scenario: New Test Station from Scratch</h3>
<p><strong>Goal:</strong> Set up a production test station that automatically converts CSV test files and uploads to WATS.</p>
<h4 id="step-1-install-pywats-client">Step 1: Install pyWATS Client</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install from PyPI</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats-api<span class="o">[</span>client<span class="o">]</span>

<span class="c1"># Or install from wheel</span>
pip<span class="w"> </span>install<span class="w"> </span>pywats_api-1.3.0-py3-none-any.whl
</code></pre></div>

<p><strong>Verify installation:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>--version
</code></pre></div>

<h4 id="step-2-initialize-configuration">Step 2: Initialize Configuration</h4>
<p><strong>Option A: GUI mode (recommended for first setup)</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui
</code></pre></div>

<ul>
<li>Complete login window (server URL + password)</li>
<li>Configure station name and location</li>
<li>Test connection</li>
</ul>
<p><strong>Option B: Headless mode</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>config<span class="w"> </span>init<span class="w"> </span>--instance-id<span class="w"> </span>production
</code></pre></div>

<p>Edit <code>%APPDATA%\pyWATS_Client\config_production.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;instance_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;instance_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Station ICT-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;service_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;api_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Will be encrypted after first auth</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Building A - Line 1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;purpose&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Production&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="step-3-authenticate-and-test">Step 3: Authenticate and Test</h4>
<p><strong>GUI mode:</strong> Already done in login window</p>
<p><strong>Headless mode:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Load config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load_for_instance</span><span class="p">(</span><span class="s2">&quot;production&quot;</span><span class="p">)</span>

<span class="c1"># Test connection</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">service_address</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">api_token</span> <span class="ow">or</span> <span class="s2">&quot;YOUR_API_TOKEN_HERE&quot;</span>
<span class="p">)</span>

<span class="c1"># Test API call</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to WATS </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="step-4-set-up-converter">Step 4: Set Up Converter</h4>
<p><strong>Create converter module</strong> (<code>C:\Converters\csv_converter.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileConverter</span><span class="p">,</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">ConverterResult</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CSVConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;CSV Test Converter&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">file_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;*.csv&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConverterResult</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Parse CSV</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span>

            <span class="c1"># Extract header info (first row)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Create report</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
                <span class="n">part_number</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;PartNumber&quot;</span><span class="p">],</span>
                <span class="n">serial_number</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;SerialNumber&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Add test steps</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># Skip header row</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;TestName&quot;</span><span class="p">],</span>
                    <span class="n">value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]),</span>
                    <span class="n">unit</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Unit&quot;</span><span class="p">),</span>
                    <span class="n">limits</span><span class="o">=</span><span class="p">(</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;HighLimit&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HighLimit&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</code></pre></div>

<p><strong>Add to config:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CSV Test Converter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;module_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;csv_converter.CSVConverter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;watch_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Incoming&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;done_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Done&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Error&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file_patterns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.csv&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;post_action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;move&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Create directories:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">New-Item</span> <span class="n">-ItemType</span> <span class="n">Directory</span> <span class="n">-Force</span> <span class="n">-Path</span> <span class="s2">&quot;C:\TestData\Incoming&quot;</span>
<span class="nb">New-Item</span> <span class="n">-ItemType</span> <span class="n">Directory</span> <span class="n">-Force</span> <span class="n">-Path</span> <span class="s2">&quot;C:\TestData\Done&quot;</span>
<span class="nb">New-Item</span> <span class="n">-ItemType</span> <span class="n">Directory</span> <span class="n">-Force</span> <span class="n">-Path</span> <span class="s2">&quot;C:\TestData\Error&quot;</span>
</code></pre></div>

<h4 id="step-5-enable-offline-queue">Step 5: Enable Offline Queue</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;offline_queue_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;reports_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\Queue&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;max_retry_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;retry_interval_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Queue directories created automatically:</strong><br />
- <code>C:\TestData\Queue\pending\</code><br />
- <code>C:\TestData\Queue\processing\</code><br />
- <code>C:\TestData\Queue\completed\</code><br />
- <code>C:\TestData\Queue\failed\</code></p>
<h4 id="step-6-test-with-sample-data">Step 6: Test with Sample Data</h4>
<p><strong>Create test file</strong> (<code>C:\TestData\Incoming\test.csv</code>):</p>
<div class="codehilite"><pre><span></span><code>PartNumber,SerialNumber,,,
WIDGET-100,SN-12345,,,
TestName,Value,Unit,LowLimit,HighLimit
Resistance,10.5,Ohm,9.0,12.0
Voltage,5.01,V,4.95,5.05
Current,0.998,A,0.95,1.05
</code></pre></div>

<p><strong>Monitor:</strong><br />
- File should be moved to <code>Done\</code> folder<br />
- Check queue: <code>C:\TestData\Queue\completed\</code><br />
- Verify in WATS: Search for <code>SN-12345</code></p>
<h4 id="step-7-deploy-to-production">Step 7: Deploy to Production</h4>
<p><strong>Option A: Windows Service</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Install as service</span>
<span class="n">python</span> <span class="n">-m</span> <span class="n">pywats_client</span> <span class="nb">install-service</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">production</span>

<span class="c"># Start service</span>
<span class="nb">Start-Service</span> <span class="n">pyWATS-Client-production</span>

<span class="c"># Check status</span>
<span class="nb">Get-Service</span> <span class="n">pyWATS-Client-production</span>
</code></pre></div>

<p><strong>Option B: Linux systemd</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create service file</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/systemd/system/pywats-client@.service

<span class="c1"># Enable and start</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>pywats-client@production
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pywats-client@production

<span class="c1"># Check status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pywats-client@production
</code></pre></div>

<p><strong>Option C: Docker</strong></p>
<div class="codehilite"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>pywats-client-production<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--restart<span class="w"> </span>unless-stopped<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/opt/pywats/config:/app/config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/opt/pywats/data:/app/data<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/testdata:/testdata<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/olreppe/pywats:client-headless
</code></pre></div>

<hr />
<h2 id="multi-process-workflows">Multi-Process Workflows</h2>
<h3 id="pattern-sequential-testing-ict-fct-eol">Pattern: Sequential Testing (ICT ‚Üí FCT ‚Üí EOL)</h3>
<p><strong>Scenario:</strong> Product goes through multiple test stages, each stage submits separate report.</p>
<h4 id="architecture">Architecture</h4>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ICT Station ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ FCT Station ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ EOL Station ‚îÇ
‚îÇ Converter 1 ‚îÇ    ‚îÇ Converter 2 ‚îÇ    ‚îÇ Converter 3 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚ñº                  ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    WATS Server                     ‚îÇ
‚îÇ  Report 1 (ICT)   Report 2 (FCT)   Report 3 (EOL) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<h4 id="implementation">Implementation</h4>
<p><strong>Each station runs separate client instance:</strong></p>
<p><strong>ICT Station:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;instance_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ict&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;instance_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ICT Station&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ICT Converter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;module_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;converters.ict_converter.ICTConverter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;watch_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\ICT\\Incoming&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file_patterns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.ict&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>FCT Station:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;instance_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fct&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;instance_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCT Station&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCT-STATION-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;converters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCT Converter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;module_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;converters.fct_converter.FCTConverter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;watch_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\TestData\\FCT\\Incoming&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file_patterns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.fct&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Process in converter:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FCTConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_file</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">],</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Set operation type (test_operation in WATS)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">set_operation_type</span><span class="p">(</span><span class="s2">&quot;FCT&quot;</span><span class="p">)</span>  <span class="c1"># or &quot;Functional Test&quot;</span>

        <span class="c1"># Important: Each station creates separate report</span>
        <span class="c1"># WATS links them by serial_number</span>

        <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</code></pre></div>

<p><strong>Querying multi-process results:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Get all reports for a serial number</span>
<span class="n">reports</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_reports</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="c1"># Filter by operation type</span>
<span class="n">ict_reports</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">operation_type</span> <span class="o">==</span> <span class="s2">&quot;ICT&quot;</span><span class="p">]</span>
<span class="n">fct_reports</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">operation_type</span> <span class="o">==</span> <span class="s2">&quot;FCT&quot;</span><span class="p">]</span>
<span class="n">eol_reports</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">operation_type</span> <span class="o">==</span> <span class="s2">&quot;EOL&quot;</span><span class="p">]</span>
</code></pre></div>

<h3 id="pattern-parallel-testing-multiple-stations-same-process">Pattern: Parallel Testing (Multiple Stations, Same Process)</h3>
<p><strong>Scenario:</strong> 5 FCT stations running in parallel, all uploading to same WATS instance.</p>
<p><strong>Configuration: Same across all stations</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCT-STATION-${NUMBER}&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// FCT-STATION-01, 02, 03...</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Building A - Line 1&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Station identification:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>

<span class="c1"># Auto-detect station name from hostname</span>
<span class="n">station_name</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">()</span>  <span class="o">//</span> <span class="s2">&quot;FCT-STATION-03&quot;</span>
</code></pre></div>

<p><strong>Rate limiting consideration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.core.throttle</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_throttling</span>

<span class="c1"># Share rate limit across all stations</span>
<span class="c1"># 500 req/min default = ~100 req/min per station with 5 stations</span>
<span class="n">configure_throttling</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">window_seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="error-recovery-patterns">Error Recovery Patterns</h2>
<h3 id="pattern-network-failure-handling">Pattern: Network Failure Handling</h3>
<p><strong>Scenario:</strong> Test station loses network connection mid-shift, queue reports, auto-upload when back online.</p>
<h4 id="configuration">Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;offline_queue_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;max_retry_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;retry_interval_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;auto_reconnect&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;health_check_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="how-it-works">How It Works</h4>
<ol>
<li><strong>Network goes down:</strong></li>
<li>Client detects connection failure</li>
<li>Switches to OFFLINE status</li>
<li>
<p>Reports queue to <code>pending/</code> folder</p>
</li>
<li>
<p><strong>Network returns:</strong></p>
</li>
<li>Health check succeeds</li>
<li>Client reconnects automatically</li>
<li>Queued reports upload in order</li>
<li>
<p>Successful uploads move to <code>completed/</code></p>
</li>
<li>
<p><strong>Monitoring queue:</strong></p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentQueue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">PersistentQueue</span><span class="p">(</span><span class="s2">&quot;/path/to/queue&quot;</span><span class="p">)</span>

<span class="c1"># Check status</span>
<span class="n">pending</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_pending_count</span><span class="p">()</span>
<span class="n">failed</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_failed_count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pending: </span><span class="si">{</span><span class="n">pending</span><span class="si">}</span><span class="s2">, Failed: </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Retry failed reports manually</span>
<span class="n">failed_reports</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_failed_reports</span><span class="p">()</span>
<span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">failed_reports</span><span class="p">:</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-authentication-expiration">Pattern: Authentication Expiration</h3>
<p><strong>Scenario:</strong> API token expires or is revoked.</p>
<h4 id="detection">Detection</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthenticationError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">)</span>
<span class="k">except</span> <span class="n">AuthenticationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Trigger re-authentication flow</span>
</code></pre></div>

<h4 id="auto-renewal-gui-mode">Auto-renewal (GUI mode)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># GUI detects auth failure</span>
<span class="c1"># Shows login dialog</span>
<span class="c1"># User re-enters credentials</span>
<span class="c1"># Token updated and encrypted</span>
<span class="c1"># Operations resume</span>
</code></pre></div>

<h4 id="manual-renewal-headless-mode">Manual renewal (headless mode)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Update token in environment</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYWATS_API_TOKEN</span><span class="o">=</span><span class="s2">&quot;new-token-here&quot;</span>

<span class="c1"># Or update config file</span>
pywats-client<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--api-token<span class="w"> </span><span class="s2">&quot;new-token&quot;</span>

<span class="c1"># Restart service</span>
systemctl<span class="w"> </span>restart<span class="w"> </span>pywats-client@production
</code></pre></div>

<h3 id="pattern-converter-failures">Pattern: Converter Failures</h3>
<p><strong>Scenario:</strong> Converter crashes or produces invalid data.</p>
<h4 id="error-handling-in-converter">Error Handling in Converter</h4>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RobustConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Parse file</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_file</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

            <span class="c1"># Validate data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span>
                    <span class="s2">&quot;Validation failed: Missing required fields&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Build report</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Data format error</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parse error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Unexpected error</span>
            <span class="n">context</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converter crash: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Internal error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="file-routing">File Routing</h4>
<div class="codehilite"><pre><span></span><code>Success ‚Üí done_folder/
Failure ‚Üí error_folder/
</code></pre></div>

<p><strong>Review failures:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check error folder</span>
<span class="nb">Get-ChildItem</span> <span class="s2">&quot;C:\TestData\Error&quot;</span> <span class="n">-Recurse</span>

<span class="c"># Read error log</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\TestData\Error\test.csv.error&quot;</span>
</code></pre></div>

<h3 id="pattern-crash-recovery">Pattern: Crash Recovery</h3>
<p><strong>Scenario:</strong> Power failure or system crash during report upload.</p>
<h4 id="persistentqueue-behavior">PersistentQueue Behavior</h4>
<p><strong>On startup:</strong><br />
1. Scan queue database (SQLite)<br />
2. Find reports in <code>processing</code> state<br />
3. Reset to <code>pending</code> state<br />
4. Retry upload</p>
<p><strong>Example recovery:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Automatic on service start</span>
<span class="c1"># No manual intervention needed</span>

<span class="c1"># To verify recovery:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentQueue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">PersistentQueue</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">queue</span><span class="o">.</span><span class="n">recover_crashed_reports</span><span class="p">()</span>

<span class="c1"># Check recovery log</span>
<span class="nb">print</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">get_recovery_stats</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="performance-optimization">Performance Optimization</h2>
<h3 id="pattern-batch-operations">Pattern: Batch Operations</h3>
<p><strong>Scenario:</strong> Upload 1000 reports from historical data.</p>
<h4 id="async-batch-submission">Async Batch Submission</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">batch_upload</span><span class="p">(</span><span class="n">reports</span><span class="p">):</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Concurrent upload (limit concurrency)</span>
    <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Max 10 concurrent</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upload_one</span><span class="p">(</span><span class="n">report</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report_async</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="c1"># Execute all uploads</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">upload_one</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports</span><span class="p">])</span>

    <span class="c1"># Analyze results</span>
    <span class="n">successes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success: </span><span class="si">{</span><span class="n">successes</span><span class="si">}</span><span class="s2">, Failures: </span><span class="si">{</span><span class="n">failures</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Run</span>
<span class="n">reports</span> <span class="o">=</span> <span class="n">load_reports_from_files</span><span class="p">()</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">batch_upload</span><span class="p">(</span><span class="n">reports</span><span class="p">))</span>
</code></pre></div>

<p><strong>Performance:</strong> ~100x faster than sequential uploads</p>
<h3 id="pattern-connection-pooling">Pattern: Connection Pooling</h3>
<p><strong>Scenario:</strong> Multiple test scripts running on same machine.</p>
<h4 id="shared-http-client">Shared HTTP Client</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">atexit</span>

<span class="c1"># Global client instance (reuses connections)</span>
<span class="n">_api_client</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_api</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_api_client</span>
    <span class="k">if</span> <span class="n">_api_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_api_client</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
            <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
            <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Clean up on exit</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_api_client</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_api_client</span>

<span class="c1"># Usage in multiple scripts</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">get_api</span><span class="p">()</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report1</span><span class="p">)</span>

<span class="c1"># Another script</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">get_api</span><span class="p">()</span>  <span class="c1"># Reuses same connection</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report2</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-caching-reference-data">Pattern: Caching Reference Data</h3>
<p><strong>Scenario:</strong> Lookups for product info, process names performed frequently.</p>
<h4 id="process-sync-cache">Process Sync Cache</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.service.process_sync</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessSyncService</span>

<span class="c1"># Automatic caching (runs in client service)</span>
<span class="n">sync</span> <span class="o">=</span> <span class="n">ProcessSyncService</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
<span class="n">sync</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Syncs every 5 minutes</span>

<span class="c1"># Access cached data (no network call)</span>
<span class="n">processes</span> <span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>
<span class="n">levels</span> <span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">get_levels</span><span class="p">()</span>
<span class="n">product_groups</span> <span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">get_product_groups</span><span class="p">()</span>
</code></pre></div>

<h4 id="manual-caching">Manual Caching</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_product_cached</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>

<span class="c1"># First call: network request</span>
<span class="n">product1</span> <span class="o">=</span> <span class="n">get_product_cached</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;WIDGET-100&quot;</span><span class="p">)</span>

<span class="c1"># Second call: cached (instant)</span>
<span class="n">product2</span> <span class="o">=</span> <span class="n">get_product_cached</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;WIDGET-100&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-messagepack-serialization">Pattern: MessagePack Serialization</h3>
<p><strong>Scenario:</strong> Large reports (1000s of steps) submitted frequently.</p>
<h4 id="configuration_1">Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span><span class="p">,</span>
    <span class="n">use_msgpack</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># 2-5x faster than JSON</span>
<span class="p">)</span>

<span class="c1"># Submit large report</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</code></pre></div>

<p><strong>Performance:</strong> 2-5x smaller payload, 2-3x faster serialization</p>
<hr />
<h2 id="common-scenarios">Common Scenarios</h2>
<h3 id="scenario-report-submission-with-retry">Scenario: Report Submission with Retry</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">RetryConfig</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://company.wats.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span><span class="p">,</span>
    <span class="n">retry_config</span><span class="o">=</span><span class="n">RetryConfig</span><span class="p">(</span>
        <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Automatic retry on transient failures</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report submitted: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed after retries: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="scenario-process-synchronization">Scenario: Process Synchronization</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Fetch all processes</span>
<span class="n">processes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>

<span class="c1"># Cache locally</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;processes_cache.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># Use cached data offline</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;processes_cache.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div>

<h3 id="scenario-serial-number-allocation">Scenario: Serial Number Allocation</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Allocate batch of serial numbers</span>
<span class="n">sns</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">allocate_serial_numbers</span><span class="p">(</span>
    <span class="n">product_name</span><span class="o">=</span><span class="s2">&quot;WIDGET-100&quot;</span><span class="p">,</span>
    <span class="n">product_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;WGT-&quot;</span><span class="p">,</span>
    <span class="n">start_index</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>  <span class="c1"># [&quot;WGT-1000&quot;, &quot;WGT-1001&quot;, ..., &quot;WGT-1099&quot;]</span>
</code></pre></div>

<h3 id="scenario-attachment-handling">Scenario: Attachment Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Submit report</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">)</span>
<span class="n">report_id</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">id</span>

<span class="c1"># Add attachment (image, log file, etc.)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;test_image.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">post_attachment</span><span class="p">(</span>
        <span class="n">uut_id</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;test_image.jpg&quot;</span><span class="p">,</span>
        <span class="n">file_content</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Test setup photo&quot;</span>
    <span class="p">)</span>
</code></pre></div>

<h3 id="scenario-box-build-assembly">Scenario: Box Build Assembly</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Main unit report</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;BOX-ASSEMBLY&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;BOX-SN-001&quot;</span>
<span class="p">)</span>

<span class="c1"># Add subunits</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCB-MAIN&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PCB-001&quot;</span>
<span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;POWER-SUPPLY&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-001&quot;</span>
<span class="p">)</span>

<span class="c1"># Add assembly tests</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power-On Test&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="troubleshooting-guide">Troubleshooting Guide</h2>
<h3 id="issue-reports-not-uploading">Issue: Reports Not Uploading</h3>
<p><strong>Check connection status:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>status
</code></pre></div>

<p><strong>Check queue:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Windows</span>
dir<span class="w"> </span><span class="s2">&quot;%APPDATA%\pyWATS_Client\reports\pending&quot;</span>

<span class="c1"># Linux</span>
ls<span class="w"> </span>~/.config/pywats_client/reports/pending
</code></pre></div>

<p><strong>Check logs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Windows</span>
Get-Content<span class="w"> </span><span class="s2">&quot;%APPDATA%\pyWATS_Client\client.log&quot;</span><span class="w"> </span>-Tail<span class="w"> </span><span class="m">50</span>

<span class="c1"># Linux</span>
tail<span class="w"> </span>-f<span class="w"> </span>~/.config/pywats_client/client.log
</code></pre></div>

<p><strong>Manual retry:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentQueue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">PersistentQueue</span><span class="p">(</span><span class="s2">&quot;path/to/queue&quot;</span><span class="p">)</span>
<span class="n">queue</span><span class="o">.</span><span class="n">retry_all_failed</span><span class="p">()</span>
</code></pre></div>

<h3 id="issue-converter-not-triggering">Issue: Converter Not Triggering</h3>
<p><strong>Verify file patterns:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;file_patterns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.csv&quot;</span><span class="p">]</span><span class="w">  </span><span class="c1">// Must match file extension</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Check watch folder:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Ensure folder exists and is writable</span>
<span class="nb">Test-Path</span> <span class="s2">&quot;C:\TestData\Incoming&quot;</span> <span class="n">-PathType</span> <span class="n">Container</span>
</code></pre></div>

<p><strong>Test converter manually:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">converters.my_converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyConverter</span>

<span class="n">converter</span> <span class="o">=</span> <span class="n">MyConverter</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">convert_file</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">TestData</span><span class="se">\\</span><span class="s2">test.csv&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
</code></pre></div>

<h3 id="issue-authentication-failures">Issue: Authentication Failures</h3>
<p><strong>Verify credentials:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test API access</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Basic YOUR_BASE64_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://company.wats.com/api/App/Version
</code></pre></div>

<p><strong>Check token encryption:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token present: </span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">api_token</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server URL: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">service_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Re-authenticate:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>config<span class="w"> </span>reset
python<span class="w"> </span>-m<span class="w"> </span>pywats_client<span class="w"> </span>gui<span class="w">  </span><span class="c1"># Re-enter credentials</span>
</code></pre></div>

<h3 id="issue-high-cpumemory-usage">Issue: High CPU/Memory Usage</h3>
<p><strong>Check converter count:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;max_converter_workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">  </span><span class="c1">// Reduce if needed (default: 10)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Disable unnecessary features:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;process_sync_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  </span><span class="c1">// If not needed</span>
<span class="w">  </span><span class="nt">&quot;converters_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">     </span><span class="c1">// Temporarily disable</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Monitor resources:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Windows</span>
<span class="nb">Get-Process</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-like</span> <span class="s2">&quot;*python*&quot;</span><span class="p">}</span>

<span class="c"># Linux</span>
<span class="n">top</span> <span class="n">-p</span> <span class="p">$(</span><span class="n">pgrep</span> <span class="o">-f</span> <span class="n">pywats_client</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-always-enable-offline-queue">1. <strong>Always Enable Offline Queue</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;offline_queue_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why:</strong> Prevents data loss during network outages</p>
<h3 id="2-use-descriptive-station-names">2. <strong>Use Descriptive Station Names</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;station_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Building-A_Line-1_ICT-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Building A, Line 1&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why:</strong> Easier troubleshooting and reporting</p>
<h3 id="3-set-appropriate-retry-limits">3. <strong>Set Appropriate Retry Limits</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;max_retry_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">       </span><span class="c1">// Balance persistence vs. queue growth</span>
<span class="w">  </span><span class="nt">&quot;retry_interval_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="w">   </span><span class="c1">// Avoid hammering server</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="4-use-converter-validation">4. <strong>Use Converter Validation</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="c1"># Validate before building report</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="s2">&quot;Validation failed&quot;</span><span class="p">)</span>

    <span class="c1"># ... build report</span>
</code></pre></div>

<h3 id="5-monitor-failed-reports">5. <strong>Monitor Failed Reports</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set up daily check</span>
cron:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">9</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>python<span class="w"> </span>check_failed_reports.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># check_failed_reports.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentQueue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">PersistentQueue</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">failed</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_failed_count</span><span class="p">()</span>

<span class="k">if</span> <span class="n">failed</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">send_alert</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2"> failed reports in queue&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="6-use-async-for-batch-operations">6. <strong>Use Async for Batch Operations</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># DON&#39;T: Sequential (slow)</span>
<span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">reports</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

<span class="c1"># DO: Async batch (fast)</span>
<span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
    <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report_async</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports</span>
<span class="p">])</span>
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="architecture.md">Architecture Overview</a></strong> - System design and components</li>
<li><strong><a href="client-architecture.md">Client Architecture</a></strong> - Client service details</li>
<li><strong><a href="error-catalog.md">Error Catalog</a></strong> - Error codes and remediation</li>
<li><strong><a href="installation/docker.md">Docker Deployment</a></strong> - Container deployment guide</li>
<li><strong><a href="getting-started.md">Getting Started</a></strong> - Installation and basics</li>
<li><strong>Domain Guides:</strong> <a href="modules/report.md">Report</a>, <a href="modules/product.md">Product</a>, <a href="modules/production.md">Production</a></li>
</ul>
<hr />
<p><strong>Last Updated:</strong> January 26, 2026<br />
<strong>Feedback:</strong> Report issues or suggest improvements via GitHub Issues</p>
</div>


<div class="section-header" id="domain-modules">
    <h1>Domain Modules</h1>
</div>


<div class="doc-separator" id="domain-modules-overview">
    <div class="doc-source">Source: docs/modules/README.md</div>
    <h1 id="domain-module-documentation">Domain Module Documentation</h1>
<p>This directory contains comprehensive documentation for each WATS domain in the pyWATS API.</p>
<h2 id="core-domains">Core Domains</h2>
<ul>
<li><strong><a href="product.md">Product</a></strong> - Products, revisions, BOMs, box build templates, vendors, categories</li>
<li><strong><a href="asset.md">Asset</a></strong> - Equipment tracking, calibration, maintenance, hierarchy, logs</li>
<li><strong><a href="production.md">Production</a></strong> - Unit lifecycle, serial numbers, assembly, verification, phases</li>
<li><strong><a href="report.md">Report</a></strong> - Test reports (UUT/UUR), all step types, querying, attachments</li>
</ul>
<h2 id="analysis-tracking">Analysis &amp; Tracking</h2>
<ul>
<li><strong><a href="analytics.md">Analytics</a></strong> - Yield analysis, measurements, Cpk statistics, Unit Flow visualization</li>
<li><strong><a href="software.md">Software</a></strong> - Package management, versioning, distribution, tags, virtual folders</li>
<li><strong><a href="rootcause.md">RootCause</a></strong> - Issue tracking, defect management, status workflows, priorities</li>
<li><strong><a href="process.md">Process</a></strong> - Operation types, test/repair processes, caching</li>
</ul>
<h2 id="identity-administration">Identity &amp; Administration</h2>
<ul>
<li><strong><a href="scim.md">SCIM</a></strong> - User provisioning from Azure AD, SCIM protocol support</li>
</ul>
<h2 id="documentation-structure">Documentation Structure</h2>
<p>Each domain guide includes:<br />
- <strong>Quick Start</strong> - Simple examples to get started<br />
- <strong>API Reference</strong> - Complete method documentation<br />
- <strong>Examples</strong> - Common usage patterns and scenarios<br />
- <strong>Best Practices</strong> - Performance tips and recommendations<br />
- <strong>Cross-references</strong> - Links to related domains</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><strong><a href="../INDEX.md">../INDEX.md</a></strong> - Main documentation index</li>
<li><strong><a href="../architecture.md">../architecture.md</a></strong> - System architecture overview</li>
<li><strong><a href="../getting-started.md">../getting-started.md</a></strong> - Installation and setup</li>
<li><strong><a href="../usage/">../usage/</a></strong> - Detailed legacy module guides with comprehensive examples</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-report">
    <div class="doc-source">Source: docs/modules/report.md</div>
    <h1 id="report-domain">Report Domain</h1>
<p>The Report domain manages test reports (UUT/UUR) containing test results, measurements, and step hierarchies. Test reports are the core data structure in WATS - they capture what happened when a unit was tested, including all measurements, pass/fail results, and contextual information.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#uut-reports-unit-under-test">UUT Reports (Unit Under Test)</a></li>
<li><a href="#uur-reports-unit-under-repair">UUR Reports (Unit Under Repair)</a></li>
<li><a href="#test-steps">Test Steps</a></li>
<li><a href="#querying-reports">Querying Reports</a></li>
<li><a href="#report-attachments">Report Attachments</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Create a UUT (test) report</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uut_report</span><span class="p">(</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;John Smith&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;W12345&quot;</span><span class="p">,</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># End-of-line test</span>
    <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;FINAL-TEST-01&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Production Floor&quot;</span>
<span class="p">)</span>

<span class="c1"># Add test steps</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>

<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_limit_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Supply Voltage&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">5.02</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.9</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.1</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="n">root</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Communication Test&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit report</span>
<span class="n">report_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report submitted: </span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Query reports using OData filter or helper methods</span>
<span class="c1"># Method 1: Helper method (simplest)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_serial</span><span class="p">(</span><span class="s2">&quot;W12345&quot;</span><span class="p">)</span>

<span class="c1"># Method 2: Using query_headers with ReportType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportType</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_headers</span><span class="p">(</span>
    <span class="n">report_type</span><span class="o">=</span><span class="n">ReportType</span><span class="o">.</span><span class="n">UUT</span><span class="p">,</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39;&quot;</span><span class="p">,</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_reports</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Query multiple serials concurrently</span>
        <span class="n">serials</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-002&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-003&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
            <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_serial</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">serials</span>
        <span class="p">])</span>

        <span class="k">for</span> <span class="n">sn</span><span class="p">,</span> <span class="n">headers</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">serials</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sn</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="si">}</span><span class="s2"> reports&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query_reports</span><span class="p">())</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>top=100
</code></pre></div>

<p>)</p>
<h1 id="method-3-using-query_uut_headers-with-odata-filter">Method 3: Using query_uut_headers with OData filter</h1>
<p>headers = api.report.query_uut_headers(<br />
    odata_filter="partNumber eq 'WIDGET-001'",<br />
    top=100<br />
)<br />
print(f"Found {len(headers)} reports")</p>
<div class="codehilite"><pre><span></span><code><span class="o">---</span>

<span class="c1">## Core Concepts</span>

<span class="c1">### UUT Report (Unit Under Test)</span>
<span class="n">A</span><span class="w"> </span><span class="o">**</span><span class="n">UUT</span><span class="w"> </span><span class="n">Report</span><span class="o">**</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">unit</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">contains</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">identification</span><span class="w"> </span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="k">number</span><span class="p">,</span><span class="w"> </span><span class="kt">serial</span><span class="p">,</span><span class="w"> </span><span class="n">revision</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Station</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="n">tested</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="p">(</span><span class="n">steps</span><span class="p">,</span><span class="w"> </span><span class="n">measurements</span><span class="p">,</span><span class="w"> </span><span class="n">pass</span><span class="o">/</span><span class="n">fail</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Timing</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="p">(</span><span class="k">start</span><span class="w"> </span><span class="kt">time</span><span class="p">,</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="kt">time</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Custom</span><span class="w"> </span><span class="n">metadata</span>

<span class="o">**</span><span class="k">Key</span><span class="w"> </span><span class="n">attributes</span><span class="o">:**</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`pn`</span><span class="o">:</span><span class="w"> </span><span class="n">Part</span><span class="w"> </span><span class="k">number</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`sn`</span><span class="o">:</span><span class="w"> </span><span class="kt">Serial</span><span class="w"> </span><span class="k">number</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`rev`</span><span class="o">:</span><span class="w"> </span><span class="n">Revision</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`process_code`</span><span class="o">:</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EOL</span><span class="w"> </span><span class="n">test</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`result`</span><span class="o">:</span><span class="w"> </span><span class="n">Overall</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pass</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;F&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fail</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`root`</span><span class="o">:</span><span class="w"> </span><span class="n">Root</span><span class="w"> </span><span class="n">SequenceCall</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">steps</span>

<span class="c1">#### Serial Number &amp; Part Number Validation</span>

<span class="n">The</span><span class="w"> </span><span class="n n-Quoted">`sn`</span><span class="w"> </span><span class="p">(</span><span class="kt">serial</span><span class="w"> </span><span class="k">number</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n n-Quoted">`pn`</span><span class="w"> </span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="k">number</span><span class="p">)</span><span class="w"> </span><span class="k">fields</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">validated</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">WATS</span><span class="w"> </span><span class="n">searches</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">filters</span><span class="p">.</span>

<span class="o">**</span><span class="n">Recommended</span><span class="w"> </span><span class="n">characters</span><span class="o">:**</span><span class="w"> </span><span class="n n-Quoted">`A-Z`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`a-z`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`0-9`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`-`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`_`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`.`</span>

<span class="o">**</span><span class="n">Problematic</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="p">(</span><span class="n">blocked</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">default</span><span class="p">)</span><span class="o">:**</span><span class="w"> </span><span class="n n-Quoted">`*`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`%`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`?`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`[`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`]`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`^`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`!`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`/`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`\`</span>

<span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">python</span>
<span class="n n-Quoted"># This will raise ReportHeaderValidationError</span>
<span class="n n-Quoted">report = UUTReport(pn=&quot;PART/001&quot;, sn=&quot;SN*001&quot;, ...)  # Error!</span>

<span class="n n-Quoted"># Bypass when intentionally needed:</span>
<span class="n n-Quoted">from pywats import allow_problematic_characters</span>

<span class="n n-Quoted">with allow_problematic_characters():</span>
<span class="n n-Quoted">    report = UUTReport(pn=&quot;PART/001&quot;, sn=&quot;SN*001&quot;, ...)  # OK (warning issued)</span>

<span class="n n-Quoted"># Or use SUPPRESS: prefix (stripped from value):</span>
<span class="n n-Quoted">report = UUTReport(pn=&quot;SUPPRESS:PART/001&quot;, sn=&quot;SN-001&quot;, ...)</span>
<span class="n n-Quoted"># report.pn == &quot;PART/001&quot;</span>
</code></pre></div>

<p>See <a href="ERROR_CATALOG.md#reportheadervalidationerror">ERROR_CATALOG.md</a> for details.</p>
<h3 id="uur-report-unit-under-repair">UUR Report (Unit Under Repair)</h3>
<p>A <strong>UUR Report</strong> documents a repair operation on a failed unit. It contains:<br />
- Reference to the original failed UUT<br />
- Repair actions taken<br />
- Failure analysis<br />
- Re-test results</p>
<p><strong>Key relationship:</strong><br />
- <code>repair_process_code</code>: Repair operation type (typically 500)<br />
- <code>test_operation_code</code>: Original test that failed</p>
<h3 id="test-steps">Test Steps</h3>
<p>Test steps are organized hierarchically:</p>
<ul>
<li><strong>SequenceCall</strong>: Container for other steps (like a folder)</li>
<li><strong>NumericStep</strong>: Measurement with limits (voltage, current, etc.)</li>
<li><strong>BooleanStep</strong>: Pass/Fail test</li>
<li><strong>StringStep</strong>: Text verification</li>
<li><strong>ChartStep</strong>: Graphical data (waveforms, plots)</li>
<li><strong>GenericStep</strong>: Actions, labels, comments</li>
</ul>
<h3 id="step-hierarchy">Step Hierarchy</h3>
<p>Steps form a tree structure:</p>
<div class="codehilite"><pre><span></span><code>MainSequence (root)
‚îú‚îÄ Power Supply Tests (SequenceCall)
‚îÇ  ‚îú‚îÄ 3.3V Rail (NumericStep)
‚îÇ  ‚îú‚îÄ 5V Rail (NumericStep)
‚îÇ  ‚îî‚îÄ 12V Rail (NumericStep)
‚îú‚îÄ Communication Tests (SequenceCall)
‚îÇ  ‚îú‚îÄ UART Test (BooleanStep)
‚îÇ  ‚îî‚îÄ I2C Test (BooleanStep)
‚îî‚îÄ Final Verification (SequenceCall)
   ‚îî‚îÄ Overall Status (BooleanStep)
</code></pre></div>

<hr />
<h2 id="uut-reports-unit-under-test">UUT Reports (Unit Under Test)</h2>
<h3 id="create-uut-report">Create UUT Report</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Using factory method (recommended)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uut_report</span><span class="p">(</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCB-MAIN-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PCB12345&quot;</span><span class="p">,</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># FCT test</span>
    <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;FCT-STATION-02&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Factory Floor&quot;</span><span class="p">,</span>
    <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;Production&quot;</span>
<span class="p">)</span>

<span class="c1"># Set overall result</span>
<span class="n">report</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>  <span class="c1"># or &quot;F&quot; for failed</span>

<span class="c1"># Get root sequence to add steps</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
</code></pre></div>

<h3 id="add-numeric-test-steps">Add Numeric Test Steps</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Simple numeric limit test</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_limit_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3.3V Rail&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">3.31</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># Using comparison operator explicitly</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models.uut.steps.comp_operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompOp</span>

<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">25.5</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;¬∞C&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GELE</span><span class="p">,</span>  <span class="c1"># Greater or Equal, Less or Equal</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># Log value only (no limits)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ambient Humidity&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">45.2</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>  <span class="c1"># Log only, no comparison</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="add-boolean-test-steps">Add Boolean Test Steps</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Simple pass/fail</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power On Self Test&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># Using explicit status codes</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Firmware Load&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>  <span class="c1"># P=Pass, F=Fail, T=Terminated, etc.</span>
<span class="p">)</span>

<span class="c1"># Failed step</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Network Connection&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="add-string-test-steps">Add String Test Steps</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># String comparison</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Firmware Version&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2.1.5&quot;</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="s2">&quot;2.1.5&quot;</span><span class="p">,</span>  <span class="c1"># Expected value</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">CASESENSIT</span><span class="p">,</span>  <span class="c1"># Case-sensitive compare</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># Log string value</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MAC Address&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;00:1A:2B:3C:4D:5E&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="create-sequence-hierarchy">Create Sequence Hierarchy</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a sequence (test group)</span>
<span class="n">power_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence_call</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Supply Tests&quot;</span><span class="p">,</span>
    <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;power_tests.py&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span>
<span class="p">)</span>

<span class="c1"># Add tests to the sequence</span>
<span class="n">power_seq</span><span class="o">.</span><span class="n">add_numeric_limit_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3.3V Rail&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">3.31</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="n">power_seq</span><span class="o">.</span><span class="n">add_numeric_limit_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;5V Rail&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.01</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.9</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.1</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># Nested sequences</span>
<span class="n">comm_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence_call</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Communication Tests&quot;</span><span class="p">)</span>
<span class="n">uart_tests</span> <span class="o">=</span> <span class="n">comm_seq</span><span class="o">.</span><span class="n">add_sequence_call</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;UART Tests&quot;</span><span class="p">)</span>
<span class="n">uart_tests</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Loopback Test&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="add-misc-info-custom-metadata">Add Misc Info (Custom Metadata)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add custom key-value metadata</span>
<span class="n">report</span><span class="o">.</span><span class="n">add_misc_info</span><span class="p">(</span><span class="s2">&quot;LotNumber&quot;</span><span class="p">,</span> <span class="s2">&quot;LOT-2025-W01&quot;</span><span class="p">)</span>
<span class="n">report</span><span class="o">.</span><span class="n">add_misc_info</span><span class="p">(</span><span class="s2">&quot;WorkOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;WO-12345&quot;</span><span class="p">)</span>
<span class="n">report</span><span class="o">.</span><span class="n">add_misc_info</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;25¬∞C&quot;</span><span class="p">)</span>
<span class="n">report</span><span class="o">.</span><span class="n">add_misc_info</span><span class="p">(</span><span class="s2">&quot;Operator_Badge&quot;</span><span class="p">,</span> <span class="s2">&quot;EMP-789&quot;</span><span class="p">)</span>

<span class="c1"># Access misc info</span>
<span class="n">misc</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">misc_info</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">misc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="submit-report">Submit Report</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Submit to server</span>
<span class="n">report_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

<span class="k">if</span> <span class="n">report_id</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Report submitted successfully: </span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Failed to submit report&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="uur-reports-unit-under-repair">UUR Reports (Unit Under Repair)</h2>
<h3 id="create-uur-from-failed-uut">Create UUR from Failed UUT</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># After a unit fails a test, create UUR for repair</span>

<span class="c1"># 1. Create and submit failed UUT</span>
<span class="n">failed_uut</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uut_report</span><span class="p">(</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Test Op&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;W-FAIL-001&quot;</span><span class="p">,</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;TEST-01&quot;</span>
<span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">failed_uut</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Test&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span><span class="p">)</span>

<span class="n">uut_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">failed_uut</span><span class="p">)</span>

<span class="c1"># 2. Create UUR from the failed UUT</span>
<span class="n">uur</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uur_report</span><span class="p">(</span>
    <span class="n">failed_uut</span><span class="p">,</span>  <span class="c1"># Pass the UUT object</span>
    <span class="n">repair_process_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>  <span class="c1"># Default repair code</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Repair Tech&quot;</span><span class="p">,</span>
    <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;REPAIR-STATION-01&quot;</span>
<span class="p">)</span>

<span class="c1"># 3. Add repair steps</span>
<span class="n">uur_root</span> <span class="o">=</span> <span class="n">uur</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>

<span class="n">uur_root</span><span class="o">.</span><span class="n">add_generic_step</span><span class="p">(</span>
    <span class="n">step_type</span><span class="o">=</span><span class="s2">&quot;Action&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Replaced faulty capacitor C15&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">uur_root</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Re-test Power Supply&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># 4. Submit UUR</span>
<span class="n">uur_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">uur</span><span class="p">)</span>
</code></pre></div>

<h3 id="create-uur-from-partprocess">Create UUR from Part/Process</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create UUR when you don&#39;t have the UUT object</span>
<span class="n">uur</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uur_from_part_and_process</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;W-REPAIR-002&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">test_operation_code</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Original test operation</span>
    <span class="n">repair_process_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>  <span class="c1"># Repair operation</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Repair Specialist&quot;</span>
<span class="p">)</span>

<span class="c1"># Add repair documentation</span>
<span class="n">uur_root</span> <span class="o">=</span> <span class="n">uur</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>

<span class="n">uur_root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Failure Mode&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;No output on 12V rail&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">uur_root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Root Cause&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Damaged voltage regulator U5&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">uur_root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Corrective Action&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Replaced U5 with known good part&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">uur</span><span class="p">)</span>
</code></pre></div>

<h3 id="failure-logging-in-uur-repair-reports">Failure Logging in UUR (Repair Reports)</h3>
<p>In UUR reports, failures are logged against a <em>unit hierarchy</em> (main unit + optional sub-units). WATS uses this hierarchy to understand <strong>where</strong> a failure occurred and to power repair analytics.</p>
<p><strong>Sub-units and <code>idx</code></strong></p>
<ul>
<li>A UUR report contains <code>subUnits</code> (exposed as <code>UURReport.sub_units</code>), where each element is a <code>UURSubUnit</code>.</li>
<li>Every <code>UURSubUnit</code> must have an integer <code>idx</code> that is <strong>unique within the report</strong>.</li>
<li><code>idx = 0</code> is reserved for the <strong>main unit</strong> (root). The library ensures a main unit exists.</li>
<li>Additional sub-units typically use <code>idx = 1..N</code>.</li>
<li><code>parentIdx</code> links a sub-unit to its parent by referencing the parent‚Äôs <code>idx</code>.<ul>
<li>Most users keep a single-level hierarchy where all sub-units have <code>parentIdx = 0</code>.</li>
</ul>
</li>
</ul>
<p><strong>Failures and fail codes</strong></p>
<ul>
<li>A failure is associated with a specific unit via the unit‚Äôs <code>idx</code> (conceptually ‚Äúpart index‚Äù).</li>
<li>In the WSJF-style serialization used by the client formats, failures are stored under the owning <code>UURSubUnit.failures</code>. That means the failure is <em>implicitly</em> tied to that sub-unit‚Äôs <code>idx</code>.</li>
<li>The <strong>repair fail code</strong> comes from the repair type‚Äôs fail-code tree (categories + selectable leaf failcodes). In the full WRML representation, WATS stores:<ul>
<li><code>Failcode</code>: the GUID of the selected leaf failcode</li>
<li><code>PartIdx</code>: which unit/sub-unit the failure belongs to (matches the sub-unit <code>idx</code>)</li>
<li><code>Idx</code>: an internal failure counter (separate from the sub-unit <code>idx</code>)</li>
</ul>
</li>
</ul>
<p>Practical rule of thumb: treat <code>idx</code> as a per-report ‚Äúprimary key‚Äù for each sub-unit, and make sure every failure is attached to the correct sub-unit so WATS can resolve <code>PartIdx</code> correctly.</p>
<hr />
<h2 id="test-steps_1">Test Steps</h2>
<h3 id="numeric-steps-with-comparison-operators">Numeric Steps with Comparison Operators</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models.uut.steps.comp_operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompOp</span>

<span class="c1"># GELE - Greater or Equal, Less or Equal (standard range)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GELE</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># GT - Greater Than</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Signal Strength&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;dBm&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GT</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># LT - Less Than</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Noise Level&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mV&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># EQ - Equal</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Counter Value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># NE - Not Equal</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Error Code&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">NE</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Should NOT be 1</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># LOG - Log only (no comparison)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1640000000</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="multi-measurement-steps">Multi-Measurement Steps</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a multi-measurement container</span>
<span class="n">multi_num</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_multiple_numeric_limit_test</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Rail Measurements&quot;</span>
<span class="p">)</span>

<span class="c1"># Add multiple measurements</span>
<span class="n">multi_num</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3.3V Rail&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">3.31</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GELE</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">multi_num</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;5V Rail&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.01</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GELE</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.9</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.1</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">multi_num</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;12V Rail&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">12.05</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GELE</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">11.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># String multi-measurement</span>
<span class="n">multi_str</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_multiple_string_value_test</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Device Information&quot;</span>
<span class="p">)</span>

<span class="n">multi_str</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;WIDGET-X1&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">CASESENSIT</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="s2">&quot;WIDGET-X1&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="n">multi_str</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Serial&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;SN12345&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="generic-steps-actions-comments">Generic Steps (Actions, Comments)</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models.uut.steps.generic_step</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlowType</span>

<span class="c1"># Action step</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_generic_step</span><span class="p">(</span>
    <span class="n">step_type</span><span class="o">=</span><span class="n">FlowType</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Initialize Hardware&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># Label/Comment</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_generic_step</span><span class="p">(</span>
    <span class="n">step_type</span><span class="o">=</span><span class="n">FlowType</span><span class="o">.</span><span class="n">Label</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Starting communication tests...&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>

<span class="c1"># Goto (control flow)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_generic_step</span><span class="p">(</span>
    <span class="n">step_type</span><span class="o">=</span><span class="n">FlowType</span><span class="o">.</span><span class="n">Goto</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Jump to cleanup&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="querying-reports">Querying Reports</h2>
<p>The report query API uses <strong>OData filters</strong> for flexible querying. Helper methods are provided for common use cases.</p>
<h3 id="reporttype-enum">ReportType Enum</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportType</span>

<span class="c1"># ReportType.UUT = &quot;U&quot; - Unit Under Test (test results)</span>
<span class="c1"># ReportType.UUR = &quot;R&quot; - Unit Under Repair (repair records)</span>
</code></pre></div>

<h3 id="query-uut-report-headers">Query UUT Report Headers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Simple queries using helper methods</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_serial</span><span class="p">(</span><span class="s2">&quot;W12345&quot;</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_part_number</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_recent_headers</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_todays_headers</span><span class="p">()</span>

<span class="c1"># Using the unified query_headers method</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportType</span>

<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_headers</span><span class="p">(</span>
    <span class="n">report_type</span><span class="o">=</span><span class="n">ReportType</span><span class="o">.</span><span class="n">UUT</span><span class="p">,</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;W12345&#39;&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">orderby</span><span class="o">=</span><span class="s2">&quot;start desc&quot;</span>
<span class="p">)</span>

<span class="c1"># Using query_uut_headers with OData filter</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39;&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="si">}</span><span class="s2"> reports&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">start_utc</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="odata-filter-examples">OData Filter Examples</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Filter by serial number</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;W12345&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Filter by part number</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Filter by status</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;status eq &#39;Failed&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Date range filter</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;start ge 2026-01-01T00:00:00Z and start le 2026-01-31T23:59:59Z&quot;</span>
<span class="p">)</span>

<span class="c1"># Combined filters</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39; and status eq &#39;Failed&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># With pagination</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39;&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">orderby</span><span class="o">=</span><span class="s2">&quot;start desc&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="query-with-expanded-fields">Query with Expanded Fields</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Expand sub-units</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;W12345&#39;&quot;</span><span class="p">,</span>
    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subUnits&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">sub_units</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">sub_units</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sub-unit: </span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Expand misc info</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39;&quot;</span><span class="p">,</span>
    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;miscInfo&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="query-uur-repair-headers">Query UUR (Repair) Headers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Query repair reports</span>
<span class="n">repairs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uur_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;W12345&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Using ReportType enum</span>
<span class="n">repairs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_headers</span><span class="p">(</span>
    <span class="n">report_type</span><span class="o">=</span><span class="n">ReportType</span><span class="o">.</span><span class="n">UUR</span><span class="p">,</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;W12345&#39;&quot;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="report-attachments">Report Attachments</h2>
<h3 id="add-attachment-to-report">Add Attachment to Report</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create report</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uut_report</span><span class="p">(</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Tester&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;W12345&quot;</span><span class="p">,</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="c1"># Add steps...</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span><span class="p">)</span>

<span class="c1"># Add attachment (e.g., screenshot, log file)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;test_screenshot.png&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">file_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Attachment</span>

<span class="n">attachment</span> <span class="o">=</span> <span class="n">Attachment</span><span class="p">(</span>
    <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;test_screenshot.png&quot;</span><span class="p">,</span>
    <span class="n">mime_type</span><span class="o">=</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">file_data</span>
<span class="p">)</span>

<span class="n">report</span><span class="o">.</span><span class="n">add_attachment</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>

<span class="c1"># Submit with attachment</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<h3 id="download-attachments">Download Attachments</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get report header using OData filter</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;W12345&#39;&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Get attachments for this report</span>
    <span class="n">attachments</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_attachments</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">uuid</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attachment: </span><span class="si">{</span><span class="n">att</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">att</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>

        <span class="c1"># Download attachment data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">download_attachment</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">uuid</span><span class="p">),</span>
            <span class="n">att</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>

        <span class="c1"># Save to file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;downloaded_</span><span class="si">{</span><span class="n">att</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="complete-test-workflow">Complete Test Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_test_and_report</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">revision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete test workflow with reporting&quot;&quot;&quot;</span>

    <span class="c1"># 1. Create report</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uut_report</span><span class="p">(</span>
        <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;AutoTest&quot;</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">serial_number</span><span class="p">,</span>
        <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;AUTO-TEST-01&quot;</span>
    <span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
    <span class="n">all_passed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># 2. Run power tests</span>
    <span class="n">power_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence_call</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Supply Tests&quot;</span><span class="p">)</span>

    <span class="n">voltage_3v3</span> <span class="o">=</span> <span class="n">measure_voltage</span><span class="p">(</span><span class="s2">&quot;3V3&quot;</span><span class="p">)</span>  <span class="c1"># Your measurement function</span>
    <span class="n">power_seq</span><span class="o">.</span><span class="n">add_numeric_limit_step</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;3.3V Rail&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">voltage_3v3</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
        <span class="n">low_limit</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span>
        <span class="n">high_limit</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span> <span class="k">if</span> <span class="mf">3.2</span> <span class="o">&lt;=</span> <span class="n">voltage_3v3</span> <span class="o">&lt;=</span> <span class="mf">3.4</span> <span class="k">else</span> <span class="s2">&quot;Failed&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">3.2</span> <span class="o">&lt;=</span> <span class="n">voltage_3v3</span> <span class="o">&lt;=</span> <span class="mf">3.4</span><span class="p">):</span>
        <span class="n">all_passed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># 3. Run communication tests</span>
    <span class="n">comm_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence_call</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Communication Tests&quot;</span><span class="p">)</span>

    <span class="n">uart_ok</span> <span class="o">=</span> <span class="n">test_uart</span><span class="p">()</span>  <span class="c1"># Your test function</span>
    <span class="n">comm_seq</span><span class="o">.</span><span class="n">add_pass_fail_step</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UART Loopback&quot;</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span> <span class="k">if</span> <span class="n">uart_ok</span> <span class="k">else</span> <span class="s2">&quot;Failed&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">uart_ok</span><span class="p">:</span>
        <span class="n">all_passed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># 4. Set overall result</span>
    <span class="n">report</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="k">if</span> <span class="n">all_passed</span> <span class="k">else</span> <span class="s2">&quot;F&quot;</span>

    <span class="c1"># 5. Submit report</span>
    <span class="n">report_id</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

    <span class="c1"># 6. Update production unit status</span>
    <span class="k">if</span> <span class="n">all_passed</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">all_passed</span><span class="p">,</span> <span class="n">report_id</span>

<span class="c1"># Run it</span>
<span class="n">passed</span><span class="p">,</span> <span class="n">report_id</span> <span class="o">=</span> <span class="n">run_test_and_report</span><span class="p">(</span><span class="s2">&quot;W12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test </span><span class="si">{</span><span class="s1">&#39;PASSED&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;FAILED&#39;</span><span class="si">}</span><span class="s2"> - Report: </span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="failure-analysis-report">Failure Analysis Report</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_failure_report</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate failure analysis from recent tests&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="c1"># Get failed reports using OData filter</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
        <span class="n">odata_filter</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;result eq &#39;Failed&#39; and start ge </span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="mi">500</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== FAILURE ANALYSIS (</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total failures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Group by part number</span>
    <span class="n">failures_by_part</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">part_number</span>
        <span class="k">if</span> <span class="n">pn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failures_by_part</span><span class="p">:</span>
            <span class="n">failures_by_part</span><span class="p">[</span><span class="n">pn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">failures_by_part</span><span class="p">[</span><span class="n">pn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

    <span class="c1"># Print summary</span>
    <span class="k">for</span> <span class="n">pn</span><span class="p">,</span> <span class="n">fails</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">failures_by_part</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">pn</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fails</span><span class="p">)</span><span class="si">}</span><span class="s2"> failures&quot;</span><span class="p">)</span>

        <span class="c1"># Show first few</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">fails</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Run it</span>
<span class="n">generate_failure_report</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="reportservice-methods">ReportService Methods</h3>
<h4 id="uut-report-operations">UUT Report Operations</h4>
<ul>
<li><code>create_uut_report(...)</code> ‚Üí <code>UUTReport</code> - Create new UUT report</li>
<li><code>query_uut_headers(odata_filter, top, skip, orderby, expand)</code> ‚Üí <code>List[ReportHeader]</code> - Query UUT report headers with OData</li>
<li><code>get_uut_report(report_id)</code> ‚Üí <code>Optional[UUTReport]</code> - Get full report</li>
<li><code>submit_report(report)</code> ‚Üí <code>Optional[UUID]</code> - Submit report to server</li>
</ul>
<h4 id="uur-report-operations">UUR Report Operations</h4>
<ul>
<li><code>create_uur_report(uut, ...)</code> ‚Üí <code>UURReport</code> - Create UUR from UUT</li>
<li><code>create_uur_from_part_and_process(...)</code> ‚Üí <code>UURReport</code> - Create UUR from metadata</li>
<li><code>query_uur_headers(odata_filter, top, skip, orderby, expand)</code> ‚Üí <code>List[ReportHeader]</code> - Query UUR report headers with OData</li>
</ul>
<h4 id="unified-query-operations">Unified Query Operations</h4>
<ul>
<li><code>query_headers(report_type, odata_filter, top, skip, orderby, expand)</code> ‚Üí <code>List[ReportHeader]</code> - Query UUT/UUR headers</li>
</ul>
<h4 id="query-helper-methods">Query Helper Methods</h4>
<ul>
<li><code>get_headers_by_serial(serial_number)</code> ‚Üí <code>List[ReportHeader]</code> - Get headers by serial</li>
<li><code>get_headers_by_part_number(part_number)</code> ‚Üí <code>List[ReportHeader]</code> - Get headers by part number</li>
<li><code>get_headers_by_date_range(start_date, end_date)</code> ‚Üí <code>List[ReportHeader]</code> - Get headers by date range</li>
<li><code>get_recent_headers(count)</code> ‚Üí <code>List[ReportHeader]</code> - Get most recent headers</li>
<li><code>get_todays_headers()</code> ‚Üí <code>List[ReportHeader]</code> - Get today's headers</li>
</ul>
<h4 id="attachment-operations">Attachment Operations</h4>
<ul>
<li><code>get_attachments(report_id)</code> ‚Üí <code>List[Attachment]</code> - Get attachment list</li>
<li><code>download_attachment(report_id, filename)</code> ‚Üí <code>bytes</code> - Download attachment data</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="reporttype-enum_1">ReportType Enum</h4>
<ul>
<li><code>ReportType.UUT</code> - "U" - UUT (Unit Under Test) reports</li>
<li><code>ReportType.UUR</code> - "R" - UUR (Unit Under Repair) reports</li>
</ul>
<h4 id="uutreport">UUTReport</h4>
<ul>
<li><code>pn</code>: Part number</li>
<li><code>sn</code>: Serial number</li>
<li><code>rev</code>: Revision</li>
<li><code>process_code</code>: Operation type</li>
<li><code>result</code>: "P" or "F"</li>
<li><code>station_name</code>: Station name</li>
<li><code>root</code>: SequenceCall (test steps)</li>
<li><code>info</code>: UUTInfo (metadata)</li>
</ul>
<h4 id="sequencecall">SequenceCall</h4>
<ul>
<li><code>name</code>: Sequence name</li>
<li><code>status</code>: Overall status</li>
<li><code>steps</code>: List of child steps</li>
<li>Methods: <code>add_numeric_step()</code>, <code>add_pass_fail_step()</code>, <code>add_sequence_call()</code>, etc.</li>
</ul>
<h4 id="watsfilter-analytics-api-only">WATSFilter (Analytics API only)</h4>
<p><strong>Note:</strong> WATSFilter is used with the Analytics API, not for report queries. <br />
For querying report headers, use OData filter syntax or the helper methods.</p>
<ul>
<li><code>part_number</code>: Filter by part</li>
<li><code>serial_number</code>: Filter by serial</li>
<li><code>result</code>: "Passed" or "Failed"</li>
<li><code>days</code>: Last N days</li>
<li><code>start_date_time</code>, <code>end_date_time</code>: Date range</li>
<li><code>operation_type</code>: Operation code</li>
<li><code>top_count</code>: Limit results</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Always add at least one step</strong> - Reports must have test steps</li>
<li><strong>Set overall result</strong> - Set <code>report.result</code> to "P" or "F"</li>
<li><strong>Use meaningful step names</strong> - Clear, descriptive names</li>
<li><strong>Organize with sequences</strong> - Group related tests</li>
<li><strong>Add misc info for context</strong> - Lot numbers, work orders, etc.</li>
<li><strong>Submit promptly</strong> - Don't delay report submission</li>
<li><strong>Include units</strong> - Always specify measurement units</li>
<li><strong>Set proper limits</strong> - Define pass/fail criteria</li>
<li><strong>Log important values</strong> - Use CompOp.LOG for reference data</li>
<li><strong>Link to production</strong> - Update unit status after testing</li>
</ol>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="production.md">Production Domain</a> - Managing units and updating status</li>
<li><a href="analytics.md">Analytics Domain</a> - Analyzing test results and yield</li>
<li><a href="process.md">Process Domain</a> - Defining operation types</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-asset">
    <div class="doc-source">Source: docs/modules/asset.md</div>
    <h1 id="asset-domain">Asset Domain</h1>
<p>The Asset domain manages test equipment, stations, fixtures, instruments, and tools used in manufacturing operations. It provides comprehensive tracking for calibration schedules, maintenance history, usage counts, hierarchical relationships (stations containing instruments), and alarm states. Assets are the physical resources that execute tests and assemblies defined in other domains.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#asset-operations">Asset Operations</a></li>
<li><a href="#asset-types">Asset Types</a></li>
<li><a href="#asset-hierarchy">Asset Hierarchy</a></li>
<li><a href="#status-and-state-management">Status and State Management</a></li>
<li><a href="#count-tracking">Count Tracking</a></li>
<li><a href="#calibration-management">Calibration Management</a></li>
<li><a href="#maintenance-management">Maintenance Management</a></li>
<li><a href="#asset-logs">Asset Logs</a></li>
<li><a href="#file-operations">File Operations</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize the API</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># List all assets</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
<span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Get specific asset by serial number</span>
<span class="n">dmm</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asset: </span><span class="si">{</span><span class="n">dmm</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">dmm</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last Calibration: </span><span class="si">{</span><span class="n">dmm</span><span class="o">.</span><span class="n">last_calibration_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create a new test instrument</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># First, get an asset type</span>
<span class="n">asset_types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
<span class="n">instrument_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">asset_types</span> <span class="k">if</span> <span class="s2">&quot;Instrument&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>

<span class="n">new_asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SCOPE-12345&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">instrument_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Oscilloscope Rigol DS1054Z&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;4-channel 50MHz oscilloscope&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Lab A&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">OK</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">manage_assets</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Fetch asset types and assets concurrently</span>
        <span class="n">asset_types</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">(),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Types: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">asset_types</span><span class="p">)</span><span class="si">}</span><span class="s2">, Assets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">manage_assets</span><span class="p">())</span>
</code></pre></div>

<h1 id="record-calibration">Record calibration</h1>
<p>api.asset.record_calibration(<br />
    serial_number="SCOPE-12345",<br />
    comment="Annual calibration completed"<br />
)</p>
<div class="codehilite"><pre><span></span><code><span class="o">---</span>

<span class="c1">## Core Concepts</span>

<span class="c1">### Asset</span>
<span class="n">An</span><span class="w"> </span><span class="o">**</span><span class="n">Asset</span><span class="o">**</span><span class="w"> </span><span class="n">represents</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">piece</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">equipment</span><span class="p">,</span><span class="w"> </span><span class="n">station</span><span class="p">,</span><span class="w"> </span><span class="n">fixture</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">tool</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">manufacturing</span><span class="p">.</span><span class="w"> </span><span class="k">Each</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="kt">serial</span><span class="w"> </span><span class="k">number</span><span class="p">.</span>

<span class="o">**</span><span class="k">Key</span><span class="w"> </span><span class="n">attributes</span><span class="o">:**</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`serial_number`</span><span class="o">:</span><span class="w"> </span><span class="k">Unique</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ICT-STATION-05&quot;</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`asset_name`</span><span class="o">:</span><span class="w"> </span><span class="n">Human</span><span class="o">-</span><span class="n">readable</span><span class="w"> </span><span class="k">name</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`type_id`</span><span class="o">:</span><span class="w"> </span><span class="n">Links</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">AssetType</span><span class="w"> </span><span class="p">(</span><span class="n">defines</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">limits</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`state`</span><span class="o">:</span><span class="w"> </span><span class="k">Current</span><span class="w"> </span><span class="k">condition</span><span class="w"> </span><span class="p">(</span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="n">WARNING</span><span class="p">,</span><span class="w"> </span><span class="n">ALARM</span><span class="p">,</span><span class="w"> </span><span class="k">ERROR</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`location`</span><span class="o">:</span><span class="w"> </span><span class="n">Physical</span><span class="w"> </span><span class="n">location</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`parent_asset_id`</span><span class="o">:</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="n">hierarchical</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="n">instrument</span><span class="w"> </span><span class="n">belongs</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">station</span><span class="p">)</span>

<span class="c1">### Asset Type</span>
<span class="n">An</span><span class="w"> </span><span class="o">**</span><span class="n">AssetType</span><span class="o">**</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">assets</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">characteristics</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">limits</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">specifies</span><span class="w"> </span><span class="n">calibration</span><span class="w"> </span><span class="n">intervals</span><span class="p">,</span><span class="w"> </span><span class="n">maintenance</span><span class="w"> </span><span class="n">schedules</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">usage</span><span class="w"> </span><span class="n">limits</span><span class="p">.</span>

<span class="o">**</span><span class="k">Key</span><span class="w"> </span><span class="n">attributes</span><span class="o">:**</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`type_name`</span><span class="o">:</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s2">&quot;Station&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Instrument&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Fixture&quot;</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`calibration_interval`</span><span class="o">:</span><span class="w"> </span><span class="n">Days</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="n">calibrations</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`maintenance_interval`</span><span class="o">:</span><span class="w"> </span><span class="n">Days</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="n">maintenance</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`running_count_limit`</span><span class="o">:</span><span class="w"> </span><span class="n">Max</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">maintenance</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`total_count_limit`</span><span class="o">:</span><span class="w"> </span><span class="n">Lifetime</span><span class="w"> </span><span class="k">usage</span><span class="w"> </span><span class="k">limit</span>

<span class="o">**</span><span class="n">Common</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span><span class="k">types</span><span class="o">:**</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Station</span><span class="o">**:</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">station</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">workstation</span><span class="w"> </span><span class="p">(</span><span class="n">ICT</span><span class="p">,</span><span class="w"> </span><span class="n">FVT</span><span class="p">,</span><span class="w"> </span><span class="n">Assembly</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Instrument</span><span class="o">**:</span><span class="w"> </span><span class="n">Measurement</span><span class="w"> </span><span class="n">equipment</span><span class="w"> </span><span class="p">(</span><span class="n">DMM</span><span class="p">,</span><span class="w"> </span><span class="n">Oscilloscope</span><span class="p">,</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Supply</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Fixture</span><span class="o">**:</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">fixtures</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">adapters</span><span class="w"> </span><span class="p">(</span><span class="n">bed</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="n">nails</span><span class="p">,</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">jigs</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Software</span><span class="o">**:</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">licenses</span><span class="w"> </span><span class="p">(</span><span class="n">LabVIEW</span><span class="p">,</span><span class="w"> </span><span class="n">TestStand</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Tool</span><span class="o">**:</span><span class="w"> </span><span class="n">Hand</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">equipment</span><span class="w"> </span><span class="p">(</span><span class="n">soldering</span><span class="w"> </span><span class="n">iron</span><span class="p">,</span><span class="w"> </span><span class="n">torque</span><span class="w"> </span><span class="n">wrench</span><span class="p">)</span>

<span class="c1">### Asset State</span>
<span class="n">Assets</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">states</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">calibration</span><span class="p">,</span><span class="w"> </span><span class="n">maintenance</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">usage</span><span class="o">:</span>

<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">OK</span><span class="o">**:</span><span class="w"> </span><span class="n">Operating</span><span class="w"> </span><span class="n">normally</span><span class="p">,</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">limits</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">WARNING</span><span class="o">**:</span><span class="w"> </span><span class="n">Approaching</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="p">(</span><span class="n">calibration</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">soon</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="k">limit</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">ALARM</span><span class="o">**:</span><span class="w"> </span><span class="n">Exceeded</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="p">(</span><span class="n">calibration</span><span class="w"> </span><span class="n">overdue</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="n">reached</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="k">ERROR</span><span class="o">**:</span><span class="w"> </span><span class="n">Hardware</span><span class="w"> </span><span class="n">fault</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">failure</span>

<span class="c1">### Asset Hierarchy</span>
<span class="n">Assets</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">parent</span><span class="o">-</span><span class="n">child</span><span class="w"> </span><span class="n">relationships</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">**</span><span class="n">Station</span><span class="o">**</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="o">**</span><span class="n">Instruments</span><span class="o">**</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">**</span><span class="n">Fixtures</span><span class="o">**</span>
<span class="o">-</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">models</span><span class="w"> </span><span class="n">physical</span><span class="w"> </span><span class="n">reality</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="n">ICT</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="n">station</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">DMM</span><span class="o">-</span><span class="mi">123</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">PSU</span><span class="o">-</span><span class="mi">456</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Children</span><span class="w"> </span><span class="n">increment</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">parents</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">used</span>
<span class="o">-</span><span class="w"> </span><span class="n">Helps</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">equipment</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">test</span>

<span class="o">---</span>

<span class="c1">## Asset Operations</span>

<span class="c1">### List All Assets</span>

<span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">python</span>
<span class="n n-Quoted"># Get all assets</span>
<span class="n n-Quoted">assets = api.asset.get_assets()</span>
<span class="n n-Quoted">print(f&quot;Total assets: {len(assets)}&quot;)</span>

<span class="n n-Quoted">for asset in assets:</span>
<span class="n n-Quoted">    print(f&quot;{asset.asset_name}&quot;)</span>
<span class="n n-Quoted">    print(f&quot;  S/N: {asset.serial_number}&quot;)</span>
<span class="n n-Quoted">    print(f&quot;  State: {asset.state}&quot;)</span>
<span class="n n-Quoted">    print(f&quot;  Location: {asset.location or &#39;Not set&#39;}&quot;)</span>

<span class="n n-Quoted"># Filter with OData query</span>
<span class="n n-Quoted">active_assets = api.asset.get_assets(</span>
<span class="n n-Quoted">    filter_str=&quot;state eq &#39;OK&#39;&quot;,</span>
<span class="n n-Quoted">    top=50</span>
<span class="n n-Quoted">)</span>

<span class="n n-Quoted"># Get assets by location</span>
<span class="n n-Quoted">lab_assets = api.asset.get_assets(</span>
<span class="n n-Quoted">    filter_str=&quot;contains(location,&#39;Lab A&#39;)&quot;</span>
<span class="n n-Quoted">)</span>
</code></pre></div>

<h3 id="get-specific-asset">Get Specific Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># By serial number (preferred)</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="c1"># By asset ID (UUID)</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">)</span>

<span class="c1"># By identifier string (tries ID first, then serial)</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">asset</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asset: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">type_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Count: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">total_count</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running Count: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">running_count</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset not found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="create-new-asset">Create New Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># Get asset type first</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
<span class="n">dmm_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="s2">&quot;DMM&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

<span class="c1"># Create simple asset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-NEW-001&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">dmm_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Keithley 2000 Multimeter&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;6.5 digit bench DMM&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Lab A&quot;</span>
<span class="p">)</span>

<span class="c1"># Create with full details</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SCOPE-001&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">dmm_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Rigol DS1054Z&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;4-channel 50MHz oscilloscope&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Lab B&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;DS1054Z&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span>
    <span class="n">total_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">running_count</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created asset ID: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="update-existing-asset">Update Existing Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get the asset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="c1"># Modify fields</span>
<span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span> <span class="o">=</span> <span class="s2">&quot;Updated Name&quot;</span>
<span class="n">asset</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;Lab C&quot;</span>
<span class="n">asset</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Moved to Lab C for project XYZ&quot;</span>

<span class="c1"># Save changes</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated: </span><span class="si">{</span><span class="n">updated</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="delete-asset">Delete Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete by serial number</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">delete_asset</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;OLD-DMM-001&quot;</span><span class="p">)</span>

<span class="c1"># Delete by asset ID</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">delete_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="o">=</span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset deleted&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Delete failed - asset may be in use&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="asset-types">Asset Types</h2>
<p>Asset types define categories of equipment with shared characteristics.</p>
<h3 id="list-asset-types">List Asset Types</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all asset types</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset Types:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">asset_type</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">asset_type</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">asset_type</span><span class="o">.</span><span class="n">type_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Calibration interval: </span><span class="si">{</span><span class="n">asset_type</span><span class="o">.</span><span class="n">calibration_interval</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maintenance interval: </span><span class="si">{</span><span class="n">asset_type</span><span class="o">.</span><span class="n">maintenance_interval</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Running count limit: </span><span class="si">{</span><span class="n">asset_type</span><span class="o">.</span><span class="n">running_count_limit</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total count limit: </span><span class="si">{</span><span class="n">asset_type</span><span class="o">.</span><span class="n">total_count_limit</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="create-asset-type">Create Asset Type</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a new asset type</span>
<span class="n">new_type</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset_type</span><span class="p">(</span>
    <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Thermal Chamber&quot;</span><span class="p">,</span>
    <span class="n">calibration_interval</span><span class="o">=</span><span class="mf">180.0</span><span class="p">,</span>  <span class="c1"># 180 days = 6 months</span>
    <span class="n">maintenance_interval</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span>   <span class="c1"># 90 days = quarterly</span>
    <span class="n">running_count_limit</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>    <span class="c1"># Reset after 5000 cycles</span>
    <span class="n">total_count_limit</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>     <span class="c1"># Replace after 50000 cycles</span>
    <span class="n">warning_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>       <span class="c1"># Warning at 80% of limit</span>
    <span class="n">alarm_threshold</span><span class="o">=</span><span class="mf">1.0</span>          <span class="c1"># Alarm at 100% of limit</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created type: </span><span class="si">{</span><span class="n">new_type</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">new_type</span><span class="o">.</span><span class="n">type_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-assets-by-type">Get Assets by Type</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all assets of a specific type</span>
<span class="c1"># First find the type</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
<span class="n">station_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span> <span class="o">==</span> <span class="s2">&quot;Station&quot;</span><span class="p">)</span>

<span class="c1"># Get all assets</span>
<span class="n">all_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>

<span class="c1"># Filter by type</span>
<span class="n">stations</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">all_assets</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">type_id</span> <span class="o">==</span> <span class="n">station_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span><span class="si">}</span><span class="s2"> stations:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">station</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">station</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="asset-hierarchy">Asset Hierarchy</h2>
<p>Assets can have parent-child relationships to model physical configurations.</p>
<h3 id="create-asset-with-parent">Create Asset with Parent</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get asset types</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
<span class="n">station_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="s2">&quot;Station&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
<span class="n">instrument_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="s2">&quot;Instrument&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>

<span class="c1"># Create parent station</span>
<span class="n">station</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">station_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;ICT Station 1&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Production Floor&quot;</span>
<span class="p">)</span>

<span class="c1"># Create child instrument (attached to station)</span>
<span class="n">dmm</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-123&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">instrument_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Keithley DMM&quot;</span><span class="p">,</span>
    <span class="n">parent_serial_number</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span>  <span class="c1"># Link to parent</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created DMM as child of </span><span class="si">{</span><span class="n">station</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="add-child-to-existing-asset">Add Child to Existing Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add a child asset to existing parent</span>
<span class="n">power_supply</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">add_child_asset</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PSU-456&quot;</span><span class="p">,</span>
    <span class="n">child_type_id</span><span class="o">=</span><span class="n">instrument_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">child_name</span><span class="o">=</span><span class="s2">&quot;Agilent Power Supply&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Triple output bench supply&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;E3631A&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">power_supply</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> to station&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-child-assets">Get Child Assets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all children of a parent asset</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">)</span>

<span class="n">children</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_child_assets</span><span class="p">(</span><span class="n">parent_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">asset_id</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Station </span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s2"> child assets:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Get children by serial number</span>
<span class="n">children</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_child_assets</span><span class="p">(</span><span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">)</span>

<span class="c1"># Get children at specific hierarchy level</span>
<span class="n">level_1_children</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_child_assets</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># Only direct children</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="status-and-state-management">Status and State Management</h2>
<p>Assets track their operational status and can enter warning/alarm states.</p>
<h3 id="get-asset-status">Get Asset Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get detailed status including alarm information</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">status</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asset Status:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  In Warning: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;in_warning&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  In Alarm: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;in_alarm&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Calibration due: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;calibration_due&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maintenance due: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maintenance_due&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Count percentage: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;count_percentage&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-asset-state">Get Asset State</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># Get current state</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_state</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset is operating normally&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset has warnings - check calibration/maintenance&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">ALARM</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset in alarm state - immediate attention required&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="set-asset-state">Set Asset State</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># Manually set asset state (e.g., after repair)</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">set_asset_state</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">OK</span>
<span class="p">)</span>

<span class="c1"># Set to maintenance mode</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">set_asset_state</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SCOPE-001&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">WARNING</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="check-warningalarm-conditions">Check Warning/Alarm Conditions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if asset is in warning</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">is_in_warning</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset has warnings&quot;</span><span class="p">)</span>

<span class="c1"># Check if asset is in alarm</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">is_in_alarm</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset in alarm state!&quot;</span><span class="p">)</span>

<span class="c1"># Get all assets in warning</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetAlarmState</span>

<span class="n">warned_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_with_alarm_state</span><span class="p">(</span>
    <span class="n">alarm_states</span><span class="o">=</span><span class="p">[</span><span class="n">AssetAlarmState</span><span class="o">.</span><span class="n">WARNING</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">warned_assets</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets in warning:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">warned_assets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get all assets in alarm</span>
<span class="n">alarmed_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_with_alarm_state</span><span class="p">(</span>
    <span class="n">alarm_states</span><span class="o">=</span><span class="p">[</span><span class="n">AssetAlarmState</span><span class="o">.</span><span class="n">ALARM</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="count-tracking">Count Tracking</h2>
<p>Assets track usage counts for maintenance scheduling.</p>
<h3 id="increment-count">Increment Count</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Increment usage count by 1</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">increment_count</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="c1"># Increment by specific amount</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">increment_count</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">amount</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>

<span class="c1"># Increment parent and all children</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">increment_count</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">amount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">increment_children</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Also increments DMM, PSU, etc.</span>
<span class="p">)</span>

<span class="c1"># Check updated counts</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total count: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">total_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running count: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">running_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="reset-running-count">Reset Running Count</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Reset running count after maintenance</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">reset_running_count</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Reset after scheduled maintenance&quot;</span>
<span class="p">)</span>

<span class="c1"># Verify reset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running count after reset: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">running_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Should be 0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total count: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">total_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Unchanged</span>
</code></pre></div>

<hr />
<h2 id="calibration-management">Calibration Management</h2>
<p>Track calibration schedules and history.</p>
<h3 id="record-calibration_1">Record Calibration</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Record calibration with current timestamp</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_calibration</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Annual calibration completed by Metrology Lab&quot;</span>
<span class="p">)</span>

<span class="c1"># Record calibration with specific date</span>
<span class="n">calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_calibration</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
    <span class="n">calibration_date</span><span class="o">=</span><span class="n">calibration_date</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Calibrated against NIST traceable standards&quot;</span>
<span class="p">)</span>

<span class="c1"># Check updated dates</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last calibration: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">last_calibration_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Next calibration: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="check-calibration-due">Check Calibration Due</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Get assets with calibration due within 30 days</span>
<span class="n">all_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">due_soon</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">all_assets</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">:</span>
        <span class="n">days_until_due</span> <span class="o">=</span> <span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">days_until_due</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">due_soon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset</span><span class="p">,</span> <span class="n">days_until_due</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assets needing calibration in next 30 days:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">asset</span><span class="p">,</span> <span class="n">days</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">due_soon</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> - Due in </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="calibration-reminder-report">Calibration Reminder Report</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_calibration_report</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">days_ahead</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate calibration schedule report&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="n">all_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_ahead</span><span class="p">)</span>

    <span class="c1"># Categorize assets</span>
    <span class="n">overdue</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">due_soon</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upcoming</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">all_assets</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">cal_date</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span>

        <span class="k">if</span> <span class="n">cal_date</span> <span class="o">&lt;</span> <span class="n">now</span><span class="p">:</span>
            <span class="n">overdue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cal_date</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">:</span>
            <span class="n">days_until</span> <span class="o">=</span> <span class="p">(</span><span class="n">cal_date</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="n">days_until</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">due_soon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset</span><span class="p">,</span> <span class="n">days_until</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">upcoming</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset</span><span class="p">,</span> <span class="n">days_until</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== CALIBRATION REPORT (</span><span class="si">{</span><span class="n">days_ahead</span><span class="si">}</span><span class="s2"> days) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">overdue</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è OVERDUE (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">overdue</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">overdue</span><span class="p">:</span>
            <span class="n">days_overdue</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">days_overdue</span><span class="si">}</span><span class="s2"> days overdue&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">due_soon</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ö° DUE SOON (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">due_soon</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">asset</span><span class="p">,</span> <span class="n">days</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">due_soon</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">upcoming</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üìÖ UPCOMING (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">upcoming</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">asset</span><span class="p">,</span> <span class="n">days</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">upcoming</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">10</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">get_calibration_report</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">days_ahead</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="maintenance-management">Maintenance Management</h2>
<p>Similar to calibration, but for general maintenance.</p>
<h3 id="record-maintenance">Record Maintenance</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Record maintenance</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_maintenance</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Replaced worn fixture pins, cleaned vacuum system&quot;</span>
<span class="p">)</span>

<span class="c1"># Record with specific date</span>
<span class="n">maintenance_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_maintenance</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;THERMAL-CHAMBER-01&quot;</span><span class="p">,</span>
    <span class="n">maintenance_date</span><span class="o">=</span><span class="n">maintenance_date</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Quarterly preventive maintenance performed&quot;</span>
<span class="p">)</span>

<span class="c1"># Check dates</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last maintenance: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">last_maintenance_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Next maintenance: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">next_maintenance_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="maintenance-schedule">Maintenance Schedule</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_maintenance_schedule</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">days_ahead</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate maintenance schedule&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="n">all_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_ahead</span><span class="p">)</span>

    <span class="n">schedule</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">all_assets</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_maintenance_date</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">maint_date</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_maintenance_date</span>

        <span class="k">if</span> <span class="n">now</span> <span class="o">&lt;=</span> <span class="n">maint_date</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">:</span>
            <span class="n">days_until</span> <span class="o">=</span> <span class="p">(</span><span class="n">maint_date</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="n">schedule</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset</span><span class="p">,</span> <span class="n">days_until</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== MAINTENANCE SCHEDULE (</span><span class="si">{</span><span class="n">days_ahead</span><span class="si">}</span><span class="s2"> days) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">asset</span><span class="p">,</span> <span class="n">days</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">schedule</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;‚ö†Ô∏è URGENT&quot;</span> <span class="k">if</span> <span class="n">days</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="k">else</span> <span class="s2">&quot;üìÖ&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">get_maintenance_schedule</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">days_ahead</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="asset-logs">Asset Logs</h2>
<p>Asset logs record events and activities.</p>
<h3 id="get-asset-logs">Get Asset Logs</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all logs</span>
<span class="n">logs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_log</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total log entries: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show first 10</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Asset: </span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  User: </span><span class="si">{</span><span class="n">log</span><span class="o">.</span><span class="n">user</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;System&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Filter logs with OData</span>
<span class="n">recent_logs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_log</span><span class="p">(</span>
    <span class="n">filter_str</span><span class="o">=</span><span class="s2">&quot;timestamp gt 2024-06-01&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">50</span>
<span class="p">)</span>

<span class="c1"># Filter by asset</span>
<span class="n">dmm_logs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_log</span><span class="p">(</span>
    <span class="n">filter_str</span><span class="o">=</span><span class="s2">&quot;contains(asset_name,&#39;DMM&#39;)&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="add-log-message">Add Log Message</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add a log entry</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">add_log_message</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Repaired faulty input connector&quot;</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;john.smith&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Log entry added&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="file-operations">File Operations</h2>
<p>‚ö†Ô∏è <strong>INTERNAL API - Subject to change</strong></p>
<p>Assets can store configuration files, calibration certificates, manuals, etc.</p>
<h3 id="upload-file-to-asset">Upload File to Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Read file content</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;calibration_cert.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># Upload to asset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">upload_blob</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Calibration_Certificate_2024-06-15.pdf&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="n">content</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File uploaded&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="list-asset-files">List Asset Files</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># List all files for an asset</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span><span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files for </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file_info</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">file_info</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file_info</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Uploaded: </span><span class="si">{</span><span class="n">file_info</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="download-file-from-asset">Download File from Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Download a file</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">download_blob</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Calibration_Certificate_2024-06-15.pdf&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">content</span><span class="p">:</span>
    <span class="c1"># Save to local file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;downloaded_cert.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File downloaded&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="delete-files">Delete Files</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete one or more files</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">delete_blobs</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
    <span class="n">filenames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;old_manual.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;outdated_config.json&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files deleted&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="complete-station-setup">Complete Station Setup</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># Get asset types</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
<span class="n">station_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="s2">&quot;Station&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
<span class="n">instrument_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="s2">&quot;Instrument&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
<span class="n">fixture_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">if</span> <span class="s2">&quot;Fixture&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>

<span class="c1"># 1. Create station</span>
<span class="n">station</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">station_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Final Verification Test Station 5&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Production Floor - Zone A&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">OK</span>
<span class="p">)</span>

<span class="c1"># 2. Add instruments</span>
<span class="n">dmm</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-FVT05-01&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">instrument_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Keithley 2000 DMM&quot;</span><span class="p">,</span>
    <span class="n">parent_serial_number</span><span class="o">=</span><span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;2000&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;6.5 digit multimeter for voltage measurements&quot;</span>
<span class="p">)</span>

<span class="n">scope</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SCOPE-FVT05-01&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">instrument_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Rigol DS1054Z Oscilloscope&quot;</span><span class="p">,</span>
    <span class="n">parent_serial_number</span><span class="o">=</span><span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;DS1054Z&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;4-channel 50MHz scope for waveform analysis&quot;</span>
<span class="p">)</span>

<span class="n">psu</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-FVT05-01&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">instrument_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Agilent E3631A Power Supply&quot;</span><span class="p">,</span>
    <span class="n">parent_serial_number</span><span class="o">=</span><span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;E3631A&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Triple output bench supply&quot;</span>
<span class="p">)</span>

<span class="c1"># 3. Add fixture</span>
<span class="n">fixture</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;FIX-FVT05-WIDGET&quot;</span><span class="p">,</span>
    <span class="n">type_id</span><span class="o">=</span><span class="n">fixture_type</span><span class="o">.</span><span class="n">type_id</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Widget Test Fixture&quot;</span><span class="p">,</span>
    <span class="n">parent_serial_number</span><span class="o">=</span><span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Custom fixture for Widget product family&quot;</span>
<span class="p">)</span>

<span class="c1"># 4. Record initial calibration for instruments</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_calibration</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-FVT05-01&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Initial calibration - factory certified&quot;</span>
<span class="p">)</span>

<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_calibration</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SCOPE-FVT05-01&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Initial calibration - factory certified&quot;</span>
<span class="p">)</span>

<span class="c1"># 5. Add configuration file</span>
<span class="n">fixture_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pin_map&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;TP1&quot;</span><span class="p">:</span> <span class="s2">&quot;V+&quot;</span><span class="p">,</span> <span class="s2">&quot;TP2&quot;</span><span class="p">:</span> <span class="s2">&quot;GND&quot;</span><span class="p">,</span> <span class="s2">&quot;TP3&quot;</span><span class="p">:</span> <span class="s2">&quot;SIGNAL&quot;</span><span class="p">},</span>
    <span class="s2">&quot;force_voltage&quot;</span><span class="p">:</span> <span class="mf">5.0</span>
<span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">upload_blob</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">fixture</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fixture_config</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Station </span><span class="si">{</span><span class="n">station</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> set up with </span><span class="si">{</span><span class="nb">len</span><span class="p">([</span><span class="n">dmm</span><span class="p">,</span><span class="w"> </span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">psu</span><span class="p">,</span><span class="w"> </span><span class="n">fixture</span><span class="p">])</span><span class="si">}</span><span class="s2"> child assets&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asset-health-dashboard">Asset Health Dashboard</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">asset_health_dashboard</span><span class="p">(</span><span class="n">api</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate comprehensive asset health report&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

    <span class="n">all_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># Categorize assets</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cal_overdue&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;cal_due_soon&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;maint_overdue&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;maint_due_soon&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;count_warning&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;count_alarm&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;in_alarm&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">all_assets</span><span class="p">:</span>
        <span class="c1"># State</span>
        <span class="n">stats</span><span class="p">[</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;ALARM&#39;</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;in_alarm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

        <span class="c1"># Calibration</span>
        <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">:</span>
            <span class="n">days_until</span> <span class="o">=</span> <span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="n">days_until</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;cal_overdue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">days_until</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;cal_due_soon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

        <span class="c1"># Maintenance</span>
        <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_maintenance_date</span><span class="p">:</span>
            <span class="n">days_until</span> <span class="o">=</span> <span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">next_maintenance_date</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="n">days_until</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;maint_overdue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">days_until</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;maint_due_soon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

        <span class="c1"># Count limits (if asset has type with limits)</span>
        <span class="c1"># This would require checking AssetType limits</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ASSET HEALTH DASHBOARD&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total Assets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_assets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">State Distribution:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ö†Ô∏è  CRITICAL ISSUES:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Assets in ALARM state: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">[</span><span class="s1">&#39;in_alarm&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Calibration overdue: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">[</span><span class="s1">&#39;cal_overdue&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maintenance overdue: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">[</span><span class="s1">&#39;maint_overdue&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üìã UPCOMING:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Calibration due (30 days): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">[</span><span class="s1">&#39;cal_due_soon&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maintenance due (30 days): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">[</span><span class="s1">&#39;maint_due_soon&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;cal_overdue&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ö†Ô∏è  OVERDUE CALIBRATIONS:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">[</span><span class="s1">&#39;cal_overdue&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">days</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days overdue&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">asset_health_dashboard</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
</code></pre></div>

<h3 id="bulk-import-assets">Bulk Import Assets</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">import_assets_from_csv</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">csv_file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Import assets from CSV file&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

    <span class="c1"># Get asset types once</span>
    <span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
    <span class="n">type_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">type_id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">}</span>

    <span class="n">created</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">type_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">type_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_map</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Unknown type &#39;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;serial_number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
                <span class="n">serial_number</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;serial_number&#39;</span><span class="p">],</span>
                <span class="n">type_id</span><span class="o">=</span><span class="n">type_map</span><span class="p">[</span><span class="n">type_name</span><span class="p">],</span>
                <span class="n">asset_name</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">location</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">part_number</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;part_number&#39;</span><span class="p">),</span>
                <span class="n">revision</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;revision&#39;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">asset</span><span class="p">:</span>
                <span class="n">created</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">created</span>

<span class="c1"># CSV format:</span>
<span class="c1"># serial_number,name,type,location,description,part_number,revision</span>
<span class="c1"># DMM-001,Keithley 2000,Instrument,Lab A,6.5 digit DMM,2000,1.0</span>
<span class="c1"># SCOPE-001,Rigol DS1054Z,Instrument,Lab A,4-ch 50MHz,DS1054Z,1.0</span>

<span class="n">imported</span> <span class="o">=</span> <span class="n">import_assets_from_csv</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s1">&#39;assets.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imported </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">imported</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="usage-tracking-with-automatic-counts">Usage Tracking with Automatic Counts</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># In your test sequence, increment counts</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_test_sequence</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">station_serial</span><span class="p">,</span> <span class="n">uut_serial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example test sequence that tracks asset usage&quot;&quot;&quot;</span>

    <span class="c1"># Increment station count (and all child instruments)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">increment_count</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">station_serial</span><span class="p">,</span>
        <span class="n">amount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">increment_children</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Increments DMM, PSU, Scope, Fixture</span>
    <span class="p">)</span>

    <span class="c1"># Run tests...</span>
    <span class="c1"># test_voltage()</span>
    <span class="c1"># test_current()</span>
    <span class="c1"># test_waveform()</span>

    <span class="c1"># Log test completion</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="n">station_serial</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">add_log_message</span><span class="p">(</span>
        <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tested unit </span><span class="si">{</span><span class="n">uut_serial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;automated_test_system&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Check if maintenance is due</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">is_in_warning</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="n">station_serial</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è  Station </span><span class="si">{</span><span class="n">station_serial</span><span class="si">}</span><span class="s2"> needs attention&quot;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="n">station_serial</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">run_test_sequence</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001-SN12345&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="practical-examples">Practical Examples</h2>
<h3 id="serial-number-lookup-with-error-handling">Serial Number Lookup with Error Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">PyWATSError</span><span class="p">,</span> <span class="n">NotFoundError</span><span class="p">,</span> <span class="n">AuthenticationError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">safe_asset_lookup</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Robust asset lookup with comprehensive error handling.</span>

<span class="sd">    Returns a dict with asset data or error information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;asset&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="kc">None</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try exact match first</span>
        <span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">asset</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asset</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Try case-insensitive search via filter</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">(</span>
            <span class="n">filter_str</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;tolower(serialNumber) eq tolower(&#39;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">,</span>
            <span class="n">top</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">assets</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Found via case-insensitive search&quot;</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Try partial match for fuzzy lookup</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">(</span>
            <span class="n">filter_str</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;contains(serialNumber, &#39;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">,</span>
            <span class="n">top</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">assets</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Exact match not found. Did you mean: </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">serial_number</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">assets</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PARTIAL_MATCH&quot;</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;suggestions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assets</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No asset found with serial number &#39;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NOT_FOUND&quot;</span>

    <span class="k">except</span> <span class="n">AuthenticationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Authentication failed - check API token&quot;</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;AUTH_ERROR&quot;</span>
    <span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;API_ERROR&quot;</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Usage</span>
<span class="n">lookup</span> <span class="o">=</span> <span class="n">safe_asset_lookup</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">lookup</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">[</span><span class="s2">&quot;asset&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">lookup</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PARTIAL_MATCH&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suggestions: </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">serial_number</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;suggestions&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="deep-asset-hierarchy-traversal">Deep Asset Hierarchy Traversal</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AssetNode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an asset in the hierarchy tree&quot;&quot;&quot;</span>
    <span class="n">asset</span><span class="p">:</span> <span class="n">Any</span>  <span class="c1"># Asset object</span>
    <span class="n">children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;AssetNode&#39;</span><span class="p">]</span>
    <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_asset_tree</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">root_serial</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssetNode</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a complete asset hierarchy tree from a root asset.</span>

<span class="sd">    Useful for:</span>
<span class="sd">    - Visualizing station configurations</span>
<span class="sd">    - Finding all equipment associated with a station</span>
<span class="sd">    - Generating equipment reports</span>

<span class="sd">    Args:</span>
<span class="sd">        api: pyWATS API instance</span>
<span class="sd">        root_serial: Serial number of root asset (e.g., station)</span>
<span class="sd">        max_depth: Maximum depth to traverse (prevent infinite loops)</span>

<span class="sd">    Returns:</span>
<span class="sd">        AssetNode tree or None if root not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_node</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetNode</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AssetNode</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>

        <span class="c1"># Get direct children</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_child_assets</span><span class="p">(</span><span class="n">parent_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">))</span>

        <span class="n">child_nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_build_node</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">AssetNode</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="n">child_nodes</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="n">root_serial</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">_build_node</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">print_asset_tree</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">AssetNode</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pretty-print the asset hierarchy&quot;&quot;&quot;</span>
    <span class="n">state_emoji</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;OK&quot;</span><span class="p">:</span> <span class="s2">&quot;‚úÖ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span> <span class="s2">&quot;‚ö†Ô∏è&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ALARM&quot;</span><span class="p">:</span> <span class="s2">&quot;üö®&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span> <span class="s2">&quot;‚ùå&quot;</span>
    <span class="p">}</span>

    <span class="n">emoji</span> <span class="o">=</span> <span class="n">state_emoji</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;‚ùì&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">emoji</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">print_asset_tree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;  ‚îÇ &quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">count_equipment</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">AssetNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count equipment by state in the hierarchy&quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ALARM&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_count</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">AssetNode</span><span class="p">):</span>
        <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">_count</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="n">_count</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">counts</span>

<span class="c1"># Usage: Inspect a station and all its equipment</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">build_asset_tree</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;FVT-STATION-05&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">tree</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Station Hierarchy:&quot;</span><span class="p">)</span>
    <span class="n">print_asset_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">count_equipment</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total equipment: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OK: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;OK&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Warning: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;WARNING&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Alarm: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ALARM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="concurrent-bulk-asset-operations">Concurrent Bulk Asset Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bulk_create_station_with_instruments</span><span class="p">(</span>
    <span class="n">api</span><span class="p">:</span> <span class="n">AsyncWATS</span><span class="p">,</span>
    <span class="n">station_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">instruments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a complete station setup with concurrent instrument creation.</span>

<span class="sd">    Much faster than sequential creation for stations with many instruments.</span>

<span class="sd">    Args:</span>
<span class="sd">        api: AsyncWATS instance</span>
<span class="sd">        station_config: Dict with station parameters</span>
<span class="sd">        instruments: List of instrument configs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success, list of serial numbers created)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get asset types once</span>
    <span class="n">types</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
    <span class="n">type_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">t</span><span class="o">.</span><span class="n">type_id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">}</span>

    <span class="c1"># 1. Create station first (required as parent)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">station_type</span> <span class="o">=</span> <span class="n">type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;test station&quot;</span><span class="p">)</span>
        <span class="n">station</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">station_config</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">],</span>
            <span class="n">type_id</span><span class="o">=</span><span class="n">station_type</span><span class="p">,</span>
            <span class="n">asset_name</span><span class="o">=</span><span class="n">station_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">location</span><span class="o">=</span><span class="n">station_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">station_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">created</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Station creation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="c1"># 2. Create all instruments concurrently</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_instrument</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">type_id</span> <span class="o">=</span> <span class="n">type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;instrument&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">],</span>
            <span class="n">type_id</span><span class="o">=</span><span class="n">type_id</span><span class="p">,</span>
            <span class="n">asset_name</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">parent_serial_number</span><span class="o">=</span><span class="n">station</span><span class="o">.</span><span class="n">serial_number</span><span class="p">,</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;part_number&quot;</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Run all instrument creations in parallel</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span><span class="n">create_instrument</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">],</span>
        <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">inst_config</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">instruments</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">inst_config</span><span class="p">[</span><span class="s1">&#39;serial_number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">created</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)</span>

    <span class="c1"># 3. Record initial calibrations concurrently</span>
    <span class="n">calibration_tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_calibration</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Initial calibration - setup complete&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">created</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Skip station, calibrate instruments</span>
    <span class="p">]</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">calibration_tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">created</span>

<span class="c1"># Usage</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup_new_station</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="n">station</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="s2">&quot;ICT-STATION-10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;In-Circuit Test Station 10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;Production Floor - Line 2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;High-volume ICT station&quot;</span>
        <span class="p">}</span>

        <span class="n">instruments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="s2">&quot;DMM-ICT10-01&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Keithley 2000&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;instrument&quot;</span><span class="p">,</span> <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;2000&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="s2">&quot;DMM-ICT10-02&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Keithley 2000&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;instrument&quot;</span><span class="p">,</span> <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;2000&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="s2">&quot;PSU-ICT10-01&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Agilent E3631A&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;instrument&quot;</span><span class="p">,</span> <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;E3631A&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="s2">&quot;RELAY-ICT10-01&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;NI PXI-2567&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;instrument&quot;</span><span class="p">,</span> <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;PXI-2567&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="s2">&quot;FIX-ICT10-MAIN&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ICT Main Fixture&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fixture&quot;</span><span class="p">},</span>
        <span class="p">]</span>

        <span class="n">success</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="k">await</span> <span class="n">bulk_create_station_with_instruments</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">instruments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Created station with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">created</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">sn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Errors occurred&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">created</span><span class="p">:</span>  <span class="c1"># In error case, created contains error messages</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">setup_new_station</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="assetservice-methods">AssetService Methods</h3>
<h4 id="asset-operations">Asset Operations</h4>
<ul>
<li><code>get_assets(filter_str, top)</code> ‚Üí <code>List[Asset]</code> - Get all assets with optional filtering</li>
<li><code>get_asset(identifier)</code> ‚Üí <code>Optional[Asset]</code> - Get asset by ID or serial number</li>
<li><code>get_asset_by_serial(serial_number)</code> ‚Üí <code>Optional[Asset]</code> - Get asset by serial number</li>
<li><code>create_asset(...)</code> ‚Üí <code>Optional[Asset]</code> - Create new asset</li>
<li><code>update_asset(asset)</code> ‚Üí <code>Optional[Asset]</code> - Update existing asset</li>
<li><code>delete_asset(asset_id, serial_number)</code> ‚Üí <code>bool</code> - Delete asset</li>
</ul>
<h4 id="status-operations">Status Operations</h4>
<ul>
<li><code>get_status(asset_id, serial_number)</code> ‚Üí <code>Optional[Dict]</code> - Get detailed status</li>
<li><code>get_asset_state(asset_id, serial_number)</code> ‚Üí <code>Optional[AssetState]</code> - Get current state</li>
<li><code>set_asset_state(asset_id, serial_number, state)</code> ‚Üí <code>bool</code> - Set state</li>
<li><code>is_in_alarm(asset_id, serial_number)</code> ‚Üí <code>bool</code> - Check if in alarm</li>
<li><code>is_in_warning(asset_id, serial_number)</code> ‚Üí <code>bool</code> - Check if in warning</li>
<li><code>get_assets_with_alarm_state(alarm_states, top)</code> ‚Üí <code>List[Asset]</code> - Get assets in specific states</li>
</ul>
<h4 id="count-operations">Count Operations</h4>
<ul>
<li><code>increment_count(asset_id, serial_number, amount, increment_children)</code> ‚Üí <code>bool</code> - Increment usage count</li>
<li><code>reset_running_count(asset_id, serial_number, comment)</code> ‚Üí <code>bool</code> - Reset running count</li>
</ul>
<h4 id="calibration-maintenance">Calibration &amp; Maintenance</h4>
<ul>
<li><code>record_calibration(asset_id, serial_number, comment, calibration_date)</code> ‚Üí <code>bool</code> - Record calibration</li>
<li><code>record_maintenance(asset_id, serial_number, comment, maintenance_date)</code> ‚Üí <code>bool</code> - Record maintenance</li>
</ul>
<h4 id="log-operations">Log Operations</h4>
<ul>
<li><code>get_asset_log(filter_str, top)</code> ‚Üí <code>List[AssetLog]</code> - Get log entries</li>
<li><code>add_log_message(asset_id, message, user)</code> ‚Üí <code>bool</code> - Add log entry</li>
</ul>
<h4 id="asset-type-operations">Asset Type Operations</h4>
<ul>
<li><code>get_asset_types()</code> ‚Üí <code>List[AssetType]</code> - Get all asset types</li>
<li><code>create_asset_type(...)</code> ‚Üí <code>Optional[AssetType]</code> - Create new asset type</li>
</ul>
<h4 id="sub-asset-operations">Sub-Asset Operations</h4>
<ul>
<li><code>get_child_assets(parent_id, parent_serial, level)</code> ‚Üí <code>List[Asset]</code> - Get child assets</li>
<li><code>add_child_asset(parent_serial, child_serial, child_type_id, ...)</code> ‚Üí <code>Optional[Asset]</code> - Add child asset</li>
</ul>
<h3 id="assetserviceinternal-methods-subject-to-change">AssetServiceInternal Methods (‚ö†Ô∏è Subject to change)</h3>
<h4 id="file-operations_1">File Operations</h4>
<ul>
<li><code>upload_file(asset_id, filename, content)</code> ‚Üí <code>bool</code> - Upload file to asset</li>
<li><code>list_files(asset_id)</code> ‚Üí <code>List[Dict]</code> - List files for asset</li>
<li><code>download_file(asset_id, filename)</code> ‚Üí <code>Optional[bytes]</code> - Download file</li>
<li><code>delete_files(asset_id, filenames)</code> ‚Üí <code>bool</code> - Delete files</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="asset">Asset</h4>
<ul>
<li><code>asset_id</code>: UUID (auto-generated)</li>
<li><code>serial_number</code>: str (required, unique)</li>
<li><code>asset_name</code>: Optional[str]</li>
<li><code>type_id</code>: UUID (required, links to AssetType)</li>
<li><code>description</code>: Optional[str]</li>
<li><code>location</code>: Optional[str]</li>
<li><code>parent_asset_id</code>: Optional[UUID]</li>
<li><code>part_number</code>: Optional[str]</li>
<li><code>revision</code>: Optional[str]</li>
<li><code>state</code>: AssetState</li>
<li><code>first_seen_date</code>: Optional[datetime]</li>
<li><code>last_seen_date</code>: Optional[datetime]</li>
<li><code>last_calibration_date</code>: Optional[datetime]</li>
<li><code>next_calibration_date</code>: Optional[datetime]</li>
<li><code>last_maintenance_date</code>: Optional[datetime]</li>
<li><code>next_maintenance_date</code>: Optional[datetime]</li>
<li><code>total_count</code>: Optional[int]</li>
<li><code>running_count</code>: Optional[int]</li>
</ul>
<h4 id="assettype">AssetType</h4>
<ul>
<li><code>type_id</code>: UUID</li>
<li><code>type_name</code>: str</li>
<li><code>calibration_interval</code>: Optional[float] (days)</li>
<li><code>maintenance_interval</code>: Optional[float] (days)</li>
<li><code>running_count_limit</code>: Optional[int]</li>
<li><code>total_count_limit</code>: Optional[int]</li>
<li><code>warning_threshold</code>: Optional[float] (0.0 - 1.0)</li>
<li><code>alarm_threshold</code>: Optional[float] (0.0 - 1.0)</li>
</ul>
<h4 id="assetstate-enum">AssetState (Enum)</h4>
<ul>
<li><code>OK</code>: Normal operation</li>
<li><code>WARNING</code>: Approaching limits</li>
<li><code>ALARM</code>: Limits exceeded</li>
<li><code>ERROR</code>: Hardware fault</li>
</ul>
<h4 id="assetalarmstate-enum">AssetAlarmState (Enum)</h4>
<ul>
<li><code>OK</code>: No issues</li>
<li><code>WARNING</code>: Warning conditions</li>
<li><code>ALARM</code>: Alarm conditions</li>
</ul>
<h4 id="assetlog">AssetLog</h4>
<ul>
<li><code>log_id</code>: UUID</li>
<li><code>asset_id</code>: UUID</li>
<li><code>asset_name</code>: str</li>
<li><code>timestamp</code>: datetime</li>
<li><code>message</code>: str</li>
<li><code>user</code>: Optional[str]</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li>
<p><strong>Use serial numbers consistently</strong> - They're the primary identifier, make them meaningful</p>
</li>
<li>
<p><strong>Define asset types first</strong> - Create asset types before creating assets</p>
</li>
<li>
<p><strong>Set calibration/maintenance intervals</strong> - Define intervals in AssetType to enable automatic scheduling</p>
</li>
<li>
<p><strong>Use hierarchies for accuracy</strong> - Model physical relationships (station ‚Üí instruments)</p>
</li>
<li>
<p><strong>Increment children when using parent</strong> - Set <code>increment_children=True</code> when incrementing station counts</p>
</li>
<li>
<p><strong>Track usage in test sequences</strong> - Automatically increment counts during tests</p>
</li>
<li>
<p><strong>Reset running count after maintenance</strong> - Clear running count to restart interval</p>
</li>
<li>
<p><strong>Add meaningful log messages</strong> - Document repairs, config changes, relocations</p>
</li>
<li>
<p><strong>Monitor warning states</strong> - Check warnings before they become alarms</p>
</li>
<li>
<p><strong>Store calibration certificates</strong> - Use file operations to attach cal certs and manuals</p>
</li>
<li>
<p><strong>Regular health checks</strong> - Run dashboard reports to catch issues early</p>
</li>
<li>
<p><strong>Don't delete assets</strong> - Set state to inactive instead, preserve history</p>
</li>
</ol>
<hr />
<h2 id="common-workflows">Common Workflows</h2>
<h3 id="monthly-calibration-planning">Monthly Calibration Planning</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Get all assets needing calibration in next 60 days</span>
<span class="n">all_assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="n">cal_schedule</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">all_assets</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="ow">and</span> <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">:</span>
        <span class="n">days</span> <span class="o">=</span> <span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">cal_schedule</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset</span><span class="p">,</span> <span class="n">days</span><span class="p">))</span>

<span class="c1"># Sort by urgency</span>
<span class="n">cal_schedule</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== CALIBRATION SCHEDULE (60 days) ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">asset</span><span class="p">,</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">cal_schedule</span><span class="p">:</span>
    <span class="n">urgency</span> <span class="o">=</span> <span class="s2">&quot;üî¥ OVERDUE&quot;</span> <span class="k">if</span> <span class="n">days</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;‚ö†Ô∏è  URGENT&quot;</span> <span class="k">if</span> <span class="n">days</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="k">else</span> <span class="s2">&quot;üìÖ&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">urgency</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">days</span><span class="p">)</span><span class="si">}</span><span class="s2"> days </span><span class="si">{</span><span class="s1">&#39;overdue&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">days</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;remaining&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="post-maintenance-workflow">Post-Maintenance Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># After completing maintenance</span>
<span class="n">asset_serial</span> <span class="o">=</span> <span class="s2">&quot;ICT-STATION-01&quot;</span>

<span class="c1"># 1. Record maintenance</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_maintenance</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="n">asset_serial</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Quarterly PM: cleaned, lubricated, replaced worn parts&quot;</span>
<span class="p">)</span>

<span class="c1"># 2. Reset running count</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">reset_running_count</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="n">asset_serial</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Count reset after quarterly maintenance&quot;</span>
<span class="p">)</span>

<span class="c1"># 3. Set state to OK</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">set_asset_state</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="n">asset_serial</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">OK</span>
<span class="p">)</span>

<span class="c1"># 4. Add log entry</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="n">asset_serial</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">add_log_message</span><span class="p">(</span>
    <span class="n">asset_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">),</span>
    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Station returned to service after quarterly maintenance&quot;</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;maintenance.team&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_serial</span><span class="si">}</span><span class="s2"> maintenance complete and returned to service&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="asset-not-found">Asset not found</h3>
<div class="codehilite"><pre><span></span><code><span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset doesn&#39;t exist - check serial number or create it&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="cannot-create-asset-without-type">Cannot create asset without type</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Always get type_id first</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_types</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">types</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No asset types defined - create types first&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">type_id</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type_id</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">type_id</span><span class="o">=</span><span class="n">type_id</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="calibrationmaintenance-dates-not-updating">Calibration/maintenance dates not updating</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Make sure you&#39;re calling the right method</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">record_calibration</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="c1"># NOT: api.asset.post_calibration() (that&#39;s lower level)</span>

<span class="c1"># Verify update</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_by_serial</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last cal: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">last_calibration_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="production.md">Production Domain</a> - Using assets in production tests</li>
<li><a href="report.md">Report Domain</a> - Including station info in test reports</li>
<li><a href="process.md">Process Domain</a> - Defining test operations that use assets</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-process">
    <div class="doc-source">Source: docs/modules/process.md</div>
    <h1 id="process-domain">Process Domain</h1>
<p>The Process domain provides access to process and operation type definitions. Processes define the types of operations performed on units (e.g., Test, Repair, Assembly). This domain uses an in-memory cache with configurable refresh intervals to optimize performance by reducing API calls. It provides read-only access to process definitions.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#process-operations">Process Operations</a></li>
<li><a href="#cache-management">Cache Management</a></li>
<li><a href="#operation-types">Operation Types</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get test operation</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">test_op</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation: </span><span class="si">{</span><span class="n">test_op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">test_op</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="n">test_op</span><span class="o">.</span><span class="n">process_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get repair operation</span>
<span class="n">repair_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="s2">&quot;Rework&quot;</span><span class="p">)</span>

<span class="c1"># Get operation by name or code</span>
<span class="n">operation</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;FCT&quot;</span><span class="p">)</span>  <span class="c1"># Can be name or code</span>

<span class="c1"># Refresh cache manually</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache last refreshed: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">last_refresh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refresh interval: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_processes</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Get multiple operations concurrently</span>
        <span class="n">ict</span><span class="p">,</span> <span class="n">fct</span><span class="p">,</span> <span class="n">repair</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;FCT&quot;</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="s2">&quot;Rework&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ICT code: </span><span class="si">{</span><span class="n">ict</span><span class="o">.</span><span class="n">code</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">ict</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FCT code: </span><span class="si">{</span><span class="n">fct</span><span class="o">.</span><span class="n">code</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">fct</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">get_processes</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="process-operation-type">Process (Operation Type)</h3>
<p>A <strong>Process</strong> defines a type of operation:<br />
- <code>name</code>: Operation name (e.g., "In-Circuit Test")<br />
- <code>code</code>: Short code (e.g., "ICT")<br />
- <code>process_type</code>: Type (TEST, REPAIR, ASSEMBLY, etc.)<br />
- <code>description</code>: Operation description</p>
<h3 id="process-types">Process Types</h3>
<p>Common process types:<br />
- <strong>TEST</strong>: Testing operations (ICT, FCT, Functional Test)<br />
- <strong>REPAIR</strong>: Repair and rework operations<br />
- <strong>ASSEMBLY</strong>: Assembly and integration<br />
- <strong>CALIBRATION</strong>: Calibration operations<br />
- <strong>INSPECTION</strong>: Visual or automated inspection</p>
<h3 id="caching">Caching</h3>
<p>The Process service uses in-memory caching:<br />
- <strong>Default refresh</strong>: 300 seconds (5 minutes)<br />
- <strong>Auto-refresh</strong>: Cache refreshes when age exceeds interval<br />
- <strong>Thread-safe</strong>: Uses locks for concurrent access<br />
- <strong>Performance</strong>: Reduces API calls for frequently accessed data</p>
<hr />
<h2 id="process-operations">Process Operations</h2>
<h3 id="get-operation-by-code-or-name">Get Operation by Code or Name</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get by code</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">ict</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">ict</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">ict</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="n">ict</span><span class="o">.</span><span class="n">process_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">ict</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get by name</span>
<span class="n">fct</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;Functional Test&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">fct</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">fct</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">fct</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-test-operations">Get Test Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get test operation specifically</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">test_op</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Operation: </span><span class="si">{</span><span class="n">test_op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">test_op</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test operation not found&quot;</span><span class="p">)</span>

<span class="c1"># Try by name or code</span>
<span class="n">fct</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;FCT&quot;</span><span class="p">)</span>
<span class="n">functional</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;Functional Test&quot;</span><span class="p">)</span>

<span class="c1"># Both should return the same operation</span>
<span class="k">if</span> <span class="n">fct</span> <span class="ow">and</span> <span class="n">functional</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">fct</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">functional</span><span class="o">.</span><span class="n">code</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">fct</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-repair-operations">Get Repair Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get repair operation</span>
<span class="n">repair</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="s2">&quot;Rework&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">repair</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Repair Operation: </span><span class="si">{</span><span class="n">repair</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">repair</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="n">repair</span><span class="o">.</span><span class="n">process_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Common repair operations</span>
<span class="n">repair_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Rework&quot;</span><span class="p">,</span> <span class="s2">&quot;Repair&quot;</span><span class="p">,</span> <span class="s2">&quot;Debug&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">repair_codes</span><span class="p">:</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">op</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="list-all-operations">List All Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all operations (via cache)</span>
<span class="c1"># Note: This accesses internal cache - implementation may vary</span>

<span class="n">all_operations</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_all_operations</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== ALL OPERATIONS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_operations</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Group by type</span>
<span class="n">by_type</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">all_operations</span><span class="p">:</span>
    <span class="n">op_type</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">process_type</span>
    <span class="k">if</span> <span class="n">op_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_type</span><span class="p">:</span>
        <span class="n">by_type</span><span class="p">[</span><span class="n">op_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">by_type</span><span class="p">[</span><span class="n">op_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

<span class="k">for</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">ops</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_type</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="cache-management">Cache Management</h2>
<h3 id="check-cache-status">Check Cache Status</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Get cache info</span>
<span class="n">last_refresh</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">last_refresh</span>
<span class="n">refresh_interval</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== CACHE STATUS ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last refresh: </span><span class="si">{</span><span class="n">last_refresh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refresh interval: </span><span class="si">{</span><span class="n">refresh_interval</span><span class="si">}</span><span class="s2"> seconds (</span><span class="si">{</span><span class="n">refresh_interval</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> minutes)&quot;</span><span class="p">)</span>

<span class="c1"># Calculate cache age</span>
<span class="k">if</span> <span class="n">last_refresh</span><span class="p">:</span>
    <span class="n">age</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_refresh</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache age: </span><span class="si">{</span><span class="n">age</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">refresh_interval</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ö† Cache is stale and will refresh on next access&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">refresh_interval</span> <span class="o">-</span> <span class="n">age</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Cache is fresh (</span><span class="si">{</span><span class="n">remaining</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> seconds until refresh)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cache not initialized&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="manual-refresh">Manual Refresh</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Force cache refresh</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refreshing process cache...&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache refreshed at: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">last_refresh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="configure-refresh-interval">Configure Refresh Interval</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set custom refresh interval (in seconds)</span>
<span class="c1"># 10 minutes = 600 seconds</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">600</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refresh interval set to </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

<span class="c1"># For frequently changing process definitions, use shorter interval</span>
<span class="c1"># 1 minute = 60 seconds</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># For stable definitions, use longer interval</span>
<span class="c1"># 1 hour = 3600 seconds</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">3600</span>
</code></pre></div>

<h3 id="auto-refresh-behavior">Auto-Refresh Behavior</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># Cache auto-refreshes when age exceeds interval</span>
<span class="c1"># Set short interval for demo</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># 5 seconds</span>

<span class="c1"># First access - loads cache</span>
<span class="n">op1</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First access: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">last_refresh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Wait for cache to expire</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># Next access - auto-refreshes</span>
<span class="n">op2</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;FCT&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After expiry: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">last_refresh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Reset to default</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">300</span>
</code></pre></div>

<hr />
<h2 id="operation-types">Operation Types</h2>
<h3 id="using-processes-in-production">Using Processes in Production</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># When creating production records, reference processes</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitInfo</span>

<span class="c1"># Get the test operation</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>

<span class="c1"># Use in unit creation or update</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;SN12345&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">unit</span> <span class="ow">and</span> <span class="n">test_op</span><span class="p">:</span>
    <span class="c1"># Record that unit went through this process</span>
    <span class="c1"># (actual method depends on Production API)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2"> processed through </span><span class="si">{</span><span class="n">test_op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="using-processes-in-reports">Using Processes in Reports</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># When creating UUT reports, reference the operation</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>

<span class="c1"># Get operation</span>
<span class="n">operation</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;FCT&quot;</span><span class="p">)</span>

<span class="c1"># Create report with operation reference</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">operation_type_code</span><span class="o">=</span><span class="n">operation</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>  <span class="c1"># Reference operation</span>
    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;FCT-01&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit report</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<h3 id="validation-helper">Validation Helper</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_operation_code</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that an operation code exists&quot;&quot;&quot;</span>

    <span class="n">operation</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Valid operation: </span><span class="si">{</span><span class="n">operation</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">operation</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úó Invalid operation code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Use it</span>
<span class="n">validate_operation_code</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>  <span class="c1"># Valid</span>
<span class="n">validate_operation_code</span><span class="p">(</span><span class="s2">&quot;INVALID&quot;</span><span class="p">)</span>  <span class="c1"># Invalid</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="operation-lookup-table">Operation Lookup Table</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_operation_lookup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build quick lookup table for operations&quot;&quot;&quot;</span>

    <span class="c1"># Get all operations</span>
    <span class="n">all_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_all_operations</span><span class="p">()</span>

    <span class="c1"># Build lookup by code</span>
    <span class="n">by_code</span> <span class="o">=</span> <span class="p">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="p">:</span> <span class="n">op</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">all_ops</span><span class="p">}</span>

    <span class="c1"># Build lookup by name (lowercase for case-insensitive)</span>
    <span class="n">by_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">op</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">all_ops</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">by_code</span><span class="p">,</span> <span class="n">by_name</span>

<span class="c1"># Use it</span>
<span class="n">code_lookup</span><span class="p">,</span> <span class="n">name_lookup</span> <span class="o">=</span> <span class="n">build_operation_lookup</span><span class="p">()</span>

<span class="c1"># Fast lookups</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">code_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>
<span class="n">fct</span> <span class="o">=</span> <span class="n">name_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;functional test&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ICT: </span><span class="si">{</span><span class="n">ict</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">ict</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not found&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FCT: </span><span class="si">{</span><span class="n">fct</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">fct</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not found&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="process-type-report">Process Type Report</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_type_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate report of operations by type&quot;&quot;&quot;</span>

    <span class="n">all_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_all_operations</span><span class="p">()</span>

    <span class="c1"># Group by type</span>
    <span class="n">by_type</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">all_ops</span><span class="p">:</span>
        <span class="n">op_type</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">process_type</span>
        <span class="k">if</span> <span class="n">op_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_type</span><span class="p">:</span>
            <span class="n">by_type</span><span class="p">[</span><span class="n">op_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">by_type</span><span class="p">[</span><span class="n">op_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PROCESS TYPE REPORT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">op_type</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_type</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="n">by_type</span><span class="p">[</span><span class="n">op_type</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">op_type</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span><span class="si">}</span><span class="s2"> operations):&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ops</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">code</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_ops</span><span class="p">)</span><span class="si">}</span><span class="s2"> operations&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">process_type_report</span><span class="p">()</span>
</code></pre></div>

<h3 id="find-operations-by-prefix">Find Operations by Prefix</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_operations_by_prefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find operations with codes starting with prefix&quot;&quot;&quot;</span>

    <span class="n">all_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_all_operations</span><span class="p">()</span>

    <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">op</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">all_ops</span> 
        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== OPERATIONS STARTING WITH &#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">matching</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">process_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">find_operations_by_prefix</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>  <span class="c1"># All test operations</span>
<span class="n">find_operations_by_prefix</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>  <span class="c1"># All repair operations</span>
</code></pre></div>

<h3 id="operation-usage-tracking">Operation Usage Tracking</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">track_operation_usage</span><span class="p">(</span><span class="n">operation_code</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Track how often an operation is used in reports&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="c1"># Verify operation exists</span>
    <span class="n">operation</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="n">operation_code</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">operation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation &#39;</span><span class="si">{</span><span class="n">operation_code</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Query reports with this operation using OData</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
        <span class="n">odata_filter</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;processCode eq </span><span class="si">{</span><span class="n">operation_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="mi">1000</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== USAGE: </span><span class="si">{</span><span class="n">operation</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">operation</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Period: Last </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reports: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Breakdown by station</span>
    <span class="n">by_station</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">station</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">station_name</span>
        <span class="n">by_station</span><span class="p">[</span><span class="n">station</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_station</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">By Station:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_station</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">track_operation_usage</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>

<h3 id="cached-access-pattern">Cached Access Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessCache</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for cached process access with fallback&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_or_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get operation with local cache layer&quot;&quot;&quot;</span>

        <span class="c1"># Check local cache first</span>
        <span class="k">if</span> <span class="n">code_or_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">code_or_name</span><span class="p">]</span>

        <span class="c1"># Get from API (uses API&#39;s cache)</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">)</span>

        <span class="c1"># Store in local cache</span>
        <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">code_or_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">operation</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">operation</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span>

        <span class="k">return</span> <span class="n">operation</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear local cache&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="c1"># Use it</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">ProcessCache</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>

<span class="c1"># First access - loads from API</span>
<span class="n">op1</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>

<span class="c1"># Second access - uses local cache</span>
<span class="n">op2</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>

<span class="c1"># Clear when needed</span>
<span class="n">cache</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="practical-examples">Practical Examples</h2>
<h3 id="operation-type-filtering-with-validation">Operation Type Filtering with Validation</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">PyWATSError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_valid_operation_code</span><span class="p">(</span>
    <span class="n">api</span><span class="p">,</span> 
    <span class="n">operation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">code_or_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a validated operation code for the specified type.</span>

<span class="sd">    Useful for report submission where you need to ensure</span>
<span class="sd">    the operation code matches the expected type.</span>

<span class="sd">    Args:</span>
<span class="sd">        api: pyWATS API instance</span>
<span class="sd">        operation_type: &quot;test&quot;, &quot;repair&quot;, or &quot;wip&quot;</span>
<span class="sd">        code_or_name: Operation code (int) or name (str)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Valid operation code or None if invalid</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; code = get_valid_operation_code(api, &quot;test&quot;, &quot;ICT&quot;)</span>
<span class="sd">        &gt;&gt;&gt; if code:</span>
<span class="sd">        ...     report.process_code = code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">type_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">,</span>
        <span class="s2">&quot;repair&quot;</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">,</span>
        <span class="s2">&quot;wip&quot;</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operation</span>
    <span class="p">}</span>

    <span class="n">get_method</span> <span class="o">=</span> <span class="n">type_methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operation_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">get_method</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid operation_type: </span><span class="si">{</span><span class="n">operation_type</span><span class="si">}</span><span class="s2">. Use &#39;test&#39;, &#39;repair&#39;, or &#39;wip&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Handle int or str input</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">)</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">code_or_name</span>

    <span class="n">operation</span> <span class="o">=</span> <span class="n">get_method</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">code</span> <span class="k">if</span> <span class="n">operation</span> <span class="k">else</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">list_operations_by_type</span><span class="p">(</span><span class="n">api</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Group all operations by their type for easy reference.</span>

<span class="sd">    Returns dict like:</span>
<span class="sd">    {</span>
<span class="sd">        &quot;test&quot;: [{&quot;code&quot;: 100, &quot;name&quot;: &quot;ICT&quot;}, ...],</span>
<span class="sd">        &quot;repair&quot;: [{&quot;code&quot;: 500, &quot;name&quot;: &quot;Rework&quot;}, ...],</span>
<span class="sd">        &quot;wip&quot;: [{&quot;code&quot;: 200, &quot;name&quot;: &quot;Assembly&quot;}, ...]</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> 
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operations</span><span class="p">()</span>
        <span class="p">],</span>
        <span class="s2">&quot;repair&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> 
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operations</span><span class="p">()</span>
        <span class="p">],</span>
        <span class="s2">&quot;wip&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> 
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operations</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">}</span>

<span class="c1"># Usage</span>
<span class="n">ops_by_type</span> <span class="o">=</span> <span class="n">list_operations_by_type</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available Test Operations:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ops_by_type</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Validate before report submission</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">get_valid_operation_code</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;ICT&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">code</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using operation code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> for test report&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: ICT operation not found, using default&quot;</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_default_test_code</span><span class="p">()</span>
</code></pre></div>

<h3 id="smart-process-cache-with-prefetch">Smart Process Cache with Prefetch</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SmartProcessCache</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enhanced process cache with prefetch and usage tracking.</span>

<span class="sd">    Features:</span>
<span class="sd">    - Prefetches commonly used operations on init</span>
<span class="sd">    - Tracks usage for analytics</span>
<span class="sd">    - Thread-safe with automatic refresh</span>
<span class="sd">    - Configurable stale threshold</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">stale_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale_threshold</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">stale_minutes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># key -&gt; (operation, timestamp)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usage_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prefetch_common</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prefetch_common</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prefetch common operation types&quot;&quot;&quot;</span>
        <span class="n">common_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>  <span class="c1"># Default test and repair</span>
        <span class="n">common_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ICT&quot;</span><span class="p">,</span> <span class="s2">&quot;FCT&quot;</span><span class="p">,</span> <span class="s2">&quot;Rework&quot;</span><span class="p">,</span> <span class="s2">&quot;Assembly&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">common_codes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_cache</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">common_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_cache</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_and_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch operation and update cache&quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="c1"># Cache by code and name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">op</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_stale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if cached entry is stale&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stale_threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_or_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get operation with smart caching.</span>

<span class="sd">        Args:</span>
<span class="sd">            code_or_name: Operation code (int) or name (str)</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProcessInfo or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
                <span class="n">op</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="c1"># Track usage</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_usage_count</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_usage_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># Return if fresh</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_stale</span><span class="p">(</span><span class="n">timestamp</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">op</span>

        <span class="c1"># Refresh stale or missing entry</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_cache</span><span class="p">(</span><span class="n">code_or_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_usage_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get operation usage statistics&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_usage_count</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Force refresh of all cached operations&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_cache</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="c1"># Usage</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">SmartProcessCache</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">stale_minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Fast cached access</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ICT&quot;</span><span class="p">)</span>  <span class="c1"># Uses cache if fresh</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>    <span class="c1"># Also cached</span>

<span class="c1"># Check what&#39;s being used most</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Operation usage stats:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_usage_stats</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> lookups&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="test-workflow-with-operation-validation">Test Workflow with Operation Validation</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowStage</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard test workflow stages&quot;&quot;&quot;</span>
    <span class="n">ICT</span> <span class="o">=</span> <span class="s2">&quot;ICT&quot;</span>          <span class="c1"># In-Circuit Test</span>
    <span class="n">FCT</span> <span class="o">=</span> <span class="s2">&quot;FCT&quot;</span>          <span class="c1"># Functional Test</span>
    <span class="n">BURN_IN</span> <span class="o">=</span> <span class="s2">&quot;BURN_IN&quot;</span>  <span class="c1"># Burn-in / Stress Test</span>
    <span class="n">FVT</span> <span class="o">=</span> <span class="s2">&quot;FVT&quot;</span>          <span class="c1"># Final Verification Test</span>
    <span class="n">REPAIR</span> <span class="o">=</span> <span class="s2">&quot;REPAIR&quot;</span>    <span class="c1"># Repair/Rework</span>
    <span class="n">PACK</span> <span class="o">=</span> <span class="s2">&quot;PACK&quot;</span>        <span class="c1"># Packaging</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for a test workflow&quot;&quot;&quot;</span>
    <span class="n">stages</span><span class="p">:</span> <span class="nb">list</span>  <span class="c1"># List of WorkflowStage</span>
    <span class="n">operation_codes</span><span class="p">:</span> <span class="nb">dict</span>  <span class="c1"># Stage -&gt; operation code mapping</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_workflow</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">stages</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a validated workflow configuration.</span>

<span class="sd">    Ensures all specified stages have valid operation codes</span>
<span class="sd">    configured in the WATS system.</span>

<span class="sd">    Args:</span>
<span class="sd">        api: pyWATS API instance</span>
<span class="sd">        stages: List of WorkflowStage values</span>

<span class="sd">    Returns:</span>
<span class="sd">        WorkflowConfig with validated operation codes</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any stage doesn&#39;t have a matching operation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">operation_codes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">:</span>
        <span class="c1"># Try to find matching operation</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">REPAIR</span><span class="p">:</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">op</span><span class="p">:</span>
            <span class="n">operation_codes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try by code for common defaults</span>
            <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">ICT</span><span class="p">:</span>
                <span class="n">operation_codes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Common ICT code</span>
            <span class="k">elif</span> <span class="n">stage</span> <span class="o">==</span> <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">REPAIR</span><span class="p">:</span>
                <span class="n">operation_codes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Common repair code</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="n">available</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing operations for stages: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Available: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">WorkflowConfig</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="n">stages</span><span class="p">,</span> <span class="n">operation_codes</span><span class="o">=</span><span class="n">operation_codes</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_workflow_stage</span><span class="p">(</span>
    <span class="n">api</span><span class="p">,</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="n">WorkflowConfig</span><span class="p">,</span>
    <span class="n">stage</span><span class="p">:</span> <span class="n">WorkflowStage</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute a workflow stage and return result.</span>

<span class="sd">    Args:</span>
<span class="sd">        api: pyWATS API instance</span>
<span class="sd">        workflow: Validated WorkflowConfig</span>
<span class="sd">        stage: Stage to execute</span>
<span class="sd">        serial_number: Unit under test serial number</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict with stage execution details</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stage</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">workflow</span><span class="o">.</span><span class="n">stages</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stage </span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2"> not in workflow&quot;</span><span class="p">)</span>

    <span class="n">operation_code</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">operation_codes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
    <span class="n">operation</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process_by_code</span><span class="p">(</span><span class="n">operation_code</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;operation_code&quot;</span><span class="p">:</span> <span class="n">operation_code</span><span class="p">,</span>
        <span class="s2">&quot;operation_name&quot;</span><span class="p">:</span> <span class="n">operation</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">operation</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
        <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="n">serial_number</span><span class="p">,</span>
        <span class="s2">&quot;ready&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

<span class="c1"># Usage: Define and validate a workflow</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">build_workflow</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="p">[</span>
    <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">ICT</span><span class="p">,</span>
    <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">FCT</span><span class="p">,</span>
    <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">FVT</span>
<span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workflow Configuration:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">workflow</span><span class="o">.</span><span class="n">operation_codes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process_by_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Execute stage</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">run_workflow_stage</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">WorkflowStage</span><span class="o">.</span><span class="n">ICT</span><span class="p">,</span> <span class="s2">&quot;UNIT-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ready to run </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;operation_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;serial_number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="processservice-methods">ProcessService Methods</h3>
<h4 id="operation-queries">Operation Queries</h4>
<ul>
<li><code>get_operation(code_or_name)</code> ‚Üí <code>Optional[ProcessInfo]</code> - Get operation by code or name</li>
<li><code>get_test_operation(code_or_name)</code> ‚Üí <code>Optional[ProcessInfo]</code> - Get test operation</li>
<li><code>get_repair_operation(code_or_name)</code> ‚Üí <code>Optional[ProcessInfo]</code> - Get repair operation</li>
<li><code>get_all_operations()</code> ‚Üí <code>List[ProcessInfo]</code> - Get all operations (from cache)</li>
</ul>
<h4 id="cache-management_1">Cache Management</h4>
<ul>
<li><code>refresh()</code> ‚Üí <code>None</code> - Force cache refresh</li>
<li><code>refresh_interval</code> ‚Üí <code>int</code> - Get/set refresh interval in seconds</li>
<li><code>last_refresh</code> ‚Üí <code>datetime</code> - Get last refresh timestamp</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="processinfo">ProcessInfo</h4>
<ul>
<li><code>id</code>: int - Process ID</li>
<li><code>name</code>: str - Operation name</li>
<li><code>code</code>: str - Short code</li>
<li><code>process_type</code>: str - Type (TEST, REPAIR, etc.)</li>
<li><code>description</code>: str - Operation description</li>
</ul>
<h3 id="cache-behavior">Cache Behavior</h3>
<ul>
<li><strong>Default Refresh</strong>: 300 seconds (5 minutes)</li>
<li><strong>Auto-Refresh</strong>: When cache age exceeds refresh_interval</li>
<li><strong>Thread-Safe</strong>: Uses threading.Lock for concurrent access</li>
<li><strong>Read-Only</strong>: Process definitions are read-only via API</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Use the cache</strong> - Don't bypass caching for frequent lookups</li>
<li><strong>Set appropriate interval</strong> - Balance freshness vs performance</li>
<li><strong>Lookup by code</strong> - Codes are more stable than names</li>
<li><strong>Validate codes</strong> - Check operation exists before using</li>
<li><strong>Refresh on startup</strong> - Ensure cache is fresh when application starts</li>
<li><strong>Monitor cache age</strong> - Track when last refresh occurred</li>
<li><strong>Use in reports</strong> - Reference operation codes in test reports</li>
<li><strong>Handle missing operations</strong> - Gracefully handle unknown codes</li>
</ol>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="report.md">Report Domain</a> - Use operation codes in test reports</li>
<li><a href="production.md">Production Domain</a> - Track operations performed on units</li>
<li><a href="analytics.md">Analytics Domain</a> - Analyze data by operation type</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-product">
    <div class="doc-source">Source: docs/modules/product.md</div>
    <h1 id="product-domain">Product Domain</h1>
<p>The Product domain manages product catalog data including product definitions, revisions, bills of materials (BOM), product groups, vendors, and box build templates. This domain is essential for defining WHAT you manufacture before you can track units in production.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#product-operations">Product Operations</a></li>
<li><a href="#revision-management">Revision Management</a></li>
<li><a href="#bill-of-materials-bom">Bill of Materials (BOM)</a></li>
<li><a href="#box-build-templates">Box Build Templates</a></li>
<li><a href="#product-groups">Product Groups</a></li>
<li><a href="#tags-and-metadata">Tags and Metadata</a></li>
<li><a href="#vendors">Vendors</a></li>
<li><a href="#product-categories">Product Categories</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize the API</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get all products</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get a specific product with full details</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create a new product</span>
<span class="n">new_product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-002&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Advanced Widget&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Next generation widget with AI capabilities&quot;</span>
<span class="p">)</span>

<span class="c1"># Create a revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-002&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Initial Release&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;First production version&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">manage_products</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Get product and its revisions concurrently</span>
        <span class="n">product</span><span class="p">,</span> <span class="n">revisions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Revisions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">revisions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">manage_products</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="product">Product</h3>
<p>A <strong>Product</strong> represents a manufactured item in your catalog. It's identified by a unique part number and can have multiple revisions.</p>
<p><strong>Key attributes:</strong><br />
- <code>part_number</code>: Unique identifier (e.g., "WIDGET-001")<br />
- <code>name</code>: Human-readable product name<br />
- <code>description</code>: Detailed description<br />
- <code>state</code>: ACTIVE or INACTIVE<br />
- <code>non_serial</code>: If True, units don't have serial numbers</p>
<h3 id="product-revision">Product Revision</h3>
<p>A <strong>ProductRevision</strong> represents a specific version or iteration of a product. Different revisions might have different components, specifications, or manufacturing processes.</p>
<p><strong>Key attributes:</strong><br />
- <code>part_number</code>: Parent product identifier<br />
- <code>revision</code>: Revision identifier (e.g., "A", "1.0", "rev2")<br />
- <code>name</code>: Revision name<br />
- <code>description</code>: What changed in this revision<br />
- <code>state</code>: ACTIVE or INACTIVE</p>
<h3 id="product-view">Product View</h3>
<p>A simplified view of a product containing only essential fields. Used for listings where full detail isn't needed.</p>
<hr />
<h2 id="product-operations">Product Operations</h2>
<h3 id="list-all-products">List All Products</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get simplified product views (faster, less data)</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

<span class="c1"># Get full product details (includes all fields)</span>
<span class="n">products_full</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products_full</span><span class="p">()</span>
<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products_full</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">product_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">created</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Modified: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">modified</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-active-products-only">Get Active Products Only</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Filter for active products only</span>
<span class="n">active_products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_active_products</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">active_products</span><span class="p">)</span><span class="si">}</span><span class="s2"> active products&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-specific-product">Get Specific Product</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get product by part number</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">product</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part Number: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Non-Serial: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">non_serial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Revision: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product not found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="create-new-product">Create New Product</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># Create a basic product</span>
<span class="n">new_product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;MAIN-BOARD-001&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Main Circuit Board&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Primary control board for XYZ system&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>

<span class="c1"># Create a non-serial product (consumables, bulk items)</span>
<span class="n">consumable</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;SCREW-M3-10MM&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;M3 x 10mm Screw&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Stainless steel machine screw&quot;</span><span class="p">,</span>
    <span class="n">non_serial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># No serial number tracking</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>

<span class="c1"># Create with custom XML data for key-value storage</span>
<span class="n">product_with_metadata</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-003&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Special Widget&quot;</span><span class="p">,</span>
    <span class="n">xml_data</span><span class="o">=</span><span class="s1">&#39;&lt;data&gt;&lt;color&gt;blue&lt;/color&gt;&lt;weight&gt;1.5kg&lt;/weight&gt;&lt;/data&gt;&#39;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="update-existing-product">Update Existing Product</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get the product</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="c1"># Modify fields</span>
<span class="n">product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Updated Widget Name&quot;</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;New and improved description&quot;</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>

<span class="c1"># Save changes</span>
<span class="n">updated_product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_product</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated: </span><span class="si">{</span><span class="n">updated_product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="bulk-createupdate-products">Bulk Create/Update Products</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">Product</span>

<span class="c1"># Create multiple products at once</span>
<span class="n">products</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Product</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;BATCH-001&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Batch Product 1&quot;</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
    <span class="p">),</span>
    <span class="n">Product</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;BATCH-002&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Batch Product 2&quot;</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
    <span class="p">),</span>
    <span class="n">Product</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;BATCH-003&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Batch Product 3&quot;</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Bulk save</span>
<span class="n">saved_products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">bulk_save_products</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">saved_products</span><span class="p">)</span><span class="si">}</span><span class="s2"> products&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="check-product-state">Check Product State</h3>
<div class="codehilite"><pre><span></span><code><span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="c1"># Check if product is active</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">is_active</span><span class="p">(</span><span class="n">product</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product is active and can be used in production&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product is inactive&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="revision-management">Revision Management</h2>
<h3 id="list-product-revisions">List Product Revisions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all revisions for a product</span>
<span class="n">revisions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Revision History:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rev</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">revisions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">revision</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">rev</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">rev</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;No description&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rev</span><span class="o">.</span><span class="n">effective_date</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Effective: </span><span class="si">{</span><span class="n">rev</span><span class="o">.</span><span class="n">effective_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-specific-revision">Get Specific Revision</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get a specific revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">revision</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Revision: </span><span class="si">{</span><span class="n">revision</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">revision</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">revision</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">revision</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">revision</span><span class="o">.</span><span class="n">created</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="create-new-revision">Create New Revision</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a new revision</span>
<span class="n">new_revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Cost Reduction&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Redesigned for lower manufacturing cost&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created revision: </span><span class="si">{</span><span class="n">new_revision</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="update-revision">Update Revision</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get the revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>

<span class="c1"># Modify</span>
<span class="n">revision</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Updated description&quot;</span>
<span class="n">revision</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Updated Name&quot;</span>

<span class="c1"># Save</span>
<span class="n">updated_revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_revision</span><span class="p">(</span><span class="n">revision</span><span class="p">)</span>
</code></pre></div>

<h3 id="bulk-createupdate-revisions">Bulk Create/Update Revisions</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductRevision</span>

<span class="c1"># Get the product first to get product_id</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="c1"># Create multiple revisions</span>
<span class="n">revisions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ProductRevision</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rev D&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Feature enhancement&quot;</span><span class="p">,</span>
        <span class="n">product_id</span><span class="o">=</span><span class="n">product</span><span class="o">.</span><span class="n">product_id</span>
    <span class="p">),</span>
    <span class="n">ProductRevision</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;E&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rev E&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Bug fix&quot;</span><span class="p">,</span>
        <span class="n">product_id</span><span class="o">=</span><span class="n">product</span><span class="o">.</span><span class="n">product_id</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Bulk save</span>
<span class="n">saved_revisions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">bulk_save_revisions</span><span class="p">(</span><span class="n">revisions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">saved_revisions</span><span class="p">)</span><span class="si">}</span><span class="s2"> revisions&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="bill-of-materials-bom">Bill of Materials (BOM)</h2>
<p>The BOM defines the components and raw materials needed to manufacture a product revision.</p>
<h3 id="get-bom">Get BOM</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get BOM as raw WSBF XML string</span>
<span class="n">bom_xml</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">bom_xml</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BOM XML length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">bom_xml</span><span class="p">)</span><span class="si">}</span><span class="s2"> characters&quot;</span><span class="p">)</span>

<span class="c1"># Get BOM as structured list of items</span>
<span class="n">bom_items</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom_items</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bill of Materials for WIDGET-001 Rev A:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bom_items</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> Rev </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Quantity: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Reference: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">reference_designator</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Description: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="update-bom">Update BOM</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">BomItem</span>

<span class="c1"># Define BOM items</span>
<span class="n">bom_items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BomItem</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;RESISTOR-10K&quot;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">reference_designator</span><span class="o">=</span><span class="s2">&quot;R1,R2,R3,R4,R5&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;10K ohm resistor&quot;</span>
    <span class="p">),</span>
    <span class="n">BomItem</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CAPACITOR-100UF&quot;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">reference_designator</span><span class="o">=</span><span class="s2">&quot;C1,C2&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;100uF electrolytic capacitor&quot;</span>
    <span class="p">),</span>
    <span class="n">BomItem</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;IC-MICROCONTROLLER&quot;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">reference_designator</span><span class="o">=</span><span class="s2">&quot;U1&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Main microcontroller&quot;</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Update the BOM</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_bom</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">bom_items</span><span class="o">=</span><span class="n">bom_items</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Updated BOM for cost reduction&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BOM updated successfully&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="box-build-templates">Box Build Templates</h2>
<p>‚ö†Ô∏è <strong>INTERNAL API - Subject to change</strong></p>
<p>Box build templates define PRODUCT-LEVEL relationships - what subunits are REQUIRED to build a product. This is different from production-level assembly (which is in the Production domain).</p>
<p><strong>Use Cases:</strong><br />
- Define product structure (parent-child relationships)<br />
- Specify which subassemblies make up a final product<br />
- Track component quantities needed</p>
<p><strong>Important:</strong> This is a DESIGN-TIME definition. To attach actual physical units during production, use <code>api.production.add_child_to_assembly()</code>.</p>
<h3 id="get-box-build-template">Get Box Build Template</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get or create a box build template</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MAIN-ASSEMBLY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Box Build Template for </span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> Rev </span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current subunits: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="add-subunits-to-template">Add Subunits to Template</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get the template</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MAIN-ASSEMBLY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Add subunits (components that make up this product)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PSU-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;ENCLOSURE&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Save changes to server</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template updated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">)</span><span class="si">}</span><span class="s2"> subunits&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="list-template-subunits">List Template Subunits</h3>
<div class="codehilite"><pre><span></span><code><span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MAIN-ASSEMBLY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Required subunits:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">subunit</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">child_part_number</span><span class="si">}</span><span class="s2"> Rev </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">child_revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Quantity: </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="update-subunit-quantity">Update Subunit Quantity</h3>
<div class="codehilite"><pre><span></span><code><span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MAIN-ASSEMBLY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Update quantity for a subunit</span>
<span class="n">template</span><span class="o">.</span><span class="n">update_subunit</span><span class="p">(</span><span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Changed from 3 to 5</span>

<span class="c1"># Save changes</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h3 id="remove-subunit-from-template">Remove Subunit from Template</h3>
<div class="codehilite"><pre><span></span><code><span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MAIN-ASSEMBLY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Remove a subunit</span>
<span class="n">template</span><span class="o">.</span><span class="n">remove_subunit</span><span class="p">(</span><span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span>

<span class="c1"># Save changes</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h3 id="complete-box-build-example">Complete Box Build Example</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Define a complete product structure</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;LAPTOP-X1&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Add all required components</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;MOTHERBOARD&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;SCREEN-15INCH&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;KEYBOARD-US&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;BATTERY-PACK&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;RAM-8GB&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 2 x 8GB modules</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;SSD-512GB&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Save all at once</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Laptop structure defined with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">)</span><span class="si">}</span><span class="s2"> components&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="product-groups">Product Groups</h2>
<p>Product groups allow you to organize products into logical categories for reporting and filtering.</p>
<h3 id="list-all-product-groups">List All Product Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all product groups</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_groups</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product Groups:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">group</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;No description&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="filter-product-groups">Filter Product Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get groups with OData filter</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_groups</span><span class="p">(</span>
    <span class="n">filter_str</span><span class="o">=</span><span class="s2">&quot;contains(name,&#39;Electronics&#39;)&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="get-groups-for-specific-product">Get Groups for Specific Product</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all groups that include this product</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_groups_for_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product WIDGET-001 Rev A belongs to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="tags-and-metadata">Tags and Metadata</h2>
<p>Tags provide key-value metadata storage for products and revisions. Useful for custom attributes, classifications, or integration data.</p>
<h3 id="product-tags">Product Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all tags for a product</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_tags</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product Tags:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Add a single tag</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ManufacturingLocation&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Factory-A&quot;</span>
<span class="p">)</span>

<span class="c1"># Set multiple tags at once (replaces all existing tags)</span>
<span class="n">new_tags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Electronics&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;RoHS&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Compliant&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;LeadTime&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2-weeks&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">set_product_tags</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="n">new_tags</span><span class="p">)</span>
</code></pre></div>

<h3 id="revision-tags">Revision Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get tags for a specific revision</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision_tags</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Revision Tags:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Add a revision-specific tag</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_revision_tag</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ECO&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;ECO-2024-0542&quot;</span>
<span class="p">)</span>

<span class="c1"># Set multiple revision tags</span>
<span class="n">revision_tags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;ApprovalDate&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-15&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;ApprovedBy&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;J.Smith&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">set_revision_tags</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">revision_tags</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="vendors">Vendors</h2>
<p>Manage vendor information for procurement and supply chain tracking.</p>
<h3 id="list-vendors">List Vendors</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all vendors</span>
<span class="n">vendors</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_vendors</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendors:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">vendor</span> <span class="ow">in</span> <span class="n">vendors</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">vendor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Contact: </span><span class="si">{</span><span class="n">vendor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contact&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Email: </span><span class="si">{</span><span class="n">vendor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="createupdate-vendor">Create/Update Vendor</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a new vendor</span>
<span class="n">vendor_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Acme Components Inc.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;contact&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;sales@acmecomponents.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phone&quot;</span><span class="p">:</span> <span class="s2">&quot;+1-555-0123&quot;</span><span class="p">,</span>
    <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;123 Industrial Pkwy, Tech City, TC 12345&quot;</span>
<span class="p">}</span>

<span class="n">saved_vendor</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">save_vendor</span><span class="p">(</span><span class="n">vendor_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created vendor: </span><span class="si">{</span><span class="n">saved_vendor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Update existing vendor (include vendor ID)</span>
<span class="n">vendor_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;vendorId&quot;</span><span class="p">:</span> <span class="s2">&quot;existing-vendor-id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Acme Components Inc.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;contact&quot;</span><span class="p">:</span> <span class="s2">&quot;Jane Smith&quot;</span><span class="p">,</span>  <span class="c1"># Updated contact</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;newsales@acmecomponents.com&quot;</span>  <span class="c1"># Updated email</span>
<span class="p">}</span>

<span class="n">updated_vendor</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">save_vendor</span><span class="p">(</span><span class="n">vendor_data</span><span class="p">)</span>
</code></pre></div>

<h3 id="delete-vendor">Delete Vendor</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete a vendor</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">delete_vendor</span><span class="p">(</span><span class="s2">&quot;vendor-id-to-delete&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor deleted&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="product-categories">Product Categories</h2>
<p>‚ö†Ô∏è <strong>INTERNAL API - Subject to change</strong></p>
<p>Categories provide another way to classify products.</p>
<h3 id="get-product-categories">Get Product Categories</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all categories</span>
<span class="n">categories</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_categories</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product Categories:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ID: </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="assign-categories-to-product">Assign Categories to Product</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set categories for a product (by category IDs)</span>
<span class="n">category_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;cat-id-1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cat-id-2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cat-id-3&quot;</span>
<span class="p">]</span>

<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">save_product_categories</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="n">category_ids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Categories assigned to product&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="complete-product-lifecycle">Complete Product Lifecycle</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># 1. Create the product</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-WIDGET&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Next Generation Widget&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Revolutionary new design&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>

<span class="c1"># 2. Create initial revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-WIDGET&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Prototype&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Initial prototype version&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>

<span class="c1"># 3. Define BOM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">BomItem</span>

<span class="n">bom</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BomItem</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;COMPONENT-1&quot;</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">BomItem</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;COMPONENT-2&quot;</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_bom</span><span class="p">(</span><span class="s2">&quot;NEW-WIDGET&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">bom</span><span class="p">)</span>

<span class="c1"># 4. Add to product group</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_groups</span><span class="p">(</span><span class="n">filter_str</span><span class="o">=</span><span class="s2">&quot;name eq &#39;New Products&#39;&quot;</span><span class="p">)</span>
<span class="c1"># (Groups are managed via WATS UI or separate API)</span>

<span class="c1"># 5. Add metadata tags</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;NEW-WIDGET&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;In Development&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_revision_tag</span><span class="p">(</span><span class="s2">&quot;NEW-WIDGET&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;TestPhase&quot;</span><span class="p">,</span> <span class="s2">&quot;Alpha&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product lifecycle setup complete!&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="product-family-management">Product Family Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Define a product family with common base</span>
<span class="n">base_products</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WIDGET-BASE&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-PLUS&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-PRO&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">pn</span> <span class="ow">in</span> <span class="n">base_products</span><span class="p">:</span>
    <span class="c1"># Check if product exists</span>
    <span class="n">existing</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
        <span class="c1"># Create if doesn&#39;t exist</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pn</span><span class="si">}</span><span class="s2"> Product&quot;</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
        <span class="p">)</span>

        <span class="c1"># Create initial revision</span>
        <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span>
            <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Initial Release&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Tag with family membership</span>
        <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="s2">&quot;ProductFamily&quot;</span><span class="p">,</span> <span class="s2">&quot;Widget Series&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="n">pn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pn</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="migrationimport-helper">Migration/Import Helper</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">import_products_from_csv</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Import products from CSV file&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

    <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
                <span class="n">part_number</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;part_number&#39;</span><span class="p">],</span>
                <span class="n">name</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
                <span class="c1"># Create default revision</span>
                <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
                    <span class="n">part_number</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;part_number&#39;</span><span class="p">],</span>
                    <span class="n">revision</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;revision&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;revision_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Initial&#39;</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">products</span>

<span class="c1"># Use it</span>
<span class="n">imported</span> <span class="o">=</span> <span class="n">import_products_from_csv</span><span class="p">(</span><span class="s1">&#39;products.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imported </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">imported</span><span class="p">)</span><span class="si">}</span><span class="s2"> products&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="productservice-methods">ProductService Methods</h3>
<h4 id="product-operations_1">Product Operations</h4>
<ul>
<li><code>get_products()</code> ‚Üí <code>List[ProductView]</code> - Get all products as simplified views</li>
<li><code>get_products_full()</code> ‚Üí <code>List[Product]</code> - Get all products with full details</li>
<li><code>get_product(part_number)</code> ‚Üí <code>Optional[Product]</code> - Get specific product</li>
<li><code>get_products_batch(part_numbers, max_workers=10)</code> ‚Üí <code>List[Result[Product]]</code> - Fetch multiple products concurrently</li>
<li><code>create_product(...)</code> ‚Üí <code>Optional[Product]</code> - Create new product</li>
<li><code>update_product(product)</code> ‚Üí <code>Optional[Product]</code> - Update existing product</li>
<li><code>bulk_save_products(products)</code> ‚Üí <code>List[Product]</code> - Bulk create/update</li>
<li><code>is_active(product)</code> ‚Üí <code>bool</code> - Check if product is active</li>
<li><code>get_active_products()</code> ‚Üí <code>List[ProductView]</code> - Get only active products</li>
</ul>
<h4 id="revision-operations">Revision Operations</h4>
<ul>
<li><code>get_revision(part_number, revision)</code> ‚Üí <code>Optional[ProductRevision]</code> - Get specific revision</li>
<li><code>get_revisions(part_number)</code> ‚Üí <code>List[ProductRevision]</code> - Get all revisions for product</li>
<li><code>get_revisions_batch(pairs, max_workers=10)</code> ‚Üí <code>List[Result[ProductRevision]]</code> - Fetch multiple revisions concurrently (pairs = list of (part_number, revision) tuples)</li>
<li><code>create_revision(...)</code> ‚Üí <code>Optional[ProductRevision]</code> - Create new revision</li>
<li><code>update_revision(revision)</code> ‚Üí <code>Optional[ProductRevision]</code> - Update existing revision</li>
<li><code>bulk_save_revisions(revisions)</code> ‚Üí <code>List[ProductRevision]</code> - Bulk create/update</li>
</ul>
<h4 id="bom-operations">BOM Operations</h4>
<ul>
<li><code>get_bom(part_number, revision)</code> ‚Üí <code>Optional[str]</code> - Get BOM as WSBF XML</li>
<li><code>get_bom_items(part_number, revision)</code> ‚Üí <code>List[BomItem]</code> - Get BOM as structured items</li>
<li><code>update_bom(part_number, revision, bom_items, description)</code> ‚Üí <code>bool</code> - Update BOM</li>
</ul>
<h4 id="group-operations">Group Operations</h4>
<ul>
<li><code>get_groups(filter_str, top)</code> ‚Üí <code>List[ProductGroup]</code> - Get product groups</li>
<li><code>get_groups_for_product(part_number, revision)</code> ‚Üí <code>List[ProductGroup]</code> - Get groups for product</li>
</ul>
<h4 id="tag-operations">Tag Operations</h4>
<ul>
<li><code>get_product_tags(part_number)</code> ‚Üí <code>List[Dict[str, str]]</code> - Get product tags</li>
<li><code>set_product_tags(part_number, tags)</code> ‚Üí <code>Optional[Product]</code> - Set product tags</li>
<li><code>add_product_tag(part_number, key, value)</code> ‚Üí <code>Optional[Product]</code> - Add single tag</li>
<li><code>get_revision_tags(part_number, revision)</code> ‚Üí <code>List[Dict[str, str]]</code> - Get revision tags</li>
<li><code>set_revision_tags(part_number, revision, tags)</code> ‚Üí <code>Optional[ProductRevision]</code> - Set revision tags</li>
<li><code>add_revision_tag(part_number, revision, key, value)</code> ‚Üí <code>Optional[ProductRevision]</code> - Add single tag</li>
</ul>
<h4 id="vendor-operations">Vendor Operations</h4>
<ul>
<li><code>get_vendors()</code> ‚Üí <code>List[Dict[str, Any]]</code> - Get all vendors</li>
<li><code>save_vendor(vendor_data)</code> ‚Üí <code>Optional[Dict[str, Any]]</code> - Create/update vendor</li>
<li><code>delete_vendor(vendor_id)</code> ‚Üí <code>bool</code> - Delete vendor</li>
</ul>
<h3 id="productserviceinternal-methods-subject-to-change">ProductServiceInternal Methods (‚ö†Ô∏è Subject to change)</h3>
<h4 id="box-build-operations">Box Build Operations</h4>
<ul>
<li><code>get_box_build(part_number, revision)</code> ‚Üí <code>BoxBuildTemplate</code> - Get/create template</li>
<li><code>get_bom(part_number, revision)</code> ‚Üí <code>List[BomItem]</code> - Get BOM items</li>
<li><code>set_bom(part_number, revision, bom_items)</code> ‚Üí <code>bool</code> - Set BOM items</li>
</ul>
<h4 id="category-operations">Category Operations</h4>
<ul>
<li><code>get_product_categories()</code> ‚Üí <code>List[Dict[str, Any]]</code> - Get all categories</li>
<li><code>set_product_categories(part_number, category_ids)</code> ‚Üí <code>bool</code> - Assign categories</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="product_1">Product</h4>
<ul>
<li><code>product_id</code>: UUID (auto-generated)</li>
<li><code>part_number</code>: str (required, unique)</li>
<li><code>name</code>: Optional[str]</li>
<li><code>description</code>: Optional[str]</li>
<li><code>revision</code>: Optional[str] (current/default revision)</li>
<li><code>state</code>: ProductState (ACTIVE/INACTIVE)</li>
<li><code>non_serial</code>: bool (default False)</li>
<li><code>xml_data</code>: Optional[str] (custom metadata)</li>
<li><code>created</code>: Optional[datetime]</li>
<li><code>modified</code>: Optional[datetime]</li>
</ul>
<h4 id="productrevision">ProductRevision</h4>
<ul>
<li><code>product_revision_id</code>: UUID (auto-generated)</li>
<li><code>product_id</code>: UUID (links to Product)</li>
<li><code>part_number</code>: str</li>
<li><code>revision</code>: str (required)</li>
<li><code>name</code>: Optional[str]</li>
<li><code>description</code>: Optional[str]</li>
<li><code>state</code>: ProductState</li>
<li><code>effective_date</code>: Optional[datetime]</li>
<li><code>xml_data</code>: Optional[str]</li>
<li><code>created</code>: Optional[datetime]</li>
<li><code>modified</code>: Optional[datetime]</li>
</ul>
<h4 id="bomitem">BomItem</h4>
<ul>
<li><code>part_number</code>: str</li>
<li><code>revision</code>: str</li>
<li><code>quantity</code>: int</li>
<li><code>reference_designator</code>: Optional[str]</li>
<li><code>description</code>: Optional[str]</li>
</ul>
<h4 id="productview">ProductView</h4>
<ul>
<li><code>part_number</code>: str</li>
<li><code>name</code>: Optional[str]</li>
<li><code>non_serial</code>: Optional[bool]</li>
<li><code>state</code>: Optional[ProductState]</li>
</ul>
<h4 id="productgroup">ProductGroup</h4>
<ul>
<li><code>product_group_id</code>: UUID</li>
<li><code>name</code>: str</li>
<li><code>description</code>: Optional[str]</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li>
<p><strong>Always create a revision</strong> - Even for the first version, create revision "A" or "1.0"</p>
</li>
<li>
<p><strong>Use meaningful part numbers</strong> - Use a consistent naming scheme (e.g., "WIDGET-001", "PCB-MAIN-V2")</p>
</li>
<li>
<p><strong>Set product state</strong> - Mark obsolete products as INACTIVE rather than deleting them</p>
</li>
<li>
<p><strong>Use tags for custom attributes</strong> - Instead of modifying the database schema, use tags</p>
</li>
<li>
<p><strong>Bulk operations for efficiency</strong> - When importing or updating many products, use bulk methods</p>
</li>
<li>
<p><strong>BOM accuracy</strong> - Keep BOMs up-to-date as product revisions change</p>
</li>
<li>
<p><strong>Box Build vs BOM</strong> - Use BOM for component lists, Box Build for structural relationships</p>
</li>
<li>
<p><strong>Document revisions</strong> - Always include meaningful descriptions when creating revisions</p>
</li>
<li>
<p><strong>Non-serial products</strong> - Mark consumables, bulk items, or non-tracked items as <code>non_serial=True</code></p>
</li>
<li>
<p><strong>Version control</strong> - Use revision tags to track ECOs, approval dates, and change history</p>
</li>
</ol>
<hr />
<h2 id="common-workflows">Common Workflows</h2>
<h3 id="new-product-introduction-npi">New Product Introduction (NPI)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Create product definition</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;New Product Name&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Product description&quot;</span>
<span class="p">)</span>

<span class="c1"># 2. Create engineering sample revision</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;ES&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Engineering Sample&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pre-production samples&quot;</span>
<span class="p">)</span>

<span class="c1"># 3. Tag as NPI</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span> <span class="s2">&quot;Phase&quot;</span><span class="p">,</span> <span class="s2">&quot;NPI&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_revision_tag</span><span class="p">(</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span> <span class="s2">&quot;ES&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Engineering Validation&quot;</span><span class="p">)</span>

<span class="c1"># 4. When ready for production, create production revision</span>
<span class="n">production_rev</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Production Release&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;First production version&quot;</span>
<span class="p">)</span>

<span class="c1"># 5. Update tags</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span> <span class="s2">&quot;Phase&quot;</span><span class="p">,</span> <span class="s2">&quot;Production&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_revision_tag</span><span class="p">(</span><span class="s2">&quot;NEW-PRODUCT&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Released&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="product-obsolescence">Product Obsolescence</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Mark product as inactive (don&#39;t delete - preserve history)</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;OLD-WIDGET&quot;</span><span class="p">)</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">INACTIVE</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_product</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

<span class="c1"># Tag with obsolescence info</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;OLD-WIDGET&quot;</span><span class="p">,</span> <span class="s2">&quot;Obsolete&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;OLD-WIDGET&quot;</span><span class="p">,</span> <span class="s2">&quot;ObsoleteDate&quot;</span><span class="p">,</span> <span class="s2">&quot;2024-12-31&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;OLD-WIDGET&quot;</span><span class="p">,</span> <span class="s2">&quot;Replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;NEW-WIDGET&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="product-not-found">Product not found</h3>
<div class="codehilite"><pre><span></span><code><span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">product</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product doesn&#39;t exist - create it first&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="revision-creation-fails">Revision creation fails</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Make sure the product exists first</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">product</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Create the product before creating revisions&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="bom-update-fails">BOM update fails</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ensure the product revision exists</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">revision</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Create the product revision first&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_bom</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">bom_items</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="production.md">Production Domain</a> - Managing units in production</li>
<li><a href="report.md">Report Domain</a> - Querying test results</li>
<li><a href="asset.md">Asset Domain</a> - Managing test equipment and tools</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-production">
    <div class="doc-source">Source: docs/modules/production.md</div>
    <h1 id="production-domain">Production Domain</h1>
<p>The Production domain manages units (individual physical products) throughout their manufacturing lifecycle. It tracks unit creation, phases, processes, verification status, assembly relationships, and change history. This domain is where you track ACTUAL units being manufactured, from creation to finalization.</p>
<blockquote>
<p><strong>‚ö†Ô∏è IMPORTANT: Server Feature Requirement</strong></p>
<p>The Production module is an optional feature that <strong>must be enabled on the WATS server by the WATS team</strong>. If production tracking is not enabled on your server, this module will not work and API calls will fail.</p>
<p>Contact your WATS administrator or the WATS support team to verify that production tracking is enabled for your server before using this module.</p>
</blockquote>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#unit-operations">Unit Operations</a></li>
<li><a href="#unit-verification">Unit Verification</a></li>
<li><a href="#phase-management">Phase Management</a></li>
<li><a href="#process-tracking">Process Tracking</a></li>
<li><a href="#assembly-management">Assembly Management</a></li>
<li><a href="#serial-number-allocation">Serial Number Allocation</a></li>
<li><a href="#unit-changes">Unit Changes</a></li>
<li><a href="#unit-phases-internal">Unit Phases (Internal)</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize the API</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get a production unit</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> Rev </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">part_revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Phase: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Process: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">current_process</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check if unit is passing all tests</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Unit is passing all tests&quot;</span><span class="p">)</span>

    <span class="c1"># Move to finalized phase</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span>
    <span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_units</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Check multiple units concurrently</span>
        <span class="n">serials</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-002&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-003&quot;</span><span class="p">]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
            <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">serials</span>
        <span class="p">])</span>

        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">check_units</span><span class="p">())</span>
</code></pre></div>

<p>else:<br />
    print("‚úó Unit has test failures")</p>
<h1 id="create-a-new-unit">Create a new unit</h1>
<p>from pywats.domains.production import Unit</p>
<p>new_unit = Unit(<br />
    serial_number="WIDGET-12346",<br />
    part_number="WIDGET-001",<br />
    part_revision="B",<br />
    status="In Production"<br />
)</p>
<p>created = api.production.create_units([new_unit])</p>
<div class="codehilite"><pre><span></span><code><span class="o">---</span>

<span class="c1">## Core Concepts</span>

<span class="c1">### Unit</span>
<span class="n">A</span><span class="w"> </span><span class="o">**</span><span class="n">Unit</span><span class="o">**</span><span class="w"> </span><span class="n">represents</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">physical</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">manufactured</span><span class="p">.</span><span class="w"> </span><span class="k">Each</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="kt">serial</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">product</span><span class="o">/</span><span class="n">revision</span><span class="p">.</span>

<span class="o">**</span><span class="k">Key</span><span class="w"> </span><span class="n">attributes</span><span class="o">:**</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`serial_number`</span><span class="o">:</span><span class="w"> </span><span class="k">Unique</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">specific</span><span class="w"> </span><span class="n">unit</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`part_number`</span><span class="o">:</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">manufactured</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`part_revision`</span><span class="o">:</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">revision</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`status`</span><span class="o">:</span><span class="w"> </span><span class="k">Current</span><span class="w"> </span><span class="k">status</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s2">&quot;In Production&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Tested&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Shipped&quot;</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`current_phase`</span><span class="o">:</span><span class="w"> </span><span class="k">Current</span><span class="w"> </span><span class="n">workflow</span><span class="w"> </span><span class="k">phase</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s2">&quot;ICT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`current_process`</span><span class="o">:</span><span class="w"> </span><span class="k">Current</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ICT</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">FCT</span><span class="p">)</span>

<span class="c1">### Unit Lifecycle</span>
<span class="n">Units</span><span class="w"> </span><span class="n">typically</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">lifecycle</span><span class="o">:</span>

<span class="mf">1.</span><span class="w"> </span><span class="o">**</span><span class="n">Creation</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">system</span>
<span class="mf">2.</span><span class="w"> </span><span class="o">**</span><span class="k">In</span><span class="w"> </span><span class="n">Production</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">enters</span><span class="w"> </span><span class="n">manufacturing</span>
<span class="mf">3.</span><span class="w"> </span><span class="o">**</span><span class="n">Testing</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">goes</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="p">(</span><span class="n">ICT</span><span class="p">,</span><span class="w"> </span><span class="n">FCT</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">.)</span>
<span class="mf">4.</span><span class="w"> </span><span class="o">**</span><span class="n">Verification</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">verified</span><span class="w"> </span><span class="p">(</span><span class="n">Pass</span><span class="o">/</span><span class="n">Fail</span><span class="p">)</span>
<span class="mf">5.</span><span class="w"> </span><span class="o">**</span><span class="k">Repair</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">failed</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="n">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">repair</span>
<span class="mf">6.</span><span class="w"> </span><span class="o">**</span><span class="n">Assembly</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">applicable</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Subunits</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">attached</span>
<span class="mf">7.</span><span class="w"> </span><span class="o">**</span><span class="n">Finalized</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">passes</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">finalized</span>
<span class="mf">8.</span><span class="w"> </span><span class="o">**</span><span class="n">Shipped</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">shipped</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">customer</span>

<span class="c1">### Unit Phase</span>
<span class="n">A</span><span class="w"> </span><span class="o">**</span><span class="n">Unit</span><span class="w"> </span><span class="k">Phase</span><span class="o">**</span><span class="w"> </span><span class="n">represents</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">production</span><span class="w"> </span><span class="n">workflow</span><span class="p">.</span><span class="w"> </span><span class="n">Phases</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">WATS</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">include</span><span class="o">:</span>

<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="k">In</span><span class="w"> </span><span class="n">Test</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">currently</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">tested</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Passed</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">test</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Failed</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">test</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="k">In</span><span class="w"> </span><span class="k">Repair</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">repaired</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Finalized</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">requirements</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Scrapped</span><span class="o">**</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">scrapped</span>

<span class="n">Phases</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="k">by</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">ID</span><span class="o">**:</span><span class="w"> </span><span class="kt">Numeric</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="k">Code</span><span class="o">**:</span><span class="w"> </span><span class="k">Phase</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="k">string</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s2">&quot;ICT_PASSED&quot;</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="k">Name</span><span class="o">**:</span><span class="w"> </span><span class="n">Display</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s2">&quot;ICT - Passed&quot;</span><span class="p">)</span>

<span class="c1">### Unit Verification</span>
<span class="o">**</span><span class="n">UnitVerification</span><span class="o">**</span><span class="w"> </span><span class="n">provides</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">status</span><span class="o">:</span>

<span class="o">**</span><span class="n">Grades</span><span class="o">:**</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`PASSED`</span><span class="o">:</span><span class="w"> </span><span class="k">All</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">passed</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`FAILED`</span><span class="o">:</span><span class="w"> </span><span class="k">Some</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">failed</span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`NOT_TESTED`</span><span class="o">:</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">hasn</span><span class="s1">&#39;t been tested yet</span>
<span class="s1">- `INCOMPLETE`: Testing in progress</span>

<span class="s1">### Assembly</span>
<span class="s1">Units can have **parent-child relationships** to represent product assemblies:</span>

<span class="s1">- A **Main Assembly** unit can have multiple **Subunit** children</span>
<span class="s1">- Each child is attached at a specific **position** or slot</span>
<span class="s1">- Children must be **finalized** before attachment</span>
<span class="s1">- Assembly structure must match the **Box Build Template** (defined in Product domain)</span>

<span class="s1">**Key distinction:**</span>
<span class="s1">- **Box Build Template** (Product domain): Defines WHAT subunits are REQUIRED (design)</span>
<span class="s1">- **Unit Assembly** (Production domain): Attaches ACTUAL units (production)</span>

<span class="s1">---</span>

<span class="s1">## Unit Operations</span>

<span class="s1">### Get Specific Unit</span>

<span class="s1">```python</span>
<span class="s1"># Get unit by serial number and part number</span>
<span class="s1">unit = api.production.get_unit(</span>
<span class="s1">    serial_number=&quot;WIDGET-12345&quot;,</span>
<span class="s1">    part_number=&quot;WIDGET-001&quot;</span>
<span class="s1">)</span>

<span class="s1">if unit:</span>
<span class="s1">    print(f&quot;Serial: {unit.serial_number}&quot;)</span>
<span class="s1">    print(f&quot;Part: {unit.part_number} Rev {unit.part_revision}&quot;)</span>
<span class="s1">    print(f&quot;Status: {unit.status}&quot;)</span>
<span class="s1">    print(f&quot;Phase: {unit.current_phase}&quot;)</span>
<span class="s1">    print(f&quot;Process: {unit.current_process}&quot;)</span>
<span class="s1">    print(f&quot;Created: {unit.created}&quot;)</span>
<span class="s1">    print(f&quot;Modified: {unit.modified}&quot;)</span>

<span class="s1">    # Check if unit has Product info attached</span>
<span class="s1">    if unit.product:</span>
<span class="s1">        print(f&quot;Product Name: {unit.product.name}&quot;)</span>

<span class="s1">    if unit.product_revision:</span>
<span class="s1">        print(f&quot;Revision Name: {unit.product_revision.name}&quot;)</span>
</code></pre></div>

<h3 id="create-units">Create Units</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Create single unit</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-NEW-001&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Created&quot;</span>
<span class="p">)</span>

<span class="n">created</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">([</span><span class="n">unit</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">created</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create multiple units in batch</span>
<span class="n">units</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Unit</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;BATCH-</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Created&quot;</span><span class="p">,</span>
        <span class="n">created</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>  <span class="c1"># Create 10 units</span>
<span class="p">]</span>

<span class="n">created_units</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_units</span><span class="p">)</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="update-unit">Update Unit</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get unit</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>

<span class="c1"># Modify fields</span>
<span class="n">unit</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Testing&quot;</span>
<span class="n">unit</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;Test Station 3&quot;</span>

<span class="c1"># Save changes</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">update_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated: </span><span class="si">{</span><span class="n">updated</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="unit-verification">Unit Verification</h2>
<p>Check if a unit is passing or failing tests.</p>
<h3 id="verify-unit-status">Verify Unit Status</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitVerificationGrade</span>

<span class="c1"># Get detailed verification</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">verification</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verification Grade: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">grade</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Is Passing: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">is_passing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed Steps: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">failed_step_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Passed Steps: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">passed_step_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check specific grade</span>
    <span class="k">if</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">PASSED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì All tests passed&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">FAILED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Some tests failed&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">NOT_TESTED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ö† Unit not yet tested&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">INCOMPLETE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚è≥ Testing in progress&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-unit-grade">Get Unit Grade</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get just the grade (simpler than full verification)</span>
<span class="n">grade</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit_grade</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">PASSED</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ready for next phase&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="simple-passfail-check">Simple Pass/Fail Check</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Quick boolean check</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Unit is passing - can proceed&quot;</span><span class="p">)</span>

    <span class="c1"># Finalize the unit</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Unit has failures - needs repair&quot;</span><span class="p">)</span>

    <span class="c1"># Send to repair</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;In Repair&quot;</span>
    <span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="phase-management">Phase Management</h2>
<p>Manage unit workflow phases.</p>
<h3 id="get-all-phases">Get All Phases</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all available phases</span>
<span class="n">phases</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_phases</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available Phases:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">unit_phase_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Code: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Name: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Flag: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">phase_flags</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<h3 id="get-specific-phase">Get Specific Phase</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># By phase ID</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_phase</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># By phase code</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_phase</span><span class="p">(</span><span class="s2">&quot;ICT_PASSED&quot;</span><span class="p">)</span>

<span class="c1"># By phase name</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_phase</span><span class="p">(</span><span class="s2">&quot;ICT - Passed&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found phase: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">unit_phase_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="set-unit-phase">Set Unit Phase</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set phase by name</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;ICT&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Starting ICT test&quot;</span>
<span class="p">)</span>

<span class="c1"># Set phase by ID</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">phase</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>  <span class="c1"># Phase ID</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Moving to next phase&quot;</span>
<span class="p">)</span>

<span class="c1"># Set phase using enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitPhaseFlag</span>

<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">phase</span><span class="o">=</span><span class="n">UnitPhaseFlag</span><span class="o">.</span><span class="n">FINALIZED</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Unit completed successfully&quot;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="process-tracking">Process Tracking</h2>
<p>Track which test operation a unit is currently at.</p>
<h3 id="set-unit-process">Set Unit Process</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set process by operation type code</span>
<span class="c1"># (Operation types are defined in the Process domain)</span>

<span class="c1"># Set to ICT (operation type 10)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">process_code</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># ICT</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Starting In-Circuit Test&quot;</span>
<span class="p">)</span>

<span class="c1"># Set to FCT (operation type 50)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">process_code</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Final Function Test</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Starting Final Test&quot;</span>
<span class="p">)</span>

<span class="c1"># Clear process (set to None)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">process_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Process completed&quot;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="assembly-management">Assembly Management</h2>
<p>Manage parent-child unit relationships for box builds.</p>
<h3 id="add-child-to-assembly">Add Child to Assembly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Prerequisites:</span>
<span class="c1"># 1. Box build template must define the child as valid (Product domain)</span>
<span class="c1"># 2. Child unit must be finalized</span>
<span class="c1"># 3. Child cannot already have a parent</span>

<span class="c1"># Add a child unit to parent assembly</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span>
    <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PCBA-12345&quot;</span><span class="p">,</span>
    <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PCBA-BOARD&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Child added to assembly&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="remove-child-from-assembly">Remove Child from Assembly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Remove a child unit from parent</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">remove_child_from_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span>
    <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PCBA-12345&quot;</span><span class="p">,</span>
    <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PCBA-BOARD&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Child removed from assembly&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="verify-assembly">Verify Assembly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if assembly is complete (all required children attached)</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">verification</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assembly Complete: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_complete&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">verification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_complete&#39;</span><span class="p">):</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="n">verification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;missing_children&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> required children:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;part_number&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="complete-assembly-workflow">Complete Assembly Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Define what subunits are required (Product domain)</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-BOARD&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;POWER-SUPPLY&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># 2. Create parent unit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>

<span class="n">parent</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span>
    <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">([</span><span class="n">parent</span><span class="p">])</span>

<span class="c1"># 3. Create and finalize child units</span>
<span class="n">pcba</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PCBA-001&quot;</span><span class="p">,</span> <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCBA-BOARD&quot;</span><span class="p">,</span> <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">psu</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-001&quot;</span><span class="p">,</span> <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;POWER-SUPPLY&quot;</span><span class="p">,</span> <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
<span class="n">cable1</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;CABLE-001&quot;</span><span class="p">,</span> <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">,</span> <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">cable2</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;CABLE-002&quot;</span><span class="p">,</span> <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">,</span> <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">([</span><span class="n">pcba</span><span class="p">,</span> <span class="n">psu</span><span class="p">,</span> <span class="n">cable1</span><span class="p">,</span> <span class="n">cable2</span><span class="p">])</span>

<span class="c1"># Test and finalize children (simplified - would actually run tests)</span>
<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pcba</span><span class="p">,</span> <span class="n">psu</span><span class="p">,</span> <span class="n">cable1</span><span class="p">,</span> <span class="n">cable2</span><span class="p">]:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">child</span><span class="o">.</span><span class="n">serial_number</span><span class="p">,</span>
        <span class="n">child</span><span class="o">.</span><span class="n">part_number</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span>
    <span class="p">)</span>

<span class="c1"># 4. Attach children to parent</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;PCBA-001&quot;</span><span class="p">,</span> <span class="s2">&quot;PCBA-BOARD&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSU-001&quot;</span><span class="p">,</span> <span class="s2">&quot;POWER-SUPPLY&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;CABLE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;CABLE-002&quot;</span><span class="p">,</span> <span class="s2">&quot;CABLE-ASSY&quot;</span><span class="p">)</span>

<span class="c1"># 5. Verify assembly is complete</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">verification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_complete&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Assembly complete - all required children attached&quot;</span><span class="p">)</span>

    <span class="c1"># Finalize the parent</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;MODULE-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN-MODULE&quot;</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Assembly incomplete&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="serial-number-allocation">Serial Number Allocation</h2>
<p>Allocate serial numbers from configured sequences.</p>
<h3 id="get-serial-number-types">Get Serial Number Types</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all serial number types</span>
<span class="n">sn_types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_serial_number_types</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Serial Number Types:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sn_type</span> <span class="ow">in</span> <span class="n">sn_types</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">sn_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Pattern: </span><span class="si">{</span><span class="n">sn_type</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Next: </span><span class="si">{</span><span class="n">sn_type</span><span class="o">.</span><span class="n">next_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="allocate-serial-numbers">Allocate Serial Numbers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Allocate a single serial number</span>
<span class="n">serial_numbers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">allocate_serial_numbers</span><span class="p">(</span>
    <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Production_SN&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">serial_numbers</span><span class="p">:</span>
    <span class="n">new_sn</span> <span class="o">=</span> <span class="n">serial_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allocated: </span><span class="si">{</span><span class="n">new_sn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Allocate multiple serial numbers</span>
<span class="n">batch_sns</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">allocate_serial_numbers</span><span class="p">(</span>
    <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Production_SN&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allocated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_sns</span><span class="p">)</span><span class="si">}</span><span class="s2"> serial numbers:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  First: </span><span class="si">{</span><span class="n">batch_sns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Last: </span><span class="si">{</span><span class="n">batch_sns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use allocated serial numbers to create units</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>

<span class="n">units</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Unit</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">part_revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">batch_sns</span>
<span class="p">]</span>

<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="unit-changes">Unit Changes</h2>
<p>Track changes to unit phase and status.</p>
<h3 id="get-unit-changes">Get Unit Changes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all changes for a specific unit</span>
<span class="n">changes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit_changes</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit change history (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span><span class="si">}</span><span class="s2"> changes):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">changed</span><span class="si">}</span><span class="s2">: Phase </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">old_unit_phase_id</span><span class="si">}</span><span class="s2"> ‚Üí </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">new_unit_phase_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    User: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">user</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;System&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Comment: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">comment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;No comment&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get recent changes (all units, last 50)</span>
<span class="n">recent_changes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit_changes</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recent changes across all units:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">recent_changes</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">comment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Phase change&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="acknowledge-unit-change">Acknowledge Unit Change</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Mark a change as acknowledged</span>
<span class="n">change_id</span> <span class="o">=</span> <span class="s2">&quot;some-change-uuid&quot;</span>

<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">acknowledge_unit_change</span><span class="p">(</span><span class="n">change_id</span><span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Change acknowledged&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="unit-phases-internal">Unit Phases (Internal)</h2>
<p>‚ö†Ô∏è <strong>INTERNAL API - Subject to change</strong></p>
<p>Get unit phase definitions from internal API.</p>
<h3 id="get-unit-phases">Get Unit Phases</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all unit phases from internal API</span>
<span class="n">phases</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_all_unit_phases</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit Phases (Internal API):&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">unit_phase_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Code: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Flags: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">phase_flags</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Description: </span><span class="si">{</span><span class="n">phase</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="complete-production-workflow">Complete Production Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">production_workflow</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">revision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete workflow from creation to finalization&quot;&quot;&quot;</span>

    <span class="c1"># 1. Create unit</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>

    <span class="n">unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">serial_number</span><span class="p">,</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
        <span class="n">part_revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Created&quot;</span>
    <span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">([</span><span class="n">unit</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Created unit: </span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Start production - Set to ICT</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Under Production&quot;</span>
    <span class="p">)</span>

    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
        <span class="n">process_code</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># ICT</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Starting In-Circuit Test&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Set to ICT process&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Run ICT test (this would create a UUT report)</span>
    <span class="c1"># ... test execution code ...</span>
    <span class="c1"># api.report.submit_report(ict_report)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. ICT test completed&quot;</span><span class="p">)</span>

    <span class="c1"># 4. Check if passed</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. ICT PASSED&quot;</span><span class="p">)</span>

        <span class="c1"># Move to FCT</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">process_code</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># FCT</span>
            <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Starting Final Function Test&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. Set to FCT process&quot;</span><span class="p">)</span>

        <span class="c1"># Run FCT test</span>
        <span class="c1"># ... test execution code ...</span>
        <span class="c1"># api.report.submit_report(fct_report)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;6. FCT test completed&quot;</span><span class="p">)</span>

        <span class="c1"># Check final result</span>
        <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. FCT PASSED&quot;</span><span class="p">)</span>

            <span class="c1"># Finalize unit</span>
            <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
                <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
                <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span><span class="p">,</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;All tests passed successfully&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;8. Unit FINALIZED ‚úì&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. FCT FAILED&quot;</span><span class="p">)</span>
            <span class="c1"># Send to repair</span>
            <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
                <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
                <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;In Repair&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. ICT FAILED&quot;</span><span class="p">)</span>
        <span class="c1"># Send to repair</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;In Repair&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Use it</span>
<span class="n">production_workflow</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="repair-workflow">Repair Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">repair_workflow</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle failed unit repair and retest&quot;&quot;&quot;</span>

    <span class="c1"># 1. Check current status</span>
    <span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verification</span><span class="o">.</span><span class="n">is_passing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit is already passing - no repair needed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit has </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">failed_step_count</span><span class="si">}</span><span class="s2"> failed steps&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Set to repair phase</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;In Repair&quot;</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Starting repair&quot;</span>
    <span class="p">)</span>

    <span class="c1"># 3. Create repair report (UUR - Unit Under Repair)</span>
    <span class="c1"># This would typically be done by creating a UUR report</span>
    <span class="c1"># See Report domain documentation for details</span>

    <span class="c1"># 4. Set back to test process</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">)</span>

    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
        <span class="n">process_code</span><span class="o">=</span><span class="n">unit</span><span class="o">.</span><span class="n">current_process</span><span class="p">,</span>  <span class="c1"># Return to failed operation</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Re-testing after repair&quot;</span>
    <span class="p">)</span>

    <span class="c1"># 5. Run test again</span>
    <span class="c1"># ... test execution code ...</span>

    <span class="c1"># 6. Check if now passing</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Repair successful - unit now passing&quot;</span><span class="p">)</span>

        <span class="c1"># Move to next phase</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Passed after repair&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Still failing after repair - escalate&quot;</span><span class="p">)</span>

        <span class="c1"># Could scrap or send to advanced repair</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Failed after repair attempt&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Use it</span>
<span class="n">repair_workflow</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="batch-production-tracking">Batch Production Tracking</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">batch_production</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">revision</span><span class="p">,</span> <span class="n">lot_number</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and track a production batch&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

    <span class="c1"># 1. Allocate serial numbers</span>
    <span class="n">serial_numbers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">allocate_serial_numbers</span><span class="p">(</span>
        <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Production_SN&quot;</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allocated </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> serial numbers&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Range: </span><span class="si">{</span><span class="n">serial_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">serial_numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Create units</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Unit</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
            <span class="n">part_revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Created&quot;</span><span class="p">,</span>
            <span class="n">lot_number</span><span class="o">=</span><span class="n">lot_number</span>  <span class="c1"># If your Unit model has this field</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">serial_numbers</span>
    <span class="p">]</span>

    <span class="n">created</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created</span><span class="p">)</span><span class="si">}</span><span class="s2"> units in lot </span><span class="si">{</span><span class="n">lot_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Track batch progress</span>
    <span class="n">batch_stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">created</span><span class="p">),</span>
        <span class="s1">&#39;tested&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;in_repair&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;finalized&#39;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="c1"># After testing, update stats</span>
    <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">serial_numbers</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="n">part_number</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Finalized&quot;</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
                <span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;finalized&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;Repair&quot;</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
                <span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;in_repair&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;Passed&quot;</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
                <span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;Failed&quot;</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
                <span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Batch Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created: </span><span class="si">{</span><span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Finalized: </span><span class="si">{</span><span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;finalized&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Passed: </span><span class="si">{</span><span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failed: </span><span class="si">{</span><span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  In Repair: </span><span class="si">{</span><span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;in_repair&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">yield_pct</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;finalized&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">batch_stats</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Yield: </span><span class="si">{</span><span class="n">yield_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">batch_stats</span>

<span class="c1"># Use it</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">batch_production</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;LOT-2025-W01&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

<h3 id="phase-gate-checks">Phase Gate Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">can_advance_to_next_phase</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">target_phase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if unit can advance to next phase&quot;&quot;&quot;</span>

    <span class="c1"># Get current unit state</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit not found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Check verification</span>
    <span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">verification</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot verify unit&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Define phase gate rules</span>
    <span class="k">if</span> <span class="n">target_phase</span> <span class="o">==</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">:</span>
        <span class="c1"># Must be passing all tests</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verification</span><span class="o">.</span><span class="n">is_passing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úó Cannot finalize - unit has </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">failed_step_count</span><span class="si">}</span><span class="s2"> failures&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Must not be in repair</span>
        <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span> <span class="ow">and</span> <span class="s2">&quot;Repair&quot;</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Cannot finalize - unit is in repair&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Unit can be finalized&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">target_phase</span> <span class="o">==</span> <span class="s2">&quot;Shipped&quot;</span><span class="p">:</span>
        <span class="c1"># Must be finalized first</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span> <span class="ow">or</span> <span class="s2">&quot;Finalized&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Cannot ship - unit not finalized&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Unit can be shipped&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Add more phase gate rules as needed</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># Use it</span>
<span class="k">if</span> <span class="n">can_advance_to_next_phase</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">):</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="productionservice-methods">ProductionService Methods</h3>
<h4 id="unit-operations">Unit Operations</h4>
<ul>
<li><code>get_unit(serial_number, part_number)</code> ‚Üí <code>Optional[Unit]</code> - Get unit details</li>
<li><code>create_units(units)</code> ‚Üí <code>List[Unit]</code> - Create one or more units</li>
<li><code>update_unit(unit)</code> ‚Üí <code>Optional[Unit]</code> - Update existing unit</li>
</ul>
<h4 id="unit-verification_1">Unit Verification</h4>
<ul>
<li><code>verify_unit(serial_number, part_number, revision)</code> ‚Üí <code>Optional[UnitVerification]</code> - Get verification details</li>
<li><code>get_unit_grade(serial_number, part_number, revision)</code> ‚Üí <code>Optional[UnitVerificationGrade]</code> - Get grade only</li>
<li><code>is_unit_passing(serial_number, part_number)</code> ‚Üí <code>bool</code> - Quick pass/fail check</li>
</ul>
<h4 id="unit-phases">Unit Phases</h4>
<ul>
<li><code>get_phases()</code> ‚Üí <code>List[UnitPhase]</code> - Get all available phases</li>
<li><code>get_phase(identifier)</code> ‚Üí <code>Optional[UnitPhase]</code> - Get specific phase by ID/code/name</li>
<li><code>get_phase_id(phase)</code> ‚Üí <code>Optional[int]</code> - Get phase ID from identifier</li>
<li><code>set_unit_phase(serial_number, part_number, phase, comment)</code> ‚Üí <code>bool</code> - Set unit phase</li>
<li><code>set_unit_process(serial_number, part_number, process_code, comment)</code> ‚Üí <code>bool</code> - Set current process</li>
</ul>
<h4 id="unit-changes_1">Unit Changes</h4>
<ul>
<li><code>get_unit_changes(serial_number, part_number, top)</code> ‚Üí <code>List[UnitChange]</code> - Get change history</li>
<li><code>acknowledge_unit_change(change_id)</code> ‚Üí <code>bool</code> - Acknowledge a change</li>
</ul>
<h4 id="assembly-operations">Assembly Operations</h4>
<ul>
<li><code>add_child_to_assembly(parent_serial, parent_part, child_serial, child_part)</code> ‚Üí <code>bool</code> - Add child unit</li>
<li><code>remove_child_from_assembly(parent_serial, parent_part, child_serial, child_part)</code> ‚Üí <code>bool</code> - Remove child unit</li>
<li><code>verify_assembly(serial_number, part_number, revision)</code> ‚Üí <code>Optional[Dict]</code> - Verify assembly completeness</li>
</ul>
<h4 id="serial-number-operations">Serial Number Operations</h4>
<ul>
<li><code>get_serial_number_types()</code> ‚Üí <code>List[SerialNumberType]</code> - Get SN types</li>
<li><code>allocate_serial_numbers(type_name, quantity)</code> ‚Üí <code>List[str]</code> - Allocate serial numbers</li>
</ul>
<h3 id="productionserviceinternal-methods-subject-to-change">ProductionServiceInternal Methods (‚ö†Ô∏è Subject to change)</h3>
<h4 id="unit-phase-operations">Unit Phase Operations</h4>
<ul>
<li><code>get_unit_phases()</code> ‚Üí <code>List[UnitPhase]</code> - Get unit phases from internal API</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="unit">Unit</h4>
<ul>
<li><code>serial_number</code>: str (required)</li>
<li><code>part_number</code>: str (required)</li>
<li><code>part_revision</code>: Optional[str]</li>
<li><code>status</code>: Optional[str]</li>
<li><code>current_phase</code>: Optional[str]</li>
<li><code>current_process</code>: Optional[int]</li>
<li><code>product</code>: Optional[Product] (attached)</li>
<li><code>product_revision</code>: Optional[ProductRevision] (attached)</li>
<li><code>created</code>: Optional[datetime]</li>
<li><code>modified</code>: Optional[datetime]</li>
</ul>
<h4 id="unitverification">UnitVerification</h4>
<ul>
<li><code>grade</code>: UnitVerificationGrade</li>
<li><code>is_passing</code>: bool</li>
<li><code>failed_step_count</code>: int</li>
<li><code>passed_step_count</code>: int</li>
</ul>
<h4 id="unitverificationgrade-enum">UnitVerificationGrade (Enum)</h4>
<ul>
<li><code>PASSED</code>: All tests passed</li>
<li><code>FAILED</code>: Some tests failed</li>
<li><code>NOT_TESTED</code>: Not yet tested</li>
<li><code>INCOMPLETE</code>: Testing in progress</li>
</ul>
<h4 id="unitphase">UnitPhase</h4>
<ul>
<li><code>unit_phase_id</code>: int</li>
<li><code>code</code>: str</li>
<li><code>name</code>: str</li>
<li><code>phase_flags</code>: Optional[int]</li>
<li><code>description</code>: Optional[str]</li>
</ul>
<h4 id="unitphaseflag-enum">UnitPhaseFlag (Enum)</h4>
<ul>
<li>Numeric values for common phases</li>
<li>Example: <code>UnitPhaseFlag.FINALIZED</code></li>
</ul>
<h4 id="unitchange">UnitChange</h4>
<ul>
<li><code>unit_change_id</code>: UUID</li>
<li><code>serial_number</code>: str</li>
<li><code>part_number</code>: str</li>
<li><code>old_unit_phase_id</code>: Optional[int]</li>
<li><code>new_unit_phase_id</code>: Optional[int]</li>
<li><code>changed</code>: datetime</li>
<li><code>user</code>: Optional[str]</li>
<li><code>comment</code>: Optional[str]</li>
</ul>
<h4 id="serialnumbertype">SerialNumberType</h4>
<ul>
<li><code>name</code>: str</li>
<li><code>pattern</code>: str</li>
<li><code>next_number</code>: int</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li>
<p><strong>Always verify before finalizing</strong> - Check <code>is_unit_passing()</code> before setting phase to "Finalized"</p>
</li>
<li>
<p><strong>Use meaningful comments</strong> - Add comments when changing phases or processes</p>
</li>
<li>
<p><strong>Track batch context</strong> - Use lot numbers or batch IDs to group related units</p>
</li>
<li>
<p><strong>Finalize children first</strong> - Children must be finalized before assembly attachment</p>
</li>
<li>
<p><strong>Verify assemblies</strong> - Always call <code>verify_assembly()</code> before finalizing box builds</p>
</li>
<li>
<p><strong>Handle repair workflow</strong> - Set proper phase when sending units to repair</p>
</li>
<li>
<p><strong>Track changes</strong> - Use <code>get_unit_changes()</code> to audit unit lifecycle</p>
</li>
<li>
<p><strong>Allocate SNs from sequences</strong> - Use configured SN types instead of manual generation</p>
</li>
<li>
<p><strong>Phase gates</strong> - Implement validation before phase transitions</p>
</li>
<li>
<p><strong>Don't skip phases</strong> - Follow your defined production flow sequence</p>
</li>
</ol>
<hr />
<h2 id="common-workflows">Common Workflows</h2>
<h3 id="test-station-integration">Test Station Integration</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_test_at_station</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">operation_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute test and update unit status&quot;&quot;&quot;</span>

    <span class="c1"># Set unit to current process</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
        <span class="n">process_code</span><span class="o">=</span><span class="n">operation_type</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Testing at </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Run test (creates UUT report)</span>
    <span class="c1"># This is typically done by test equipment/software</span>
    <span class="c1"># report = create_test_report(serial_number, operation_type)</span>
    <span class="c1"># api.report.submit_report(report)</span>

    <span class="c1"># After test, check result</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
        <span class="c1"># Move to next phase</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Passed at </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Send to repair</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed at </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<h3 id="multi-station-production-line">Multi-Station Production Line</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">production_line</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Move unit through multiple stations&quot;&quot;&quot;</span>

    <span class="n">stations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ICT&quot;</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;FCT&quot;</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Burn-In&quot;</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Final Inspection&quot;</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== </span><span class="si">{</span><span class="n">station</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>

        <span class="c1"># Set process</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
            <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
            <span class="n">process_code</span><span class="o">=</span><span class="n">station</span><span class="p">[</span><span class="s1">&#39;process&#39;</span><span class="p">],</span>
            <span class="n">comment</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;At </span><span class="si">{</span><span class="n">station</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Simulate test execution</span>
        <span class="c1"># In real scenario, this calls test software</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Placeholder for actual test</span>

        <span class="c1"># Check result</span>
        <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì PASS at </span><span class="si">{</span><span class="n">station</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úó FAIL at </span><span class="si">{</span><span class="n">station</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># All stations passed - finalize</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
        <span class="n">serial_number</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Completed all production stages&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úì Unit FINALIZED&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="unit-not-found">Unit not found</h3>
<div class="codehilite"><pre><span></span><code><span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit doesn&#39;t exist - create it first&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="cannot-finalize-unit">Cannot finalize unit</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if passing</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">):</span>
    <span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span><span class="s2">&quot;WIDGET-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot finalize - </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">failed_step_count</span><span class="si">}</span><span class="s2"> failures&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="cannot-add-child-to-assembly">Cannot add child to assembly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Common reasons:</span>
<span class="c1"># 1. Child not finalized</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">child_sn</span><span class="p">,</span> <span class="n">child_pn</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>

<span class="c1"># 2. Child not in box build template</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="n">parent_pn</span><span class="p">,</span> <span class="n">parent_rev</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="n">child_pn</span><span class="p">,</span> <span class="n">child_rev</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># 3. Child already has a parent</span>
<span class="c1"># Remove from old parent first</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">remove_child_from_assembly</span><span class="p">(</span><span class="n">old_parent_sn</span><span class="p">,</span> <span class="n">old_parent_pn</span><span class="p">,</span> <span class="n">child_sn</span><span class="p">,</span> <span class="n">child_pn</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="product.md">Product Domain</a> - Defining products and box build templates</li>
<li><a href="report.md">Report Domain</a> - Creating test reports for units</li>
<li><a href="process.md">Process Domain</a> - Defining operation types and workflows</li>
<li><a href="analytics.md">Analytics Domain</a> - Analyzing unit flow and yield</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-analytics">
    <div class="doc-source">Source: docs/modules/analytics.md</div>
    <h1 id="analytics-domain">Analytics Domain</h1>
<p>The Analytics domain provides data analysis and visualization capabilities for test results. It includes yield calculations, measurement aggregation, Cpk analysis, and production flow visualization (Unit Flow). Use this domain to understand manufacturing performance, identify trends, and optimize processes.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#type-safe-enums">Type-Safe Enums</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#yield-analysis">Yield Analysis</a></li>
<li><a href="#measurement-aggregation">Measurement Aggregation</a></li>
<li><a href="#unit-flow-analysis-internal">Unit Flow Analysis</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">WATSFilter</span><span class="p">,</span> <span class="n">StatusFilter</span><span class="p">,</span> <span class="n">MeasurementPath</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Initialize</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get yield for last 7 days (using type-safe enum)</span>
<span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">StatusFilter</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span>  <span class="c1"># Type-safe enum</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>

<span class="n">yield_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yield: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Passed: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">passed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">failed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get measurements for a step (using friendly path format)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">MeasurementPath</span><span class="p">(</span><span class="s2">&quot;Numeric Limit Tests/3.3V Rail&quot;</span><span class="p">)</span>
<span class="n">measurements</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span>
    <span class="n">filter_obj</span><span class="p">,</span>
    <span class="n">measurement_paths</span><span class="o">=</span><span class="n">path</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Avg: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">avg</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cpk: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">cpk</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span><span class="p">,</span> <span class="n">WATSFilter</span><span class="p">,</span> <span class="n">StatusFilter</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">analyze_yield</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="c1"># Concurrent queries - much faster!</span>
        <span class="n">yield_result</span><span class="p">,</span> <span class="n">measurements</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yield: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">analyze_yield</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="type-safe-enums">Type-Safe Enums</h2>
<p>The Analytics domain provides type-safe enums for building queries with IDE autocomplete and compile-time validation.</p>
<h3 id="query-enums">Query Enums</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">StatusFilter</span><span class="p">,</span> <span class="n">RunFilter</span><span class="p">,</span> <span class="n">StepType</span><span class="p">,</span> <span class="n">CompOperator</span>

<span class="c1"># Status filter - filter by test result status</span>
<span class="n">StatusFilter</span><span class="o">.</span><span class="n">PASSED</span>      <span class="c1"># &quot;P&quot; - Passed tests only</span>
<span class="n">StatusFilter</span><span class="o">.</span><span class="n">FAILED</span>      <span class="c1"># &quot;F&quot; - Failed tests only</span>
<span class="n">StatusFilter</span><span class="o">.</span><span class="n">ERROR</span>       <span class="c1"># &quot;E&quot; - Error/terminated tests</span>
<span class="n">StatusFilter</span><span class="o">.</span><span class="n">TERMINATED</span>  <span class="c1"># &quot;T&quot; - Terminated tests</span>
<span class="n">StatusFilter</span><span class="o">.</span><span class="n">ALL</span>         <span class="c1"># &quot;*&quot; - All statuses</span>

<span class="c1"># Run filter - filter by test run sequence</span>
<span class="n">RunFilter</span><span class="o">.</span><span class="n">FIRST</span>           <span class="c1"># 1 - First run only</span>
<span class="n">RunFilter</span><span class="o">.</span><span class="n">LAST</span>            <span class="c1"># -1 - Last run only</span>
<span class="n">RunFilter</span><span class="o">.</span><span class="n">ALL</span>             <span class="c1"># 0 - All runs</span>
<span class="n">RunFilter</span><span class="o">.</span><span class="n">ALL_EXCEPT_FIRST</span> <span class="c1"># 2 - All except first run</span>

<span class="c1"># Step types returned in analytics results</span>
<span class="n">StepType</span><span class="o">.</span><span class="n">NUMERIC_LIMIT</span>    <span class="c1"># Numeric measurement with limits</span>
<span class="n">StepType</span><span class="o">.</span><span class="n">STRING_VALUE</span>     <span class="c1"># String comparison</span>
<span class="n">StepType</span><span class="o">.</span><span class="n">PASS_FAIL</span>        <span class="c1"># Binary pass/fail</span>
<span class="n">StepType</span><span class="o">.</span><span class="n">SEQUENCECALL</span>     <span class="c1"># Sequence call step</span>

<span class="c1"># Comparison operators in step results</span>
<span class="n">CompOperator</span><span class="o">.</span><span class="n">GELE</span>   <span class="c1"># Greater/Equal and Less/Equal (within range)</span>
<span class="n">CompOperator</span><span class="o">.</span><span class="n">GT</span>     <span class="c1"># Greater than</span>
<span class="n">CompOperator</span><span class="o">.</span><span class="n">LT</span>     <span class="c1"># Less than</span>
<span class="n">CompOperator</span><span class="o">.</span><span class="n">EQ</span>     <span class="c1"># Equal</span>
<span class="n">CompOperator</span><span class="o">.</span><span class="n">NE</span>     <span class="c1"># Not equal</span>
<span class="n">CompOperator</span><span class="o">.</span><span class="n">LOG</span>    <span class="c1"># Logged value (no comparison)</span>
</code></pre></div>

<h3 id="dimension-and-kpi-enums">Dimension and KPI Enums</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dimension</span><span class="p">,</span> <span class="n">KPI</span><span class="p">,</span> <span class="n">RepairDimension</span><span class="p">,</span> <span class="n">RepairKPI</span>

<span class="c1"># Grouping dimensions for dynamic queries</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">PART_NUMBER</span>     <span class="c1"># Group by part number</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">STATION_NAME</span>    <span class="c1"># Group by test station</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">PERIOD</span>          <span class="c1"># Group by time period</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">PROCESS_CODE</span>    <span class="c1"># Group by process code</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">REVISION</span>        <span class="c1"># Group by product revision</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">OPERATOR</span>        <span class="c1"># Group by operator</span>
<span class="n">Dimension</span><span class="o">.</span><span class="n">FIXTURE_ID</span>      <span class="c1"># Group by fixture</span>
<span class="c1"># ... and 15+ more dimensions</span>

<span class="c1"># KPIs for yield/performance queries</span>
<span class="n">KPI</span><span class="o">.</span><span class="n">UNIT_COUNT</span>     <span class="c1"># Number of units tested</span>
<span class="n">KPI</span><span class="o">.</span><span class="n">FPY</span>            <span class="c1"># First Pass Yield</span>
<span class="n">KPI</span><span class="o">.</span><span class="n">RTY</span>            <span class="c1"># Rolled Throughput Yield</span>
<span class="n">KPI</span><span class="o">.</span><span class="n">PPM_FPY</span>        <span class="c1"># Parts per million (FPY based)</span>
<span class="n">KPI</span><span class="o">.</span><span class="n">AVG_TEST_TIME</span>  <span class="c1"># Average test time</span>
<span class="n">KPI</span><span class="o">.</span><span class="n">RETEST_COUNT</span>   <span class="c1"># Number of retests</span>
<span class="c1"># ... and 15+ more KPIs</span>

<span class="c1"># Repair-specific dimensions and KPIs</span>
<span class="n">RepairDimension</span><span class="o">.</span><span class="n">REPAIR_CODE</span>       <span class="c1"># Repair code</span>
<span class="n">RepairDimension</span><span class="o">.</span><span class="n">COMPONENT_REF</span>     <span class="c1"># Component reference</span>
<span class="n">RepairKPI</span><span class="o">.</span><span class="n">REPAIR_COUNT</span>            <span class="c1"># Number of repairs</span>
<span class="n">RepairKPI</span><span class="o">.</span><span class="n">REPAIR_REPORT_COUNT</span>     <span class="c1"># Repair reports</span>
</code></pre></div>

<h3 id="dimensionbuilder-fluent-api">DimensionBuilder - Fluent API</h3>
<p>Build dimension queries with type safety and IDE autocomplete:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">DimensionBuilder</span><span class="p">,</span> <span class="n">Dimension</span><span class="p">,</span> <span class="n">KPI</span><span class="p">,</span> <span class="n">WATSFilter</span>

<span class="c1"># Build custom dimension query</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">DimensionBuilder</span><span class="p">()</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">KPI</span><span class="o">.</span><span class="n">UNIT_COUNT</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">KPI</span><span class="o">.</span><span class="n">FPY</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dimension</span><span class="o">.</span><span class="n">PART_NUMBER</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dimension</span><span class="o">.</span><span class="n">PERIOD</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Result: &quot;unitCount desc;fpy;partNumber;period&quot;</span>

<span class="c1"># Use with WATSFilter</span>
<span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">dimensions</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
    <span class="n">period_count</span><span class="o">=</span><span class="mi">30</span>
<span class="p">)</span>

<span class="c1"># Use presets for common patterns</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">DimensionBuilder</span><span class="o">.</span><span class="n">yield_by_product</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">DimensionBuilder</span><span class="o">.</span><span class="n">yield_by_station</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">DimensionBuilder</span><span class="o">.</span><span class="n">repair_analysis</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">DimensionBuilder</span><span class="o">.</span><span class="n">oee_analysis</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h3 id="path-utilities">Path Utilities</h3>
<p>Work with measurement paths using a user-friendly format:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementPath</span><span class="p">,</span> <span class="n">StepPath</span>

<span class="c1"># Create paths with forward slashes (user-friendly format)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">MeasurementPath</span><span class="p">(</span><span class="s2">&quot;Functional Test/Power Supply/3.3V Rail&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">display</span><span class="p">)</span>     <span class="c1"># Functional Test/Power Supply/3.3V Rail</span>
<span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">api_format</span><span class="p">)</span>  <span class="c1"># Functional Test¬∂Power Supply¬∂3.3V Rail (internal)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>       <span class="c1"># [&#39;Functional Test&#39;, &#39;Power Supply&#39;, &#39;3.3V Rail&#39;]</span>

<span class="c1"># Build paths with concatenation</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">StepPath</span><span class="p">(</span><span class="s2">&quot;Functional Test&quot;</span><span class="p">)</span>
<span class="n">full_path</span> <span class="o">=</span> <span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;Power Supply&quot;</span> <span class="o">/</span> <span class="s2">&quot;3.3V Rail&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">display</span><span class="p">)</span>  <span class="c1"># Functional Test/Power Supply/3.3V Rail</span>

<span class="c1"># Use from_parts for programmatic construction</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">MeasurementPath</span><span class="o">.</span><span class="n">from_parts</span><span class="p">([</span><span class="s2">&quot;Main&quot;</span><span class="p">,</span> <span class="s2">&quot;SubTest&quot;</span><span class="p">,</span> <span class="s2">&quot;Measurement&quot;</span><span class="p">])</span>

<span class="c1"># Paths work directly in API calls</span>
<span class="n">measurements</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span>
    <span class="n">filter_obj</span><span class="p">,</span>
    <span class="n">measurement_paths</span><span class="o">=</span><span class="n">path</span>  <span class="c1"># Automatic conversion to API format</span>
<span class="p">)</span>

<span class="c1"># Access display format from results</span>
<span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_path_display</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Friendly format</span>
</code></pre></div>

<hr />
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="yield">Yield</h3>
<p><strong>Yield</strong> is the percentage of units that passed testing:<br />
- <code>yield_pct</code>: Percentage (0-100)<br />
- <code>passed</code>: Number of passed units<br />
- <code>failed</code>: Number of failed units<br />
- <code>total</code>: Total units tested</p>
<h3 id="measurements">Measurements</h3>
<p><strong>Aggregated measurements</strong> provide statistical analysis of numeric test steps:<br />
- <code>avg</code>: Average value<br />
- <code>min</code>, <code>max</code>: Minimum and maximum<br />
- <code>std_dev</code>: Standard deviation<br />
- <code>cpk</code>: Process capability index<br />
- <code>count</code>: Number of measurements</p>
<h3 id="unit-flow">Unit Flow</h3>
<p><strong>Unit Flow</strong> visualizes how units move through production:<br />
- <strong>Nodes</strong>: Operations/processes (e.g., "ICT", "FCT", "Assembly")<br />
- <strong>Links</strong>: Transitions between operations<br />
- <strong>Units</strong>: Individual units tracked through the flow</p>
<hr />
<h2 id="yield-analysis">Yield Analysis</h2>
<h3 id="get-overall-yield">Get Overall Yield</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">WATSFilter</span><span class="p">,</span> <span class="n">StatusFilter</span>

<span class="c1"># Yield for last 30 days</span>
<span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">StatusFilter</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span>  <span class="c1"># Include all statuses</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">)</span>

<span class="n">yield_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== YIELD ANALYSIS ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yield: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Passed: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">passed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">failed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="yield-by-date-range">Yield by Date Range</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Last quarter</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">start_date_time</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date_time</span><span class="o">=</span><span class="n">end_date</span>
<span class="p">)</span>

<span class="n">yield_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q1 Yield: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="yield-by-station">Yield by Station</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Compare yield across stations</span>
<span class="n">stations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ICT-01&quot;</span><span class="p">,</span> <span class="s2">&quot;ICT-02&quot;</span><span class="p">,</span> <span class="s2">&quot;ICT-03&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== YIELD BY STATION ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
    <span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
        <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">,</span>
        <span class="n">days</span><span class="o">=</span><span class="mi">7</span>
    <span class="p">)</span>

    <span class="n">yield_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% (</span><span class="si">{</span><span class="n">yield_result</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2"> units)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="yield-trend-over-time">Yield Trend Over Time</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_daily_yield</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get yield for each of the last N days&quot;&quot;&quot;</span>

    <span class="n">trends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">):</span>
        <span class="n">day_end</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">day_start</span> <span class="o">=</span> <span class="n">day_end</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
            <span class="n">start_date_time</span><span class="o">=</span><span class="n">day_start</span><span class="p">,</span>
            <span class="n">end_date_time</span><span class="o">=</span><span class="n">day_end</span>
        <span class="p">)</span>

        <span class="n">yield_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>

        <span class="n">trends</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">day_start</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
            <span class="s1">&#39;yield&#39;</span><span class="p">:</span> <span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="p">,</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">yield_result</span><span class="o">.</span><span class="n">total</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">trends</span>

<span class="c1"># Use it</span>
<span class="n">trends</span> <span class="o">=</span> <span class="n">get_daily_yield</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== 14-DAY YIELD TREND ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">trend</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">trends</span><span class="p">):</span>
    <span class="n">yield_bar</span> <span class="o">=</span> <span class="s2">&quot;‚ñà&quot;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">trend</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># Visual bar</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trend</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">trend</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% </span><span class="si">{</span><span class="n">yield_bar</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">trend</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> units)&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="measurement-aggregation">Measurement Aggregation</h2>
<h3 id="get-measurement-statistics">Get Measurement Statistics</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">WATSFilter</span><span class="p">,</span> <span class="n">MeasurementPath</span>

<span class="c1"># Get measurements for a specific test step</span>
<span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>

<span class="c1"># Use user-friendly path format (slashes)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">MeasurementPath</span><span class="p">(</span><span class="s2">&quot;Power Supply Tests/3.3V Rail&quot;</span><span class="p">)</span>
<span class="n">measurements</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span>
    <span class="n">filter_obj</span><span class="p">,</span>
    <span class="n">measurement_paths</span><span class="o">=</span><span class="n">path</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">measurements</span><span class="p">:</span>
    <span class="n">meas</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Count: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">avg</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">min</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">max</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Std Dev: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">std_dev</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cpk: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">cpk</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="multiple-measurements">Multiple Measurements</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementPath</span>

<span class="c1"># Get multiple measurements at once using path objects</span>
<span class="n">step_paths</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MeasurementPath</span><span class="p">(</span><span class="s2">&quot;Power Supply Tests/3.3V Rail&quot;</span><span class="p">),</span>
    <span class="n">MeasurementPath</span><span class="p">(</span><span class="s2">&quot;Power Supply Tests/5V Rail&quot;</span><span class="p">),</span>
    <span class="n">MeasurementPath</span><span class="p">(</span><span class="s2">&quot;Power Supply Tests/12V Rail&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">measurements</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span>
    <span class="n">filter_obj</span><span class="p">,</span>
    <span class="n">measurement_paths</span><span class="o">=</span><span class="n">step_paths</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== POWER RAIL MEASUREMENTS ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Path: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_path_display</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># User-friendly format</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Avg: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">avg</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (œÉ=</span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">std_dev</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Range: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">min</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">max</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cpk: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">cpk</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="cpk-analysis">Cpk Analysis</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementPath</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_process_capability</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">step_path</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze process capability (Cpk) for a measurement&quot;&quot;&quot;</span>

    <span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
        <span class="n">days</span><span class="o">=</span><span class="n">days</span>
    <span class="p">)</span>

    <span class="c1"># Accept string or MeasurementPath</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">MeasurementPath</span><span class="p">(</span><span class="n">step_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">step_path</span>

    <span class="n">measurements</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span>
        <span class="n">filter_obj</span><span class="p">,</span>
        <span class="n">measurement_paths</span><span class="o">=</span><span class="n">path</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">measurements</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No measurements found&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">meas</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== PROCESS CAPABILITY: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cpk: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">cpk</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">meas</span><span class="o">.</span><span class="n">cpk</span> <span class="o">&gt;=</span> <span class="mf">1.33</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úì Process is capable (Cpk ‚â• 1.33)&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">meas</span><span class="o">.</span><span class="n">cpk</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ö† Process is marginally capable (1.0 ‚â§ Cpk &lt; 1.33)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úó Process is not capable (Cpk &lt; 1.0)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">avg</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Std Dev: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">std_dev</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Range: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">min</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">max</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Samples: </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it with user-friendly path</span>
<span class="n">analyze_process_capability</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;Power Supply/3.3V Rail&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="unit-flow-analysis-internal">Unit Flow Analysis (Internal)</h2>
<p>‚ö†Ô∏è <strong>INTERNAL API - Subject to change</strong></p>
<p>Unit Flow visualizes production flow and identifies bottlenecks.</p>
<h3 id="basic-unit-flow-query">Basic Unit Flow Query</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitFlowFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Create filter</span>
<span class="n">flow_filter</span> <span class="o">=</span> <span class="n">UnitFlowFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">date_from</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
    <span class="n">date_to</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Get flow data</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_unit_flow</span><span class="p">(</span><span class="n">flow_filter</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== UNIT FLOW ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Links: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Units: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Show nodes (operations)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Operations:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">unit_count</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>

<span class="c1"># Show transitions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transitions:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">source_name</span><span class="si">}</span><span class="s2"> ‚Üí </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">target_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">unit_count</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="identify-bottlenecks">Identify Bottlenecks</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get bottlenecks (nodes with high unit count)</span>
<span class="n">flow_filter</span> <span class="o">=</span> <span class="n">UnitFlowFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>

<span class="n">bottlenecks</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_bottlenecks</span><span class="p">(</span><span class="n">flow_filter</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== BOTTLENECKS ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bottleneck</span> <span class="ow">in</span> <span class="n">bottlenecks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bottleneck</span><span class="o">.</span><span class="n">operation_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Units waiting: </span><span class="si">{</span><span class="n">bottleneck</span><span class="o">.</span><span class="n">unit_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Avg time: </span><span class="si">{</span><span class="n">bottleneck</span><span class="o">.</span><span class="n">avg_time_hours</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="trace-serial-numbers-through-flow">Trace Serial Numbers Through Flow</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Trace specific units</span>
<span class="n">flow_filter</span> <span class="o">=</span> <span class="n">UnitFlowFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">serial_numbers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;W12345&quot;</span><span class="p">,</span> <span class="s2">&quot;W12346&quot;</span><span class="p">,</span> <span class="s2">&quot;W12347&quot;</span><span class="p">],</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">)</span>

<span class="n">trace_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">trace_serial_numbers</span><span class="p">(</span><span class="n">flow_filter</span><span class="p">)</span>

<span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">trace_result</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Path: </span><span class="si">{</span><span class="s1">&#39; ‚Üí &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">node_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total time: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">total_time_hours</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="yield-dashboard">Yield Dashboard</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">WATSFilter</span>

<span class="k">def</span><span class="w"> </span><span class="nf">yield_dashboard</span><span class="p">(</span><span class="n">part_numbers</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate yield dashboard for multiple products&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;YIELD DASHBOARD (</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">pn</span> <span class="ow">in</span> <span class="n">part_numbers</span><span class="p">:</span>
        <span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>
        <span class="n">yield_result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_yield</span><span class="p">(</span><span class="n">filter_obj</span><span class="p">)</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;part&#39;</span><span class="p">:</span> <span class="n">pn</span><span class="p">,</span>
            <span class="s1">&#39;yield&#39;</span><span class="p">:</span> <span class="n">yield_result</span><span class="o">.</span><span class="n">yield_pct</span><span class="p">,</span>
            <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="n">yield_result</span><span class="o">.</span><span class="n">passed</span><span class="p">,</span>
            <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="n">yield_result</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">yield_result</span><span class="o">.</span><span class="n">total</span>
        <span class="p">})</span>

    <span class="c1"># Sort by yield (ascending)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;Part Number&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Yield&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Passed&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Failed&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Total&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;‚úì&quot;</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">95</span> <span class="k">else</span> <span class="s2">&quot;‚ö†&quot;</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">85</span> <span class="k">else</span> <span class="s2">&quot;‚úó&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.1f</span><span class="si">}</span><span class="s2">% </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Summary</span>
    <span class="n">avg_yield</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;yield&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">total_units</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;AVERAGE&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">avg_yield</span><span class="si">:</span><span class="s2">&gt;7.1f</span><span class="si">}</span><span class="s2">% </span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">total_units</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-002&quot;</span><span class="p">,</span> <span class="s2">&quot;WIDGET-003&quot;</span><span class="p">,</span> <span class="s2">&quot;GADGET-001&quot;</span><span class="p">]</span>
<span class="n">yield_dashboard</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>

<h3 id="measurement-report">Measurement Report</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">WATSFilter</span><span class="p">,</span> <span class="n">MeasurementPath</span>

<span class="k">def</span><span class="w"> </span><span class="nf">measurement_report</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">step_paths</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate measurement report for multiple steps&quot;&quot;&quot;</span>

    <span class="n">filter_obj</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

    <span class="c1"># Convert string paths to MeasurementPath objects</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">MeasurementPath</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">step_paths</span><span class="p">]</span>

    <span class="n">measurements</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_aggregated_measurements</span><span class="p">(</span>
        <span class="n">filter_obj</span><span class="p">,</span>
        <span class="n">measurement_paths</span><span class="o">=</span><span class="n">paths</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== MEASUREMENT REPORT: </span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Step&#39;</span><span class="si">:</span><span class="s2">&lt;40</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Avg&#39;</span><span class="si">:</span><span class="s2">&gt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Std Dev&#39;</span><span class="si">:</span><span class="s2">&gt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Cpk&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Count&#39;</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
        <span class="n">cpk_status</span> <span class="o">=</span> <span class="s2">&quot;‚úì&quot;</span> <span class="k">if</span> <span class="n">meas</span><span class="o">.</span><span class="n">cpk</span> <span class="o">&gt;=</span> <span class="mf">1.33</span> <span class="k">else</span> <span class="s2">&quot;‚ö†&quot;</span> <span class="k">if</span> <span class="n">meas</span><span class="o">.</span><span class="n">cpk</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="s2">&quot;‚úó&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">step_name</span><span class="si">:</span><span class="s2">&lt;40</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">avg</span><span class="si">:</span><span class="s2">&gt;10.3f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">std_dev</span><span class="si">:</span><span class="s2">&gt;10.3f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">cpk</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">meas</span><span class="o">.</span><span class="n">count</span><span class="si">:</span><span class="s2">&gt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cpk_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

<span class="c1"># Use it with user-friendly paths</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Power Supply Tests/3.3V Rail&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Power Supply Tests/5V Rail&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Power Supply Tests/12V Rail&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Temperature Tests/Idle Temp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Temperature Tests/Load Temp&quot;</span>
<span class="p">]</span>

<span class="n">measurement_report</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="analyticsservice-methods">AnalyticsService Methods</h3>
<p>All methods are accessed via <code>api.analytics</code>. Methods marked with ‚ö†Ô∏è use internal WATS endpoints that may change without notice.</p>
<h4 id="yield-operations">Yield Operations</h4>
<ul>
<li><code>get_yield(filter)</code> ‚Üí <code>YieldResult</code> - Calculate yield statistics</li>
</ul>
<h4 id="measurement-operations">Measurement Operations</h4>
<ul>
<li><code>get_aggregated_measurements(filter, measurement_paths)</code> ‚Üí <code>List[AggregatedMeasurement]</code> - Get measurement statistics</li>
</ul>
<h4 id="unit-flow-operations-internal-api">Unit Flow Operations (‚ö†Ô∏è Internal API)</h4>
<ul>
<li><code>get_unit_flow(filter)</code> ‚Üí <code>UnitFlowResult</code> - Get complete flow data</li>
<li><code>get_flow_nodes()</code> ‚Üí <code>List[UnitFlowNode]</code> - Get flow nodes</li>
<li><code>get_flow_links()</code> ‚Üí <code>List[UnitFlowLink]</code> - Get flow links</li>
<li><code>get_flow_units()</code> ‚Üí <code>List[UnitFlowUnit]</code> - Get flow units</li>
<li><code>get_bottlenecks(filter, min_yield_threshold)</code> ‚Üí <code>List[UnitFlowNode]</code> - Identify bottlenecks</li>
<li><code>trace_serial_numbers(serial_numbers, filter)</code> ‚Üí <code>UnitFlowResult</code> - Trace specific units</li>
</ul>
<h4 id="stepmeasurement-filter-operations-internal-api">Step/Measurement Filter Operations (‚ö†Ô∏è Internal API)</h4>
<ul>
<li><code>get_measurement_list(filter_data, step_filters, sequence_filters)</code> ‚Üí <code>List[MeasurementListItem]</code> - Measurement values with XML filters</li>
<li><code>get_measurement_list_by_product(product_group_id, level_id, days, step_filters, sequence_filters)</code> ‚Üí <code>List[MeasurementListItem]</code> - Simple query</li>
<li><code>get_step_status_list(filter_data, step_filters, sequence_filters)</code> ‚Üí <code>List[StepStatusItem]</code> - Step statuses with XML filters</li>
<li><code>get_step_status_list_by_product(product_group_id, level_id, days, step_filters, sequence_filters)</code> ‚Üí <code>List[StepStatusItem]</code> - Simple query</li>
<li><code>get_top_failed_advanced(filter_data, top_count)</code> ‚Üí <code>List[TopFailedStep]</code> - Top failed steps with advanced filters</li>
<li><code>get_top_failed_by_product(part_number, process_code, product_group_id, level_id, days, count)</code> ‚Üí <code>List[TopFailedStep]</code> - Simple query</li>
</ul>
<h3 id="enums">Enums</h3>
<h4 id="query-enums-from-pywats">Query Enums (from <code>pywats</code>)</h4>
<table>
<thead>
<tr>
<th>Enum</th>
<th>Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StatusFilter</code></td>
<td><code>PASSED</code>, <code>FAILED</code>, <code>ERROR</code>, <code>TERMINATED</code>, <code>ALL</code></td>
<td>Filter by test status</td>
</tr>
<tr>
<td><code>RunFilter</code></td>
<td><code>FIRST</code>, <code>LAST</code>, <code>ALL</code>, <code>ALL_EXCEPT_FIRST</code></td>
<td>Filter by run sequence</td>
</tr>
<tr>
<td><code>StepType</code></td>
<td><code>NUMERIC_LIMIT</code>, <code>STRING_VALUE</code>, <code>PASS_FAIL</code>, <code>SEQUENCECALL</code>, etc.</td>
<td>Step type classification</td>
</tr>
<tr>
<td><code>CompOperator</code></td>
<td><code>GELE</code>, <code>GT</code>, <code>LT</code>, <code>EQ</code>, <code>NE</code>, <code>LOG</code>, etc.</td>
<td>Comparison operators</td>
</tr>
<tr>
<td><code>SortDirection</code></td>
<td><code>ASC</code>, <code>DESC</code></td>
<td>Sort direction for dimension queries</td>
</tr>
</tbody>
</table>
<h4 id="dimensionkpi-enums-from-pywats-or-pywatsdomainsanalytics">Dimension/KPI Enums (from <code>pywats</code> or <code>pywats.domains.analytics</code>)</h4>
<table>
<thead>
<tr>
<th>Enum</th>
<th>Count</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Dimension</code></td>
<td>23+</td>
<td>Grouping dimensions (PART_NUMBER, STATION_NAME, PERIOD, etc.)</td>
</tr>
<tr>
<td><code>RepairDimension</code></td>
<td>15</td>
<td>Repair-specific dimensions</td>
</tr>
<tr>
<td><code>KPI</code></td>
<td>21+</td>
<td>Key Performance Indicators (FPY, RTY, PPM_FPY, etc.)</td>
</tr>
<tr>
<td><code>RepairKPI</code></td>
<td>2</td>
<td>Repair KPIs</td>
</tr>
</tbody>
</table>
<h4 id="dimensionbuilder-class-methods">DimensionBuilder Class Methods</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>add(dimension, direction=None, asc=False, desc=False)</code></td>
<td>Add dimension with optional sort</td>
</tr>
<tr>
<td><code>add_all(*dimensions)</code></td>
<td>Add multiple dimensions</td>
</tr>
<tr>
<td><code>build()</code></td>
<td>Build semicolon-separated string</td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>Clear all dimensions</td>
</tr>
<tr>
<td><code>yield_by_product()</code></td>
<td>Preset for product yield analysis</td>
</tr>
<tr>
<td><code>yield_by_station()</code></td>
<td>Preset for station yield analysis</td>
</tr>
<tr>
<td><code>repair_analysis()</code></td>
<td>Preset for repair statistics</td>
</tr>
<tr>
<td><code>oee_analysis()</code></td>
<td>Preset for OEE metrics</td>
</tr>
</tbody>
</table>
<h3 id="path-utilities-from-pywats">Path Utilities (from <code>pywats</code>)</h3>
<table>
<thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StepPath</code></td>
<td>Step path with <code>/</code> ‚Üî <code>¬∂</code> conversion</td>
</tr>
<tr>
<td><code>MeasurementPath</code></td>
<td>Measurement path with <code>/</code> ‚Üî <code>¬∂</code> conversion</td>
</tr>
</tbody>
</table>
<p><strong>Properties</strong>: <code>.display</code> (user-friendly), <code>.api_format</code> (internal), <code>.parts</code> (list)</p>
<p><strong>Methods</strong>: <code>from_parts(parts)</code>, concatenation with <code>/</code> operator</p>
<h3 id="models">Models</h3>
<h4 id="yieldresult">YieldResult</h4>
<ul>
<li><code>yield_pct</code>: float (percentage)</li>
<li><code>passed</code>: int</li>
<li><code>failed</code>: int</li>
<li><code>total</code>: int</li>
</ul>
<h4 id="aggregatedmeasurement">AggregatedMeasurement</h4>
<ul>
<li><code>step_name</code>: str</li>
<li><code>step_path</code>: str (API format with <code>¬∂</code>)</li>
<li><code>step_path_display</code>: str (user-friendly with <code>/</code>)</li>
<li><code>count</code>: int</li>
<li><code>avg</code>: float</li>
<li><code>min</code>, <code>max</code>: float</li>
<li><code>std_dev</code>: float</li>
<li><code>cpk</code>: float (process capability index)</li>
</ul>
<h4 id="topfailedstep">TopFailedStep</h4>
<ul>
<li><code>step_name</code>, <code>step_path</code>: str</li>
<li><code>step_path_display</code>: str (user-friendly)</li>
<li><code>step_type</code>: <code>Union[StepType, str]</code></li>
<li><code>fail_count</code>, <code>total_count</code>: int</li>
<li><code>step_filter</code>, <code>sequence_filter</code>: str (XML for drill-down)</li>
</ul>
<h4 id="stepanalysisrow">StepAnalysisRow</h4>
<ul>
<li><code>step_name</code>, <code>step_path</code>: str</li>
<li><code>step_path_display</code>: str (user-friendly)</li>
<li><code>step_type</code>: <code>Union[StepType, str]</code></li>
<li><code>comp_operator</code>: <code>Union[CompOperator, str]</code></li>
<li>Statistical fields: <code>avg</code>, <code>std_dev</code>, <code>cpk</code>, etc.</li>
</ul>
<h4 id="unitflowfilter">UnitFlowFilter</h4>
<ul>
<li><code>part_number</code>: str</li>
<li><code>date_from</code>, <code>date_to</code>: datetime</li>
<li><code>days</code>: int (shortcut for last N days)</li>
<li><code>serial_numbers</code>: List[str] (optional filter)</li>
</ul>
<h4 id="stepstatusitem-internal-api">StepStatusItem (‚ö†Ô∏è Internal API)</h4>
<ul>
<li><code>step_name</code>, <code>step_path</code>, <code>step_type</code>: str - Step identification</li>
<li><code>pass_count</code>, <code>fail_count</code>, <code>total_count</code>: int - Status counts</li>
<li><code>status</code>: str - Current status</li>
<li><code>serial_number</code>, <code>report_id</code>: str - Associated unit info</li>
</ul>
<h4 id="measurementlistitem-internal-api">MeasurementListItem (‚ö†Ô∏è Internal API)</h4>
<ul>
<li><code>serial_number</code>, <code>part_number</code>, <code>revision</code>: str - Unit identification</li>
<li><code>step_name</code>, <code>step_path</code>: str - Step identification</li>
<li><code>value</code>: float - Measured value</li>
<li><code>limit_low</code>, <code>limit_high</code>: float - Limits</li>
<li><code>status</code>: str - Pass/Fail status</li>
<li><code>unit</code>: str - Unit of measurement</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Use type-safe enums</strong> - Leverage <code>StatusFilter</code>, <code>RunFilter</code>, <code>Dimension</code>, <code>KPI</code> for IDE autocomplete</li>
<li><strong>Use path utilities</strong> - <code>MeasurementPath("Main/SubTest/Meas")</code> handles format conversion automatically</li>
<li><strong>Use DimensionBuilder presets</strong> - Start with <code>DimensionBuilder.yield_by_product()</code> and customize</li>
<li><strong>Start with simple queries</strong> - Use default parameters, add filters as needed</li>
<li><strong>Monitor Cpk trends</strong> - Cpk &lt; 1.0 indicates process capability issues</li>
<li><strong>Investigate anomalies</strong> - Low Cpk or sudden yield drops</li>
<li><strong>Use Unit Flow for bottlenecks</strong> - Visualize production flow</li>
</ol>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="report.md">Report Domain</a> - Test reports and measurements</li>
<li><a href="production.md">Production Domain</a> - Unit lifecycle and status</li>
<li><a href="process.md">Process Domain</a> - Operation type definitions</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-rootcause">
    <div class="doc-source">Source: docs/modules/rootcause.md</div>
    <h1 id="rootcause-domain">RootCause Domain</h1>
<p>The RootCause domain provides issue tracking and defect management capabilities. Use this to create tickets for failures, track root cause investigations, assign work, and close issues. It supports status-based workflows (Open ‚Üí In Progress ‚Üí Resolved ‚Üí Closed), priority management, and view filtering (assigned to me, following, all).</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#ticket-management">Ticket Management</a></li>
<li><a href="#status-and-workflow">Status and Workflow</a></li>
<li><a href="#priority-management">Priority Management</a></li>
<li><a href="#view-filtering">View Filtering</a></li>
<li><a href="#search-and-query">Search and Query</a></li>
<li><a href="#Ô∏è-known-issues--workarounds">‚ö†Ô∏è Known Issues &amp; Workarounds</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get all open tickets</span>
<span class="n">open_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_open_tickets</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== OPEN TICKETS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">open_tickets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Priority: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Assigned: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assigned_to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get specific ticket</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="k">if</span> <span class="n">ticket</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ticket: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get active tickets (open + in progress)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="n">active</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">active</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickets assigned to me&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">track_issues</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Fetch different ticket views concurrently</span>
        <span class="n">my_tickets</span><span class="p">,</span> <span class="n">all_open</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_open_tickets</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;My tickets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">my_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">, All open: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_open</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">track_issues</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="tickets">Tickets</h3>
<p>A <strong>Ticket</strong> is an issue tracking record:<br />
- <code>subject</code>: Ticket title<br />
- <code>description</code>: Detailed description<br />
- <code>status</code>: Current status (OPEN, IN_PROGRESS, etc.)<br />
- <code>priority</code>: Priority level (LOW, NORMAL, HIGH, CRITICAL)<br />
- <code>assigned_to</code>: User assigned to the ticket</p>
<h3 id="status-workflow">Status Workflow</h3>
<p>Tickets flow through statuses:<br />
- <strong>OPEN</strong>: New ticket, not yet started<br />
- <strong>IN_PROGRESS</strong>: Actively being worked on<br />
- <strong>RESOLVED</strong>: Solution implemented, awaiting verification<br />
- <strong>CLOSED</strong>: Verified and closed</p>
<h3 id="priority-levels">Priority Levels</h3>
<p>Priority indicates urgency:<br />
- <strong>LOW</strong>: Minor issue, no immediate impact<br />
- <strong>NORMAL</strong>: Standard issue<br />
- <strong>HIGH</strong>: Important, needs attention soon<br />
- <strong>CRITICAL</strong>: Urgent, production impact</p>
<h3 id="views">Views</h3>
<p>View filters control which tickets you see:<br />
- <strong>ASSIGNED</strong>: Tickets assigned to you<br />
- <strong>FOLLOWING</strong>: Tickets you're following<br />
- <strong>ALL</strong>: All tickets (requires permissions)</p>
<hr />
<h2 id="ticket-management">Ticket Management</h2>
<h3 id="get-ticket-by-id">Get Ticket by ID</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get specific ticket</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="k">if</span> <span class="n">ticket</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ticket #</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Priority: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assigned: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assigned_to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">created_date_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Description:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ticket not found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-all-open-tickets">Get All Open Tickets</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="c1"># Get all open tickets (view: all)</span>
<span class="n">open_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_open_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== OPEN TICKETS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">open_tickets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Priority: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Assigned: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assigned_to</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Unassigned&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">created_date_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-active-tickets">Get Active Tickets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get open + in-progress tickets</span>
<span class="n">active</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== ACTIVE TICKETS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">active</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">active</span><span class="p">:</span>
    <span class="n">status_icon</span> <span class="o">=</span> <span class="s2">&quot;üü°&quot;</span> <span class="k">if</span> <span class="n">ticket</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;OPEN&quot;</span> <span class="k">else</span> <span class="s2">&quot;üîµ&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_icon</span><span class="si">}</span><span class="s2"> #</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="status-and-workflow">Status and Workflow</h2>
<h3 id="query-by-status">Query by Status</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketStatus</span>

<span class="c1"># Get tickets with specific status</span>
<span class="n">open_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Open tickets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get in-progress tickets</span>
<span class="n">in_progress</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In progress: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">in_progress</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="combine-multiple-statuses">Combine Multiple Statuses</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get open OR in-progress tickets using &quot;|&quot; operator</span>
<span class="n">active_status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">active_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">active_status</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active tickets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">active_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Breakdown by status</span>
<span class="n">by_status</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">active_tickets</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">status</span>
    <span class="n">by_status</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">status</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">by_status</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="track-status-changes">Track Status Changes</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">track_ticket_workflow</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show ticket history and status changes&quot;&quot;&quot;</span>

    <span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ticket</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ticket not found&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== TICKET #</span><span class="si">{</span><span class="n">ticket_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">created_date_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># If ticket has updates/history</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ticket</span><span class="p">,</span> <span class="s1">&#39;updates&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ticket</span><span class="o">.</span><span class="n">updates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">History:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">update</span> <span class="ow">in</span> <span class="n">ticket</span><span class="o">.</span><span class="n">updates</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">update</span><span class="o">.</span><span class="n">date_time</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">update</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">track_ticket_workflow</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="priority-management">Priority Management</h2>
<h3 id="filter-by-priority">Filter by Priority</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketPriority</span><span class="p">,</span> <span class="n">TicketView</span>

<span class="c1"># Get high priority tickets</span>
<span class="n">high_priority</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== HIGH PRIORITY TICKETS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">high_priority</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">high_priority</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Assigned: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assigned_to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="priority-report">Priority Report</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="k">def</span><span class="w"> </span><span class="nf">priority_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate report of tickets by priority&quot;&quot;&quot;</span>

    <span class="c1"># Get all active tickets</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>

    <span class="c1"># Count by priority</span>
    <span class="n">by_priority</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">active</span><span class="p">:</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">priority</span>
        <span class="n">by_priority</span><span class="p">[</span><span class="n">priority</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_priority</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ACTIVE TICKETS BY PRIORITY&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="c1"># Define priority order</span>
    <span class="n">priority_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span> <span class="s2">&quot;LOW&quot;</span><span class="p">]</span>

    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">priority</span> <span class="ow">in</span> <span class="n">priority_order</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">by_priority</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">count</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;üî¥&quot;</span> <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="s2">&quot;CRITICAL&quot;</span> <span class="k">else</span> <span class="s2">&quot;üü†&quot;</span> <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="s2">&quot;HIGH&quot;</span> <span class="k">else</span> <span class="s2">&quot;üü°&quot;</span> <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="s2">&quot;NORMAL&quot;</span> <span class="k">else</span> <span class="s2">&quot;üü¢&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">priority</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">count</span><span class="si">:</span><span class="s2">&gt;4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;TOTAL&#39;</span><span class="si">:</span><span class="s2">&lt;14</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">total</span><span class="si">:</span><span class="s2">&gt;4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">priority_report</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="view-filtering">View Filtering</h2>
<h3 id="assigned-to-me">Assigned to Me</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="c1"># Get tickets assigned to me</span>
<span class="n">my_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== MY TICKETS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">my_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">my_tickets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Priority: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="following">Following</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get tickets I&#39;m following</span>
<span class="n">following</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">FOLLOWING</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== FOLLOWING (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">following</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">following</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="all-tickets-with-permissions">All Tickets (with permissions)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all tickets (requires permissions)</span>
<span class="n">all_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total tickets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Group by assigned user</span>
<span class="n">by_user</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">all_tickets</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">assigned_to</span> <span class="ow">or</span> <span class="s2">&quot;Unassigned&quot;</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_user</span><span class="p">:</span>
        <span class="n">by_user</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">by_user</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== TICKETS BY ASSIGNEE ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">tickets</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_user</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tickets</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickets&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="search-and-query">Search and Query</h2>
<h3 id="search-by-subjecttags">Search by Subject/Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Search for tickets containing &quot;calibration&quot;</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">search_string</span><span class="o">=</span><span class="s2">&quot;calibration&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== SEARCH: &#39;calibration&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Tags: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">ticket</span><span class="o">.</span><span class="n">tags</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="combined-search">Combined Search</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketStatus</span><span class="p">,</span> <span class="n">TicketPriority</span>

<span class="c1"># Search for high priority open tickets about &quot;ICT&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">search_string</span><span class="o">=</span><span class="s2">&quot;ICT&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== HIGH PRIORITY OPEN ICT ISSUES (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="find-tickets-for-part-number">Find Tickets for Part Number</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_tickets_for_part</span><span class="p">(</span><span class="n">part_number</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all tickets related to a part number&quot;&quot;&quot;</span>

    <span class="c1"># Search in subject and tags</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">search_string</span><span class="o">=</span><span class="n">part_number</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== TICKETS FOR </span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Priority: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">created_date_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">find_tickets_for_part</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="known-issues-workarounds">‚ö†Ô∏è Known Issues &amp; Workarounds</h2>
<h3 id="server-does-not-return-assignee-field">Server Does Not Return Assignee Field</h3>
<p><strong>Problem</strong>: The WATS server does NOT return the <code>assignee</code> field in ticket API responses. After fetching a ticket via <code>get_ticket()</code>, the <code>assignee</code> field will always be <code>None</code>, even if the ticket is actually assigned to someone.</p>
<p>This causes issues because WATS enforces the business rule:</p>
<blockquote>
<p>"Unassigned tickets must have status 'new'"</p>
</blockquote>
<p>If you fetch a ticket and try to update it (e.g., change status to SOLVED), the update will fail with a 400 error because the server sees no assignee in your request.</p>
<p><strong>Workaround</strong>: Always preserve and pass the assignee explicitly when modifying tickets.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚ùå BAD - This will fail for assigned tickets with non-new status</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">update_ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>  <span class="c1"># 400 Error: &quot;Unassigned tickets must have status new&quot;</span>

<span class="c1"># ‚úÖ GOOD - Use change_status() with explicit assignee</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">,</span>
    <span class="n">assignee</span><span class="o">=</span><span class="s2">&quot;user@example.com&quot;</span>  <span class="c1"># Must provide the current assignee!</span>
<span class="p">)</span>

<span class="c1"># ‚úÖ GOOD - Use add_comment() with explicit assignee</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;This is a comment&quot;</span><span class="p">,</span>
    <span class="n">assignee</span><span class="o">=</span><span class="s2">&quot;user@example.com&quot;</span>  <span class="c1"># Must provide the current assignee!</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Best Practices</strong>:<br />
1. When creating workflows, store the assignee from <code>create_ticket()</code> or <code>assign_ticket()</code> results<br />
2. Pass the assignee to all subsequent <code>add_comment()</code> and <code>change_status()</code> calls<br />
3. Don't rely on <code>get_ticket()</code> to tell you who a ticket is assigned to<br />
4. If using fixtures in tests, include the assignee in the fixture data</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Example: Store assignee when creating a ticket</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Issue investigation&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">assignee</span><span class="o">=</span><span class="s2">&quot;user@example.com&quot;</span>
<span class="p">)</span>

<span class="c1"># The service preserves assignee in the result</span>
<span class="n">stored_assignee</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">assignee</span>  <span class="c1"># &quot;user@example.com&quot;</span>

<span class="c1"># Later, when updating the ticket, pass the stored assignee</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">,</span>
    <span class="n">assignee</span><span class="o">=</span><span class="n">stored_assignee</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="ticket-dashboard">Ticket Dashboard</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ticket_dashboard</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate comprehensive ticket dashboard&quot;&quot;&quot;</span>

    <span class="c1"># Get all tickets</span>
    <span class="n">all_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TICKET DASHBOARD&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

    <span class="c1"># Summary by status</span>
    <span class="n">by_status</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">all_tickets</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">status</span>
        <span class="n">by_status</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">By Status:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">status</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_status</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get active tickets</span>
    <span class="n">active</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">all_tickets</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span> <span class="s2">&quot;IN_PROGRESS&quot;</span><span class="p">]]</span>

    <span class="c1"># Active by priority</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Active Tickets by Priority (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">active</span><span class="p">)</span><span class="si">}</span><span class="s2"> total):&quot;</span><span class="p">)</span>
    <span class="n">by_priority</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">active</span><span class="p">:</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">priority</span>
        <span class="n">by_priority</span><span class="p">[</span><span class="n">priority</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_priority</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">priority</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span> <span class="s2">&quot;LOW&quot;</span><span class="p">]:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">by_priority</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">priority</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Unassigned</span>
    <span class="n">unassigned</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">active</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">assigned_to</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">unassigned</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ö† </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unassigned</span><span class="p">)</span><span class="si">}</span><span class="s2"> unassigned active tickets&quot;</span><span class="p">)</span>

    <span class="c1"># Old tickets</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
    <span class="n">old_cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">old_active</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">active</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">created_date_time</span> <span class="o">&lt;</span> <span class="n">old_cutoff</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">old_active</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ö† </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">old_active</span><span class="p">)</span><span class="si">}</span><span class="s2"> active tickets older than 30 days&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">ticket_dashboard</span><span class="p">()</span>
</code></pre></div>

<h3 id="defect-tracking-integration">Defect Tracking Integration</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">track_defect_from_failure</span><span class="p">(</span><span class="n">uut_report_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create/update ticket when a unit fails&quot;&quot;&quot;</span>

    <span class="c1"># Get the failed UUT report (from Report domain)</span>
    <span class="n">uut_report</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_uut_report</span><span class="p">(</span><span class="n">uut_report_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">uut_report</span> <span class="ow">or</span> <span class="n">uut_report</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;Failed&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UUT did not fail&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Check if ticket already exists</span>
    <span class="n">search_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;UUT:</span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">existing</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span><span class="n">search_string</span><span class="o">=</span><span class="n">search_string</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
        <span class="n">ticket</span> <span class="o">=</span> <span class="n">existing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing ticket: #</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Create new ticket (implementation depends on API)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Need to create ticket for </span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">subject</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failure: </span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unit failed at </span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">completed_date_time</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Station: </span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">station</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Operator: </span><span class="si">{</span><span class="n">uut_report</span><span class="o">.</span><span class="n">operator</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Add failed steps</span>
        <span class="n">failed_steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">uut_report</span><span class="o">.</span><span class="n">steps</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Failed&quot;</span><span class="p">]</span>
        <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed Steps:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">failed_steps</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="c1"># Use it</span>
<span class="n">track_defect_from_failure</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
</code></pre></div>

<h3 id="aging-report">Aging Report</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">def</span><span class="w"> </span><span class="nf">aging_report</span><span class="p">(</span><span class="n">days_threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find old active tickets&quot;&quot;&quot;</span>

    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_threshold</span><span class="p">)</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">()</span>

    <span class="n">old_tickets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">active</span> 
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">created_date_time</span> <span class="o">&lt;</span> <span class="n">cutoff</span>
    <span class="p">]</span>

    <span class="c1"># Sort by age (oldest first)</span>
    <span class="n">old_tickets</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">created_date_time</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== TICKETS OLDER THAN </span><span class="si">{</span><span class="n">days_threshold</span><span class="si">}</span><span class="s2"> DAYS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">old_tickets</span><span class="p">)</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">old_tickets</span><span class="p">:</span>
        <span class="n">age_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">ticket</span><span class="o">.</span><span class="n">created_date_time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Age: </span><span class="si">{</span><span class="n">age_days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Priority: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Assigned: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assigned_to</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Unassigned&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">aging_report</span><span class="p">(</span><span class="n">days_threshold</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="rootcauseservice-methods">RootCauseService Methods</h3>
<h4 id="ticket-queries">Ticket Queries</h4>
<ul>
<li><code>get_ticket(ticket_id)</code> ‚Üí <code>Optional[Ticket]</code> - Get specific ticket</li>
<li><code>get_tickets(status=None, view=None, search_string=None)</code> ‚Üí <code>List[Ticket]</code> - Query tickets</li>
<li><code>get_open_tickets(view=None)</code> ‚Üí <code>List[Ticket]</code> - Get open tickets</li>
<li><code>get_active_tickets(view=None)</code> ‚Üí <code>List[Ticket]</code> - Get open + in-progress tickets</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="ticket">Ticket</h4>
<ul>
<li><code>id</code>: int - Ticket ID</li>
<li><code>subject</code>: str - Ticket title</li>
<li><code>description</code>: str - Detailed description</li>
<li><code>status</code>: str - Status (OPEN, IN_PROGRESS, RESOLVED, CLOSED)</li>
<li><code>priority</code>: str - Priority (LOW, NORMAL, HIGH, CRITICAL)</li>
<li><code>assigned_to</code>: str - Assigned user</li>
<li><code>created_date_time</code>: datetime - Creation timestamp</li>
<li><code>tags</code>: List[str] - Tags for organization</li>
<li><code>updates</code>: List[TicketUpdate] - Update history</li>
</ul>
<h4 id="ticketstatus-enum">TicketStatus (Enum)</h4>
<ul>
<li><code>OPEN</code> - New ticket</li>
<li><code>IN_PROGRESS</code> - Being worked on</li>
<li><code>RESOLVED</code> - Solution implemented</li>
<li><code>CLOSED</code> - Verified and closed</li>
</ul>
<h4 id="ticketpriority-enum">TicketPriority (Enum)</h4>
<ul>
<li><code>LOW</code> - Minor issue</li>
<li><code>NORMAL</code> - Standard priority</li>
<li><code>HIGH</code> - Important</li>
<li><code>CRITICAL</code> - Urgent</li>
</ul>
<h4 id="ticketview-enum">TicketView (Enum)</h4>
<ul>
<li><code>ASSIGNED</code> - Tickets assigned to you</li>
<li><code>FOLLOWING</code> - Tickets you're following</li>
<li><code>ALL</code> - All tickets (requires permissions)</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Use appropriate priority</strong> - Reserve CRITICAL for production impact</li>
<li><strong>Assign tickets promptly</strong> - Avoid unassigned backlog</li>
<li><strong>Search before creating</strong> - Avoid duplicate tickets</li>
<li><strong>Update status regularly</strong> - Keep workflow current</li>
<li><strong>Use tags</strong> - Tag with part numbers, stations, categories</li>
<li><strong>Monitor aging tickets</strong> - Review old active tickets regularly</li>
<li><strong>Link to evidence</strong> - Reference UUT reports, measurements</li>
<li><strong>Close resolved tickets</strong> - Verify and close when complete</li>
</ol>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="report.md">Report Domain</a> - Link tickets to failed test reports</li>
<li><a href="production.md">Production Domain</a> - Track units with defects</li>
<li><a href="analytics.md">Analytics Domain</a> - Analyze failure trends</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-software">
    <div class="doc-source">Source: docs/modules/software.md</div>
    <h1 id="software-domain">Software Domain</h1>
<p>The Software domain manages software packages and their distribution. Use this to track software versions, manage releases, organize packages with tags and folders, and associate files with packages. It supports versioning, status management (Development, Released, Obsolete), and tag-based organization.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#package-management">Package Management</a></li>
<li><a href="#package-files">Package Files</a></li>
<li><a href="#tags-and-organization">Tags and Organization</a></li>
<li><a href="#virtual-folders">Virtual Folders</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#api-reference">API Reference</a></li>
</ul>
<hr />
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="c1"># Initialize</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get all released packages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageStatus</span>

<span class="n">released</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">released</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get specific package by name</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Version: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># List package files</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_size</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>

<span class="c1"># Get latest released version</span>
<span class="n">latest</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_released_package</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageStatus</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">manage_software</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Fetch multiple package statuses concurrently</span>
        <span class="n">released</span><span class="p">,</span> <span class="n">development</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">DEVELOPMENT</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Released: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">released</span><span class="p">)</span><span class="si">}</span><span class="s2">, In Development: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">development</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">manage_software</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="packages">Packages</h3>
<p>A <strong>Package</strong> is a versioned software distribution:<br />
- <code>name</code>: Package name (unique)<br />
- <code>version</code>: Version string<br />
- <code>status</code>: DEVELOPMENT, RELEASED, or OBSOLETE<br />
- <code>description</code>: Package description<br />
- <code>files</code>: Associated files</p>
<h3 id="package-status">Package Status</h3>
<p>Packages can be in three states:<br />
- <strong>DEVELOPMENT</strong>: Under development, not ready for release<br />
- <strong>RELEASED</strong>: Released and ready for use<br />
- <strong>OBSOLETE</strong>: Deprecated, no longer recommended</p>
<h3 id="tags">Tags</h3>
<p><strong>Tags</strong> are key-value pairs for organizing packages:<br />
- <code>tag</code>: Tag name (e.g., "product", "type")<br />
- <code>value</code>: Tag value (e.g., "WIDGET-001", "firmware")</p>
<h3 id="virtual-folders">Virtual Folders</h3>
<p><strong>Virtual Folders</strong> organize packages hierarchically:<br />
- Folder-like structure without physical directories<br />
- Packages can belong to multiple folders<br />
- Used for logical organization (e.g., by product line, by type)</p>
<hr />
<h2 id="package-management">Package Management</h2>
<h3 id="list-all-packages">List All Packages</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all packages</span>
<span class="n">all_packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total packages: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_packages</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">all_packages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="filter-by-status">Filter by Status</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageStatus</span>

<span class="c1"># Get only released packages</span>
<span class="n">released</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== RELEASED PACKAGES ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">released</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get development packages</span>
<span class="n">dev_packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">DEVELOPMENT</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dev_packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> packages in development&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-package-by-id">Get Package by ID</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get specific package</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Version: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">created_date_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package not found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-package-by-name">Get Package by Name</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get latest version of a package by name</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package not found&quot;</span><span class="p">)</span>

<span class="c1"># Get specific version and status</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span>
    <span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2.1.0&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="get-latest-released-package">Get Latest Released Package</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get the latest released version</span>
<span class="n">latest</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_released_package</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">latest</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latest released: v</span><span class="si">{</span><span class="n">latest</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Released: </span><span class="si">{</span><span class="n">latest</span><span class="o">.</span><span class="n">created_date_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No released version found&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="package-files">Package Files</h2>
<h3 id="list-package-files">List Package Files</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get package and its files</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span> <span class="ow">and</span> <span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== FILES IN </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Size: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  MD5: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">md5_checksum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Description: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No files found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="download-package-file">Download Package File</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">def</span><span class="w"> </span><span class="nf">download_package_files</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">destination_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download all files from a package&quot;&quot;&quot;</span>

    <span class="c1"># Get package</span>
    <span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_released_package</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">package</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files in package &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Create destination folder</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files from </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>

        <span class="c1"># Download using software service (method depends on implementation)</span>
        <span class="c1"># This is a placeholder - actual implementation may vary</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">file_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>

        <span class="c1"># Verify checksum after download</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;md5_checksum&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    MD5: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">md5_checksum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded to: </span><span class="si">{</span><span class="n">destination_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">download_package_files</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">,</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Downloads</span><span class="se">\\</span><span class="s2">Firmware&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="tags-and-organization">Tags and Organization</h2>
<h3 id="query-packages-by-tag">Query Packages by Tag</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get packages with a specific tag</span>
<span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages_by_tag</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;product&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== PACKAGES FOR WIDGET-001 ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Filter by status too</span>
<span class="n">released_packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages_by_tag</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;product&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="list-package-tags">List Package Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get package and inspect tags</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span> <span class="ow">and</span> <span class="n">package</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== TAGS FOR </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No tags found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="organize-by-tags">Organize by Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_packages_by_product</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Group packages by product tag&quot;&quot;&quot;</span>

    <span class="c1"># Get all released packages</span>
    <span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">)</span>

    <span class="c1"># Group by product tag</span>
    <span class="n">by_product</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pkg</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">pkg</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span>
                    <span class="n">product</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">if</span> <span class="n">product</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_product</span><span class="p">:</span>
                        <span class="n">by_product</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">by_product</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>

    <span class="c1"># Display</span>
    <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">pkgs</span> <span class="ow">in</span> <span class="n">by_product</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">list_packages_by_product</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="virtual-folders_1">Virtual Folders</h2>
<h3 id="list-folders">List Folders</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all virtual folders</span>
<span class="n">folders</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_virtual_folders</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== VIRTUAL FOLDERS ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Packages: </span><span class="si">{</span><span class="n">folder</span><span class="o">.</span><span class="n">package_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-packages-in-folder">Get Packages in Folder</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get packages in a specific folder</span>
<span class="n">folder_packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages_in_folder</span><span class="p">(</span><span class="s2">&quot;Firmware/Stable&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== PACKAGES IN Firmware/Stable ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">folder_packages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="folder-hierarchy">Folder Hierarchy</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show_folder_tree</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display virtual folder hierarchy&quot;&quot;&quot;</span>

    <span class="n">folders</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_virtual_folders</span><span class="p">()</span>

    <span class="c1"># Sort by path</span>
    <span class="n">folders</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== PACKAGE FOLDERS ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
        <span class="c1"># Calculate indent based on path depth</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">folder</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="n">depth</span>
        <span class="n">folder_name</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/ (</span><span class="si">{</span><span class="n">folder</span><span class="o">.</span><span class="n">package_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">show_folder_tree</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="advanced-usage">Advanced Usage</h2>
<h3 id="version-comparison">Version Comparison</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_latest_version</span><span class="p">(</span><span class="n">package_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find latest version across all statuses&quot;&quot;&quot;</span>

    <span class="c1"># Get all packages with this name</span>
    <span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">()</span>

    <span class="c1"># Filter by name</span>
    <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packages</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">package_name</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">matching</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No packages found with name &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Sort by version</span>
    <span class="n">matching</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">version</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">latest</span> <span class="o">=</span> <span class="n">matching</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== VERSIONS OF </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">matching</span><span class="p">:</span>
        <span class="n">current</span> <span class="o">=</span> <span class="s2">&quot; &lt;- LATEST&quot;</span> <span class="k">if</span> <span class="n">pkg</span> <span class="o">==</span> <span class="n">latest</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">latest</span>

<span class="c1"># Use it</span>
<span class="n">latest</span> <span class="o">=</span> <span class="n">get_latest_version</span><span class="p">(</span><span class="s2">&quot;FirmwareUpdate&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="package-audit">Package Audit</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">def</span><span class="w"> </span><span class="nf">audit_packages</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find packages that need attention&quot;&quot;&quot;</span>

    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

    <span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== PACKAGE AUDIT (last </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Old development packages</span>
    <span class="n">old_dev</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packages</span> 
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PackageStatus</span><span class="o">.</span><span class="n">DEVELOPMENT</span> 
        <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">created_date_time</span> <span class="o">&lt;</span> <span class="n">cutoff</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">old_dev</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö† </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">old_dev</span><span class="p">)</span><span class="si">}</span><span class="s2"> development packages older than </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">old_dev</span><span class="p">:</span>
            <span class="n">age</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">pkg</span><span class="o">.</span><span class="n">created_date_time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2"> days old)&quot;</span><span class="p">)</span>

    <span class="c1"># Packages with no files</span>
    <span class="n">no_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packages</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">files</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">no_files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ö† </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">no_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> packages with no files:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">no_files</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

    <span class="c1"># Released packages</span>
    <span class="n">released</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packages</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úì </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">released</span><span class="p">)</span><span class="si">}</span><span class="s2"> released packages&quot;</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">audit_packages</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></div>

<h3 id="package-distribution-report">Package Distribution Report</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">package_distribution_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show package distribution by status&quot;&quot;&quot;</span>

    <span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">()</span>

    <span class="c1"># Count by status</span>
    <span class="n">by_status</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="n">by_status</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Count by tag</span>
    <span class="n">by_tag</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pkg</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">pkg</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">by_tag</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Display</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PACKAGE DISTRIBUTION REPORT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total Packages: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">By Status:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">status</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_status</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top Tags:&quot;</span><span class="p">)</span>
    <span class="n">sorted_tags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_tag</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sorted_tags</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># Use it</span>
<span class="n">package_distribution_report</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="api-reference">API Reference</h2>
<h3 id="softwareservice-methods">SoftwareService Methods</h3>
<h4 id="package-queries">Package Queries</h4>
<ul>
<li><code>get_packages(status=None)</code> ‚Üí <code>List[Package]</code> - Get all packages, optionally filtered by status</li>
<li><code>get_package(package_id)</code> ‚Üí <code>Optional[Package]</code> - Get package by ID</li>
<li><code>get_package_by_name(name, status=None, version=None)</code> ‚Üí <code>Optional[Package]</code> - Get package by name</li>
<li><code>get_released_package(name)</code> ‚Üí <code>Optional[Package]</code> - Get latest released version</li>
</ul>
<h4 id="tag-queries">Tag Queries</h4>
<ul>
<li><code>get_packages_by_tag(tag, value, status=None)</code> ‚Üí <code>List[Package]</code> - Get packages with specific tag</li>
</ul>
<h4 id="virtual-folder-queries">Virtual Folder Queries</h4>
<ul>
<li><code>get_virtual_folders()</code> ‚Üí <code>List[VirtualFolder]</code> - Get all folders</li>
<li><code>get_packages_in_folder(folder_path)</code> ‚Üí <code>List[Package]</code> - Get packages in folder</li>
</ul>
<h3 id="models">Models</h3>
<h4 id="package">Package</h4>
<ul>
<li><code>id</code>: int - Package ID</li>
<li><code>name</code>: str - Package name</li>
<li><code>version</code>: str - Version string</li>
<li><code>status</code>: PackageStatus - Status (DEVELOPMENT, RELEASED, OBSOLETE)</li>
<li><code>description</code>: str - Description</li>
<li><code>created_date_time</code>: datetime - Creation timestamp</li>
<li><code>files</code>: List[PackageFile] - Associated files</li>
<li><code>tags</code>: List[PackageTag] - Tags</li>
</ul>
<h4 id="packagefile">PackageFile</h4>
<ul>
<li><code>id</code>: int - File ID</li>
<li><code>file_name</code>: str - File name</li>
<li><code>file_size</code>: int - File size in bytes</li>
<li><code>file_type</code>: str - MIME type</li>
<li><code>md5_checksum</code>: str - MD5 hash</li>
<li><code>description</code>: str - File description</li>
</ul>
<h4 id="packagetag">PackageTag</h4>
<ul>
<li><code>tag</code>: str - Tag name</li>
<li><code>value</code>: str - Tag value</li>
</ul>
<h4 id="virtualfolder">VirtualFolder</h4>
<ul>
<li><code>id</code>: int - Folder ID</li>
<li><code>path</code>: str - Folder path</li>
<li><code>package_count</code>: int - Number of packages</li>
</ul>
<h4 id="packagestatus-enum">PackageStatus (Enum)</h4>
<ul>
<li><code>DEVELOPMENT</code> - Under development</li>
<li><code>RELEASED</code> - Released and ready</li>
<li><code>OBSOLETE</code> - Deprecated</li>
</ul>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Use status filtering</strong> - Filter by RELEASED for production deployments</li>
<li><strong>Version semantically</strong> - Use semantic versioning (major.minor.patch)</li>
<li><strong>Tag consistently</strong> - Establish tag naming conventions</li>
<li><strong>Verify checksums</strong> - Always verify MD5 checksums after download</li>
<li><strong>Organize with folders</strong> - Use virtual folders for logical grouping</li>
<li><strong>Archive old versions</strong> - Mark as OBSOLETE instead of deleting</li>
<li><strong>Document packages</strong> - Provide clear descriptions</li>
<li><strong>Track associations</strong> - Tag packages with product/component info</li>
</ol>
<hr />
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="product.md">Product Domain</a> - Products and revisions</li>
<li><a href="production.md">Production Domain</a> - Unit production and assembly</li>
<li><a href="asset.md">Asset Domain</a> - Equipment and calibration</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-scim">
    <div class="doc-source">Source: docs/modules/scim.md</div>
    <h1 id="scim-user-provisioning">SCIM - User Provisioning</h1>
<p>The SCIM (System for Cross-domain Identity Management) domain provides API access for automatic user provisioning from Azure Active Directory to WATS.</p>
<h2 id="overview">Overview</h2>
<p>SCIM is an industry standard protocol (RFC 7644) for managing user identities across cloud services. The WATS SCIM endpoint enables automatic user provisioning from Azure AD, supporting:</p>
<ul>
<li>User creation and deletion</li>
<li>User activation/deactivation</li>
<li>User attribute updates (display name, etc.)</li>
<li>Token generation for Azure AD configuration</li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<h3 id="synchronous-usage">Synchronous Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
<span class="p">)</span>

<span class="c1"># Get provisioning token for Azure AD configuration</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">duration_days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="k">if</span> <span class="n">token</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configure Azure with: </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">token</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

<span class="c1"># List all SCIM users</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">resources</span> <span class="ow">or</span> <span class="p">[]:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;active&quot;</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">active</span> <span class="k">else</span> <span class="s2">&quot;inactive&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">user_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="asynchronous-usage">Asynchronous Usage</h3>
<p>For concurrent requests and better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncWATS</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provision_users</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncWATS</span><span class="p">(</span>
        <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://your-wats-server.com&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-api-token&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">api</span><span class="p">:</span>
        <span class="c1"># Get token and users concurrently</span>
        <span class="n">token</span><span class="p">,</span> <span class="n">users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">duration_days</span><span class="o">=</span><span class="mi">90</span><span class="p">),</span>
            <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token valid until: </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">expires_utc</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total users: </span><span class="si">{</span><span class="n">users</span><span class="o">.</span><span class="n">total_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">provision_users</span><span class="p">())</span>
</code></pre></div>

<h2 id="service-methods">Service Methods</h2>
<h3 id="token-generation">Token Generation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get JWT token for Azure AD provisioning configuration</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">duration_days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="k">if</span> <span class="n">token</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token expires: </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">expires_utc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token: </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="user-listing">User Listing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all SCIM users (single page)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total users: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">total_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">resources</span> <span class="ow">or</span> <span class="p">[]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">user_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="paginated-user-iteration">Paginated User Iteration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Iterate over ALL users efficiently (automatic pagination)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">iter_users</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">user_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># With max limit</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">iter_users</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_users</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">process_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="c1"># With progress callback</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">,</span> <span class="n">items_so_far</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetched page </span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">items_so_far</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> users&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">iter_users</span><span class="p">(</span><span class="n">on_page</span><span class="o">=</span><span class="n">on_page</span><span class="p">):</span>
    <span class="n">sync_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h3 id="user-creation">User Creation</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScimUser</span><span class="p">,</span> <span class="n">ScimUserName</span><span class="p">,</span> <span class="n">ScimUserEmail</span>

<span class="c1"># Create a new user</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">ScimUser</span><span class="p">(</span>
    <span class="n">user_name</span><span class="o">=</span><span class="s2">&quot;john.doe@example.com&quot;</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="n">ScimUserName</span><span class="p">(</span><span class="n">given_name</span><span class="o">=</span><span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="n">family_name</span><span class="o">=</span><span class="s2">&quot;Doe&quot;</span><span class="p">),</span>
    <span class="n">emails</span><span class="o">=</span><span class="p">[</span><span class="n">ScimUserEmail</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;john.doe@example.com&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;work&quot;</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">created</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">if</span> <span class="n">created</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created user ID: </span><span class="si">{</span><span class="n">created</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="user-retrieval">User Retrieval</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get user by ID</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s2">&quot;a1b2c3d4-e5f6-7890-abcd-ef1234567890&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get user by username</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_user_by_username</span><span class="p">(</span><span class="s2">&quot;john.doe@example.com&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User ID: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="user-updates">User Updates</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScimPatchRequest</span><span class="p">,</span> <span class="n">ScimPatchOperation</span>

<span class="c1"># Update display name (convenience method)</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">update_display_name</span><span class="p">(</span><span class="s2">&quot;user-id&quot;</span><span class="p">,</span> <span class="s2">&quot;John Smith&quot;</span><span class="p">)</span>

<span class="c1"># Deactivate a user (convenience method)</span>
<span class="n">deactivated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">deactivate_user</span><span class="p">(</span><span class="s2">&quot;user-id&quot;</span><span class="p">)</span>

<span class="c1"># Set active status (convenience method)</span>
<span class="n">activated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">set_user_active</span><span class="p">(</span><span class="s2">&quot;user-id&quot;</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Manual patch operation</span>
<span class="n">patch</span> <span class="o">=</span> <span class="n">ScimPatchRequest</span><span class="p">(</span>
    <span class="n">operations</span><span class="o">=</span><span class="p">[</span>
        <span class="n">ScimPatchOperation</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;displayName&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Jane Doe&quot;</span><span class="p">),</span>
        <span class="n">ScimPatchOperation</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">update_user</span><span class="p">(</span><span class="s2">&quot;user-id&quot;</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span>
</code></pre></div>

<h3 id="user-deletion">User Deletion</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete user by ID</span>
<span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="s2">&quot;a1b2c3d4-e5f6-7890-abcd-ef1234567890&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="models">Models</h2>
<h3 id="scimuser">ScimUser</h3>
<p>Main user resource model.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>str</code></td>
<td>Unique user identifier (GUID)</td>
</tr>
<tr>
<td><code>user_name</code></td>
<td><code>str</code></td>
<td>Username (typically email address)</td>
</tr>
<tr>
<td><code>display_name</code></td>
<td><code>str</code></td>
<td>Display name</td>
</tr>
<tr>
<td><code>active</code></td>
<td><code>bool</code></td>
<td>Whether user is active</td>
</tr>
<tr>
<td><code>external_id</code></td>
<td><code>str</code></td>
<td>External ID from Azure AD</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>ScimUserName</code></td>
<td>Structured name components</td>
</tr>
<tr>
<td><code>emails</code></td>
<td><code>List[ScimUserEmail]</code></td>
<td>Email addresses</td>
</tr>
<tr>
<td><code>schemas</code></td>
<td><code>List[str]</code></td>
<td>SCIM schemas</td>
</tr>
<tr>
<td><code>meta</code></td>
<td><code>Dict</code></td>
<td>SCIM metadata</td>
</tr>
</tbody>
</table>
<h3 id="scimusername">ScimUserName</h3>
<p>User name components.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>formatted</code></td>
<td><code>str</code></td>
<td>Full formatted name</td>
</tr>
<tr>
<td><code>given_name</code></td>
<td><code>str</code></td>
<td>First name</td>
</tr>
<tr>
<td><code>family_name</code></td>
<td><code>str</code></td>
<td>Last name (surname)</td>
</tr>
</tbody>
</table>
<h3 id="scimuseremail">ScimUserEmail</h3>
<p>User email entry.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code>str</code></td>
<td>Email address</td>
</tr>
<tr>
<td><code>type</code></td>
<td><code>str</code></td>
<td>Email type (work, home, etc.)</td>
</tr>
<tr>
<td><code>primary</code></td>
<td><code>bool</code></td>
<td>Whether primary email</td>
</tr>
</tbody>
</table>
<h3 id="scimtoken">ScimToken</h3>
<p>JWT token response.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token</code></td>
<td><code>str</code></td>
<td>JWT token string</td>
</tr>
<tr>
<td><code>expires_utc</code></td>
<td><code>datetime</code></td>
<td>Token expiration (UTC)</td>
</tr>
<tr>
<td><code>duration_days</code></td>
<td><code>int</code></td>
<td>Token validity in days</td>
</tr>
</tbody>
</table>
<h3 id="scimpatchrequest">ScimPatchRequest</h3>
<p>SCIM patch request body.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>schemas</code></td>
<td><code>List[str]</code></td>
<td>Must include patch schema</td>
</tr>
<tr>
<td><code>operations</code></td>
<td><code>List[ScimPatchOperation]</code></td>
<td>Patch operations</td>
</tr>
</tbody>
</table>
<h3 id="scimpatchoperation">ScimPatchOperation</h3>
<p>Single patch operation.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>op</code></td>
<td><code>str</code></td>
<td>Operation type (only "replace" supported)</td>
</tr>
<tr>
<td><code>path</code></td>
<td><code>str</code></td>
<td>Attribute path</td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>Any</code></td>
<td>New value</td>
</tr>
</tbody>
</table>
<h3 id="scimlistresponse">ScimListResponse</h3>
<p>Paginated list response.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>total_results</code></td>
<td><code>int</code></td>
<td>Total result count</td>
</tr>
<tr>
<td><code>items_per_page</code></td>
<td><code>int</code></td>
<td>Items per page</td>
</tr>
<tr>
<td><code>start_index</code></td>
<td><code>int</code></td>
<td>Start index</td>
</tr>
<tr>
<td><code>resources</code></td>
<td><code>List[ScimUser]</code></td>
<td>User resources</td>
</tr>
<tr>
<td><code>schemas</code></td>
<td><code>List[str]</code></td>
<td>Response schemas</td>
</tr>
</tbody>
</table>
<h2 id="api-endpoints">API Endpoints</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Service Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/api/SCIM/v2/Token</code></td>
<td><code>get_token()</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/SCIM/v2/Users</code></td>
<td><code>get_users()</code>, <code>iter_users()</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/SCIM/v2/Users</code></td>
<td><code>create_user()</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/SCIM/v2/Users/{id}</code></td>
<td><code>get_user()</code></td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/SCIM/v2/Users/{id}</code></td>
<td><code>delete_user()</code></td>
</tr>
<tr>
<td>PATCH</td>
<td><code>/api/SCIM/v2/Users/{id}</code></td>
<td><code>update_user()</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/SCIM/v2/Users/userName={userName}</code></td>
<td><code>get_user_by_username()</code></td>
</tr>
</tbody>
</table>
<h2 id="azure-ad-configuration">Azure AD Configuration</h2>
<p>To configure Azure AD for automatic provisioning:</p>
<ol>
<li>
<p>Generate a provisioning token:<br />
<code>python
   token = api.scim.get_token(duration_days=90)</code></p>
</li>
<li>
<p>In Azure AD Enterprise Applications:</p>
</li>
<li>Select your WATS application</li>
<li>Go to Provisioning</li>
<li>Set Provisioning Mode to "Automatic"</li>
<li>Enter your WATS SCIM endpoint URL: <code>https://your-wats-server.com/api/SCIM/v2</code></li>
<li>
<p>Use the generated token as the "Secret Token"</p>
</li>
<li>
<p>Configure attribute mappings as needed</p>
</li>
<li>
<p>Enable provisioning</p>
</li>
</ol>
<h2 id="error-handling">Error Handling</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">PyWATSError</span><span class="p">,</span> <span class="n">NotFoundError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">scim</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="s2">&quot;non-existent-id&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SCIM error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="notes">Notes</h2>
<ul>
<li>SCIM PATCH operations only support "replace" operation type</li>
<li>Users provisioned via SCIM should be managed through Azure AD</li>
<li>Token duration default is 90 days if not specified</li>
<li>All models use snake_case field names (camelCase aliases handled automatically)</li>
</ul>
</div>


<div class="doc-separator" id="domain-modules-events">
    <div class="doc-source">Source: docs/modules/EVENTS.md</div>
    <h1 id="event-architecture">Event Architecture</h1>
<p>The pyWATS event system provides a protocol-agnostic way to integrate with external message sources (IPC-CFX, MQTT, webhooks) and route events to appropriate handlers.</p>
<h2 id="architecture-overview">Architecture Overview</h2>
<div class="codehilite"><pre><span></span><code><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                         </span><span class="nx">External</span><span class="w"> </span><span class="nx">Sources</span><span class="w">                              </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="nx">CFX</span><span class="w"> </span><span class="nx">Broker</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">    </span><span class="nx">MQTT</span><span class="w"> </span><span class="nx">Broker</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">    </span><span class="nx">Webhooks</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">    </span><span class="nx">Files</span><span class="w">      </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">         </span><span class="err">‚îÇ</span><span class="w">                 </span><span class="err">‚îÇ</span><span class="w">                  </span><span class="err">‚îÇ</span><span class="w">                </span><span class="err">‚îÇ</span>
<span class="w">         </span><span class="err">‚ñº</span><span class="w">                 </span><span class="err">‚ñº</span><span class="w">                  </span><span class="err">‚ñº</span><span class="w">                </span><span class="err">‚ñº</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                      </span><span class="nx">Transport</span><span class="w"> </span><span class="nx">Adapters</span><span class="w">                               </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="nx">CFXTransport</span><span class="w">     </span><span class="nx">MQTTTransport</span><span class="w">     </span><span class="nx">WebhookTransport</span><span class="w">   </span><span class="nx">FileWatcher</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="p">(</span><span class="nx">pywats_cfx</span><span class="p">)</span><span class="w">     </span><span class="p">(</span><span class="nx">pywats_mqtt</span><span class="p">)</span><span class="w">                                      </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                             </span><span class="err">‚îÇ</span><span class="w"> </span><span class="nx">Protocol</span><span class="o">-</span><span class="nx">specific</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Normalized</span><span class="w"> </span><span class="nx">Event</span>
<span class="w">                             </span><span class="err">‚ñº</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                      </span><span class="nx">pywats_events</span><span class="w"> </span><span class="nx">Core</span><span class="w">                               </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">    </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">    </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">  </span><span class="nx">Event</span><span class="w">   </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ</span><span class="w">   </span><span class="nx">EventBus</span><span class="w">   </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ</span><span class="w">   </span><span class="nx">HandlerRegistry</span><span class="w">        </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">  </span><span class="nx">Model</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">  </span><span class="p">(</span><span class="nx">pub</span><span class="o">/</span><span class="nx">sub</span><span class="p">)</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">   </span><span class="p">(</span><span class="nx">routing</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="k">type</span><span class="p">)</span><span class="w">      </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">                         </span><span class="err">‚îÇ</span><span class="w">                          </span><span class="err">‚îÇ</span><span class="w">                 </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">                  </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">           </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">                  </span><span class="err">‚îÇ</span><span class="w"> </span><span class="nx">RetryPolicy</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w">           </span><span class="err">‚îÇ</span><span class="w"> </span><span class="nx">ErrorPolicy</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w">          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">                  </span><span class="err">‚îÇ</span><span class="w"> </span><span class="p">(</span><span class="nx">backoff</span><span class="p">)</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">           </span><span class="err">‚îÇ</span><span class="w"> </span><span class="p">(</span><span class="nx">DLQ</span><span class="p">,</span><span class="w"> </span><span class="nx">CB</span><span class="p">)</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">                  </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">           </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">          </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                             </span><span class="err">‚îÇ</span>
<span class="w">                             </span><span class="err">‚ñº</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w">                      </span><span class="nx">WATS</span><span class="w"> </span><span class="nx">Handlers</span><span class="w"> </span><span class="p">(</span><span class="nx">planned</span><span class="p">)</span><span class="w">                          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="nx">ReportHandler</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">   </span><span class="nx">AssetHandler</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">   </span><span class="nx">ProductionHandler</span><span class="w">          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">ReportService</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">AssetService</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">ProductionService</span><span class="w">        </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
</code></pre></div>

<h2 id="packages">Packages</h2>
<h3 id="pywats_events-core">pywats_events (Core)</h3>
<p>The protocol-agnostic event system foundation:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_events</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">EventType</span><span class="p">,</span> <span class="n">EventBus</span><span class="p">,</span> <span class="n">BaseHandler</span>

<span class="c1"># Create an event</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
    <span class="n">event_type</span><span class="o">=</span><span class="n">EventType</span><span class="o">.</span><span class="n">TEST_RESULT</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;unit_id&quot;</span><span class="p">:</span> <span class="s2">&quot;SN-123&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;pass&quot;</span><span class="p">},</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;test-station&quot;</span>
<span class="p">)</span>

<span class="c1"># Create a handler</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">event_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">EventType</span><span class="o">.</span><span class="n">TEST_RESULT</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;unit_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Wire it up</span>
<span class="n">bus</span> <span class="o">=</span> <span class="n">EventBus</span><span class="p">()</span>
<span class="n">bus</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">MyHandler</span><span class="p">())</span>
<span class="n">bus</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">bus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</code></pre></div>

<h3 id="pywats_cfx-ipc-cfx-adapter">pywats_cfx (IPC-CFX Adapter)</h3>
<p>Adapter for IPC-CFX factory messaging standard:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_cfx</span><span class="w"> </span><span class="kn">import</span> <span class="n">CFXTransport</span><span class="p">,</span> <span class="n">CFXConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_events</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventBus</span>

<span class="c1"># Configure CFX connection</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">CFXConfig</span><span class="p">(</span>
    <span class="n">amqp</span><span class="o">=</span><span class="n">AMQPConfig</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;cfx-broker.factory.local&quot;</span><span class="p">),</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="n">EndpointConfig</span><span class="p">(</span><span class="n">cfx_handle</span><span class="o">=</span><span class="s2">&quot;//Company/WATS/Station1&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create transport and connect to event bus</span>
<span class="n">transport</span> <span class="o">=</span> <span class="n">CFXTransport</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">bus</span> <span class="o">=</span> <span class="n">EventBus</span><span class="p">()</span>
<span class="n">bus</span><span class="o">.</span><span class="n">register_transport</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>

<span class="c1"># CFX messages automatically converted to domain events</span>
<span class="n">bus</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Starts receiving CFX messages</span>
</code></pre></div>

<h2 id="event-types">Event Types</h2>
<p>Events are categorized by domain:</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Event Types</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Test</strong></td>
<td><code>TEST_RESULT</code>, <code>TEST_STARTED</code>, <code>INSPECTION_RESULT</code></td>
<td>Test and inspection results</td>
</tr>
<tr>
<td><strong>Asset</strong></td>
<td><code>ASSET_FAULT</code>, <code>ASSET_STATE_CHANGED</code>, <code>ASSET_MAINTENANCE</code></td>
<td>Equipment status and faults</td>
</tr>
<tr>
<td><strong>Material</strong></td>
<td><code>MATERIAL_INSTALLED</code>, <code>MATERIAL_CONSUMED</code></td>
<td>BOM and component tracking</td>
</tr>
<tr>
<td><strong>Production</strong></td>
<td><code>WORK_STARTED</code>, <code>WORK_COMPLETED</code>, <code>UNIT_DISQUALIFIED</code></td>
<td>Production flow events</td>
</tr>
<tr>
<td><strong>System</strong></td>
<td><code>TRANSPORT_CONNECTED</code>, <code>HANDLER_ERROR</code>, <code>EVENT_DEAD_LETTER</code></td>
<td>Internal system events</td>
</tr>
</tbody>
</table>
<h2 id="cfx-message-mapping">CFX Message Mapping</h2>
<p>IPC-CFX messages are converted to normalized domain events:</p>
<table>
<thead>
<tr>
<th>CFX Message</th>
<th>Domain Event</th>
<th>WATS Handler Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UnitsTested</code></td>
<td><code>TestResultEvent</code></td>
<td><code>ReportService.submit()</code></td>
</tr>
<tr>
<td><code>UnitsInspected</code></td>
<td><code>TestResultEvent</code></td>
<td><code>ReportService.submit()</code></td>
</tr>
<tr>
<td><code>MaterialsInstalled</code></td>
<td><code>MaterialInstalledEvent</code></td>
<td>Component traceability</td>
</tr>
<tr>
<td><code>FaultOccurred</code></td>
<td><code>AssetFaultEvent</code></td>
<td><code>AssetService</code> fault logging</td>
</tr>
<tr>
<td><code>StationStateChanged</code></td>
<td><code>AssetStateChangedEvent</code></td>
<td>Equipment status</td>
</tr>
<tr>
<td><code>WorkStarted/Completed</code></td>
<td><code>WorkStartedEvent/WorkCompletedEvent</code></td>
<td>Production tracking</td>
</tr>
</tbody>
</table>
<h2 id="cfx-sample-explorer">CFX Sample Explorer</h2>
<p>Use the explorer CLI to understand CFX message formats:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># List all available samples</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_cfx.explorer<span class="w"> </span>--list

<span class="c1"># View raw CFX message</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_cfx.explorer<span class="w"> </span>--sample<span class="w"> </span>units_tested_ict

<span class="c1"># Convert to domain event with WATS mapping hints</span>
python<span class="w"> </span>-m<span class="w"> </span>pywats_cfx.explorer<span class="w"> </span>--convert<span class="w"> </span>units_tested_ict
</code></pre></div>

<p>Available samples:<br />
- <strong>Test</strong>: <code>units_tested_ict</code>, <code>units_tested_fct</code>, <code>units_inspected_aoi</code>, <code>units_inspected_spi</code><br />
- <strong>Production</strong>: <code>work_started</code>, <code>work_completed_pass</code>, <code>work_completed_fail</code><br />
- <strong>Materials</strong>: <code>materials_smt</code>, <code>materials_th</code>, <code>materials_loaded</code><br />
- <strong>Faults</strong>: <code>fault_temp</code>, <code>fault_feeder</code>, <code>fault_cleared</code></p>
<h2 id="policies">Policies</h2>
<h3 id="retry-policy">Retry Policy</h3>
<p>Configure retry behavior for failed handlers:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_events.policies</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryPolicy</span>

<span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
    <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">initial_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>      <span class="c1"># 1 second</span>
    <span class="n">max_delay</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>         <span class="c1"># Max 60 seconds</span>
    <span class="n">exponential_base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>   <span class="c1"># Exponential backoff</span>
    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span>             <span class="c1"># Add randomness</span>
<span class="p">)</span>

<span class="c1"># Filter which exceptions to retry</span>
<span class="n">policy</span><span class="o">.</span><span class="n">retry_on</span><span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">)</span>
<span class="n">policy</span><span class="o">.</span><span class="n">no_retry_on</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span>  <span class="c1"># Never retry these</span>
</code></pre></div>

<h3 id="error-policy">Error Policy</h3>
<p>Handle permanently failed events:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_events.policies</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorPolicy</span><span class="p">,</span> <span class="n">DeadLetterQueue</span><span class="p">,</span> <span class="n">CircuitBreaker</span>

<span class="n">dlq</span> <span class="o">=</span> <span class="n">DeadLetterQueue</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>    <span class="c1"># Open after 5 failures</span>
    <span class="n">reset_timeout</span><span class="o">=</span><span class="mf">30.0</span>      <span class="c1"># Try again after 30 seconds</span>
<span class="p">)</span>

<span class="n">policy</span> <span class="o">=</span> <span class="n">ErrorPolicy</span><span class="p">(</span><span class="n">dead_letter_queue</span><span class="o">=</span><span class="n">dlq</span><span class="p">,</span> <span class="n">circuit_breaker</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>

<span class="c1"># Get failed events for analysis/replay</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dlq</span><span class="o">.</span><span class="n">get_entries</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="testing">Testing</h2>
<p>Use <code>MockTransport</code> for testing without external dependencies:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_events</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventBus</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">EventType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_events.transports</span><span class="w"> </span><span class="kn">import</span> <span class="n">MockTransport</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_my_handler</span><span class="p">():</span>
    <span class="n">bus</span> <span class="o">=</span> <span class="n">EventBus</span><span class="p">()</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">MockTransport</span><span class="p">()</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">register_transport</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>

    <span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">TestHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">event_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">EventType</span><span class="o">.</span><span class="n">TEST_RESULT</span><span class="p">]</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span> <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="n">bus</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">TestHandler</span><span class="p">())</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Inject test event</span>
    <span class="n">transport</span><span class="o">.</span><span class="n">inject_event</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span>
        <span class="n">event_type</span><span class="o">=</span><span class="n">EventType</span><span class="o">.</span><span class="n">TEST_RESULT</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;unit_id&quot;</span><span class="p">:</span> <span class="s2">&quot;TEST-123&quot;</span><span class="p">,</span> <span class="s2">&quot;passed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="p">))</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">received</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>

<h2 id="next-steps">Next Steps</h2>
<p>The WATS handlers that consume domain events and call pyWATS services are planned:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Future: WATS handlers (not yet implemented)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReportHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_service</span><span class="p">:</span> <span class="n">ReportService</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_service</span> <span class="o">=</span> <span class="n">report_service</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">event_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">EventType</span><span class="o">.</span><span class="n">TEST_RESULT</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">TestResultEvent</span><span class="p">(</span><span class="o">**</span><span class="n">event</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_uut_report</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<p>See the CFX explorer output for mapping hints when implementing handlers.</p>
</div>


<div class="section-header" id="usage-guides">
    <h1>Usage Guides</h1>
</div>


<div class="doc-separator" id="usage-guides-report-module">
    <div class="doc-source">Source: docs/usage/report-module.md</div>
    <h1 id="report-module-usage-guide">Report Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The Report module handles test report submission and querying. It supports two report types:<br />
- <strong>UUT Reports</strong> (Unit Under Test) - Test results for passing/failing units<br />
- <strong>UUR Reports</strong> (Unit Under Repair) - Repair/rework documentation</p>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools.test_uut</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestUUT</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Create report using factory</span>
<span class="n">uut</span> <span class="o">=</span> <span class="n">TestUUT</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
    <span class="n">purpose</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Test</span>
<span class="p">)</span>

<span class="c1"># Add test steps</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voltage Test&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit report</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<h2 id="factory-methods-recommended">Factory Methods (RECOMMENDED)</h2>
<h3 id="why-use-factory-methods">Why Use Factory Methods?</h3>
<p>The <code>TestUUT</code> factory provides:<br />
- ‚úÖ Automatic report structure creation<br />
- ‚úÖ Proper sequence hierarchy<br />
- ‚úÖ Convenient step creation methods<br />
- ‚úÖ Automatic timestamp management<br />
- ‚úÖ Validation during construction</p>
<h3 id="creating-a-report-with-testuut">Creating a Report with TestUUT</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools.test_uut</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestUUT</span>

<span class="c1"># Initialize with basic info</span>
<span class="n">uut</span> <span class="o">=</span> <span class="n">TestUUT</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;MOD-2025-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Test Operator&quot;</span><span class="p">,</span>
    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;Station-5&quot;</span><span class="p">,</span>
    <span class="n">purpose</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># Test purpose</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span>  <span class="c1"># Operation/process code (optional)</span>
<span class="p">)</span>

<span class="c1"># Get root sequence to add steps</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>

<span class="c1"># Add test steps (see step types below)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Convert to report and submit</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<h3 id="factory-constructor-parameters">Factory Constructor Parameters</h3>
<div class="codehilite"><pre><span></span><code><span class="n">TestUUT</span><span class="p">(</span>
    <span class="n">part_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>              <span class="c1"># Product part number (required)</span>
    <span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>            <span class="c1"># Unit serial number (required)</span>
    <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>           <span class="c1"># Product revision</span>
    <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>     <span class="c1"># Operator name</span>
    <span class="n">station</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>             <span class="c1"># Test station ID</span>
    <span class="n">purpose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>             <span class="c1"># Purpose code (10=Test, 20=Debug, etc.)</span>
    <span class="n">operation_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Process/operation code</span>
    <span class="n">batch_serial_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>         <span class="c1"># Batch/lot number</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Auto-set if not provided</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="step-types-and-methods">Step Types and Methods</h2>
<p>All step methods are called on a sequence (typically <code>root = uut.get_root()</code>).</p>
<h3 id="1-numeric-step-single-measurement">1. Numeric Step (Single Measurement)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voltage Output&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">5.02</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="s2">&quot;GELE&quot;</span><span class="p">,</span>      <span class="c1"># Comparison: GELE, GT, LT, EQ, NE, GE, LE, LOG</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>      <span class="c1"># &quot;Passed&quot;, &quot;Failed&quot;, &quot;Done&quot;, &quot;Skipped&quot;, etc.</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Comparison Operators</strong>:<br />
- <code>GELE</code> - Greater or Equal, Less or Equal (in range)<br />
- <code>GT</code> - Greater Than<br />
- <code>LT</code> - Less Than<br />
- <code>GE</code> - Greater or Equal<br />
- <code>LE</code> - Less or Equal<br />
- <code>EQ</code> - Equal<br />
- <code>NE</code> - Not Equal<br />
- <code>LOG</code> - Logarithmic</p>
<h3 id="2-multi-numeric-step-multiple-measurements">2. Multi-Numeric Step (Multiple Measurements)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_multi_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Rails&quot;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;3.3V Rail&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">3.31</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op&quot;</span><span class="p">:</span> <span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;5V Rail&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">5.05</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op&quot;</span><span class="p">:</span> <span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="mf">4.75</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="mf">5.25</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>  <span class="c1"># Overall step status</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="3-boolean-step-passfail-test">3. Boolean Step (Pass/Fail Test)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LED Test&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># True = Passed, False = Failed</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="4-multi-boolean-step-multiple-passfail-tests">4. Multi-Boolean Step (Multiple Pass/Fail Tests)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_multi_boolean_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Digital I/O Test&quot;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Output 1&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Output 2&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Output 3&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed&quot;</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span>  <span class="c1"># Overall - failed if any measurement failed</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="5-string-step-text-value">5. String Step (Text Value)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Firmware Version&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;v2.1.5&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Done&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="6-multi-string-step-multiple-text-values">6. Multi-String Step (Multiple Text Values)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_multi_string_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Component Versions&quot;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bootloader&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;v1.2.0&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Done&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Application&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;v2.1.5&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Done&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;FPGA&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;v3.0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Done&quot;</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Done&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="7-nested-sequences-test-groups">7. Nested Sequences (Test Groups)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a sub-sequence for grouping related tests</span>
<span class="n">power_tests</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Power Supply Tests&quot;</span><span class="p">)</span>

<span class="c1"># Add steps to the sub-sequence</span>
<span class="n">power_tests</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">power_tests</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Create another sub-sequence</span>
<span class="n">io_tests</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;I/O Tests&quot;</span><span class="p">)</span>
<span class="n">io_tests</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="8-chart-step-graphsplots">8. Chart Step (Graphs/Plots)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="o">.</span><span class="n">add_chart_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Frequency Response&quot;</span><span class="p">,</span>
    <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;LINE&quot;</span><span class="p">,</span>  <span class="c1"># LINE, LINE_LOG_X, LINE_LOG_Y, LINE_LOG_XY</span>
    <span class="n">series</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x_values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">],</span>
            <span class="s2">&quot;y_values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.0</span><span class="p">],</span>
            <span class="s2">&quot;x_unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y_unit&quot;</span><span class="p">:</span> <span class="s2">&quot;dB&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Done&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="complete-example-complex-test-report">Complete Example: Complex Test Report</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools.test_uut</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestUUT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Create test report</span>
<span class="n">uut</span> <span class="o">=</span> <span class="n">TestUUT</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;POWER-MODULE-500W&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PM500-2025-12345&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Jane Smith&quot;</span><span class="p">,</span>
    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;Final-Test-3&quot;</span><span class="p">,</span>
    <span class="n">purpose</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Final test</span>
    <span class="n">batch_serial_number</span><span class="o">=</span><span class="s2">&quot;BATCH-2025-W50&quot;</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>

<span class="c1"># 1. Initialization tests</span>
<span class="n">init_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Initialization&quot;</span><span class="p">)</span>
<span class="n">init_seq</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span><span class="s2">&quot;Firmware Version&quot;</span><span class="p">,</span> <span class="s2">&quot;v3.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;Done&quot;</span><span class="p">)</span>
<span class="n">init_seq</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="s2">&quot;Self-Test&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Passed&quot;</span><span class="p">)</span>

<span class="c1"># 2. Power output tests</span>
<span class="n">power_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Power Output Tests&quot;</span><span class="p">)</span>
<span class="n">power_seq</span><span class="o">.</span><span class="n">add_multi_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Output Voltages&quot;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;12V Output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">12.05</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op&quot;</span><span class="p">:</span> <span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="mf">11.4</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="mf">12.6</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;5V Output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">5.02</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op&quot;</span><span class="p">:</span> <span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="mf">4.75</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="mf">5.25</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;3.3V Output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">3.31</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op&quot;</span><span class="p">:</span> <span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="mf">3.14</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="mf">3.47</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># 3. Load regulation test</span>
<span class="n">load_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Load Regulation&quot;</span><span class="p">)</span>
<span class="n">load_seq</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;12V @ 10A&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">11.98</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">11.4</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">12.6</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>
<span class="n">load_seq</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;12V @ 40A&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">11.92</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">11.4</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">12.6</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># 4. Protection tests</span>
<span class="n">protection_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Protection Tests&quot;</span><span class="p">)</span>
<span class="n">protection_seq</span><span class="o">.</span><span class="n">add_multi_boolean_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Protection Circuits&quot;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Over-Voltage&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Over-Current&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Over-Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Short-Circuit&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>

<span class="c1"># 5. Efficiency test with chart</span>
<span class="n">efficiency_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Efficiency Test&quot;</span><span class="p">)</span>
<span class="n">efficiency_seq</span><span class="o">.</span><span class="n">add_chart_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Efficiency vs Load&quot;</span><span class="p">,</span>
    <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;LINE&quot;</span><span class="p">,</span>
    <span class="n">series</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x_values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>  <span class="c1"># Load in amps</span>
            <span class="s2">&quot;y_values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">88.5</span><span class="p">,</span> <span class="mf">91.2</span><span class="p">,</span> <span class="mf">92.1</span><span class="p">,</span> <span class="mf">91.8</span><span class="p">],</span>  <span class="c1"># Efficiency %</span>
            <span class="s2">&quot;x_unit&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y_unit&quot;</span><span class="p">:</span> <span class="s2">&quot;%&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Done&quot;</span>
<span class="p">)</span>

<span class="c1"># Convert and submit</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report submitted for </span><span class="si">{</span><span class="n">uut</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="manual-report-creation-advanced">Manual Report Creation (Advanced)</h2>
<p>If you need fine-grained control, create reports directly:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span><span class="p">,</span> <span class="n">UUTInfo</span><span class="p">,</span> <span class="n">SequenceCall</span><span class="p">,</span> <span class="n">NumericStep</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="c1"># Create report structure manually</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">()</span>
<span class="n">report</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">UUTInfo</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Operator Name&quot;</span><span class="p">,</span>
    <span class="n">start_date_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create root sequence</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">SequenceCall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MainSequence&quot;</span><span class="p">)</span>
<span class="n">report</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

<span class="c1"># Add step manually</span>
<span class="n">step</span> <span class="o">=</span> <span class="n">NumericStep</span><span class="p">(</span>
    <span class="n">step_type</span><span class="o">=</span><span class="s2">&quot;ET_NLT&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
<span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

<span class="c1"># Submit</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<p><strong>‚ö†Ô∏è Warning</strong>: Manual creation requires understanding the internal structure. Use <code>TestUUT</code> factory instead.</p>
<h2 id="uur-reports-repairs">UUR Reports (Repairs)</h2>
<h3 id="creating-repair-reports">Creating Repair Reports</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UURReport</span>

<span class="c1"># Option 1: From existing UUT report</span>
<span class="n">uur</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uur_report</span><span class="p">(</span>
    <span class="n">from_uut_report</span><span class="o">=</span><span class="n">uut_report</span><span class="p">,</span>
    <span class="n">failure_category</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>  <span class="c1"># Repair category code</span>
    <span class="n">failure_code</span><span class="o">=</span><span class="mi">501</span><span class="p">,</span>      <span class="c1"># Specific failure code</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Replaced capacitor C15&quot;</span><span class="p">,</span>
    <span class="n">action_taken</span><span class="o">=</span><span class="s2">&quot;Component replacement&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Repair Tech&quot;</span>
<span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uur_report</span><span class="p">(</span><span class="n">uur</span><span class="p">)</span>

<span class="c1"># Option 2: From part number and process</span>
<span class="n">uur</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uur_from_part_and_process</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">process_code</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">failure_category</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">failure_code</span><span class="o">=</span><span class="mi">501</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Failed power test&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Repair Tech&quot;</span>
<span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uur_report</span><span class="p">(</span><span class="n">uur</span><span class="p">)</span>
</code></pre></div>

<h2 id="querying-reports">Querying Reports</h2>
<p>The report query API uses OData filters for flexible querying. The helper methods provide a simpler interface for common queries.</p>
<h3 id="using-odata-filters">Using OData Filters</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportType</span>

<span class="c1"># Filter by part number</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;PART-001&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Filter by serial number</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;SN-12345&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Filter by result</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;result eq &#39;Passed&#39;&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="c1"># Combined filters</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;PART-001&#39; and result eq &#39;Failed&#39;&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">orderby</span><span class="o">=</span><span class="s2">&quot;start desc&quot;</span>
<span class="p">)</span>

<span class="c1"># Query repair (UUR) reports</span>
<span class="n">repairs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uur_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;SN-12345&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># Unified query using ReportType enum</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_headers</span><span class="p">(</span>
    <span class="n">report_type</span><span class="o">=</span><span class="n">ReportType</span><span class="o">.</span><span class="n">UUT</span><span class="p">,</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;SN-12345&#39;&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="convenience-methods">Convenience Methods</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get reports by serial number</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_serial</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>

<span class="c1"># Get reports by part number</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_part_number</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>

<span class="c1"># Get reports by date range</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_headers_by_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="c1"># Get recent reports</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_recent_headers</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Get today&#39;s reports</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_todays_headers</span><span class="p">()</span>

<span class="c1"># Load full report by UUID</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get_uut_report</span><span class="p">(</span><span class="s2">&quot;report-uuid-here&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="expanded-fields">Expanded Fields</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Include sub-units in response</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;serialNumber eq &#39;SN-12345&#39;&quot;</span><span class="p">,</span>
    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subUnits&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Include miscellaneous info</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;PART-001&#39;&quot;</span><span class="p">,</span>
    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;miscInfo&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-always-use-testuut-factory">1. Always Use TestUUT Factory</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì RECOMMENDED</span>
<span class="n">uut</span> <span class="o">=</span> <span class="n">TestUUT</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># ‚úó AVOID - Manual creation is error-prone</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">()</span>
<span class="n">report</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">UUTInfo</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c1"># ... lots of boilerplate ...</span>
</code></pre></div>

<h3 id="2-use-appropriate-step-types">2. Use Appropriate Step Types</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - use specific types</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="s2">&quot;LED Test&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1"># ‚úó Avoid - generic steps when specific ones exist</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>  <span class="c1"># Should be numeric</span>
</code></pre></div>

<h3 id="3-organize-with-sequences">3. Organize with Sequences</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - grouped logically</span>
<span class="n">power_tests</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>
<span class="n">power_tests</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">power_tests</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">io_tests</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;I/O Tests&quot;</span><span class="p">)</span>
<span class="n">io_tests</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># ‚úó Avoid - flat structure</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="s2">&quot;Power 1&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="s2">&quot;Power 2&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="s2">&quot;I/O 1&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>  <span class="c1"># Mixed without grouping</span>
</code></pre></div>

<h3 id="4-set-meaningful-status">4. Set Meaningful Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - clear status</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>  <span class="c1"># For informational steps</span>

<span class="c1"># ‚úó Avoid - wrong status</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>  <span class="c1"># Should be Passed/Failed</span>
</code></pre></div>

<h3 id="5-include-units">5. Include Units</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - includes units</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1"># ‚úó Avoid - missing units</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>  <span class="c1"># What unit?</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-test-with-retry-logic">Pattern 1: Test with Retry Logic</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_test_with_retry</span><span class="p">(</span><span class="n">uut</span><span class="p">:</span> <span class="n">TestUUT</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">perform_test</span><span class="p">()</span>  <span class="c1"># Your test logic</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">passed</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Test (attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span>
            <span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">add_boolean_step</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Test (attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Failed&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>
</code></pre></div>

<h3 id="pattern-2-conditional-testing">Pattern 2: Conditional Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">conditional_test</span><span class="p">(</span><span class="n">uut</span><span class="p">:</span> <span class="n">TestUUT</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>

    <span class="c1"># Initial test</span>
    <span class="n">voltage</span> <span class="o">=</span> <span class="n">measure_voltage</span><span class="p">()</span>
    <span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="s2">&quot;Initial Voltage&quot;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

    <span class="c1"># Only do burn-in if voltage is good</span>
    <span class="k">if</span> <span class="mf">4.5</span> <span class="o">&lt;=</span> <span class="n">voltage</span> <span class="o">&lt;=</span> <span class="mf">5.5</span><span class="p">:</span>
        <span class="n">burnin_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s2">&quot;Burn-In Test&quot;</span><span class="p">)</span>
        <span class="c1"># ... burn-in steps ...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root</span><span class="o">.</span><span class="n">add_string_step</span><span class="p">(</span><span class="s2">&quot;Burn-In&quot;</span><span class="p">,</span> <span class="s2">&quot;Skipped - voltage out of range&quot;</span><span class="p">,</span> <span class="s2">&quot;Skipped&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>
</code></pre></div>

<h3 id="pattern-3-data-driven-testing">Pattern 3: Data-Driven Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">data_driven_test</span><span class="p">(</span><span class="n">uut</span><span class="p">:</span> <span class="n">TestUUT</span><span class="p">,</span> <span class="n">test_points</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>

    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">test_points</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">measure_at_point</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
            <span class="s2">&quot;comp_op&quot;</span><span class="p">:</span> <span class="s2">&quot;GELE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Passed&quot;</span> <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">min</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">point</span><span class="o">.</span><span class="n">max</span> <span class="k">else</span> <span class="s2">&quot;Failed&quot;</span>
        <span class="p">})</span>

    <span class="n">root</span><span class="o">.</span><span class="n">add_multi_numeric_step</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test Points&quot;</span><span class="p">,</span>
        <span class="n">measurements</span><span class="o">=</span><span class="n">measurements</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Passed&quot;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;Failed&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="factory-methods-not-working">Factory Methods Not Working?</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Make sure you import from tools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools.test_uut</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestUUT</span>  <span class="c1"># ‚úì Correct</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>  <span class="c1"># ‚úó Wrong - this is the model, not factory</span>
</code></pre></div>

<h3 id="steps-not-appearing-in-report">Steps Not Appearing in Report?</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Make sure you call methods on the sequence, not the factory</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>  <span class="c1"># Get the root sequence</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># ‚úì Correct</span>

<span class="n">uut</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># ‚úó Wrong - call on root</span>
</code></pre></div>

<h3 id="report-submission-failing">Report Submission Failing?</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Convert to report before sending</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">uut</span><span class="o">.</span><span class="n">to_report</span><span class="p">()</span>  <span class="c1"># Don&#39;t forget this!</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uut_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

<span class="c1"># Not:</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uut_report</span><span class="p">(</span><span class="n">uut</span><span class="p">)</span>  <span class="c1"># ‚úó Wrong - uut is factory, not report</span>
</code></pre></div>

<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="production-module.md">Production Module</a> - For serial number management before testing</li>
<li><a href="product-module.md">Product Module</a> - For product/revision setup</li>
<li><a href="../architecture.md">Architecture</a> - Overall system design</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-report-builder">
    <div class="doc-source">Source: docs/usage/report-builder.md</div>
    <h1 id="reportbuilder-simple-report-building-for-pywats">ReportBuilder - Simple Report Building for pyWATS</h1>
<h2 id="overview">Overview</h2>
<p>The <strong>ReportBuilder</strong> is a forgiving, LLM-friendly tool for creating WATS test reports with minimal complexity. It's designed for:</p>
<ul>
<li><strong>Converter scripts</strong> that parse test data from various formats</li>
<li><strong>LLM-generated code</strong> that needs to build reports without deep understanding</li>
<li><strong>Quick prototyping</strong> where you don't want to think about report structure</li>
<li><strong>Situations with messy data</strong> that needs graceful handling</li>
</ul>
<h2 id="philosophy">Philosophy</h2>
<ul>
<li><strong>If it can be inferred, it will be</strong> - Step types, comparison operators, and statuses are automatically determined</li>
<li><strong>If it's missing, use sensible defaults</strong> - You only specify what you have</li>
<li><strong>Never fail on missing metadata</strong> - Do the best with what's provided</li>
<li><strong>Support both flat and hierarchical structures</strong> - Automatically organize by groups</li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<h3 id="simple-example">Simple Example</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="c1"># Create builder</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;MOD-2025-001&quot;</span>
<span class="p">)</span>

<span class="c1"># Add steps - it figures out the types</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Voltage Test&quot;</span><span class="p">,</span> <span class="mf">5.02</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Power OK&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Serial Read&quot;</span><span class="p">,</span> <span class="s2">&quot;ABC123&quot;</span><span class="p">)</span>

<span class="c1"># Build and submit</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<h3 id="one-liner-with-quick_report">One-Liner with quick_report()</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">quick_report</span>

<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span> <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="mf">5.5</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">quick_report</span><span class="p">(</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-001&quot;</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>

<h2 id="key-features">Key Features</h2>
<h3 id="1-automatic-type-inference">1. Automatic Type Inference</h3>
<p>The builder automatically determines the correct step type based on your data:</p>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Boolean Test&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>           <span class="c1"># ‚Üí Boolean step</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Numeric Test&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>           <span class="c1"># ‚Üí Numeric step</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;String Test&quot;</span><span class="p">,</span> <span class="s2">&quot;ABC&quot;</span><span class="p">)</span>          <span class="c1"># ‚Üí String step</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Multi-Numeric&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>    <span class="c1"># ‚Üí Multi-numeric step</span>
</code></pre></div>

<h3 id="2-smart-status-calculation">2. Smart Status Calculation</h3>
<p>Status is automatically calculated from limits unless you override it:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Auto-calculated as &quot;P&quot; (in range)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test1&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># Auto-calculated as &quot;F&quot; (out of range)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test2&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># Manual override</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test3&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>  <span class="c1"># Force fail</span>
</code></pre></div>

<h3 id="3-flexible-data-handling">3. Flexible Data Handling</h3>
<p>Works with messy, real-world data:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Limits as strings (auto-converted)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="s2">&quot;5.02&quot;</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="s2">&quot;4.5&quot;</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="s2">&quot;5.5&quot;</span><span class="p">)</span>

<span class="c1"># Various status formats</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test1&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;PASS&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test2&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test3&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;Passed&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test4&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Boolean from string</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">)</span>  <span class="c1"># Converts to boolean</span>
</code></pre></div>

<h3 id="4-automatic-groupingsequences">4. Automatic Grouping/Sequences</h3>
<p>Create hierarchical reports by specifying groups:</p>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-001&quot;</span><span class="p">)</span>

<span class="c1"># Power tests group</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;VCC&quot;</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;VDD&quot;</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>

<span class="c1"># Communication tests group</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;UART&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Communication&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;I2C&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Communication&quot;</span><span class="p">)</span>

<span class="c1"># Build creates sequences automatically</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<p>Result:</p>
<div class="codehilite"><pre><span></span><code>MainSequence
‚îú‚îÄ‚îÄ Power Tests (sequence)
‚îÇ   ‚îú‚îÄ‚îÄ VCC
‚îÇ   ‚îî‚îÄ‚îÄ VDD
‚îî‚îÄ‚îÄ Communication (sequence)
    ‚îú‚îÄ‚îÄ UART
    ‚îî‚îÄ‚îÄ I2C
</code></pre></div>

<h2 id="api-reference">API Reference</h2>
<h3 id="reportbuilder">ReportBuilder</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReportBuilder</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">part_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="n">operator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">station</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">process_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">purpose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span>
</code></pre></div>

<p><strong>Parameters:</strong><br />
- <code>part_number</code> (required): Part number<br />
- <code>serial_number</code> (required): Serial number<br />
- <code>revision</code>: Revision (default: "A")<br />
- <code>operator</code>: Operator name (default: "Converter")<br />
- <code>station</code>: Station name<br />
- <code>location</code>: Location<br />
- <code>process_code</code>: Operation type code (default: 10 = SW Debug)<br />
- <code>result</code>: Overall result "P" or "F" (auto-calculated if None)<br />
- <code>start_time</code>: Start time (defaults to now)<br />
- <code>purpose</code>: Test purpose</p>
<h3 id="add_step">add_step()</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_step</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">CompOp</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ReportBuilder&quot;</span>
</code></pre></div>

<p><strong>Type Inference:</strong><br />
- <code>bool</code> / <code>"TRUE"</code> / <code>"FALSE"</code> / <code>"PASS"</code> / <code>"FAIL"</code> ‚Üí Boolean step<br />
- <code>float</code> / <code>int</code> with limits ‚Üí Numeric limit test<br />
- <code>float</code> / <code>int</code> without limits ‚Üí Numeric log<br />
- <code>str</code> ‚Üí String step<br />
- <code>list[float]</code> / <code>list[int]</code> ‚Üí Multi-numeric step<br />
- <code>list[bool]</code> ‚Üí Multi-boolean step<br />
- <code>list[str]</code> ‚Üí Multi-string step</p>
<p><strong>Parameters:</strong><br />
- <code>name</code> (required): Step name<br />
- <code>value</code>: Measured value (can be anything)<br />
- <code>unit</code>: Unit of measurement (e.g., "V", "A", "¬∞C")<br />
- <code>low_limit</code>: Lower limit (for numeric tests)<br />
- <code>high_limit</code>: Upper limit (for numeric tests)<br />
- <code>status</code>: Status override ("P", "F", "Passed", "Failed", etc.)<br />
- <code>group</code>: Group/sequence name (creates hierarchy)<br />
- <code>comp_op</code>: Comparison operator (auto-inferred if not specified)<br />
- <code>**kwargs</code>: Additional metadata stored for debugging</p>
<p><strong>Returns:</strong> Self (for method chaining)</p>
<h3 id="add_step_from_dict">add_step_from_dict()</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_step_from_dict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">name_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="n">value_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">unit_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span>
    <span class="n">low_limit_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;low_limit&quot;</span><span class="p">,</span>
    <span class="n">high_limit_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;high_limit&quot;</span><span class="p">,</span>
    <span class="n">status_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span>
    <span class="n">group_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;group&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ReportBuilder&quot;</span>
</code></pre></div>

<p>Add a step from a dictionary with flexible key mapping. Automatically tries common variations:<br />
- name: <code>name</code>, <code>Name</code>, <code>TestName</code>, <code>test_name</code>, <code>Step</code><br />
- value: <code>value</code>, <code>Value</code>, <code>MeasuredValue</code>, <code>Result</code><br />
- unit: <code>unit</code>, <code>Unit</code>, <code>Units</code>, <code>UOM</code><br />
- low_limit: <code>low_limit</code>, <code>LowLimit</code>, <code>Low</code>, <code>MinLimit</code>, <code>min</code><br />
- high_limit: <code>high_limit</code>, <code>HighLimit</code>, <code>High</code>, <code>MaxLimit</code>, <code>max</code><br />
- status: <code>status</code>, <code>Status</code>, <code>Result</code>, <code>Pass</code><br />
- group: <code>group</code>, <code>Group</code>, <code>Sequence</code>, <code>TestGroup</code></p>
<h3 id="add_misc_info">add_misc_info()</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_misc_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ReportBuilder&quot;</span>
</code></pre></div>

<p>Add searchable metadata to the report header.</p>
<h3 id="add_sub_unit">add_sub_unit()</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_sub_unit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">part_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">part_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">revision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ReportBuilder&quot;</span>
</code></pre></div>

<p>Add a sub-unit (component) to the report.</p>
<h3 id="build">build()</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UUTReport</span>
</code></pre></div>

<p>Build the final UUTReport. This method:<br />
1. Creates UUTReport with header info<br />
2. Groups steps by sequence (if groups specified)<br />
3. Adds all steps in correct order<br />
4. Sets overall result based on step statuses<br />
5. Adds misc info and sub-units</p>
<p><strong>Returns:</strong> UUTReport ready to submit</p>
<h3 id="quick_report">quick_report()</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">quick_report</span><span class="p">(</span>
    <span class="n">part_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">steps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UUTReport</span>
</code></pre></div>

<p>Create a report from a list of step dictionaries in one call. Perfect for LLM-generated code.</p>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="example-1-simple-converter">Example 1: Simple Converter</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_my_format</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># Parse your file format</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">parse_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># Create builder</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">],</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Add all tests</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
            <span class="n">low_limit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;low_limit&quot;</span><span class="p">),</span>
            <span class="n">high_limit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_limit&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Done!</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h3 id="example-2-from-csv-data">Example 2: From CSV Data</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="s2">&quot;PN-FROM-CSV&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-FROM-CSV&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">add_step_from_dict</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span>
                <span class="n">name_key</span><span class="o">=</span><span class="s2">&quot;TestName&quot;</span><span class="p">,</span>
                <span class="n">value_key</span><span class="o">=</span><span class="s2">&quot;MeasuredValue&quot;</span><span class="p">,</span>
                <span class="n">unit_key</span><span class="o">=</span><span class="s2">&quot;Unit&quot;</span><span class="p">,</span>
                <span class="n">low_limit_key</span><span class="o">=</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">,</span>
                <span class="n">high_limit_key</span><span class="o">=</span><span class="s2">&quot;HighLimit&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h3 id="example-3-with-metadata">Example 3: With Metadata</h3>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;ASSEMBLY-500&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;ASM-2025-0123&quot;</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Production Line 3&quot;</span><span class="p">,</span>
    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;Final Test&quot;</span>
<span class="p">)</span>

<span class="c1"># Add tests</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Visual Inspection&quot;</span><span class="p">,</span> <span class="s2">&quot;PASS&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="mf">12.05</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">11.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">12.5</span><span class="p">)</span>

<span class="c1"># Add metadata</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_misc_info</span><span class="p">(</span><span class="s2">&quot;Batch Number&quot;</span><span class="p">,</span> <span class="s2">&quot;BATCH-2025-Q1-042&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_misc_info</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;22¬∞C&quot;</span><span class="p">)</span>

<span class="c1"># Add components</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_sub_unit</span><span class="p">(</span>
    <span class="n">part_type</span><span class="o">=</span><span class="s2">&quot;Power Supply&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PSU-24V-100W&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-001&quot;</span>
<span class="p">)</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h3 id="example-4-ict-converter">Example 4: ICT Converter</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_ict_data</span><span class="p">(</span><span class="n">ict_file</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">parse_ict_file</span><span class="p">(</span><span class="n">ict_file</span><span class="p">)</span>

    <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;pn&quot;</span><span class="p">],</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sn&quot;</span><span class="p">],</span>
        <span class="n">operator</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Group by test type</span>
    <span class="k">for</span> <span class="n">resistance</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;resistances&quot;</span><span class="p">]:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">resistance</span><span class="p">[</span><span class="s2">&quot;designator&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">resistance</span><span class="p">[</span><span class="s2">&quot;measured&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Œ©&quot;</span><span class="p">,</span>
            <span class="n">low_limit</span><span class="o">=</span><span class="n">resistance</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">],</span>
            <span class="n">high_limit</span><span class="o">=</span><span class="n">resistance</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">],</span>
            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Resistance Tests&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">capacitor</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;capacitors&quot;</span><span class="p">]:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">capacitor</span><span class="p">[</span><span class="s2">&quot;designator&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">capacitor</span><span class="p">[</span><span class="s2">&quot;measured&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;¬µF&quot;</span><span class="p">,</span>
            <span class="n">low_limit</span><span class="o">=</span><span class="n">capacitor</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">],</span>
            <span class="n">high_limit</span><span class="o">=</span><span class="n">capacitor</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">],</span>
            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Capacitance Tests&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h2 id="llm-integration-guide">LLM Integration Guide</h2>
<h3 id="for-llm-monitoringautocorrection">For LLM Monitoring/Autocorrection</h3>
<p>When monitoring converter code, check for these patterns:</p>
<p>‚úÖ <strong>Good Pattern:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<p>‚ùå <strong>Avoid Direct UUTReport Construction:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Too complex for LLMs to get right</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span><span class="n">pn</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span> <span class="n">sn</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># Easy to mess up parameters</span>
</code></pre></div>

<h3 id="for-llm-implementation-of-new-converters">For LLM Implementation of New Converters</h3>
<p><strong>Template for LLMs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_my_format</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># 1. Parse file (this is the only custom part)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">parse_your_format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># 2. Create builder</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">],</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># 3. Add steps (one line per test)</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
            <span class="n">low_limit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;low_limit&quot;</span><span class="p">),</span>
            <span class="n">high_limit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_limit&quot;</span><span class="p">),</span>
            <span class="n">group</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span>  <span class="c1"># Optional</span>
        <span class="p">)</span>

    <span class="c1"># 4. Build and return</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<p><strong>LLM should only customize:</strong> The <code>parse_your_format()</code> function to extract data from the specific file format.</p>
<p><strong>Everything else is standard.</strong></p>
<h2 id="advanced-features">Advanced Features</h2>
<h3 id="multi-value-steps">Multi-Value Steps</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Multi-numeric (array of numbers)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
    <span class="s2">&quot;Calibration Points&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">],</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mV&quot;</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">1.5</span>
<span class="p">)</span>

<span class="c1"># Multi-boolean (array of pass/fail)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Pin Tests&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>

<span class="c1"># Multi-string (array of strings)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Serial Numbers&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ABC&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">,</span> <span class="s2">&quot;GHI&quot;</span><span class="p">])</span>
</code></pre></div>

<h3 id="custom-comparison-operators">Custom Comparison Operators</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models.uut.steps.comp_operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompOp</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
    <span class="s2">&quot;Exact Value&quot;</span><span class="p">,</span>
    <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">EQ</span>  <span class="c1"># Must equal exactly</span>
<span class="p">)</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
    <span class="s2">&quot;Greater Than&quot;</span><span class="p">,</span>
    <span class="mf">10.0</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GT</span>  <span class="c1"># Must be &gt; 5.0 (not &gt;=)</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="failed-reports">Failed Reports</h3>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="s2">&quot;PN&quot;</span><span class="p">,</span> <span class="s2">&quot;SN&quot;</span><span class="p">)</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test1&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>  <span class="c1"># Pass</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test2&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>  <span class="c1"># FAIL</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># report.result will be &quot;F&quot; because Test2 failed</span>
</code></pre></div>

<h2 id="comparison-with-direct-api">Comparison with Direct API</h2>
<h3 id="before-complex">Before (Complex):</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.report.report_models.uut.steps.comp_operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompOp</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
    <span class="n">pn</span><span class="o">=</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span>
    <span class="n">sn</span><span class="o">=</span><span class="s2">&quot;SN-001&quot;</span><span class="p">,</span>
    <span class="n">rev</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">process_code</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;Station1&quot;</span><span class="p">,</span>
    <span class="n">result</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>

<span class="c1"># Need to know exact parameters, types, and comparison operators</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">5.02</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="n">comp_op</span><span class="o">=</span><span class="n">CompOp</span><span class="o">.</span><span class="n">GELE</span><span class="p">,</span>
    <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
    <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;P&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="after-simple">After (Simple):</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="s2">&quot;PN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-001&quot;</span><span class="p">)</span>

<span class="c1"># Just provide data - everything else is inferred</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="mf">5.02</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Use ReportBuilder for converters</strong> - It handles edge cases better than manual construction</li>
<li><strong>Let it infer types</strong> - Don't overthink numeric vs string vs boolean</li>
<li><strong>Use groups for organization</strong> - Makes reports easier to read in WATS</li>
<li><strong>Add misc_info for metadata</strong> - Searchable in WATS</li>
<li><strong>Let status auto-calculate</strong> - Only override if you have explicit pass/fail from source</li>
</ol>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="problem-status-always-p-even-with-failures">Problem: Status always "P" even with failures</h3>
<p><strong>Solution:</strong> Make sure limits are numeric (not strings), or provide explicit status:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Auto-fails if out of range</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># Or explicit</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="problem-wrong-step-type-created">Problem: Wrong step type created</h3>
<p><strong>Solution:</strong> Ensure value is correct Python type:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Boolean</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># ‚úì</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>  <span class="c1"># ‚úó (becomes string step)</span>

<span class="c1"># Numeric</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># ‚úì</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="s2">&quot;5.0&quot;</span><span class="p">)</span>  <span class="c1"># ? (auto-converted, but better to convert yourself)</span>
</code></pre></div>

<h3 id="problem-cant-find-data-in-dictionary">Problem: Can't find data in dictionary</h3>
<p><strong>Solution:</strong> Use <code>add_step_from_dict()</code> with explicit key names:</p>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span><span class="o">.</span><span class="n">add_step_from_dict</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">name_key</span><span class="o">=</span><span class="s2">&quot;TestName&quot;</span><span class="p">,</span>  <span class="c1"># Specify exact keys</span>
    <span class="n">value_key</span><span class="o">=</span><span class="s2">&quot;MeasuredValue&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../modules/report.md">Report Module Documentation</a></li>
<li><a href="../../converters/converter_template.py">Converter Template</a></li>
<li><a href="../../examples/report/report_builder_examples.py">Examples</a></li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-asset-module">
    <div class="doc-source">Source: docs/usage/asset-module.md</div>
    <h1 id="asset-module-usage-guide">Asset Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The Asset module manages test fixtures, and other manufacturing assets in WATS. Assets can be hierarchical (e.g., stations containing instruments) and track calibration, maintenance, and usage history.</p>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Get all assets</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>

<span class="c1"># Get specific asset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>

<span class="c1"># Get assets by type</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_by_type</span><span class="p">(</span><span class="s2">&quot;Station&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="asset-types">Asset Types</h2>
<p>Assets are categorized by type. Common types include:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Station</strong></td>
<td>Test station or workstation</td>
<td>ICT-01, FVT-STATION-01</td>
</tr>
<tr>
<td><strong>Instrument</strong></td>
<td>Measurement equipment</td>
<td>DMM, Oscilloscope, Power Supply</td>
</tr>
<tr>
<td><strong>Fixture</strong></td>
<td>Test fixtures</td>
<td>Bed-of-nails, Custom fixture</td>
</tr>
<tr>
<td><strong>Software</strong></td>
<td>Software tools</td>
<td>LabVIEW RT, TestStand</td>
</tr>
<tr>
<td><strong>Tool</strong></td>
<td>Hand tools or equipment</td>
<td>Soldering iron, Torque wrench</td>
</tr>
</tbody>
</table>
<h2 id="basic-operations">Basic Operations</h2>
<h3 id="1-get-assets">1. Get Assets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all assets (summary view)</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>

<span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Serial: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get full asset details (with nested data)</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_full</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Children: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">asset</span><span class="o">.</span><span class="n">children</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-get-asset-by-id">2. Get Asset by ID</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get specific asset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>

<span class="k">if</span> <span class="n">asset</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Serial Number: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Location: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-get-assets-by-type">3. Get Assets by Type</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all assets of a specific type</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_by_type</span><span class="p">(</span><span class="s2">&quot;Station&quot;</span><span class="p">)</span>
<span class="n">instruments</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_by_type</span><span class="p">(</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>
<span class="n">fixtures</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_by_type</span><span class="p">(</span><span class="s2">&quot;Fixture&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span><span class="si">}</span><span class="s2"> stations&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">station</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">station</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-create-asset">4. Create Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># Create new asset</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM2024-12345&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Keithley 2000 Digital Multimeter&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Lab A&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created asset: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="5-update-asset">5. Update Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get asset, modify, update</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="n">asset</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Updated description&quot;</span>
<span class="n">asset</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;Lab B&quot;</span>
<span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">IN_CALIBRATION</span>

<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated: </span><span class="si">{</span><span class="n">updated</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="6-delete-asset">6. Delete Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete an asset (use with caution)</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">delete_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asset deleted&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="asset-hierarchy">Asset Hierarchy</h2>
<p>Assets can have parent-child relationships (e.g., instruments inside a station).</p>
<h3 id="1-get-child-assets">1. Get Child Assets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get children of an asset</span>
<span class="n">children</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_child_assets</span><span class="p">(</span><span class="n">parent_asset_id</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Station has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s2"> instruments:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">asset_type</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-create-child-asset">2. Create Child Asset</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create asset as child of another</span>
<span class="n">instrument</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DMM-Internal&quot;</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-INT-001&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="o">=</span><span class="n">station_asset_id</span>  <span class="c1"># Parent asset</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="3-move-asset-change-parent">3. Move Asset (Change Parent)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Move asset to new parent</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="n">asset</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">new_parent_id</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</code></pre></div>

<h2 id="asset-states">Asset States</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># Available states</span>
<span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span>           <span class="c1"># In use, operational</span>
<span class="n">AssetState</span><span class="o">.</span><span class="n">INACTIVE</span>         <span class="c1"># Not in use</span>
<span class="n">AssetState</span><span class="o">.</span><span class="n">IN_CALIBRATION</span>   <span class="c1"># Being calibrated</span>
<span class="n">AssetState</span><span class="o">.</span><span class="n">IN_REPAIR</span>        <span class="c1"># Being repaired</span>
<span class="n">AssetState</span><span class="o">.</span><span class="n">RETIRED</span>          <span class="c1"># End of life</span>
</code></pre></div>

<h3 id="state-transitions">State Transitions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Example: Send asset for calibration</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">IN_CALIBRATION</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

<span class="c1"># After calibration complete</span>
<span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="n">asset</span><span class="o">.</span><span class="n">calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</code></pre></div>

<h2 id="asset-tags">Asset Tags</h2>
<p>Assets can have tags (key-value metadata):</p>
<h3 id="1-get-asset-tags">1. Get Asset Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get tags for an asset</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset_tags</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-set-asset-tags">2. Set Asset Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.shared</span><span class="w"> </span><span class="kn">import</span> <span class="n">Setting</span>

<span class="c1"># Set tags (replaces all existing)</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">set_asset_tags</span><span class="p">(</span><span class="n">asset_id</span><span class="p">,</span> <span class="p">[</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Manufacturer&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Keithley&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2000&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;CalibrationInterval&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;365&quot;</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>

<h3 id="3-add-single-tag">3. Add Single Tag</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add/update single tag</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">add_asset_tag</span><span class="p">(</span><span class="n">asset_id</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span> <span class="s2">&quot;Lab A&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="calibration-tracking">Calibration Tracking</h2>
<h3 id="1-track-calibration-dates">1. Track Calibration Dates</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Update calibration info</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="n">asset</span><span class="o">.</span><span class="n">calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-find-assets-due-for-calibration">2. Find Assets Due for Calibration</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Get all instruments</span>
<span class="n">instruments</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_by_type</span><span class="p">(</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>

<span class="c1"># Find those due for calibration</span>
<span class="n">due_soon</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">:</span>
        <span class="n">days_until</span> <span class="o">=</span> <span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">days</span>
        <span class="k">if</span> <span class="n">days_until</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">due_soon</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;asset&quot;</span><span class="p">:</span> <span class="n">instr</span><span class="p">,</span>
                <span class="s2">&quot;days_until&quot;</span><span class="p">:</span> <span class="n">days_until</span>
            <span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assets due for calibration within 30 days:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">due_soon</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;asset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;days_until&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-station-setup">Pattern 1: Station Setup</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="c1"># 1. Create station</span>
<span class="n">station</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ICT-STATION-01&quot;</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Station&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;ICT-2024-001&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;In-Circuit Test Station 1&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Production Floor&quot;</span>
<span class="p">)</span>

<span class="c1"># 2. Add instruments to station</span>
<span class="n">dmm</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ICT-01-DMM&quot;</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Station DMM&quot;</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="o">=</span><span class="n">station</span><span class="o">.</span><span class="n">asset_id</span>
<span class="p">)</span>

<span class="n">power_supply</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ICT-01-PSU&quot;</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-001&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Station Power Supply&quot;</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="o">=</span><span class="n">station</span><span class="o">.</span><span class="n">asset_id</span>
<span class="p">)</span>

<span class="c1"># 3. Tag the station</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">set_asset_tags</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">asset_id</span><span class="p">,</span> <span class="p">[</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Production Line 1&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Process&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;ICT&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Shift&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>

<h3 id="pattern-2-asset-inventory-report">Pattern 2: Asset Inventory Report</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_inventory_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate asset inventory by type&quot;&quot;&quot;</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>

    <span class="c1"># Group by type</span>
    <span class="n">by_type</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
        <span class="n">asset_type</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">asset_type</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">if</span> <span class="n">asset_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_type</span><span class="p">:</span>
            <span class="n">by_type</span><span class="p">[</span><span class="n">asset_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">by_type</span><span class="p">[</span><span class="n">asset_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

    <span class="c1"># Print report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ASSET INVENTORY REPORT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">asset_type</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_type</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">asset_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">state</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">) [</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span><span class="si">}</span><span class="s2"> assets&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-3-calibration-management">Pattern 3: Calibration Management</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetState</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_for_calibration</span><span class="p">(</span><span class="n">asset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark asset as in calibration&quot;&quot;&quot;</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
    <span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">IN_CALIBRATION</span>
    <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> sent for calibration&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">complete_calibration</span><span class="p">(</span><span class="n">asset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interval_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">365</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete calibration and update dates&quot;&quot;&quot;</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
    <span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span>
    <span class="n">asset</span><span class="o">.</span><span class="n">calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">interval_days</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">update_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> calibration complete, next due: </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_calibration_schedule</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get upcoming calibration schedule&quot;&quot;&quot;</span>
    <span class="n">instruments</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets_by_type</span><span class="p">(</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>

    <span class="n">schedule</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">:</span>
            <span class="n">schedule</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">instr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;serial&quot;</span><span class="p">:</span> <span class="n">instr</span><span class="o">.</span><span class="n">serial_number</span><span class="p">,</span>
                <span class="s2">&quot;due_date&quot;</span><span class="p">:</span> <span class="n">instr</span><span class="o">.</span><span class="n">next_calibration_date</span><span class="p">,</span>
                <span class="s2">&quot;days_remaining&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">next_calibration_date</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">days</span>
            <span class="p">})</span>

    <span class="c1"># Sort by due date</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;due_date&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">schedule</span>
</code></pre></div>

<h3 id="pattern-4-asset-search">Pattern 4: Asset Search</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_assets</span><span class="p">(</span>
    <span class="n">name_contains</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">AssetState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search assets with filters&quot;&quot;&quot;</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
        <span class="c1"># Apply filters</span>
        <span class="k">if</span> <span class="n">name_contains</span> <span class="ow">and</span> <span class="n">name_contains</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">asset_type</span> <span class="ow">and</span> <span class="n">asset</span><span class="o">.</span><span class="n">asset_type</span> <span class="o">!=</span> <span class="n">asset_type</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">and</span> <span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">state</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">location</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Usage</span>
<span class="n">dmms</span> <span class="o">=</span> <span class="n">find_assets</span><span class="p">(</span><span class="n">name_contains</span><span class="o">=</span><span class="s2">&quot;DMM&quot;</span><span class="p">,</span> <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>
<span class="n">active_stations</span> <span class="o">=</span> <span class="n">find_assets</span><span class="p">(</span><span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Station&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">AssetState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">)</span>
<span class="n">lab_equipment</span> <span class="o">=</span> <span class="n">find_assets</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;Lab&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="asset-model-reference">Asset Model Reference</h2>
<h3 id="asset-fields">Asset Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>asset_id</code></td>
<td>UUID</td>
<td>Unique identifier</td>
</tr>
<tr>
<td><code>name</code></td>
<td>str</td>
<td>Asset name</td>
</tr>
<tr>
<td><code>asset_type</code></td>
<td>str</td>
<td>Type (Station, Instrument, etc.)</td>
</tr>
<tr>
<td><code>serial_number</code></td>
<td>str</td>
<td>Serial number</td>
</tr>
<tr>
<td><code>description</code></td>
<td>str</td>
<td>Description</td>
</tr>
<tr>
<td><code>state</code></td>
<td>AssetState</td>
<td>Current state</td>
</tr>
<tr>
<td><code>location</code></td>
<td>str</td>
<td>Physical location</td>
</tr>
<tr>
<td><code>parent_id</code></td>
<td>UUID</td>
<td>Parent asset ID (for hierarchy)</td>
</tr>
<tr>
<td><code>calibration_date</code></td>
<td>datetime</td>
<td>Last calibration date</td>
</tr>
<tr>
<td><code>next_calibration_date</code></td>
<td>datetime</td>
<td>Next calibration due</td>
</tr>
<tr>
<td><code>children</code></td>
<td>List[Asset]</td>
<td>Child assets (when loaded)</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>List[Setting]</td>
<td>Key-value tags</td>
</tr>
</tbody>
</table>
<h3 id="assetstate-enum">AssetState Enum</h3>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACTIVE</code></td>
<td>In use, operational</td>
</tr>
<tr>
<td><code>INACTIVE</code></td>
<td>Not currently in use</td>
</tr>
<tr>
<td><code>IN_CALIBRATION</code></td>
<td>Being calibrated</td>
</tr>
<tr>
<td><code>IN_REPAIR</code></td>
<td>Under repair</td>
</tr>
<tr>
<td><code>RETIRED</code></td>
<td>End of life</td>
</tr>
</tbody>
</table>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-meaningful-names">1. Use Meaningful Names</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Good - descriptive names</span>
<span class="s2">&quot;ICT-STATION-01&quot;</span>
<span class="s2">&quot;FVT-DMM-KEITHLEY&quot;</span>
<span class="s2">&quot;FIXTURE-PCBA-V2&quot;</span>

<span class="c1"># Avoid - unclear names</span>
<span class="s2">&quot;ASSET1&quot;</span>
<span class="s2">&quot;INST&quot;</span>
</code></pre></div>

<h3 id="2-track-serial-numbers">2. Track Serial Numbers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Always include serial numbers for traceability</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;KTH-2000-12345&quot;</span><span class="p">,</span>  <span class="c1"># Include manufacturer serial</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="3-use-tags-for-custom-data">3. Use Tags for Custom Data</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Tags for flexible metadata</span>
<span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">set_asset_tags</span><span class="p">(</span><span class="n">asset_id</span><span class="p">,</span> <span class="p">[</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Manufacturer&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Keithley&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2000&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;PurchaseDate&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2024-01-15&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;WarrantyExpires&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2027-01-15&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;CostCenter&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;PROD-001&quot;</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>

<h3 id="4-maintain-hierarchy">4. Maintain Hierarchy</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Organize assets hierarchically</span>
<span class="c1"># Station -&gt; Instruments -&gt; Components</span>

<span class="n">station</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FVT-01&quot;</span><span class="p">,</span> <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Station&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">dmm</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FVT-01-DMM&quot;</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="n">station</span><span class="o">.</span><span class="n">asset_id</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">scope</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FVT-01-SCOPE&quot;</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="n">station</span><span class="o">.</span><span class="n">asset_id</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="5-track-calibration">5. Track Calibration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set calibration dates when creating instruments</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">instrument</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">create_asset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DMM-001&quot;</span><span class="p">,</span>
    <span class="n">asset_type</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">,</span>
    <span class="n">calibration_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="n">next_calibration_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="asset-not-found">Asset Not Found</h3>
<div class="codehilite"><pre><span></span><code><span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asset </span><span class="si">{</span><span class="n">asset_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
    <span class="c1"># Try searching by name</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assets</span> <span class="k">if</span> <span class="s2">&quot;DMM&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</code></pre></div>

<h3 id="parent-child-issues">Parent-Child Issues</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify parent exists before creating child</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parent asset not found, create it first&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="state-transitions_1">State Transitions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Some state transitions may be restricted</span>
<span class="c1"># Always check current state before changing</span>
<span class="n">asset</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">get_asset</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">AssetState</span><span class="o">.</span><span class="n">RETIRED</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot modify retired asset&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="product-module.md">Product Module</a> - Managing products tested by assets</li>
<li><a href="production-module.md">Production Module</a> - Manufacturing units at stations</li>
<li><a href="report-module.md">Report Module</a> - Test reports from stations</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-process-module">
    <div class="doc-source">Source: docs/usage/process-module.md</div>
    <h1 id="process-module-usage-guide">Process Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The Process module provides access to process/operation definitions in WATS. Processes define the types of operations that can be performed during manufacturing:</p>
<ul>
<li><strong>Test Operations</strong> - End-of-line tests, ICT tests, functional tests</li>
<li><strong>Repair Operations</strong> - Repair, RMA repair, rework</li>
<li><strong>WIP Operations</strong> - Work-in-progress tracking, assembly steps</li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Get all processes</span>
<span class="n">processes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>

<span class="c1"># Get a specific test operation</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># By code</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;End of line test&quot;</span><span class="p">)</span>  <span class="c1"># By name</span>

<span class="c1"># Validate a process code</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_valid_test_operation</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Valid test operation&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="process-types">Process Types</h2>
<table>
<thead>
<tr>
<th>Type</th>
<th>Flag</th>
<th>Typical Codes</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test</td>
<td><code>is_test_operation</code></td>
<td>100-499</td>
<td>End of line test, ICT, FCT</td>
</tr>
<tr>
<td>Repair</td>
<td><code>is_repair_operation</code></td>
<td>500-599</td>
<td>Repair, RMA Repair</td>
</tr>
<tr>
<td>WIP</td>
<td><code>is_wip_operation</code></td>
<td>200-299</td>
<td>Assembly, Inspection</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check process type</span>
<span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">is_test_operation</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a test operation&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">process</span><span class="o">.</span><span class="n">is_repair_operation</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a repair operation&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">process</span><span class="o">.</span><span class="n">is_wip_operation</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a WIP operation&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="caching">Caching</h2>
<p>The Process service maintains an in-memory cache to minimize API calls. By default, the cache refreshes every 5 minutes.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configure cache refresh interval (seconds)</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">600</span>  <span class="c1"># 10 minutes</span>

<span class="c1"># Force cache refresh</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

<span class="c1"># Check cache status</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last refresh: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">last_refresh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refresh interval: </span><span class="si">{</span><span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="basic-operations">Basic Operations</h2>
<h3 id="1-get-all-processes">1. Get All Processes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all processes (cached)</span>
<span class="n">processes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>

<span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_test_operation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Type: Test Operation&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_repair_operation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Type: Repair Operation&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_wip_operation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Type: WIP Operation&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-get-processes-by-type">2. Get Processes by Type</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get test operations only</span>
<span class="n">test_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operations</span><span class="p">()</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">test_ops</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get repair operations only</span>
<span class="n">repair_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operations</span><span class="p">()</span>

<span class="c1"># Get WIP operations only</span>
<span class="n">wip_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operations</span><span class="p">()</span>
</code></pre></div>

<h3 id="3-get-specific-process">3. Get Specific Process</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># By code (int)</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># By name (str, case-insensitive)</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process</span><span class="p">(</span><span class="s2">&quot;End of line test&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">process</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Process not found&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-get-specific-operation-types">4. Get Specific Operation Types</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get test operation (returns None if not a test operation)</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="s2">&quot;ICT Test&quot;</span><span class="p">)</span>

<span class="c1"># Get repair operation (returns None if not a repair operation)</span>
<span class="n">repair_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">repair_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation</span><span class="p">(</span><span class="s2">&quot;Repair&quot;</span><span class="p">)</span>

<span class="c1"># Get WIP operation</span>
<span class="n">wip_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operation</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">wip_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operation</span><span class="p">(</span><span class="s2">&quot;Assembly&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="validation-helpers">Validation Helpers</h2>
<h3 id="validate-process-codes">Validate Process Codes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Validate test operation code</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_valid_test_operation</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code 100 is a valid test operation&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code 100 is NOT a valid test operation&quot;</span><span class="p">)</span>

<span class="c1"># Validate repair operation code</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_valid_repair_operation</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code 500 is a valid repair operation&quot;</span><span class="p">)</span>

<span class="c1"># Validate WIP operation code</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_valid_wip_operation</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code 200 is a valid WIP operation&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="get-default-codes">Get Default Codes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get default test code (first available or 100 as fallback)</span>
<span class="n">default_test</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_default_test_code</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default test code: </span><span class="si">{</span><span class="n">default_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get default repair code (first available or 500 as fallback)</span>
<span class="n">default_repair</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_default_repair_code</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default repair code: </span><span class="si">{</span><span class="n">default_repair</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-process-validation-before-report-submission">Pattern 1: Process Validation Before Report Submission</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_report_process</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">process_code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate process code before submitting a report&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_valid_test_operation</span><span class="p">(</span><span class="n">process_code</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid test operation code: </span><span class="si">{</span><span class="n">process_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="n">process_code</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">name</span>

<span class="c1"># Usage</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">process_name</span> <span class="o">=</span> <span class="n">validate_report_process</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Submitting report for: </span><span class="si">{</span><span class="n">process_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-2-display-available-operations">Pattern 2: Display Available Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display_available_operations</span><span class="p">(</span><span class="n">api</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display all available operations by type&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== TEST OPERATIONS ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== REPAIR OPERATIONS ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== WIP OPERATIONS ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">code</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-3-process-code-lookup-table">Pattern 3: Process Code Lookup Table</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_process_lookup</span><span class="p">(</span><span class="n">api</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build lookup table for process codes&quot;&quot;&quot;</span>

    <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;repair&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;wip&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_test_operation</span><span class="p">:</span>
            <span class="n">lookup</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">][</span><span class="n">proc</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">name</span>
        <span class="k">elif</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_repair_operation</span><span class="p">:</span>
            <span class="n">lookup</span><span class="p">[</span><span class="s2">&quot;repair&quot;</span><span class="p">][</span><span class="n">proc</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">name</span>
        <span class="k">elif</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_wip_operation</span><span class="p">:</span>
            <span class="n">lookup</span><span class="p">[</span><span class="s2">&quot;wip&quot;</span><span class="p">][</span><span class="n">proc</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">name</span>

    <span class="k">return</span> <span class="n">lookup</span>

<span class="c1"># Usage</span>
<span class="n">lookup</span> <span class="o">=</span> <span class="n">build_process_lookup</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test operation 100: </span><span class="si">{</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-4-automatic-process-selection">Pattern 4: Automatic Process Selection</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_appropriate_process</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">operation_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get appropriate process code for operation type&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_default_test_code</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="s2">&quot;repair&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_default_repair_code</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wip_ops</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_wip_operations</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">wip_ops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span> <span class="k">if</span> <span class="n">wip_ops</span> <span class="k">else</span> <span class="mi">200</span>
</code></pre></div>

<h2 id="internal-api-advanced">Internal API (Advanced)</h2>
<p>The process service provides additional internal API functionality:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get processes with full details (ProcessID, etc.)</span>
<span class="n">processes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_all_processes</span><span class="p">()</span>

<span class="c1"># Get repair operation configurations</span>
<span class="n">configs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_operation_configs</span><span class="p">()</span>

<span class="c1"># Get repair categories (fail codes)</span>
<span class="n">categories</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_repair_categories</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># Get flattened fail codes</span>
<span class="n">fail_codes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_fail_codes</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</code></pre></div>

<p>‚ö†Ô∏è <strong>Warning:</strong> These methods use internal API endpoints that may change without notice.<br />
Check the docstrings for <code>‚ö†Ô∏è INTERNAL API</code> warnings.</p>
<h2 id="model-reference">Model Reference</h2>
<h3 id="processinfo">ProcessInfo</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>code</code></td>
<td>int</td>
<td>Process code (e.g., 100, 500)</td>
</tr>
<tr>
<td><code>name</code></td>
<td>str</td>
<td>Process name</td>
</tr>
<tr>
<td><code>description</code></td>
<td>str</td>
<td>Process description</td>
</tr>
<tr>
<td><code>is_test_operation</code></td>
<td>bool</td>
<td>True if test operation</td>
</tr>
<tr>
<td><code>is_repair_operation</code></td>
<td>bool</td>
<td>True if repair operation</td>
</tr>
<tr>
<td><code>is_wip_operation</code></td>
<td>bool</td>
<td>True if WIP operation</td>
</tr>
<tr>
<td><code>process_id</code></td>
<td>UUID</td>
<td>Process GUID (internal API)</td>
</tr>
<tr>
<td><code>process_index</code></td>
<td>int</td>
<td>Process order index</td>
</tr>
<tr>
<td><code>state</code></td>
<td>int</td>
<td>Process state (1=active)</td>
</tr>
</tbody>
</table>
<h3 id="repaircategory-internal-api">RepairCategory (Internal API)</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>guid</code></td>
<td>UUID</td>
<td>Category identifier</td>
</tr>
<tr>
<td><code>description</code></td>
<td>str</td>
<td>Category name</td>
</tr>
<tr>
<td><code>selectable</code></td>
<td>bool</td>
<td>Can be selected</td>
</tr>
<tr>
<td><code>sort_order</code></td>
<td>int</td>
<td>Display order</td>
</tr>
<tr>
<td><code>failure_type</code></td>
<td>int</td>
<td>Failure type code</td>
</tr>
<tr>
<td><code>fail_codes</code></td>
<td>List</td>
<td>Nested fail codes</td>
</tr>
</tbody>
</table>
<h3 id="repairoperationconfig-internal-api">RepairOperationConfig (Internal API)</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>description</code></td>
<td>str</td>
<td>Configuration name</td>
</tr>
<tr>
<td><code>uut_required</code></td>
<td>int</td>
<td>UUT required flag</td>
</tr>
<tr>
<td><code>bom_required</code></td>
<td>int</td>
<td>BOM required flag</td>
</tr>
<tr>
<td><code>vendor_required</code></td>
<td>int</td>
<td>Vendor required flag</td>
</tr>
<tr>
<td><code>comp_ref_mask</code></td>
<td>str</td>
<td>Component reference regex</td>
</tr>
<tr>
<td><code>categories</code></td>
<td>List</td>
<td>Repair categories</td>
</tr>
</tbody>
</table>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-caching-effectively">1. Use Caching Effectively</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Don&#39;t disable caching unless necessary</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># Keep reasonable interval</span>

<span class="c1"># Only refresh when needed</span>
<span class="k">if</span> <span class="n">need_fresh_data</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</code></pre></div>

<h3 id="2-validate-before-operations">2. Validate Before Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Always validate process codes</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_valid_test_operation</span><span class="p">(</span><span class="n">process_code</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid process code: </span><span class="si">{</span><span class="n">process_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-use-type-specific-methods">3. Use Type-Specific Methods</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Good - type-safe lookup</span>
<span class="n">test_op</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Less safe - could return wrong type</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-handle-missing-processes">4. Handle Missing Processes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Always check for None</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="k">if</span> <span class="n">process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Use default or raise error</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_default_test_code</span><span class="p">()</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="process-not-found">Process Not Found</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if process exists</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="k">if</span> <span class="n">process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># List all available processes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available processes:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_processes</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="wrong-process-type">Wrong Process Type</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># get_test_operation returns None if not a test operation</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_test_operation</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># Returns None (500 is repair)</span>

<span class="c1"># Use generic get_process to check type</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">get_process</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="k">if</span> <span class="n">process</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">is_repair_operation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a repair operation, not a test operation&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="stale-cache-data">Stale Cache Data</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Force refresh if you expect new processes</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

<span class="c1"># Or reduce refresh interval</span>
<span class="n">api</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># 1 minute</span>
</code></pre></div>

<h2 id="limitations">Limitations</h2>
<h3 id="read-only-operations">Read-Only Operations</h3>
<p>Process definitions are <strong>read-only</strong> through the PyWATS API. <br />
Creating, updating, or deleting processes is not supported.</p>
<p>Process management must be done through the WATS Admin interface:<br />
- Add new test operations<br />
- Configure repair operations<br />
- Set up WIP operations</p>
<p>The API provides:<br />
- ‚úÖ List all processes<br />
- ‚úÖ Filter by process type<br />
- ‚úÖ Look up by code or name<br />
- ‚úÖ Validate process codes<br />
- ‚ùå Create processes<br />
- ‚ùå Update processes<br />
- ‚ùå Delete processes</p>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="report-module.md">Report Module</a> - Test reports using process codes</li>
<li><a href="production-module.md">Production Module</a> - Production with process tracking</li>
<li><a href="software-module.md">Software Module</a> - Software distribution</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-product-module">
    <div class="doc-source">Source: docs/usage/product-module.md</div>
    <h1 id="product-module-usage-guide">Product Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The Product module manages products (parts), revisions, BOMs (Bill of Materials), and box build templates in WATS.</p>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Get all products</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>

<span class="c1"># Get specific product</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>

<span class="c1"># Get revisions</span>
<span class="n">revisions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="basic-operations">Basic Operations</h2>
<h3 id="1-get-products">1. Get Products</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all products (summary view)</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>

<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get product with full details</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_full</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">created_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Revisions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">revisions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-get-specific-product">2. Get Specific Product</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># Get by part number</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">product</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part Number: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-create-product">3. Create Product</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># Create new product</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-PART-001&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;New Product Description&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">product_group</span><span class="o">=</span><span class="s2">&quot;Electronics&quot;</span>  <span class="c1"># Optional</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created product: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-update-product">4. Update Product</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get product, modify, update</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Updated Description&quot;</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>

<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_product</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
</code></pre></div>

<h2 id="product-revisions">Product Revisions</h2>
<h3 id="1-get-revisions">1. Get Revisions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all revisions for a product</span>
<span class="n">revisions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">rev</span> <span class="ow">in</span> <span class="n">revisions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Revision </span><span class="si">{</span><span class="n">rev</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">rev</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get specific revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-create-revision">2. Create Revision</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># Create new revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Revision C changes&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="3-revision-states">3. Revision States</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># Available states</span>
<span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>        <span class="c1"># Active/in production</span>
<span class="n">ProductState</span><span class="o">.</span><span class="n">OBSOLETE</span>      <span class="c1"># No longer used</span>
<span class="n">ProductState</span><span class="o">.</span><span class="n">DEVELOPMENT</span>   <span class="c1"># In development</span>
<span class="n">ProductState</span><span class="o">.</span><span class="n">PROTOTYPE</span>     <span class="c1"># Prototype phase</span>
</code></pre></div>

<h2 id="product-tags">Product Tags</h2>
<p>Products and revisions can have tags (key-value metadata):</p>
<h3 id="1-product-tags">1. Product Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get product tags</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_tags</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">tag</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Set product tags (replaces all)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">set_product_tags</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Power Supply&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;12V&quot;</span><span class="p">}</span>
<span class="p">])</span>

<span class="c1"># Add single tag</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;Manufacturer&quot;</span><span class="p">,</span> <span class="s2">&quot;ACME Corp&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-revision-tags">2. Revision Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get revision tags</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision_tags</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Set revision tags</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">set_revision_tags</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;PCB_Version&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1.2&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Test_Program&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;v3.1&quot;</span><span class="p">}</span>
<span class="p">])</span>
</code></pre></div>

<h2 id="bill-of-materials-bom">Bill of Materials (BOM)</h2>
<h3 id="1-get-bom">1. Get BOM</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get BOM for a revision</span>
<span class="n">bom</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="s2">&quot;ASSEMBLY-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bom</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> - Qty: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Designators: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">designators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Revision Mask: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">revision_mask</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-upload-bom">2. Upload BOM</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Upload BOM from list</span>
<span class="n">bom_items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;RESISTOR-100&quot;</span><span class="p">,</span>
        <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;designators&quot;</span><span class="p">:</span> <span class="s2">&quot;R1,R2,R3,R4,R5,R6,R7,R8,R9,R10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>  <span class="c1"># Any revision</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;CAPACITOR-10UF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;designators&quot;</span><span class="p">:</span> <span class="s2">&quot;C1,C2,C3,C4,C5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;A|B&quot;</span>  <span class="c1"># Revision A or B only</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">upload_bom</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;ASSEMBLY-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">bom_items</span><span class="o">=</span><span class="n">bom_items</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="3-revision-masks">3. Revision Masks</h3>
<p>Revision masks control which component revisions are acceptable:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Common patterns:</span>
<span class="s2">&quot;*&quot;</span>        <span class="c1"># Any revision</span>
<span class="s2">&quot;A&quot;</span>        <span class="c1"># Only revision A</span>
<span class="s2">&quot;A|B&quot;</span>      <span class="c1"># Revision A or B</span>
<span class="s2">&quot;A|B|C&quot;</span>    <span class="c1"># Revision A, B, or C</span>
<span class="s2">&quot;[A-Z]&quot;</span>    <span class="c1"># Any letter A through Z</span>
</code></pre></div>

<h3 id="4-upload-bom-from-dict">4. Upload BOM from Dict</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Alternative: Upload from dictionary</span>
<span class="n">bom_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;RESISTOR-100&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;designators&quot;</span><span class="p">:</span> <span class="s2">&quot;R1-R10&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span>
    <span class="s2">&quot;CAPACITOR-10UF&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;designators&quot;</span><span class="p">:</span> <span class="s2">&quot;C1-C5&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">upload_bom_from_dict</span><span class="p">(</span><span class="s2">&quot;ASSEMBLY-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">bom_dict</span><span class="p">)</span>
</code></pre></div>

<h2 id="box-build-templates-internal-api">Box Build Templates (Internal API)</h2>
<p>Box build templates define assemblies with sub-units (e.g., PCBAs in modules).</p>
<p><strong>‚ö†Ô∏è Note</strong>: This uses internal WATS APIs that may change.</p>
<h3 id="1-get-box-build-template">1. Get Box Build Template</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get template showing required subunits</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Main part: </span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Required subunits:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">subunit</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> (Index: </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Revision mask: </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">revision_mask</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-get-required-parts">2. Get Required Parts</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get list of parts needed for assembly</span>
<span class="n">parts</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_subunits</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-add-subunit-to-box-build">3. Add Subunit to Box Build</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get template, add subunit, and save</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span>
    <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PCBA-200&quot;</span><span class="p">,</span>
    <span class="n">child_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">revision_mask</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>  <span class="c1"># Accept any revision</span>
    <span class="n">index</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># Position in assembly</span>
<span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h3 id="4-remove-subunit">4. Remove Subunit</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get template, remove subunit, and save</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">remove_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-200&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>  <span class="c1"># Remove by part and revision</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h3 id="5-box-build-context-manager">5. Box Build Context Manager</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Convenient way to define box build</span>
<span class="k">with</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">builder</span><span class="p">:</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-200&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-201&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="c1"># Auto-saved when context exits</span>
</code></pre></div>

<h2 id="product-groups">Product Groups</h2>
<h3 id="1-get-product-groups">1. Get Product Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all product groups</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_groups</span><span class="p">()</span>

<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-filter-by-group">2. Filter by Group</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all products in a group</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_products</span><span class="p">()</span>
<span class="n">electronics</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">product_group</span> <span class="o">==</span> <span class="s2">&quot;Electronics&quot;</span><span class="p">]</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-product-setup-workflow">Pattern 1: Product Setup Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="c1"># 1. Create product</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-MODULE&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;New Power Module&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">DEVELOPMENT</span>
<span class="p">)</span>

<span class="c1"># 2. Create initial revision</span>
<span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEW-MODULE&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">DEVELOPMENT</span>
<span class="p">)</span>

<span class="c1"># 3. Add tags</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">set_product_tags</span><span class="p">(</span><span class="s2">&quot;NEW-MODULE&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Power Supply&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;12V&quot;</span><span class="p">}</span>
<span class="p">])</span>

<span class="c1"># 4. Upload BOM</span>
<span class="n">bom</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>  <span class="c1"># Your BOM items</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">upload_bom</span><span class="p">(</span><span class="s2">&quot;NEW-MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">bom</span><span class="p">)</span>

<span class="c1"># 5. Activate when ready</span>
<span class="n">revision</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_revision</span><span class="p">(</span><span class="n">revision</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-2-revision-upgrade">Pattern 2: Revision Upgrade</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Copy settings from old to new revision</span>
<span class="n">old_rev</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">old_bom</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">old_tags</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision_tags</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Create new revision</span>
<span class="n">new_rev</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">DEVELOPMENT</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Based on Rev </span><span class="si">{</span><span class="n">old_rev</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="c1"># Copy BOM (modify as needed)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">upload_bom</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">old_bom</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>

<span class="c1"># Copy tags</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">set_revision_tags</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">old_tags</span><span class="p">)</span>

<span class="c1"># When tested, activate new and obsolete old</span>
<span class="n">new_rev</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="n">old_rev</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">OBSOLETE</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_revision</span><span class="p">(</span><span class="n">new_rev</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_revision</span><span class="p">(</span><span class="n">old_rev</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-3-assembly-definition">Pattern 3: Assembly Definition</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Define a module with subassemblies</span>
<span class="n">MAIN_MODULE</span> <span class="o">=</span> <span class="s2">&quot;MODULE-500W&quot;</span>
<span class="n">MAIN_REV</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>

<span class="c1"># Create main product</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span><span class="n">MAIN_MODULE</span><span class="p">,</span> <span class="s2">&quot;500W Power Module&quot;</span><span class="p">,</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span><span class="n">MAIN_MODULE</span><span class="p">,</span> <span class="n">MAIN_REV</span><span class="p">,</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">)</span>

<span class="c1"># Define subunits</span>
<span class="k">with</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="n">MAIN_MODULE</span><span class="p">,</span> <span class="n">MAIN_REV</span><span class="p">)</span> <span class="k">as</span> <span class="n">builder</span><span class="p">:</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-CONTROL&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-POWER&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;FAN-ASSEMBLY&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Upload BOM for mechanical parts</span>
<span class="n">mechanical_bom</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;SCREW-M3&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;designators&quot;</span><span class="p">:</span> <span class="s2">&quot;S1-S8&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;HEATSINK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;designators&quot;</span><span class="p">:</span> <span class="s2">&quot;HS1&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">upload_bom</span><span class="p">(</span><span class="n">MAIN_MODULE</span><span class="p">,</span> <span class="n">MAIN_REV</span><span class="p">,</span> <span class="n">mechanical_bom</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-4-bom-validation">Pattern 4: BOM Validation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_bom</span><span class="p">(</span><span class="n">part_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate BOM has all required parts&quot;&quot;&quot;</span>
    <span class="n">bom</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">revision</span><span class="p">)</span>

    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bom</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
        <span class="c1"># Check if referenced part exists</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">part_number</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part not found: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Check if part has active revision matching mask</span>
        <span class="n">revisions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">part_number</span><span class="p">)</span>
        <span class="n">active_revs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">revisions</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">active_revs</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No active revision for: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">issues</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-meaningful-part-numbers">1. Use Meaningful Part Numbers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - descriptive</span>
<span class="s2">&quot;MODULE-500W-12V&quot;</span>
<span class="s2">&quot;PCBA-CONTROLLER-V2&quot;</span>
<span class="s2">&quot;RESISTOR-10K-0603&quot;</span>

<span class="c1"># ‚úó Avoid - unclear</span>
<span class="s2">&quot;PART001&quot;</span>
<span class="s2">&quot;ASM-1&quot;</span>
</code></pre></div>

<h3 id="2-manage-states-properly">2. Manage States Properly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - proper lifecycle</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">DEVELOPMENT</span>  <span class="c1"># During design</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>       <span class="c1"># In production</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">OBSOLETE</span>     <span class="c1"># End of life</span>

<span class="c1"># ‚úó Avoid - skipping states</span>
<span class="n">product</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>  <span class="c1"># Directly from creation (risky)</span>
</code></pre></div>

<h3 id="3-use-revision-masks">3. Use Revision Masks</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - flexible BOM</span>
<span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;RESISTOR&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">}</span>  <span class="c1"># Any revision OK</span>

<span class="c1"># ‚úì Good - controlled BOM</span>
<span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;FIRMWARE&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;3.0|3.1&quot;</span><span class="p">}</span>  <span class="c1"># Specific versions</span>

<span class="c1"># ‚úó Avoid - too restrictive</span>
<span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="s2">&quot;RESISTOR&quot;</span><span class="p">,</span> <span class="s2">&quot;revision_mask&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>  <span class="c1"># Must update for every revision</span>
</code></pre></div>

<h3 id="4-tag-consistently">4. Tag Consistently</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - consistent naming</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="s2">&quot;Electronics&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;PART-002&quot;</span><span class="p">,</span> <span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="s2">&quot;Mechanical&quot;</span><span class="p">)</span>

<span class="c1"># ‚úó Avoid - inconsistent</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;electronics&quot;</span><span class="p">)</span>  <span class="c1"># Lowercase</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add_product_tag</span><span class="p">(</span><span class="s2">&quot;PART-002&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Mechanical&quot;</span><span class="p">)</span>       <span class="c1"># Different key</span>
</code></pre></div>

<h3 id="5-validate-before-production">5. Validate Before Production</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - validate before activating</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;NEW-PART&quot;</span><span class="p">)</span>
<span class="n">bom</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_bom</span><span class="p">(</span><span class="s2">&quot;NEW-PART&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bom</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Has BOM</span>
    <span class="n">revision</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="s2">&quot;NEW-PART&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">revision</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
    <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_revision</span><span class="p">(</span><span class="n">revision</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot activate - BOM is empty&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="product-not-found">Product Not Found</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if product exists before operations</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">product</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product doesn&#39;t exist - create it first&quot;</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="bom-upload-failing">BOM Upload Failing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ensure all referenced parts exist</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bom_items</span><span class="p">:</span>
    <span class="n">part</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Create </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;part_number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> first&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="revision-conflicts">Revision Conflicts</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check existing revisions before creating new</span>
<span class="n">revisions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_revisions</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">)</span>
<span class="n">existing</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">revision</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">revisions</span><span class="p">]</span>
<span class="k">if</span> <span class="s2">&quot;B&quot;</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Revision B already exists&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="production-module.md">Production Module</a> - For manufacturing units from products</li>
<li><a href="report-module.md">Report Module</a> - For testing products</li>
<li><a href="../architecture.md">Architecture</a> - Overall system design</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-production-module">
    <div class="doc-source">Source: docs/usage/production-module.md</div>
    <h1 id="production-module-usage-guide">Production Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The Production module manages serial numbers, unit tracking, production phases, and assembly operations in WATS.</p>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Get unit information</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>

<span class="c1"># Verify unit status</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Passing: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">is_passing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check if unit is passing</span>
<span class="n">is_passing</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="serial-number-management">Serial Number Management</h2>
<h3 id="1-allocate-serial-numbers">1. Allocate Serial Numbers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get available serial number types for a product</span>
<span class="n">sn_types</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_serial_number_types</span><span class="p">(</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">sn_type</span> <span class="ow">in</span> <span class="n">sn_types</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sn_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sn_type</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Allocate serial numbers (if using WATS allocation)</span>
<span class="n">serial_numbers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">allocate_serial_numbers</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">serial_type_id</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># From get_serial_number_types</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">serial_numbers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allocated: </span><span class="si">{</span><span class="n">sn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-manual-serial-numbers">2. Manual Serial Numbers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># For customer-provided or pre-existing serials</span>
<span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;CUSTOMER-SN-001&quot;</span>

<span class="c1"># Create unit with this serial (happens automatically on first test/operation)</span>
<span class="c1"># No explicit allocation needed</span>
</code></pre></div>

<h2 id="unit-operations">Unit Operations</h2>
<h3 id="1-get-unit-information">1. Get Unit Information</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get full unit details</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Serial: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> Rev </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phase: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">phase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Process: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">current_process</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last Test: </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">last_test_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-createupdate-units">2. Create/Update Units</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>

<span class="c1"># Units are typically created automatically when first tested</span>
<span class="c1"># But you can create them explicitly:</span>

<span class="n">unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-NEW-001&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PART-001&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>

<span class="n">created_unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-set-unit-phase">3. Set Unit Phase</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Common phases:</span>
<span class="c1"># - &quot;Undefined&quot;</span>
<span class="c1"># - &quot;Under Production - Queued&quot;</span>
<span class="c1"># - &quot;Under Production&quot;</span>
<span class="c1"># - &quot;Finalized&quot;</span>
<span class="c1"># - &quot;Scrapped&quot;</span>

<span class="c1"># Set unit to production queue</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;Under Production - Queued&quot;</span><span class="p">)</span>

<span class="c1"># Start production</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;Under Production&quot;</span><span class="p">)</span>

<span class="c1"># Finalize after passing all tests</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-set-unit-process">4. Set Unit Process</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set current operation/process</span>
<span class="c1"># Process codes come from app.get_processes()</span>

<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span>
    <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span>  <span class="c1"># ICT, Final Test, etc.</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="5-update-unit-tags">5. Update Unit Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add or update tags (metadata) on units</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_tags</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;LotNumber&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;LOT-2025-W01&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;WorkOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;WO-12345&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Station&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ICT-3&quot;</span><span class="p">}</span>
<span class="p">])</span>
</code></pre></div>

<h2 id="unit-verification">Unit Verification</h2>
<h3 id="1-verify-unit-status">1. Verify Unit Status</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitVerificationGrade</span>

<span class="c1"># Get verification with grade</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grade: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">grade</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Passing: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">is_passing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed Steps: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">failed_step_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check specific grades</span>
<span class="k">if</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">PASSED</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All tests passed&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">FAILED</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some tests failed&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">verification</span><span class="o">.</span><span class="n">grade</span> <span class="o">==</span> <span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">NOT_TESTED</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not yet tested&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-simple-passfail-check">2. Simple Pass/Fail Check</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Quick check - returns boolean</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit is passing&quot;</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit has failures&quot;</span><span class="p">)</span>
    <span class="c1"># Send to repair or scrap</span>
</code></pre></div>

<h3 id="3-verification-grades">3. Verification Grades</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitVerificationGrade</span>

<span class="c1"># Available grades:</span>
<span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">PASSED</span>          <span class="c1"># All tests passed</span>
<span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">FAILED</span>          <span class="c1"># Has failures</span>
<span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">NOT_TESTED</span>      <span class="c1"># No test data</span>
<span class="n">UnitVerificationGrade</span><span class="o">.</span><span class="n">PENDING</span>         <span class="c1"># Tests in progress</span>
</code></pre></div>

<h2 id="unit-changes-history">Unit Changes (History)</h2>
<h3 id="1-get-change-history">1. Get Change History</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all changes for a unit</span>
<span class="n">changes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit_changes</span><span class="p">(</span><span class="s2">&quot;SN-12345&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">change_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Process: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">process_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Operator: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">operator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Phase: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">new_phase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-track-unit-lifecycle">2. Track Unit Lifecycle</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">print_unit_lifecycle</span><span class="p">(</span><span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print complete unit lifecycle&quot;&quot;&quot;</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit_changes</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Lifecycle for </span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">changes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">timestamp</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">timestamp</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">change_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Process: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">process_name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Phase: </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">old_phase</span><span class="si">}</span><span class="s2"> ‚Üí </span><span class="si">{</span><span class="n">change</span><span class="o">.</span><span class="n">new_phase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<h2 id="assembly-operations">Assembly Operations</h2>
<h3 id="1-verify-assembly-box-build">1. Verify Assembly (Box Build)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if all required subunits are present</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;MODULE-SN-001&quot;</span><span class="p">,</span>
    <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span>
    <span class="n">parent_revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Complete: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">is_complete</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing parts: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">missing_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">missing</span> <span class="ow">in</span> <span class="n">verification</span><span class="o">.</span><span class="n">missing_parts</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">missing</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> at index </span><span class="si">{</span><span class="n">missing</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-build-assembly">2. Build Assembly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add subunit to assembly (using production service)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;MODULE-SN-001&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PCBA-SN-123&quot;</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># Position in assembly (from box build template)</span>
<span class="p">)</span>

<span class="c1"># Add another subunit</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;MODULE-SN-001&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PCBA-SN-124&quot;</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Verify assembly is complete</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-SN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">verification</span><span class="o">.</span><span class="n">is_complete</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assembly complete!&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-disassemble">3. Disassemble</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Remove subunit from assembly</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">remove_child_from_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;MODULE-SN-001&quot;</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># Position to remove</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="production-batches">Production Batches</h2>
<h3 id="1-track-batchlot">1. Track Batch/Lot</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Group units by batch using tags</span>
<span class="n">batch_number</span> <span class="o">=</span> <span class="s2">&quot;BATCH-2025-W01&quot;</span>

<span class="c1"># Set batch on units as they&#39;re created</span>
<span class="k">for</span> <span class="n">serial</span> <span class="ow">in</span> <span class="n">serial_numbers</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_tags</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;LotNumber&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">batch_number</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;ManufactureDate&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-01-15&quot;</span><span class="p">}</span>
    <span class="p">])</span>
</code></pre></div>

<h3 id="2-query-batch-units">2. Query Batch Units</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all units in batch (via report query with OData)</span>
<span class="c1"># Note: Tag-based filtering may require specific OData syntax</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
    <span class="n">odata_filter</span><span class="o">=</span><span class="s2">&quot;partNumber eq &#39;WIDGET-001&#39;&quot;</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">500</span>
<span class="p">)</span>

<span class="c1"># Filter by tag in application code</span>
<span class="n">batch_units</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">headers</span> 
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;LotNumber&quot;</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;BATCH-2025-W01&quot;</span> 
           <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;misc_info&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[])</span>
<span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_units</span><span class="p">)</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-complete-production-workflow">Pattern 1: Complete Production Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">production_workflow</span><span class="p">(</span><span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">part_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete workflow from creation to finalization&quot;&quot;&quot;</span>

    <span class="c1"># 1. Set to production queue</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="s2">&quot;Under Production - Queued&quot;</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_tags</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;LotNumber&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;LOT-2025-W01&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;StartDate&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()}</span>
    <span class="p">])</span>

    <span class="c1"># 2. Start production - ICT</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="s2">&quot;Under Production&quot;</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># ICT</span>

    <span class="c1"># Run ICT test (creates UUT report)</span>
    <span class="c1"># ... test code ...</span>

    <span class="c1"># 3. Move to next operation - Final Test</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="c1"># Run final test</span>
    <span class="c1"># ... test code ...</span>

    <span class="c1"># 4. Verify and finalize</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">):</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: Production complete&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: Failed - send to repair&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-2-assembly-build-workflow">Pattern 2: Assembly Build Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_module</span><span class="p">(</span><span class="n">module_sn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pcba_serials</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build module from PCBAs&quot;&quot;&quot;</span>

    <span class="n">MODULE_PART</span> <span class="o">=</span> <span class="s2">&quot;MODULE-100&quot;</span>
    <span class="n">MODULE_REV</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>

    <span class="c1"># 1. Create module unit</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="s2">&quot;Under Production - Queued&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Verify all PCBAs are passing</span>
    <span class="k">for</span> <span class="n">pcba_sn</span> <span class="ow">in</span> <span class="n">pcba_serials</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">pcba_sn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PCBA </span><span class="si">{</span><span class="n">pcba_sn</span><span class="si">}</span><span class="s2"> is not passing&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Build assembly</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">pcba_sn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pcba_serials</span><span class="p">):</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
            <span class="n">parent_serial</span><span class="o">=</span><span class="n">module_sn</span><span class="p">,</span>
            <span class="n">child_serial</span><span class="o">=</span><span class="n">pcba_sn</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span>
        <span class="p">)</span>

    <span class="c1"># 4. Verify assembly complete</span>
    <span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="n">MODULE_PART</span><span class="p">,</span> <span class="n">MODULE_REV</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">verification</span><span class="o">.</span><span class="n">is_complete</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assembly incomplete: </span><span class="si">{</span><span class="n">verification</span><span class="o">.</span><span class="n">missing_parts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 5. Test module</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="s2">&quot;Under Production&quot;</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># ... run module tests ...</span>

    <span class="c1"># 6. Finalize if passing</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">module_sn</span><span class="p">):</span>
        <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-3-repair-workflow">Pattern 3: Repair Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">repair_workflow</span><span class="p">(</span><span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle failed unit repair&quot;&quot;&quot;</span>

    <span class="c1"># 1. Check current status</span>
    <span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_unit</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verification</span><span class="o">.</span><span class="n">is_passing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit is already passing&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># 2. Create UUR (repair) report</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UURReport</span>

    <span class="c1"># Get last test to determine failure</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>

    <span class="c1"># Create repair report</span>
    <span class="n">uur</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">create_uur_from_part_and_process</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">unit</span><span class="o">.</span><span class="n">part_number</span><span class="p">,</span>
        <span class="n">serial_number</span><span class="o">=</span><span class="n">serial_number</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="n">unit</span><span class="o">.</span><span class="n">revision</span><span class="p">,</span>
        <span class="n">process_code</span><span class="o">=</span><span class="n">unit</span><span class="o">.</span><span class="n">current_process</span><span class="p">,</span>
        <span class="n">failure_category</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>  <span class="c1"># Your failure category</span>
        <span class="n">failure_code</span><span class="o">=</span><span class="mi">501</span><span class="p">,</span>      <span class="c1"># Specific failure</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Repair performed&quot;</span><span class="p">,</span>
        <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;Repair Tech&quot;</span>
    <span class="p">)</span>

    <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">send_uur_report</span><span class="p">(</span><span class="n">uur</span><span class="p">)</span>

    <span class="c1"># 3. Retest</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_process</span><span class="p">(</span><span class="n">serial_number</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="n">unit</span><span class="o">.</span><span class="n">current_process</span><span class="p">)</span>

    <span class="c1"># ... run test again ...</span>

    <span class="c1"># 4. Check if now passing</span>
    <span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">serial_number</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: Repair successful&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">: Still failing - escalate&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-4-production-dashboard">Pattern 4: Production Dashboard</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">production_dashboard</span><span class="p">(</span><span class="n">part_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show production status for a product&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="c1"># Get all reports for product using OData filter</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
        <span class="n">odata_filter</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;partNumber eq &#39;</span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&#39; and start ge </span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="mi">1000</span>
    <span class="p">)</span>

    <span class="c1"># Analyze</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">passed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">passed</span><span class="p">])</span>
    <span class="n">failed</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">passed</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> Production Status (Last 7 Days)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Tested: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Passed: </span><span class="si">{</span><span class="n">passed</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">passed</span><span class="o">/</span><span class="n">total</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">failed</span><span class="o">/</span><span class="n">total</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

    <span class="c1"># Show units in production</span>
    <span class="n">in_production</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">and</span> <span class="n">unit</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s2">&quot;Under Production&quot;</span><span class="p">:</span>
            <span class="n">in_production</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Currently in production: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">in_production</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">in_production</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show first 10</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">sn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-phases-consistently">1. Use Phases Consistently</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - proper flow</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;Under Production - Queued&quot;</span><span class="p">)</span>  <span class="c1"># 1. Queued</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;Under Production&quot;</span><span class="p">)</span>           <span class="c1"># 2. Testing</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>                  <span class="c1"># 3. Done</span>

<span class="c1"># ‚úó Avoid - skipping phases</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>  <span class="c1"># Directly (missing history)</span>
</code></pre></div>

<h3 id="2-verify-before-finalizing">2. Verify Before Finalizing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - always check</span>
<span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">is_unit_passing</span><span class="p">(</span><span class="n">sn</span><span class="p">):</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Handle failure</span>

<span class="c1"># ‚úó Avoid - finalizing without checking</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>  <span class="c1"># What if it failed?</span>
</code></pre></div>

<h3 id="3-track-with-tags">3. Track with Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - comprehensive tracking</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_tags</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;LotNumber&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;LOT-001&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;WorkOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;WO-12345&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Station&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ICT-3&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Operator&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">}</span>
<span class="p">])</span>

<span class="c1"># ‚úó Avoid - minimal tracking</span>
<span class="c1"># (Hard to trace issues later)</span>
</code></pre></div>

<h3 id="4-validate-assembly-order">4. Validate Assembly Order</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ‚úì Good - build in order</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">pcba_sn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pcba_serials</span><span class="p">):</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="n">pcba_sn</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

<span class="c1"># ‚úó Avoid - wrong indices</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="n">pcba1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Should be 0</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span><span class="n">module_sn</span><span class="p">,</span> <span class="n">pcba2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Should be 1</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="unit-not-found">Unit Not Found</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Units are created on first test or explicit creation</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(</span><span class="s2">&quot;NEW-SN-001&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit will be created on first test&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="assembly-verification-failing">Assembly Verification Failing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check template definition</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required subunits: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Verify each subunit</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span><span class="s2">&quot;MODULE-SN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">missing</span> <span class="ow">in</span> <span class="n">verification</span><span class="o">.</span><span class="n">missing_parts</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing: </span><span class="si">{</span><span class="n">missing</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> at index </span><span class="si">{</span><span class="n">missing</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="process-code-not-found">Process Code Not Found</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get available process codes</span>
<span class="n">processes</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get_processes</span><span class="p">()</span>
<span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="report-module.md">Report Module</a> - For creating test reports</li>
<li><a href="product-module.md">Product Module</a> - For product/BOM setup</li>
<li><a href="../architecture.md">Architecture</a> - Overall system design</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-rootcause-module">
    <div class="doc-source">Source: docs/usage/rootcause-module.md</div>
    <h1 id="rootcause-module-usage-guide">RootCause Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The RootCause module provides a ticketing system for tracking quality issues, root cause investigations, and corrective actions in WATS. It supports the 8D (Eight Disciplines) problem-solving methodology commonly used in electronics manufacturing.</p>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketStatus</span><span class="p">,</span> <span class="n">TicketPriority</span><span class="p">,</span> <span class="n">TicketView</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Get open tickets assigned to you</span>
<span class="n">tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
    <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span>
<span class="p">)</span>

<span class="c1"># Create a new ticket</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Solder Bridge Defect - ICT Line 1&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">initial_comment</span><span class="o">=</span><span class="s2">&quot;Detected 5</span><span class="si">% d</span><span class="s2">efect rate on PCBA-001&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="ticket-status">Ticket Status</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketStatus</span>

<span class="c1"># Individual statuses (IntFlag - can be combined)</span>
<span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span>          <span class="c1"># 1 - New ticket</span>
<span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span>   <span class="c1"># 2 - Being worked on</span>
<span class="n">TicketStatus</span><span class="o">.</span><span class="n">ON_HOLD</span>       <span class="c1"># 4 - Temporarily paused</span>
<span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span>        <span class="c1"># 8 - Solution found</span>
<span class="n">TicketStatus</span><span class="o">.</span><span class="n">CLOSED</span>        <span class="c1"># 16 - Closed</span>
<span class="n">TicketStatus</span><span class="o">.</span><span class="n">ARCHIVED</span>      <span class="c1"># 32 - Archived</span>

<span class="c1"># Combining statuses for filtering</span>
<span class="n">active</span> <span class="o">=</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span>  <span class="c1"># Open or In Progress</span>
<span class="n">all_active</span> <span class="o">=</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">ON_HOLD</span>
</code></pre></div>

<h2 id="ticket-priority">Ticket Priority</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketPriority</span>

<span class="n">TicketPriority</span><span class="o">.</span><span class="n">LOW</span>     <span class="c1"># 0 - Low priority</span>
<span class="n">TicketPriority</span><span class="o">.</span><span class="n">MEDIUM</span>  <span class="c1"># 1 - Normal priority</span>
<span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span>    <span class="c1"># 2 - High priority (production impact)</span>
</code></pre></div>

<h2 id="ticket-views">Ticket Views</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.rootcause</span><span class="w"> </span><span class="kn">import</span> <span class="n">TicketView</span>

<span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span>   <span class="c1"># 0 - Tickets assigned to you</span>
<span class="n">TicketView</span><span class="o">.</span><span class="n">FOLLOWING</span>  <span class="c1"># 1 - Tickets you&#39;re following</span>
<span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>        <span class="c1"># 2 - All tickets (requires permission)</span>
</code></pre></div>

<h2 id="basic-operations">Basic Operations</h2>
<h3 id="1-get-tickets">1. Get Tickets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get tickets assigned to you (default view)</span>
<span class="n">my_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span><span class="p">,</span>
    <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">my_tickets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">TicketStatus</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Priority: </span><span class="si">{</span><span class="n">TicketPriority</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Assignee: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assignee</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get all open tickets</span>
<span class="n">all_open</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
    <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>
<span class="p">)</span>

<span class="c1"># Get active tickets (convenience method)</span>
<span class="n">active</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_active_tickets</span><span class="p">()</span>  <span class="c1"># OPEN | IN_PROGRESS</span>
</code></pre></div>

<h3 id="2-get-single-ticket">2. Get Single Ticket</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get ticket by ID</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>

<span class="k">if</span> <span class="n">ticket</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ticket #</span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Owner: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">owner</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assignee: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">assignee</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Team: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">team</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">ticket</span><span class="o">.</span><span class="n">created_utc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># History (comments and updates)</span>
    <span class="k">if</span> <span class="n">ticket</span><span class="o">.</span><span class="n">history</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;History entries: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">history</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">update</span> <span class="ow">in</span> <span class="n">ticket</span><span class="o">.</span><span class="n">history</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">update</span><span class="o">.</span><span class="n">update_utc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">update</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-create-ticket">3. Create Ticket</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic ticket</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;ICT Failure Rate Spike&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">initial_comment</span><span class="o">=</span><span class="s2">&quot;Failure rate increased from 1% to 5% this morning.&quot;</span>
<span class="p">)</span>

<span class="c1"># Ticket linked to a test report</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failure Investigation - </span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">report_uuid</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span>  <span class="c1"># Link to failing report</span>
    <span class="n">initial_comment</span><span class="o">=</span><span class="s2">&quot;Investigating test failure on unit...&quot;</span>
<span class="p">)</span>

<span class="c1"># Ticket with assignee and team</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Process Issue - Reflow Profile&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
    <span class="n">assignee</span><span class="o">=</span><span class="s2">&quot;quality_engineer&quot;</span><span class="p">,</span>
    <span class="n">team</span><span class="o">=</span><span class="s2">&quot;Quality Team&quot;</span><span class="p">,</span>
    <span class="n">initial_comment</span><span class="o">=</span><span class="s2">&quot;Temperature profile may need adjustment.&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="4-update-ticket">4. Update Ticket</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get ticket, modify, update</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="s2">&quot;Engineering Team&quot;</span>

<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">update_ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
</code></pre></div>

<h3 id="5-add-comment">5. Add Comment</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add comment to ticket</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Completed 5-Why analysis. Root cause identified as incorrect stencil.&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="6-change-status">6. Change Status</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Change ticket status</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span>
<span class="p">)</span>

<span class="c1"># Mark as solved</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="7-assign-ticket">7. Assign Ticket</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Assign to user</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">assign_ticket</span><span class="p">(</span>
    <span class="n">ticket_id</span><span class="o">=</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span>
    <span class="n">assignee</span><span class="o">=</span><span class="s2">&quot;john.smith&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="8-archive-tickets">8. Archive Tickets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Archive solved tickets</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">archive_tickets</span><span class="p">([</span><span class="n">ticket_id1</span><span class="p">,</span> <span class="n">ticket_id2</span><span class="p">])</span>

<span class="c1"># Note: Only SOLVED tickets can be archived</span>
</code></pre></div>

<h2 id="team-assignment-with-tags">Team Assignment with Tags</h2>
<p>Tags can be used to store team member roles:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.shared</span><span class="w"> </span><span class="kn">import</span> <span class="n">Setting</span>

<span class="c1"># Get ticket and add team member tags</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>

<span class="n">team_tags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Team_Champion&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;J. Smith&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Team_Leader&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;M. Johnson&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Team_ProcessEng&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;K. Williams&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Team_TestEng&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;L. Chen&quot;</span><span class="p">),</span>
    <span class="n">Setting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;Team_QualityEng&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;R. Patel&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Add tags to ticket</span>
<span class="k">if</span> <span class="n">ticket</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
    <span class="n">ticket</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">team_tags</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ticket</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">team_tags</span>

<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">update_ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
</code></pre></div>

<h2 id="8d-problem-solving-workflow">8D Problem-Solving Workflow</h2>
<p>The 8D methodology is a structured approach to problem solving. Here's how to implement it with RootCause tickets:</p>
<h3 id="d0-preparation">D0: Preparation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create ticket for the problem</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[8D] Solder Bridge Defect - </span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
    <span class="n">report_uuid</span><span class="o">=</span><span class="n">failing_report_id</span><span class="p">,</span>
    <span class="n">initial_comment</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## D0: Preparation</span>

<span class="s2">### Emergency Response Actions</span>
<span class="s2">1. Quarantine affected batch</span>
<span class="s2">2. Stop production on affected line</span>
<span class="s2">3. Notify Quality Manager</span>

<span class="s2">### Symptom Description</span>
<span class="s2">- Defect: Solder bridge on U3 (MCU)</span>
<span class="s2">- Impact: ICT test failure</span>
<span class="s2">- Urgency: HIGH - Production stopped</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="d1-establish-team">D1: Establish Team</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Document team formation</span>
<span class="n">d1_comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## D1: Team Assembly</span>

<span class="s2">### Cross-Functional Team</span>

<span class="s2">| Role | Name | Responsibility |</span>
<span class="s2">|------|------|----------------|</span>
<span class="s2">| Champion | J. Smith | Executive sponsor |</span>
<span class="s2">| Leader | M. Johnson | Investigation lead |</span>
<span class="s2">| Process Engineer | K. Williams | Manufacturing process |</span>
<span class="s2">| Test Engineer | L. Chen | Test system expert |</span>
<span class="s2">| Quality Engineer | R. Patel | Quality documentation |</span>

<span class="s2">### Team Charter</span>
<span class="s2">- Objective: Identify root cause and implement corrective action</span>
<span class="s2">- Timeline: 2 weeks</span>
<span class="s2">- Meetings: Daily standup at 09:00</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">d1_comment</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span><span class="p">)</span>
</code></pre></div>

<h3 id="d2-problem-definition">D2: Problem Definition</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Document problem using 5W2H</span>
<span class="n">d2_comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## D2: Problem Definition (5W2H)</span>

<span class="s2">### WHAT is the problem?</span>
<span class="s2">Solder bridges on U3 MCU pins 12-13</span>

<span class="s2">### WHERE was it found?</span>
<span class="s2">ICT Station 01, Production Line 2</span>

<span class="s2">### WHEN did it occur?</span>
<span class="s2">Started 2024-12-13 morning shift</span>

<span class="s2">### WHO found it?</span>
<span class="s2">Automated ICT test system</span>

<span class="s2">### WHY is it a problem?</span>
<span class="s2">- Causes test failures</span>
<span class="s2">- 5</span><span class="si">% d</span><span class="s2">efect rate (threshold: 1%)</span>
<span class="s2">- Production line stopped</span>

<span class="s2">### HOW MANY affected?</span>
<span class="s2">5 units out of 100 tested</span>

<span class="s2">### HOW was it detected?</span>
<span class="s2">Boundary scan test during ICT</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">d2_comment</span><span class="p">)</span>
</code></pre></div>

<h3 id="d3-interim-containment">D3: Interim Containment</h3>
<div class="codehilite"><pre><span></span><code><span class="n">d3_comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## D3: Interim Containment Actions</span>

<span class="s2">### Actions Taken</span>

<span class="s2">| Action | Owner | Status |</span>
<span class="s2">|--------|-------|--------|</span>
<span class="s2">| Quarantine batch L2024-1213 | Technician | Complete |</span>
<span class="s2">| 100% visual inspection | QC | Complete |</span>
<span class="s2">| Increase SPI sampling to 100% | Process Eng | Complete |</span>
<span class="s2">| Add manual inspection post-reflow | Supervisor | Complete |</span>

<span class="s2">### Verification</span>
<span class="s2">- 50 units quarantined and inspected</span>
<span class="s2">- 5 total defective units identified</span>
<span class="s2">- 45 good units released</span>
<span class="s2">- No escapes to customer</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">d3_comment</span><span class="p">)</span>
</code></pre></div>

<h3 id="d4-root-cause-analysis">D4: Root Cause Analysis</h3>
<div class="codehilite"><pre><span></span><code><span class="n">d4_comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## D4: Root Cause Analysis</span>

<span class="s2">### 5-Why Analysis</span>

<span class="s2">1. **Why?** Too much solder paste on pads</span>
<span class="s2">2. **Why?** Stencil aperture oversized</span>
<span class="s2">3. **Why?** Wrong stencil revision used (Rev A vs Rev B)</span>
<span class="s2">4. **Why?** Stencil not verified before changeover</span>
<span class="s2">5. **Why?** No stencil verification in changeover procedure</span>

<span class="s2">**ROOT CAUSE:** Missing stencil verification step in changeover procedure</span>

<span class="s2">### Verification</span>
<span class="s2">- Test: Used correct stencil on 20 units</span>
<span class="s2">- Result: 0 defects</span>
<span class="s2">- Conclusion: Root cause confirmed</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">d4_comment</span><span class="p">)</span>
</code></pre></div>

<h3 id="d5-d8-continue-pattern">D5-D8: Continue Pattern</h3>
<p>Continue documenting each phase with comments until closure.</p>
<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-create-ticket-from-test-failure">Pattern 1: Create Ticket from Test Failure</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_failure_ticket</span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span> <span class="n">serial_number</span><span class="p">,</span> <span class="n">failure_description</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create RootCause ticket from a test failure&quot;&quot;&quot;</span>

    <span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
        <span class="n">subject</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Test Failure - </span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="n">TicketPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
        <span class="n">report_uuid</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span>
        <span class="n">initial_comment</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## Test Failure Report</span>

<span class="s2">**Serial Number:** </span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span>
<span class="s2">**Report ID:** </span><span class="si">{</span><span class="n">report_id</span><span class="si">}</span>

<span class="s2">### Failure Description</span>
<span class="si">{</span><span class="n">failure_description</span><span class="si">}</span>

<span class="s2">### Initial Assessment</span>
<span class="s2">Pending investigation.</span>

<span class="s2">---</span>
<span class="s2">*Auto-generated from test system*</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ticket</span>
</code></pre></div>

<h3 id="pattern-2-get-my-active-tickets">Pattern 2: Get My Active Tickets</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_my_active_tickets</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all active tickets assigned to current user&quot;&quot;&quot;</span>

    <span class="n">tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
        <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">ON_HOLD</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ASSIGNED</span>
    <span class="p">)</span>

    <span class="c1"># Sort by priority (HIGH first)</span>
    <span class="n">tickets</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">priority</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">priority</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tickets</span>
</code></pre></div>

<h3 id="pattern-3-ticket-summary-report">Pattern 3: Ticket Summary Report</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_ticket_summary</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate summary of all tickets by status&quot;&quot;&quot;</span>

    <span class="n">all_tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
        <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">ON_HOLD</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>
    <span class="p">)</span>

    <span class="c1"># Group by status</span>
    <span class="n">by_status</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">all_tickets</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">TicketStatus</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">ticket</span><span class="o">.</span><span class="n">status</span> <span class="k">else</span> <span class="s2">&quot;UNKNOWN&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_status</span><span class="p">:</span>
            <span class="n">by_status</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">by_status</span><span class="p">[</span><span class="n">status</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>

    <span class="c1"># Print summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROOTCAUSE TICKET SUMMARY&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">status</span><span class="p">,</span> <span class="n">tickets</span> <span class="ow">in</span> <span class="n">by_status</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tickets</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickets&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tickets</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Show first 5</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="n">TicketPriority</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">priority</span> <span class="k">else</span> <span class="s2">&quot;?&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  #</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">ticket_number</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">priority</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">subject</span><span class="p">[:</span><span class="mi">40</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-4-close-and-archive-workflow">Pattern 4: Close and Archive Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">resolution_comment</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close a ticket with resolution comment&quot;&quot;&quot;</span>

    <span class="c1"># Add resolution comment</span>
    <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## Resolution</span>

<span class="si">{</span><span class="n">resolution_comment</span><span class="si">}</span>

<span class="s2">---</span>
<span class="s2">*Ticket closed by automated workflow*</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Change to SOLVED</span>
    <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">archive_old_solved_tickets</span><span class="p">(</span><span class="n">days_old</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Archive tickets solved more than X days ago&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="n">solved</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
        <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>
    <span class="p">)</span>

    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_old</span><span class="p">)</span>
    <span class="n">to_archive</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">solved</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ticket</span><span class="o">.</span><span class="n">updated_utc</span> <span class="ow">and</span> <span class="n">ticket</span><span class="o">.</span><span class="n">updated_utc</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
            <span class="n">to_archive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">ticket_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_archive</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">archive_tickets</span><span class="p">(</span><span class="n">to_archive</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archived </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">to_archive</span><span class="p">)</span><span class="si">}</span><span class="s2"> tickets&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="ticket-model-reference">Ticket Model Reference</h2>
<h3 id="ticket-fields">Ticket Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ticket_id</code></td>
<td>UUID</td>
<td>Unique identifier</td>
</tr>
<tr>
<td><code>ticket_number</code></td>
<td>int</td>
<td>Human-readable ticket number</td>
</tr>
<tr>
<td><code>subject</code></td>
<td>str</td>
<td>Ticket title</td>
</tr>
<tr>
<td><code>status</code></td>
<td>TicketStatus</td>
<td>Current status</td>
</tr>
<tr>
<td><code>priority</code></td>
<td>TicketPriority</td>
<td>Priority level</td>
</tr>
<tr>
<td><code>owner</code></td>
<td>str</td>
<td>Ticket owner username</td>
</tr>
<tr>
<td><code>assignee</code></td>
<td>str</td>
<td>Assigned user</td>
</tr>
<tr>
<td><code>team</code></td>
<td>str</td>
<td>Assigned team</td>
</tr>
<tr>
<td><code>report_uuid</code></td>
<td>UUID</td>
<td>Linked test report ID</td>
</tr>
<tr>
<td><code>created_utc</code></td>
<td>datetime</td>
<td>Creation timestamp</td>
</tr>
<tr>
<td><code>updated_utc</code></td>
<td>datetime</td>
<td>Last update timestamp</td>
</tr>
<tr>
<td><code>progress</code></td>
<td>str</td>
<td>Progress notes</td>
</tr>
<tr>
<td><code>origin</code></td>
<td>str</td>
<td>Origin/source</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>List[Setting]</td>
<td>Key-value tags</td>
</tr>
<tr>
<td><code>history</code></td>
<td>List[TicketUpdate]</td>
<td>Update history</td>
</tr>
</tbody>
</table>
<h3 id="ticketupdate-fields">TicketUpdate Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>update_id</code></td>
<td>UUID</td>
<td>Update identifier</td>
</tr>
<tr>
<td><code>update_utc</code></td>
<td>datetime</td>
<td>Update timestamp</td>
</tr>
<tr>
<td><code>update_user</code></td>
<td>str</td>
<td>User who made update</td>
</tr>
<tr>
<td><code>content</code></td>
<td>str</td>
<td>Update content</td>
</tr>
<tr>
<td><code>update_type</code></td>
<td>TicketUpdateType</td>
<td>Type of update</td>
</tr>
<tr>
<td><code>attachments</code></td>
<td>List[TicketAttachment]</td>
<td>Attached files</td>
</tr>
</tbody>
</table>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-clear-subjects">1. Use Clear Subjects</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Good - descriptive subjects</span>
<span class="s2">&quot;[8D] Solder Bridge on U3 - Batch L2024-1213&quot;</span>
<span class="s2">&quot;ICT Failure Spike - Line 2 Morning Shift&quot;</span>
<span class="s2">&quot;Customer Return - RMA-2024-001&quot;</span>

<span class="c1"># Avoid - vague subjects</span>
<span class="s2">&quot;Problem&quot;</span>
<span class="s2">&quot;Issue&quot;</span>
<span class="s2">&quot;Check this&quot;</span>
</code></pre></div>

<h3 id="2-link-to-reports">2. Link to Reports</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Always link tickets to related test reports</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">create_ticket</span><span class="p">(</span>
    <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">report_uuid</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span>  <span class="c1"># Link to failing report</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="3-document-progress">3. Document Progress</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add comments at each stage</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="s2">&quot;Started 5-Why analysis...&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="s2">&quot;Root cause identified: ...&quot;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="s2">&quot;Corrective action implemented: ...&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-use-proper-status-transitions">4. Use Proper Status Transitions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Typical flow:</span>
<span class="c1"># OPEN -&gt; IN_PROGRESS -&gt; SOLVED -&gt; ARCHIVED</span>

<span class="c1"># Or with holds:</span>
<span class="c1"># OPEN -&gt; IN_PROGRESS -&gt; ON_HOLD -&gt; IN_PROGRESS -&gt; SOLVED</span>
</code></pre></div>

<h3 id="5-assign-appropriately">5. Assign Appropriately</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Assign to specific user for accountability</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">assign_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="s2">&quot;quality_engineer&quot;</span><span class="p">)</span>

<span class="c1"># Use team for group ownership</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="s2">&quot;Quality Team&quot;</span>
<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">update_ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="ticket-not-found">Ticket Not Found</h3>
<div class="codehilite"><pre><span></span><code><span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">ticket</span><span class="p">:</span>
    <span class="c1"># Try searching</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
        <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span> <span class="o">|</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>
    <span class="p">)</span>
    <span class="c1"># Search by subject or other criteria</span>
</code></pre></div>

<h3 id="cannot-archive">Cannot Archive</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Only SOLVED tickets can be archived</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">ticket</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">change_status</span><span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="n">TicketStatus</span><span class="o">.</span><span class="n">SOLVED</span><span class="p">)</span>

<span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">archive_tickets</span><span class="p">([</span><span class="n">ticket_id</span><span class="p">])</span>
</code></pre></div>

<h3 id="view-returns-empty">View Returns Empty</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ASSIGNED view requires tickets assigned to current user</span>
<span class="c1"># Use ALL view to see everything (requires permission)</span>
<span class="n">tickets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">rootcause</span><span class="o">.</span><span class="n">get_tickets</span><span class="p">(</span>
    <span class="n">status</span><span class="o">=</span><span class="n">TicketStatus</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
    <span class="n">view</span><span class="o">=</span><span class="n">TicketView</span><span class="o">.</span><span class="n">ALL</span>  <span class="c1"># Instead of ASSIGNED</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="product-module.md">Product Module</a> - Products involved in issues</li>
<li><a href="production-module.md">Production Module</a> - Production units with failures</li>
<li><a href="report-module.md">Report Module</a> - Test reports linked to tickets</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-software-module">
    <div class="doc-source">Source: docs/usage/software-module.md</div>
    <h1 id="software-module-usage-guide">Software Module Usage Guide</h1>
<h2 id="overview">Overview</h2>
<p>The Software module provides functionality for managing software distribution packages in WATS. These packages are used to distribute software, configurations, and files to test stations and production equipment.</p>
<h2 id="quick-start">Quick Start</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageStatus</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;credentials&quot;</span><span class="p">)</span>

<span class="c1"># Get all software packages</span>
<span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">()</span>

<span class="c1"># Get a released package by name</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_released_package</span><span class="p">(</span><span class="s2">&quot;TestExecutive&quot;</span><span class="p">)</span>

<span class="c1"># Create a new package</span>
<span class="n">new_pkg</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTestSoftware&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Test station software v2.0&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="package-status-workflow">Package Status Workflow</h2>
<p>Software packages follow a strict status workflow:</p>
<div class="codehilite"><pre><span></span><code><span class="n">DRAFT</span> <span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫</span> <span class="n">PENDING</span> <span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫</span> <span class="n">RELEASED</span> <span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫</span> <span class="n">REVOKED</span>
  <span class="err">‚ñ≤</span>             <span class="err">‚îÇ</span>
  <span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
     <span class="p">(</span><span class="n">return</span><span class="p">)</span>
</code></pre></div>

<table>
<thead>
<tr>
<th>Status</th>
<th>Description</th>
<th>Can Edit</th>
<th>Can Delete</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DRAFT</code></td>
<td>Initial state, under development</td>
<td>All fields</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><code>PENDING</code></td>
<td>Submitted for review</td>
<td>Status, Tags only</td>
<td>‚ùå No</td>
</tr>
<tr>
<td><code>RELEASED</code></td>
<td>Approved for distribution</td>
<td>Status, Tags only</td>
<td>‚ùå No</td>
</tr>
<tr>
<td><code>REVOKED</code></td>
<td>Withdrawn from distribution</td>
<td>-</td>
<td>‚úÖ Yes</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageStatus</span>

<span class="c1"># Status enum values</span>
<span class="n">PackageStatus</span><span class="o">.</span><span class="n">DRAFT</span>      <span class="c1"># &quot;Draft&quot;</span>
<span class="n">PackageStatus</span><span class="o">.</span><span class="n">PENDING</span>    <span class="c1"># &quot;Pending&quot;</span>
<span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span>   <span class="c1"># &quot;Released&quot;</span>
<span class="n">PackageStatus</span><span class="o">.</span><span class="n">REVOKED</span>    <span class="c1"># &quot;Revoked&quot;</span>
</code></pre></div>

<h2 id="basic-operations">Basic Operations</h2>
<h3 id="1-list-all-packages">1. List All Packages</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all packages</span>
<span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages</span><span class="p">()</span>

<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-get-package-by-id">2. Get Package by ID</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get specific package</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Version: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-get-package-by-name">3. Get Package by Name</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get package by name and status</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TestExecutive&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="mi">2</span>  <span class="c1"># Optional - omit for latest</span>
<span class="p">)</span>

<span class="c1"># Convenience method for released packages</span>
<span class="n">released</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_released_package</span><span class="p">(</span><span class="s2">&quot;TestExecutive&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-create-package">4. Create Package</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageTag</span>

<span class="c1"># Create with basic info</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTestSoftware&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Automated test software for production&quot;</span><span class="p">,</span>
    <span class="n">install_on_root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">root_directory</span><span class="o">=</span><span class="s2">&quot;/TestStation&quot;</span><span class="p">,</span>
    <span class="n">priority</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create with tags</span>
<span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;platform&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;windows&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;test-executive&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2.0.0&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TaggedSoftware&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Software with metadata tags&quot;</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Note:</strong> If a package with the same name exists, the new version will be incremented automatically.</p>
<h3 id="5-update-package">5. Update Package</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get package</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="c1"># Update metadata (only in DRAFT status)</span>
<span class="n">package</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Updated description&quot;</span>
<span class="n">package</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">updated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">update_package</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
</code></pre></div>

<p><strong>Note:</strong> Only DRAFT packages allow full editing. PENDING and RELEASED packages can only have Status and Tags updated.</p>
<h3 id="6-delete-package">6. Delete Package</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete by ID (must be DRAFT or REVOKED)</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="c1"># Delete by name and version</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">delete_package_by_name</span><span class="p">(</span><span class="s2">&quot;MyTestSoftware&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<h2 id="status-workflow-methods">Status Workflow Methods</h2>
<h3 id="submit-for-review-draft-pending">Submit for Review (Draft ‚Üí Pending)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">submit_for_review</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package submitted for review&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="return-to-draft-pending-draft">Return to Draft (Pending ‚Üí Draft)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">return_to_draft</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package returned to draft&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="release-package-pending-released">Release Package (Pending ‚Üí Released)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">release_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package released for distribution&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="revoke-package-released-revoked">Revoke Package (Released ‚Üí Revoked)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">revoke_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package revoked&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="package-files">Package Files</h2>
<h3 id="list-package-files">List Package Files</h3>
<div class="codehilite"><pre><span></span><code><span class="n">files</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_files</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">size_mb</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">size_mb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Path: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Checksum: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">checksum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Attributes: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="upload-zip-file">Upload Zip File</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Read zip file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;software_package.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">zip_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># Upload to package (merge with existing)</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">upload_zip</span><span class="p">(</span>
    <span class="n">package_id</span><span class="o">=</span><span class="n">package_id</span><span class="p">,</span>
    <span class="n">zip_content</span><span class="o">=</span><span class="n">zip_content</span><span class="p">,</span>
    <span class="n">clean_install</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Merge files</span>
<span class="p">)</span>

<span class="c1"># Upload with clean install (delete existing first)</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">upload_zip</span><span class="p">(</span>
    <span class="n">package_id</span><span class="o">=</span><span class="n">package_id</span><span class="p">,</span>
    <span class="n">zip_content</span><span class="o">=</span><span class="n">zip_content</span><span class="p">,</span>
    <span class="n">clean_install</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Delete all existing files first</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Zip File Requirements:</strong><br />
- Files cannot be at the root level of the zip<br />
- All files must be in a folder: <code>zipFile/myFolder/myFile.txt</code></p>
<h3 id="update-file-attributes">Update File Attributes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get files first</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_files</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="c1"># Update attribute for a file</span>
<span class="n">target_file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;setup.exe&quot;</span><span class="p">)</span>

<span class="n">success</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">update_file_attribute</span><span class="p">(</span>
    <span class="n">file_id</span><span class="o">=</span><span class="n">target_file</span><span class="o">.</span><span class="n">file_id</span><span class="p">,</span>
    <span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;ExecuteOnce&quot;</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>File Attribute Values:</strong><br />
| Attribute | Description |<br />
|-----------|-------------|<br />
| <code>None</code> | No special handling |<br />
| <code>ExecuteOnce</code> | Execute once after install |<br />
| <code>ExecuteAlways</code> | Execute on every sync |<br />
| <code>TopLevelFile</code> | Display in package root |<br />
| <code>OverwriteNever</code> | Never overwrite existing |<br />
| <code>OverwriteOnNewPackageVersion</code> | Only overwrite on new version |<br />
| <code>ExecuteOncePerVersion</code> | Execute once per package version |</p>
<h2 id="package-tags">Package Tags</h2>
<p>Tags provide metadata for filtering and organizing packages.</p>
<h3 id="create-package-with-tags">Create Package with Tags</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.software</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageTag</span>

<span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;platform&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;windows&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;production&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;test-engineering&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TaggedPackage&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Package with tags&quot;</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="filter-by-tag">Filter by Tag</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get packages with specific tag</span>
<span class="n">packages</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_packages_by_tag</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;platform&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;windows&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> v</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="virtual-folders">Virtual Folders</h2>
<p>Virtual folders are registered directories in Production Manager.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all virtual folders</span>
<span class="n">folders</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_virtual_folders</span><span class="p">()</span>

<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">folder</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Description: </span><span class="si">{</span><span class="n">folder</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-create-and-release-package">Pattern 1: Create and Release Package</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_and_release_package</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">zip_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a package and release it for distribution&quot;&quot;&quot;</span>

    <span class="c1"># 1. Create draft package</span>
    <span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">package</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to create package&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Upload files</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">zip_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">upload_zip</span><span class="p">(</span>
        <span class="n">package_id</span><span class="o">=</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">,</span>
        <span class="n">zip_content</span><span class="o">=</span><span class="n">zip_content</span><span class="p">,</span>
        <span class="n">clean_install</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># 3. Submit for review</span>
    <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">submit_for_review</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>

    <span class="c1"># 4. Release (requires approval workflow in production)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">release_package</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>
</code></pre></div>

<h3 id="pattern-2-get-latest-released-package">Pattern 2: Get Latest Released Package</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_latest_package</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the latest released version of a package&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_by_name</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span>
        <span class="c1"># Omit version to get highest version</span>
    <span class="p">)</span>
</code></pre></div>

<h3 id="pattern-3-package-version-comparison">Pattern 3: Package Version Comparison</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_newer_version_available</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">current_version</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a newer released version exists&quot;&quot;&quot;</span>
    <span class="n">latest</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_released_package</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">latest</span> <span class="ow">and</span> <span class="n">latest</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">latest</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="n">current_version</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<h3 id="pattern-4-revoke-and-replace-package">Pattern 4: Revoke and Replace Package</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">replace_package</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">old_pkg_id</span><span class="p">,</span> <span class="n">new_zip_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Revoke old package and create replacement&quot;&quot;&quot;</span>

    <span class="c1"># Get old package info</span>
    <span class="n">old_pkg</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="n">old_pkg_id</span><span class="p">)</span>

    <span class="c1"># Revoke old package (if released)</span>
    <span class="k">if</span> <span class="n">old_pkg</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">revoke_package</span><span class="p">(</span><span class="n">old_pkg_id</span><span class="p">)</span>

    <span class="c1"># Create new version (auto-increments version number)</span>
    <span class="n">new_pkg</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">old_pkg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">old_pkg</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="n">old_pkg</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="n">old_pkg</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Upload new files</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_zip_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">upload_zip</span><span class="p">(</span><span class="n">new_pkg</span><span class="o">.</span><span class="n">package_id</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">clean_install</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_pkg</span>
</code></pre></div>

<h2 id="model-reference">Model Reference</h2>
<h3 id="package">Package</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>package_id</code></td>
<td>UUID</td>
<td>Unique identifier</td>
</tr>
<tr>
<td><code>name</code></td>
<td>str</td>
<td>Package name</td>
</tr>
<tr>
<td><code>description</code></td>
<td>str</td>
<td>Package description</td>
</tr>
<tr>
<td><code>version</code></td>
<td>int</td>
<td>Version number (auto-incremented)</td>
</tr>
<tr>
<td><code>status</code></td>
<td>PackageStatus</td>
<td>Current status</td>
</tr>
<tr>
<td><code>install_on_root</code></td>
<td>bool</td>
<td>Install at root level</td>
</tr>
<tr>
<td><code>root_directory</code></td>
<td>str</td>
<td>Root installation directory</td>
</tr>
<tr>
<td><code>priority</code></td>
<td>int</td>
<td>Installation priority</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>List[PackageTag]</td>
<td>Metadata tags</td>
</tr>
<tr>
<td><code>created_utc</code></td>
<td>datetime</td>
<td>Creation timestamp</td>
</tr>
<tr>
<td><code>modified_utc</code></td>
<td>datetime</td>
<td>Last modification</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td>str</td>
<td>Creator username</td>
</tr>
<tr>
<td><code>modified_by</code></td>
<td>str</td>
<td>Last modifier username</td>
</tr>
<tr>
<td><code>files</code></td>
<td>List[PackageFile]</td>
<td>Package files (when populated)</td>
</tr>
</tbody>
</table>
<h3 id="packagefile">PackageFile</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file_id</code></td>
<td>UUID</td>
<td>File identifier</td>
</tr>
<tr>
<td><code>filename</code></td>
<td>str</td>
<td>File name</td>
</tr>
<tr>
<td><code>path</code></td>
<td>str</td>
<td>Full path within package</td>
</tr>
<tr>
<td><code>size</code></td>
<td>int</td>
<td>File size in bytes</td>
</tr>
<tr>
<td><code>checksum</code></td>
<td>str</td>
<td>File checksum</td>
</tr>
<tr>
<td><code>attributes</code></td>
<td>str</td>
<td>File attributes</td>
</tr>
<tr>
<td><code>created_utc</code></td>
<td>datetime</td>
<td>Creation timestamp</td>
</tr>
<tr>
<td><code>modified_utc</code></td>
<td>datetime</td>
<td>Last modification</td>
</tr>
</tbody>
</table>
<h3 id="packagetag">PackageTag</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td>str</td>
<td>Tag name/key</td>
</tr>
<tr>
<td><code>value</code></td>
<td>str</td>
<td>Tag value</td>
</tr>
</tbody>
</table>
<h3 id="virtualfolder">VirtualFolder</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>folder_id</code></td>
<td>UUID</td>
<td>Folder identifier</td>
</tr>
<tr>
<td><code>name</code></td>
<td>str</td>
<td>Folder name</td>
</tr>
<tr>
<td><code>path</code></td>
<td>str</td>
<td>Folder path</td>
</tr>
<tr>
<td><code>description</code></td>
<td>str</td>
<td>Folder description</td>
</tr>
</tbody>
</table>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-meaningful-names">1. Use Meaningful Names</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Good - descriptive name with version info</span>
<span class="s2">&quot;TestExecutive_EOL_v2&quot;</span>
<span class="s2">&quot;Calibration_Tools_ICT&quot;</span>

<span class="c1"># Avoid - vague names</span>
<span class="s2">&quot;Software1&quot;</span>
<span class="s2">&quot;Package&quot;</span>
</code></pre></div>

<h3 id="2-use-tags-for-organization">2. Use Tags for Organization</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Organize by metadata</span>
<span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;platform&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;windows&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;station_type&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;ICT&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;maintainer&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;test-team&quot;</span><span class="p">),</span>
    <span class="n">PackageTag</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;semantic_version&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2.1.0&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="3-always-test-before-release">3. Always Test Before Release</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create and test in DRAFT</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">create_package</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">upload_zip</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">,</span> <span class="n">zip_content</span><span class="p">)</span>

<span class="c1"># Verify files</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package_files</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1"># Then release</span>
<span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">submit_for_review</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">release_package</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>
</code></pre></div>

<h3 id="4-clean-up-test-packages">4. Clean Up Test Packages</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Delete test packages after testing</span>
<span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PackageStatus</span><span class="o">.</span><span class="n">DRAFT</span><span class="p">,</span> <span class="n">PackageStatus</span><span class="o">.</span><span class="n">REVOKED</span><span class="p">]:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="cannot-delete-package">Cannot Delete Package</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Must be DRAFT or REVOKED to delete</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PackageStatus</span><span class="o">.</span><span class="n">RELEASED</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">revoke_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">package</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PackageStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">return_to_draft</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>

<span class="c1"># Now can delete</span>
<span class="n">api</span><span class="o">.</span><span class="n">software</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span>
</code></pre></div>

<h3 id="zip-upload-fails">Zip Upload Fails</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ensure zip has proper structure</span>
<span class="c1"># Files must be in a folder, not at root</span>
<span class="c1"># Correct: mypackage.zip/installer/setup.exe</span>
<span class="c1"># Wrong:   mypackage.zip/setup.exe (at root)</span>
</code></pre></div>

<h3 id="status-transition-fails">Status Transition Fails</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Only valid transitions:</span>
<span class="c1"># Draft -&gt; Pending (submit_for_review)</span>
<span class="c1"># Pending -&gt; Draft (return_to_draft)</span>
<span class="c1"># Pending -&gt; Released (release_package)</span>
<span class="c1"># Released -&gt; Revoked (revoke_package)</span>

<span class="c1"># Cannot skip steps (e.g., Draft -&gt; Released)</span>
</code></pre></div>

<h2 id="limitations">Limitations</h2>
<h3 id="package-file-download-not-supported">Package File Download Not Supported</h3>
<p>Downloading package files is not currently supported through the PyWATS API. <br />
Files can only be uploaded to packages, not downloaded.</p>
<p>To access package files, use the WATS web interface or Production Manager.</p>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="process-module.md">Process Module</a> - Test/repair operations</li>
<li><a href="production-module.md">Production Module</a> - Production units</li>
<li><a href="asset-module.md">Asset Module</a> - Test station assets</li>
</ul>
</div>


<div class="doc-separator" id="usage-guides-box-build-guide">
    <div class="doc-source">Source: docs/usage/box-build-guide.md</div>
    <h1 id="box-build-guide">Box Build Guide</h1>
<h2 id="overview">Overview</h2>
<p>Box build functionality in pyWATS manages multi-level product assemblies where a parent product contains one or more child products (subunits). This guide explains how to:</p>
<ol>
<li>Define what subunits a product requires (Box Build Template)</li>
<li>Actually build assemblies during production (Unit Assembly)</li>
</ol>
<h2 id="key-concept-templates-vs-units">Key Concept: Templates vs. Units</h2>
<p>Understanding the distinction between these two concepts is crucial:</p>
<h3 id="box-build-template-product-domain">Box Build Template (Product Domain)</h3>
<p><strong>What it is:</strong> A DESIGN-TIME definition of what subunits are required to build a product.</p>
<p><strong>Where it lives:</strong> Product domain (<code>api.product</code>)</p>
<p><strong>Example use case:</strong> "A Controller Module (CTRL-100) requires 1x Power Supply and 2x Sensor Board"</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># This defines the REQUIREMENTS (what&#39;s needed)</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;SENSOR-300&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h3 id="unit-assembly-production-domain">Unit Assembly (Production Domain)</h3>
<p><strong>What it is:</strong> RUNTIME attachment of actual production units (with serial numbers) to a parent unit.</p>
<p><strong>Where it lives:</strong> Production domain (<code>api.production</code>)</p>
<p><strong>Example use case:</strong> "Unit CTRL-SN-001 now contains PSU-SN-456, SENSOR-SN-789, and SENSOR-SN-790"</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># This BUILDS the assembly (attaches actual units)</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span> <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span> <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="complete-workflow">Complete Workflow</h2>
<h3 id="step-1-create-products">Step 1: Create Products</h3>
<p>First, create the parent and child products with revisions:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.product.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProductState</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your-token&quot;</span><span class="p">)</span>

<span class="c1"># Create child product (Power Supply)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Supply Unit&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;24V DC Power Supply&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>

<span class="c1"># Create parent product (Controller Module)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Controller Module&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Main Controller with Power Supply&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_revision</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="o">=</span><span class="n">ProductState</span><span class="o">.</span><span class="n">ACTIVE</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="step-2-define-box-build-template">Step 2: Define Box Build Template</h3>
<p>Define what subunits the parent product requires:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get or create box build template</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Add required subunits</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Save to server</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># Or use context manager (auto-saves)</span>
<span class="k">with</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bb</span><span class="p">:</span>
    <span class="n">bb</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bb</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;SENSOR-300&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Automatically saved when exiting context</span>
</code></pre></div>

<h3 id="step-3-create-production-units">Step 3: Create Production Units</h3>
<p>Create actual units with serial numbers:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.domains.production</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unit</span>

<span class="c1"># Create parent unit</span>
<span class="n">parent_unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>

<span class="c1"># Create child unit</span>
<span class="n">child_unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>

<span class="c1"># Save to WATS</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">create_units</span><span class="p">([</span><span class="n">parent_unit</span><span class="p">,</span> <span class="n">child_unit</span><span class="p">])</span>
</code></pre></div>

<h3 id="step-4-test-and-finalize-child-units">Step 4: Test and Finalize Child Units</h3>
<p><strong>Important:</strong> Child units MUST be finalized before they can be added to an assembly.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run tests on child unit (creates test reports)</span>
<span class="c1"># ... your test code here ...</span>

<span class="c1"># Set child unit to &quot;Finalized&quot; phase</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span>
    <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;Finalized&quot;</span>  <span class="c1"># or phase=16 (the phase ID)</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="step-5-build-the-assembly">Step 5: Build the Assembly</h3>
<p>Attach child units to the parent:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add child to parent assembly</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span>
    <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span>
    <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Child successfully added to assembly!&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="step-6-verify-assembly">Step 6: Verify Assembly</h3>
<p>Check if all required subunits are attached:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify assembly matches box build template</span>
<span class="n">verification</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span>
    <span class="n">serial_number</span><span class="o">=</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">revision</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verification result: </span><span class="si">{</span><span class="n">verification</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="api-reference">API Reference</h2>
<h3 id="product-domain-templates">Product Domain (Templates)</h3>
<h4 id="apiproductget_box_build_templatepart_number-revision"><code>api.product.get_box_build_template(part_number, revision)</code></h4>
<p>Get or create a box build template.</p>
<div class="codehilite"><pre><span></span><code><span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="boxbuildtemplateadd_subunitpart_number-revision-quantity1"><code>BoxBuildTemplate.add_subunit(part_number, revision, quantity=1)</code></h4>
<p>Add a subunit requirement to the template.</p>
<div class="codehilite"><pre><span></span><code><span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;SENSOR-300&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">revision_mask</span><span class="o">=</span><span class="s2">&quot;A,B&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Parameters:</strong><br />
- <code>part_number</code>: Child product part number<br />
- <code>revision</code>: Default revision for the child<br />
- <code>quantity</code>: How many are required (default: 1)<br />
- <code>revision_mask</code>: Acceptable revisions pattern (optional)</p>
<h4 id="boxbuildtemplateremove_subunitpart_number-revision"><code>BoxBuildTemplate.remove_subunit(part_number, revision)</code></h4>
<p>Remove a subunit from the template.</p>
<div class="codehilite"><pre><span></span><code><span class="n">template</span><span class="o">.</span><span class="n">remove_subunit</span><span class="p">(</span><span class="s2">&quot;OLD-PART&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="boxbuildtemplatesave"><code>BoxBuildTemplate.save()</code></h4>
<p>Persist all changes to the server.</p>
<div class="codehilite"><pre><span></span><code><span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h4 id="boxbuildtemplatesubunits"><code>BoxBuildTemplate.subunits</code></h4>
<p>Get current subunits (including pending changes).</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">subunit</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">subunits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">child_part_number</span><span class="si">}</span><span class="s2"> rev </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">child_revision</span><span class="si">}</span><span class="s2">: qty </span><span class="si">{</span><span class="n">subunit</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="production-domain-unit-assembly">Production Domain (Unit Assembly)</h3>
<h4 id="apiproductionadd_child_to_assemblyparent_serial-parent_part-child_serial-child_part"><code>api.production.add_child_to_assembly(parent_serial, parent_part, child_serial, child_part)</code></h4>
<p>Attach a child unit to a parent assembly.</p>
<p><strong>Requirements:</strong><br />
- Parent's box build template must define this child product<br />
- Child unit must be in "Finalized" phase<br />
- Child must not already have a parent</p>
<div class="codehilite"><pre><span></span><code><span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span>
    <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span>
    <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="apiproductionremove_child_from_assemblyparent_serial-parent_part-child_serial-child_part"><code>api.production.remove_child_from_assembly(parent_serial, parent_part, child_serial, child_part)</code></h4>
<p>Detach a child unit from a parent.</p>
<div class="codehilite"><pre><span></span><code><span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">remove_child_from_assembly</span><span class="p">(</span>
    <span class="n">parent_serial</span><span class="o">=</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span>
    <span class="n">parent_part</span><span class="o">=</span><span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span>
    <span class="n">child_serial</span><span class="o">=</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span>
    <span class="n">child_part</span><span class="o">=</span><span class="s2">&quot;PSU-200&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="apiproductionverify_assemblyserial_number-part_number-revision"><code>api.production.verify_assembly(serial_number, part_number, revision)</code></h4>
<p>Check if assembly matches box build template.</p>
<div class="codehilite"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">verify_assembly</span><span class="p">(</span><span class="s2">&quot;CTRL-SN-001&quot;</span><span class="p">,</span> <span class="s2">&quot;CTRL-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="apiproductionset_unit_phaseserial_number-part_number-phase"><code>api.production.set_unit_phase(serial_number, part_number, phase)</code></h4>
<p>Set a unit's phase. Use "Finalized" (or phase ID 16) before adding to assembly.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># By name</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span> <span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span> <span class="s2">&quot;Finalized&quot;</span><span class="p">)</span>

<span class="c1"># By ID</span>
<span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">set_unit_phase</span><span class="p">(</span><span class="s2">&quot;PSU-SN-456&quot;</span><span class="p">,</span> <span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</code></pre></div>

<h2 id="revision-masks">Revision Masks</h2>
<p>Revision masks control which child revisions are acceptable in a box build:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Accept only revision A</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PART&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">revision_mask</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Accept any revision starting with &quot;1.&quot;</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PART&quot;</span><span class="p">,</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">revision_mask</span><span class="o">=</span><span class="s2">&quot;1.%&quot;</span><span class="p">)</span>

<span class="c1"># Accept multiple specific revisions</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PART&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">revision_mask</span><span class="o">=</span><span class="s2">&quot;A,B,C&quot;</span><span class="p">)</span>

<span class="c1"># Accept revision range</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PART&quot;</span><span class="p">,</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">revision_mask</span><span class="o">=</span><span class="s2">&quot;1.0,1.1,1.2&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="error-handling">Error Handling</h2>
<h3 id="common-errors">Common Errors</h3>
<p><strong>Child not finalized:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Child</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">phase</span><span class="w"> </span><span class="n">Finalized</span>
<span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">api</span><span class="o">.</span><span class="na">production</span><span class="o">.</span><span class="na">set_unit_phase</span><span class="o">(</span><span class="n">child_sn</span><span class="o">,</span><span class="w"> </span><span class="n">child_pn</span><span class="o">,</span><span class="w"> </span><span class="s2">&quot;Finalized&quot;</span><span class="o">)</span>
</code></pre></div>

<p><strong>Child not in template:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Parent</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">valid</span>
<span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="n">first</span>
</code></pre></div>

<p><strong>Child already has parent:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">parent</span>
<span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">first</span>
</code></pre></div>

<h2 id="bom-vs-box-build">BOM vs Box Build</h2>
<p><strong>Bill of Materials (BOM):</strong> Lists electronic components (resistors, capacitors, ICs) - typically for PCB assembly. Uses WSBF XML format.</p>
<p><strong>Box Build Template:</strong> Lists subassemblies/subunits (PCBAs, power supplies, modules) - for mechanical/final assembly. Uses ProductRevisionRelation.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># BOM: Electronic components for PCB</span>
<span class="n">bom_items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BomItem</span><span class="p">(</span><span class="n">component_ref</span><span class="o">=</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;RES-10K&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">BomItem</span><span class="p">(</span><span class="n">component_ref</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;CAP-100NF&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">update_bom</span><span class="p">(</span><span class="s2">&quot;PCBA-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">bom_items</span><span class="p">)</span>

<span class="c1"># Box Build: Subassemblies for final product</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_box_build_template</span><span class="p">(</span><span class="s2">&quot;MODULE-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PCBA-100&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># The assembled PCB</span>
<span class="n">template</span><span class="o">.</span><span class="n">add_subunit</span><span class="p">(</span><span class="s2">&quot;PSU-200&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># Power supply</span>
<span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<ol>
<li>
<p><strong>Define templates before production:</strong> Set up box build templates before creating production units.</p>
</li>
<li>
<p><strong>Finalize children first:</strong> Always finalize child units before adding to assembly.</p>
</li>
<li>
<p><strong>Use revision masks wisely:</strong> Allow flexibility where appropriate (e.g., <code>"1.%"</code> for minor revisions).</p>
</li>
<li>
<p><strong>Verify after assembly:</strong> Always call <code>verify_assembly()</code> to confirm completeness.</p>
</li>
<li>
<p><strong>Handle errors gracefully:</strong> Wrap assembly operations in try/except blocks.</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">add_child_to_assembly</span><span class="p">(</span>
        <span class="n">parent_serial</span><span class="p">,</span> <span class="n">parent_part</span><span class="p">,</span> <span class="n">child_serial</span><span class="p">,</span> <span class="n">child_part</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assembly failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Handle error (retry, log, alert, etc.)</span>
</code></pre></div>
</div>


<div class="section-header" id="reference">
    <h1>Reference</h1>
</div>


<div class="doc-separator" id="reference-env-variables">
    <div class="doc-source">Source: docs/env-variables.md</div>
    <h1 id="environment-variables-for-pywats-client-debugging">Environment Variables for pyWATS Client Debugging</h1>
<h2 id="overview">Overview</h2>
<p>For development and debugging, you can use environment variables to provide credentials without committing them to the repository.</p>
<h2 id="setup">Setup</h2>
<ol>
<li>
<p><strong>Copy the example file:</strong><br />
<code>bash
   cp .env.example .env</code></p>
</li>
<li>
<p><strong>Edit <code>.env</code> with your credentials:</strong><br />
<code>bash
   PYWATS_SERVER_URL=https://python.wats.com
   PYWATS_API_TOKEN=your_actual_token_here</code></p>
</li>
<li>
<p><strong>Load environment variables:</strong></p>
</li>
</ol>
<p><strong>PowerShell:</strong><br />
<code>powershell
   # Load from .env file (requires dotenv package or manual loading)
   Get-Content .env | ForEach-Object {
       if ($_ -match '^([^=]+)=(.*)$') {
           [Environment]::SetEnvironmentVariable($matches[1], $matches[2], 'Process')
       }
   }</code></p>
<p><strong>Bash/Linux:</strong><br />
<code>bash
   export $(grep -v '^#' .env | xargs)</code></p>
<p><strong>Or set directly:</strong><br />
<code>powershell
   $env:PYWATS_SERVER_URL = "https://python.wats.com"
   $env:PYWATS_API_TOKEN = "cHlXQVRTX0FQ..."</code></p>
<ol>
<li><strong>Run the client:</strong><br />
<code>bash
   python -m pywats_client service --instance-id default</code></li>
</ol>
<h2 id="how-it-works">How It Works</h2>
<p>The <code>ClientConfig</code> class checks for environment variables at runtime via the <code>get_runtime_credentials()</code> method:</p>
<ul>
<li><code>PYWATS_SERVER_URL</code> - Server URL (e.g., <code>https://python.wats.com</code>)</li>
<li><code>PYWATS_API_TOKEN</code> - API authentication token</li>
</ul>
<p><strong>Important Behavior:</strong></p>
<ol>
<li><strong>Environment variables are runtime-only</strong> - They are NEVER saved to the config file</li>
<li><strong>Fallback mechanism</strong> - Environment variables are only used if the config file has empty values</li>
<li><strong>Persistence</strong> - Credentials entered through the GUI or saved to config.json are always persisted</li>
<li><strong>Development workflow</strong> - Use env vars for debugging without modifying config files</li>
</ol>
<p>This means:<br />
- ‚úÖ You can use env vars for debugging without them being saved to git<br />
- ‚úÖ Config file credentials (entered via GUI) persist between sessions<br />
- ‚úÖ Env vars only apply when config values are empty<br />
- ‚úÖ Changing credentials in GUI saves them properly to config.json</p>
<h2 id="vs-code-integration">VS Code Integration</h2>
<p>For VS Code debugging, add to <code>.vscode/launch.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pyWATS Client Service&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pywats_client&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--instance-id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;PYWATS_SERVER_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://python.wats.com&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;PYWATS_API_TOKEN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_token_here&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pyWATS Client GUI&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pywats_client&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;gui&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--instance-id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;PYWATS_SERVER_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://python.wats.com&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;PYWATS_API_TOKEN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_token_here&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="security-notes">Security Notes</h2>
<ul>
<li>‚úÖ <code>.env</code> is in <code>.gitignore</code> - safe for local credentials</li>
<li>‚úÖ Environment variables are runtime-only and NEVER saved to config files</li>
<li>‚úÖ Config file credentials (from GUI) are properly persisted</li>
<li>‚úÖ Env vars don't override saved config values</li>
<li>‚ö†Ô∏è <strong>Never commit <code>.env</code> or tokens to git</strong></li>
<li>‚ö†Ô∏è <strong>Use test tokens for development, not production tokens</strong></li>
</ul>
<h2 id="getting-test-token">Getting Test Token</h2>
<p>From test config:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api-tests/instances/client_a_config.json</span>
<span class="p">{</span>
    <span class="s2">&quot;service_address&quot;</span><span class="p">:</span> <span class="s2">&quot;https://python.wats.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_token&quot;</span><span class="p">:</span> <span class="s2">&quot;cHlXQVRTX0FQSV9BVVRPVEVTVDo2cGhUUjg0ZTVIMHA1R3JUWGtQZlY0UTNvbmk2MiM=&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Set in your local <code>.env</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">PYWATS_SERVER_URL</span><span class="o">=</span>https://python.wats.com
<span class="nv">PYWATS_API_TOKEN</span><span class="o">=</span><span class="nv">cHlXQVRTX0FQSV9BVVRPVEVTVDo2cGhUUjg0ZTVIMHA1R3JUWGtQZlY0UTNvbmk2MiM</span><span class="o">=</span>
</code></pre></div>

<h2 id="priority-order">Priority Order</h2>
<ol>
<li><strong>Config file values</strong> (if not empty)</li>
<li><strong>Environment variables</strong> (if config empty)</li>
<li><strong>User prompt</strong> (if both empty)</li>
</ol>
<p>This means you can have different configs per instance but use env vars as a fallback for debugging.</p>
</div>


<div class="doc-separator" id="reference-error-catalog">
    <div class="doc-source">Source: docs/error-catalog.md</div>
    <h1 id="pywats-error-catalog">PyWATS Error Catalog</h1>
<p><strong>Last Updated:</strong> January 23, 2026<br />
<strong>Version:</strong> 0.1.0b34</p>
<p>This document provides a comprehensive reference for all errors that can occur when using the pyWATS library. Each error includes its cause, examples, and remediation steps.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#error-handling-modes">Error Handling Modes</a></li>
<li><a href="#exception-hierarchy">Exception Hierarchy</a></li>
<li><a href="#connection-errors">Connection Errors</a></li>
<li><a href="#authentication--authorization">Authentication &amp; Authorization</a></li>
<li><a href="#data-validation-errors">Data Validation Errors</a></li>
<li><a href="#resource-errors">Resource Errors</a></li>
<li><a href="#server-errors">Server Errors</a></li>
<li><a href="#result-pattern-error-codes">Result Pattern Error Codes</a></li>
<li><a href="#client-errors">Client Errors</a></li>
<li><a href="#retry-behavior">Retry Behavior</a></li>
<li><a href="#quick-reference">Quick Reference</a></li>
</ul>
<hr />
<h2 id="error-handling-modes">Error Handling Modes</h2>
<p>PyWATS supports two error handling modes that control how the library responds to ambiguous situations:</p>
<h3 id="strict-mode-default">STRICT Mode (Default)</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">ErrorMode</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>
    <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span>  <span class="c1"># Default</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Behavior:</strong><br />
- ‚úÖ Raises exceptions for all errors (404, validation, server errors)<br />
- ‚úÖ Raises <code>EmptyResponseError</code> when expecting data but receiving empty response<br />
- ‚úÖ Best for production code that needs certainty<br />
- ‚úÖ Fail-fast approach</p>
<h3 id="lenient-mode">LENIENT Mode</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">ErrorMode</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://wats.example.com&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s2">&quot;your_token&quot;</span><span class="p">,</span>
    <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">LENIENT</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Behavior:</strong><br />
- ‚úÖ Returns <code>None</code> for 404 (resource not found)<br />
- ‚úÖ Returns <code>None</code> for empty responses<br />
- ‚úÖ Only raises exceptions for actual errors (validation, authentication, server errors)<br />
- ‚úÖ Best for exploratory code and scripts that handle missing data gracefully</p>
<hr />
<h2 id="exception-hierarchy">Exception Hierarchy</h2>
<div class="codehilite"><pre><span></span><code><span class="nv">Exception</span>
‚îî‚îÄ‚îÄ<span class="w"> </span><span class="nv">PyWATSError</span><span class="w"> </span><span class="ss">(</span><span class="nv">base</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">pyWATS</span><span class="w"> </span><span class="nv">errors</span><span class="ss">)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">WatsApiError</span><span class="w"> </span><span class="ss">(</span><span class="nv">HTTP</span><span class="w"> </span><span class="mi">4</span><span class="nv">xx</span><span class="o">/</span><span class="mi">5</span><span class="nv">xx</span><span class="w"> </span><span class="nv">errors</span><span class="ss">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">AuthenticationError</span><span class="w"> </span><span class="ss">(</span><span class="mi">401</span><span class="ss">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">AuthorizationError</span><span class="w"> </span><span class="ss">(</span><span class="mi">403</span><span class="ss">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ValidationError</span><span class="w"> </span><span class="ss">(</span><span class="mi">400</span><span class="ss">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ConflictError</span><span class="w"> </span><span class="ss">(</span><span class="mi">409</span><span class="ss">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="nv">ServerError</span><span class="w"> </span><span class="ss">(</span><span class="mi">5</span><span class="nv">xx</span><span class="ss">)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">NotFoundError</span><span class="w"> </span><span class="ss">(</span><span class="mi">404</span><span class="ss">)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">EmptyResponseError</span><span class="w"> </span><span class="ss">(</span><span class="nv">STRICT</span><span class="w"> </span><span class="nv">mode</span><span class="w"> </span><span class="nv">only</span><span class="ss">)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span><span class="nv">ConnectionError</span><span class="w"> </span><span class="ss">(</span><span class="nv">network</span><span class="w"> </span><span class="nv">failures</span><span class="ss">)</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span><span class="nv">TimeoutError</span><span class="w"> </span><span class="ss">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">timeouts</span><span class="ss">)</span>
</code></pre></div>

<p><strong>All exceptions inherit from <code>PyWATSError</code></strong>, so you can catch all pyWATS-specific errors with:</p>
<div class="codehilite"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyWATS error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">operation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="connection-errors">Connection Errors</h2>
<h3 id="connectionerror">ConnectionError</h3>
<p><strong>HTTP Status:</strong> N/A (network level)<br />
<strong>Error Code:</strong> <code>CONNECTION_ERROR</code><br />
<strong>Retry:</strong> ‚úÖ Automatic (if retry enabled)</p>
<p><strong>Cause:</strong><br />
- Cannot connect to WATS server<br />
- DNS resolution failure<br />
- Network unavailable<br />
- Firewall blocking connection<br />
- Server is down</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="ne">ConnectionError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://unreachable-server.com&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">test_connection</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot connect: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Details: {&#39;cause&#39;: &#39;Name or service not known&#39;}</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Verify server URL is correct<br />
2. Check network connectivity (<code>ping wats-server.com</code>)<br />
3. Verify DNS resolution (<code>nslookup wats-server.com</code>)<br />
4. Check firewall/proxy settings<br />
5. Confirm WATS server is running<br />
6. Try accessing server URL in browser</p>
<p><strong>Related Errors:</strong><br />
- <code>TimeoutError</code> - Connection attempt times out</p>
<hr />
<h3 id="timeouterror">TimeoutError</h3>
<p><strong>HTTP Status:</strong> N/A (network level)<br />
<strong>Error Code:</strong> <code>TIMEOUT</code><br />
<strong>Retry:</strong> ‚úÖ Automatic (if retry enabled)</p>
<p><strong>Cause:</strong><br />
- Request takes longer than configured timeout<br />
- Server is slow to respond<br />
- Network latency issues<br />
- Large data transfer</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="ne">TimeoutError</span>

<span class="c1"># Set a short timeout</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Large query that takes &gt;5 seconds</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request timed out: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Increase timeout value:<br />
<code>python
   api = pyWATS(base_url="...", token="...", timeout=60)</code><br />
2. Narrow query scope (use filters, limit results)<br />
3. Check network latency<br />
4. Contact server administrator if persistent</p>
<p><strong>Related Errors:</strong><br />
- <code>ConnectionError</code> - Cannot establish connection</p>
<hr />
<h2 id="authentication-authorization">Authentication &amp; Authorization</h2>
<h3 id="authenticationerror">AuthenticationError</h3>
<p><strong>HTTP Status:</strong> 401 Unauthorized<br />
<strong>Error Code:</strong> <code>UNAUTHORIZED</code><br />
<strong>Retry:</strong> ‚ùå No (credentials need fixing)</p>
<p><strong>Cause:</strong><br />
- Invalid credentials (username/password)<br />
- Malformed authentication token<br />
- Token not Base64 encoded properly<br />
- Expired session</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">AuthenticationError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;invalid_token&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">test_connection</span><span class="p">()</span>
<span class="k">except</span> <span class="n">AuthenticationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status code: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># 401</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Verify credentials are correct<br />
2. Ensure token is Base64 encoded:<br />
<code>python
   import base64
   credentials = "username:password"
   token = base64.b64encode(credentials.encode()).decode()</code><br />
3. Check for special characters in password<br />
4. Try authenticating through WATS web interface<br />
5. Contact administrator to verify account status</p>
<p><strong>Related Errors:</strong><br />
- <code>AuthorizationError</code> - Valid credentials but insufficient permissions</p>
<hr />
<h3 id="authorizationerror">AuthorizationError</h3>
<p><strong>HTTP Status:</strong> 403 Forbidden<br />
<strong>Error Code:</strong> <code>FORBIDDEN</code><br />
<strong>Retry:</strong> ‚ùå No (permissions issue)</p>
<p><strong>Cause:</strong><br />
- User lacks required permissions for operation<br />
- API endpoint requires elevated privileges<br />
- Resource access restricted</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">AuthorizationError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># User doesn&#39;t have permission to create products</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">except</span> <span class="n">AuthorizationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permission denied: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Verify user has required permissions in WATS<br />
2. Contact administrator to grant necessary roles<br />
3. Use account with appropriate access level<br />
4. Check WATS user permissions in admin panel</p>
<p><strong>Related Errors:</strong><br />
- <code>AuthenticationError</code> - Invalid credentials</p>
<hr />
<h2 id="data-validation-errors">Data Validation Errors</h2>
<h3 id="reportheadervalidationerror">ReportHeaderValidationError</h3>
<p><strong>HTTP Status:</strong> N/A (client-side validation)<br />
<strong>Error Code:</strong> <code>PROBLEMATIC_CHARACTERS</code><br />
<strong>Retry:</strong> ‚ùå No (fix input data or bypass intentionally)</p>
<p><strong>Cause:</strong><br />
- Serial number or part number contains characters that cause issues with WATS searches/filters<br />
- Problematic characters: <code>*</code>, <code>%</code>, <code>?</code>, <code>[</code>, <code>]</code>, <code>^</code>, <code>!</code>, <code>/</code>, <code>\</code></p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportHeaderValidationError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
        <span class="n">pn</span><span class="o">=</span><span class="s2">&quot;PART/001&quot;</span><span class="p">,</span>  <span class="c1"># Contains &#39;/&#39; - problematic!</span>
        <span class="n">sn</span><span class="o">=</span><span class="s2">&quot;SN*001&quot;</span><span class="p">,</span>    <span class="c1"># Contains &#39;*&#39; - problematic!</span>
        <span class="n">rev</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="n">process_code</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;TestStation&quot;</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Lab&quot;</span><span class="p">,</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;Development&quot;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># Wrapped in pydantic ValidationError</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problematic characters in report header&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Bypass Options:</strong></p>
<p>When you intentionally need to use problematic characters:</p>
<h4 id="option-1-context-manager">Option 1: Context Manager</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">allow_problematic_characters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>

<span class="k">with</span> <span class="n">allow_problematic_characters</span><span class="p">():</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
        <span class="n">pn</span><span class="o">=</span><span class="s2">&quot;PART/001&quot;</span><span class="p">,</span>  <span class="c1"># Now allowed (warning issued)</span>
        <span class="n">sn</span><span class="o">=</span><span class="s2">&quot;SN*001&quot;</span><span class="p">,</span>    <span class="c1"># Now allowed (warning issued)</span>
        <span class="o">...</span>
    <span class="p">)</span>
</code></pre></div>

<h4 id="option-2-suppress-prefix">Option 2: SUPPRESS: Prefix</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUTReport</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span>
    <span class="n">pn</span><span class="o">=</span><span class="s2">&quot;SUPPRESS:PART/001&quot;</span><span class="p">,</span>  <span class="c1"># Prefix stripped, value = &quot;PART/001&quot;</span>
    <span class="n">sn</span><span class="o">=</span><span class="s2">&quot;SUPPRESS:SN*001&quot;</span><span class="p">,</span>    <span class="c1"># Prefix stripped, value = &quot;SN*001&quot;</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Use only recommended characters: <code>A-Z</code>, <code>a-z</code>, <code>0-9</code>, <code>-</code>, <code>_</code>, <code>.</code><br />
2. If problematic characters are required, use bypass options above<br />
3. Be aware that bypassed values may cause issues with WATS searches/filters</p>
<p><strong>Related Errors:</strong><br />
- <code>ValidationError</code> - General validation failures</p>
<hr />
<h3 id="validationerror">ValidationError</h3>
<p><strong>HTTP Status:</strong> 400 Bad Request<br />
<strong>Error Code:</strong> <code>INVALID_INPUT</code>, <code>MISSING_REQUIRED_FIELD</code>, <code>INVALID_FORMAT</code>, <code>VALUE_OUT_OF_RANGE</code><br />
<strong>Retry:</strong> ‚ùå No (fix input data)</p>
<p><strong>Cause:</strong><br />
- Missing required fields<br />
- Invalid data format<br />
- Value out of acceptable range<br />
- Failed Pydantic model validation<br />
- Constraint violation</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Missing required field</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty part number</span>
        <span class="n">state</span><span class="o">=</span><span class="s2">&quot;ACTIVE&quot;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation failed: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;part_number&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;&#39;</span>
</code></pre></div>

<p><strong>Common Scenarios:</strong></p>
<h4 id="missing-required-field">Missing Required Field</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Error: part_number is required</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">)</span>

<span class="c1"># Fix:</span>
<span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="invalid-format">Invalid Format</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Error: Invalid date format</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2024-13-40&quot;</span><span class="p">)</span>  <span class="c1"># Invalid date</span>

<span class="c1"># Fix:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="n">WATSFilter</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
</code></pre></div>

<h4 id="pydantic-validation">Pydantic Validation</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Product</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">PydanticValidationError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET&quot;</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="s2">&quot;INVALID_STATE&quot;</span>  <span class="c1"># Not a valid ProductState</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">PydanticValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Check error message for specific field and issue<br />
2. Verify all required fields are provided<br />
3. Validate data types match expected types<br />
4. Check value constraints (min/max, length, pattern)<br />
5. Review model documentation for field requirements<br />
6. Use Pydantic models for automatic validation</p>
<p><strong>Related Errors:</strong><br />
- Pydantic <code>ValidationError</code> - Model validation failures</p>
<hr />
<h2 id="resource-errors">Resource Errors</h2>
<h3 id="notfounderror">NotFoundError</h3>
<p><strong>HTTP Status:</strong> 404 Not Found<br />
<strong>Error Code:</strong> <code>NOT_FOUND</code><br />
<strong>Retry:</strong> ‚ùå No (resource doesn't exist)</p>
<p><strong>Behavior:</strong><br />
- <strong>STRICT mode:</strong> Raises <code>NotFoundError</code><br />
- <strong>LENIENT mode:</strong> Returns <code>None</code></p>
<p><strong>Cause:</strong><br />
- Resource with given identifier doesn't exist<br />
- Wrong part number, serial number, or ID<br />
- Resource was deleted<br />
- Typo in identifier</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">NotFoundError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;NONEXISTENT-PART&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not found: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resource type: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">resource_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;Product&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Identifier: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;NONEXISTENT-PART&#39;</span>
</code></pre></div>

<p><strong>LENIENT mode example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">LENIENT</span><span class="p">)</span>

<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;MAYBE-EXISTS&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product not found, creating new one...&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Verify identifier is correct (check for typos)<br />
2. List available resources to confirm existence:<br />
<code>python
   products = api.product.get_products()
   print([p.part_number for p in products])</code><br />
3. Use search/query methods to find resource<br />
4. Check if resource was deleted<br />
5. Use LENIENT mode if <code>None</code> is acceptable</p>
<p><strong>Related Errors:</strong><br />
- <code>EmptyResponseError</code> - Empty result set in STRICT mode</p>
<hr />
<h3 id="conflicterror">ConflictError</h3>
<p><strong>HTTP Status:</strong> 409 Conflict<br />
<strong>Error Code:</strong> <code>CONFLICT</code>, <code>ALREADY_EXISTS</code><br />
<strong>Retry:</strong> ‚ùå No (conflict must be resolved)</p>
<p><strong>Cause:</strong><br />
- Resource already exists (duplicate)<br />
- Concurrent modification conflict<br />
- Constraint violation (unique key)<br />
- Version mismatch (optimistic locking)</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">ConflictError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Part number already exists</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">create_product</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>  <span class="c1"># Already exists</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Duplicate&quot;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">ConflictError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflict: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Check if resource already exists before creating<br />
2. Use update instead of create for existing resources<br />
3. Handle concurrent modifications with retry logic<br />
4. Use unique identifiers<br />
5. Implement optimistic locking if needed</p>
<p><strong>Related Errors:</strong><br />
- <code>ValidationError</code> - Data validation failures</p>
<hr />
<h3 id="emptyresponseerror">EmptyResponseError</h3>
<p><strong>HTTP Status:</strong> 200 OK (but body is empty)<br />
<strong>Error Code:</strong> N/A<br />
<strong>Retry:</strong> ‚ùå No<br />
<strong>Mode:</strong> STRICT only</p>
<p><strong>Cause:</strong><br />
- Server returned 200 OK but response body is empty/null<br />
- Query returned no results<br />
- Resource exists but has no data<br />
- Server bug (should return 404)</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">EmptyResponseError</span><span class="p">,</span> <span class="n">ErrorMode</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">STRICT</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Query returns empty result set</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">query_uut_headers</span><span class="p">(</span>
        <span class="n">WATSFilter</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;NEVER-TESTED&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">EmptyResponseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empty response: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">operation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;query_uut_headers&#39;</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Switch to LENIENT mode if empty results are acceptable:<br />
<code>python
   api = pyWATS(error_mode=ErrorMode.LENIENT)
   reports = api.report.query_uut_headers(filter)
   if reports is None or len(reports) == 0:
       print("No reports found")</code><br />
2. Broaden query filters<br />
3. Verify resource should have data<br />
4. Check if operation allows empty responses</p>
<p><strong>Related Errors:</strong><br />
- <code>NotFoundError</code> - Resource doesn't exist (404)</p>
<hr />
<h2 id="server-errors">Server Errors</h2>
<h3 id="servererror">ServerError</h3>
<p><strong>HTTP Status:</strong> 500-599 (Server errors)<br />
<strong>Error Code:</strong> <code>API_ERROR</code>, <code>OPERATION_FAILED</code><br />
<strong>Retry:</strong> ‚úÖ Automatic (if retry enabled)</p>
<p><strong>Cause:</strong><br />
- Internal server error<br />
- Database error<br />
- Server bug<br />
- Resource exhaustion<br />
- Unhandled exception on server</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">ServerError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">submit_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ServerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status code: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># 500, 502, 503, etc.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response body: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">response_body</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Common Status Codes:</strong><br />
- <strong>500</strong> - Internal Server Error<br />
- <strong>502</strong> - Bad Gateway (proxy error)<br />
- <strong>503</strong> - Service Unavailable (server overloaded)<br />
- <strong>504</strong> - Gateway Timeout</p>
<p><strong>Remediation:</strong><br />
1. Wait and retry (automatic retry is enabled by default)<br />
2. Check WATS server logs for details<br />
3. Contact server administrator<br />
4. Reduce request frequency (see <a href="#retry-behavior">Retry Behavior</a>)<br />
5. Report bug to WATS support if persistent</p>
<p><strong>Related Errors:</strong><br />
- <code>TimeoutError</code> - Request times out before server responds</p>
<hr />
<h2 id="result-pattern-error-codes">Result Pattern Error Codes</h2>
<p>When using the <code>Result[T]</code> pattern, methods return <code>Success[T]</code> or <code>Failure</code> instead of raising exceptions:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats.shared</span><span class="w"> </span><span class="kn">import</span> <span class="n">Result</span><span class="p">,</span> <span class="n">Success</span><span class="p">,</span> <span class="n">Failure</span><span class="p">,</span> <span class="n">ErrorCode</span>

<span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">[</span><span class="n">Product</span><span class="p">]</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">some_result_based_method</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># result is Failure</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error [</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">error_code</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suggestions: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">suggestions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="standard-error-codes">Standard Error Codes</h3>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>Description</th>
<th>HTTP Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INVALID_INPUT</code></td>
<td>Input validation failed</td>
<td>400</td>
</tr>
<tr>
<td><code>MISSING_REQUIRED_FIELD</code></td>
<td>Required field not provided</td>
<td>400</td>
</tr>
<tr>
<td><code>INVALID_FORMAT</code></td>
<td>Data format is incorrect</td>
<td>400</td>
</tr>
<tr>
<td><code>VALUE_OUT_OF_RANGE</code></td>
<td>Value exceeds constraints</td>
<td>400</td>
</tr>
<tr>
<td><code>NOT_FOUND</code></td>
<td>Resource doesn't exist</td>
<td>404</td>
</tr>
<tr>
<td><code>ALREADY_EXISTS</code></td>
<td>Resource already exists</td>
<td>409</td>
</tr>
<tr>
<td><code>CONFLICT</code></td>
<td>Resource conflict</td>
<td>409</td>
</tr>
<tr>
<td><code>OPERATION_FAILED</code></td>
<td>Operation failed</td>
<td>500</td>
</tr>
<tr>
<td><code>SAVE_FAILED</code></td>
<td>Save operation failed</td>
<td>500</td>
</tr>
<tr>
<td><code>DELETE_FAILED</code></td>
<td>Delete operation failed</td>
<td>500</td>
</tr>
<tr>
<td><code>UNAUTHORIZED</code></td>
<td>Authentication required</td>
<td>401</td>
</tr>
<tr>
<td><code>FORBIDDEN</code></td>
<td>Insufficient permissions</td>
<td>403</td>
</tr>
<tr>
<td><code>CONNECTION_ERROR</code></td>
<td>Network failure</td>
<td>N/A</td>
</tr>
<tr>
<td><code>TIMEOUT</code></td>
<td>Request timeout</td>
<td>N/A</td>
</tr>
<tr>
<td><code>API_ERROR</code></td>
<td>Generic API error</td>
<td>500</td>
</tr>
<tr>
<td><code>UNKNOWN_ERROR</code></td>
<td>Unclassified error</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h3 id="example-usage">Example Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.shared</span><span class="w"> </span><span class="kn">import</span> <span class="n">Failure</span><span class="p">,</span> <span class="n">ErrorCode</span>

<span class="c1"># Creating a failure</span>
<span class="n">failure</span> <span class="o">=</span> <span class="n">Failure</span><span class="p">(</span>
    <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">MISSING_REQUIRED_FIELD</span><span class="p">,</span>
    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;part_number is required to create a product&quot;</span><span class="p">,</span>
    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;part_number&quot;</span><span class="p">,</span> <span class="s2">&quot;received&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="n">suggestions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Provide a unique part_number string&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Handling failures</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_failure</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resource not found, creating new one...&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">UNAUTHORIZED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Authentication required&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="client-errors">Client Errors</h2>
<p>These errors occur in the pyWATS Client application (<code>pywats_client</code>):</p>
<h3 id="configuration-errors">Configuration Errors</h3>
<p><strong>Cause:</strong><br />
- Invalid configuration file<br />
- Missing required configuration<br />
- Failed to load/save config</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;invalid_config.json&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Verify config file exists and is valid JSON<br />
2. Use <code>ClientConfig.load_or_create()</code> to create default if missing<br />
3. Check file permissions<br />
4. Validate required fields are present</p>
<h3 id="converter-errors">Converter Errors</h3>
<p><strong>Cause:</strong><br />
- File format not recognized<br />
- Invalid converter configuration<br />
- Converter execution failure</p>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationResult</span>

<span class="c1"># Low confidence - file not recognized</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">validate_file</span><span class="p">(</span><span class="s2">&quot;unknown.dat&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">can_convert</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot convert: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confidence: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">confidence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &lt; 0.5</span>
</code></pre></div>

<p><strong>Remediation:</strong><br />
1. Check file format matches converter expectations<br />
2. Verify converter is enabled<br />
3. Review converter configuration<br />
4. Check converter logs for details<br />
5. Ensure dependencies are met (ready=True)</p>
<h3 id="queue-errors">Queue Errors</h3>
<p><strong>Cause:</strong><br />
- Failed to persist queue<br />
- Queue corruption<br />
- Disk space exhausted</p>
<p><strong>Remediation:</strong><br />
1. Check disk space<br />
2. Verify queue directory is writable<br />
3. Clear corrupted queue files<br />
4. Restart client</p>
<hr />
<h2 id="retry-behavior">Retry Behavior</h2>
<p>PyWATS automatically retries failed requests for transient errors:</p>
<h3 id="retryable-errors">Retryable Errors</h3>
<p>The following errors trigger automatic retry:<br />
- <code>ConnectionError</code> - Network failures<br />
- <code>TimeoutError</code> - Request timeouts<br />
- <code>ServerError</code> with status 429, 500, 502, 503, 504</p>
<h3 id="retry-configuration">Retry Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">RetryConfig</span>

<span class="c1"># Default retry (3 attempts, exponential backoff)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="c1"># Custom retry</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">RetryConfig</span><span class="p">(</span>
    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>          <span class="c1"># Try up to 5 times</span>
    <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>          <span class="c1"># Start with 2 second delay</span>
    <span class="n">max_delay</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>          <span class="c1"># Cap at 60 seconds</span>
    <span class="n">exponential_base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>    <span class="c1"># Double delay each retry</span>
    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>             <span class="c1"># Add randomness to prevent thundering herd</span>
<span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">retry_config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Disable retry</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">retry_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<h3 id="retry-delay-calculation">Retry Delay Calculation</h3>
<div class="codehilite"><pre><span></span><code>delay = min(base_delay <span class="gs">* (exponential_base *</span>* attempt), max_delay)
if jitter:
    delay = delay <span class="gs">* (0.5 + random.random() *</span> 0.5)
</code></pre></div>

<p><strong>Example delays (base_delay=1.0, exponential_base=2.0):</strong><br />
- Attempt 1: 1 second<br />
- Attempt 2: 2 seconds<br />
- Attempt 3: 4 seconds<br />
- Attempt 4: 8 seconds<br />
- Attempt 5: 16 seconds</p>
<h3 id="non-retryable-errors">Non-Retryable Errors</h3>
<p>These errors are NOT retried (fix required):<br />
- <code>AuthenticationError</code> (401)<br />
- <code>AuthorizationError</code> (403)<br />
- <code>ValidationError</code> (400)<br />
- <code>NotFoundError</code> (404)<br />
- <code>ConflictError</code> (409)</p>
<hr />
<h2 id="quick-reference">Quick Reference</h2>
<h3 id="common-error-patterns">Common Error Patterns</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyWATS</span><span class="p">,</span> <span class="n">PyWATSError</span><span class="p">,</span> <span class="n">NotFoundError</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="ne">ConnectionError</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="c1"># Handle specific errors</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Product not found&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid input: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">field</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot connect to server&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">PyWATSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyWATS error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use LENIENT mode for optional resources</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">pyWATS</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">error_mode</span><span class="o">=</span><span class="n">ErrorMode</span><span class="o">.</span><span class="n">LENIENT</span><span class="p">)</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="s2">&quot;MAYBE-EXISTS&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not found&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use Result pattern for structured errors</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">some_result_method</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_failure</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">error_code</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">suggestions</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="debugging-tips">Debugging Tips</h3>
<ol>
<li>
<p><strong>Enable debug logging:</strong><br />
<code>python
   from pywats.core.logging import enable_debug_logging
   enable_debug_logging()</code></p>
</li>
<li>
<p><strong>Inspect exception details:</strong><br />
<code>python
   try:
       api.product.get_product("X")
   except PyWATSError as e:
       print(f"Message: {e.message}")
       print(f"Operation: {e.operation}")
       print(f"Details: {e.details}")
       if hasattr(e, 'cause') and e.cause:
           print(f"Cause: {e.cause}")</code></p>
</li>
<li>
<p><strong>Check HTTP status codes:</strong><br />
<code>python
   try:
       api.product.create_product(...)
   except WatsApiError as e:
       print(f"HTTP Status: {e.status_code}")</code></p>
</li>
<li>
<p><strong>Use test_connection():</strong><br />
<code>python
   if api.test_connection():
       print("Connected successfully")
   else:
       print("Connection failed")</code></p>
</li>
</ol>
<h3 id="getting-help">Getting Help</h3>
<ul>
<li><strong>Documentation:</strong> https://github.com/olreppe/pyWATS/tree/main/docs</li>
<li><strong>GitHub Issues:</strong> https://github.com/olreppe/pyWATS/issues</li>
<li><strong>Email:</strong> support@virinco.com</li>
<li><strong>WATS Community:</strong> https://wats.com/community</li>
</ul>
<hr />
<p><strong>Error catalog version:</strong> 0.1.0b34<br />
<strong>Last updated:</strong> January 23, 2026</p>
</div>


<div class="doc-separator" id="reference-wats-domain-knowledge">
    <div class="doc-source">Source: docs/wats-domain-knowledge.md</div>
    <h1 id="wats-domain-knowledge-for-ai-agents">WATS Domain Knowledge for AI Agents</h1>
<p>This document contains essential domain knowledge for AI agents working with WATS. Understanding these concepts is crucial for correctly interpreting and answering questions about manufacturing test data.</p>
<hr />
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="units-reports-and-runs">Units, Reports, and Runs</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Unit</strong></td>
<td>A single device/product being tested, identified by serial number</td>
</tr>
<tr>
<td><strong>Report</strong></td>
<td>The test result document from a single test execution</td>
</tr>
<tr>
<td><strong>Run</strong></td>
<td>A test execution sequence number (Run 1, Run 2, etc.)</td>
</tr>
<tr>
<td><strong>Retest</strong></td>
<td>Any run after Run 1</td>
</tr>
</tbody>
</table>
<p><strong>Key relationship</strong>: One unit can have multiple reports (one per run).</p>
<h3 id="process-test-operation">Process / Test Operation</h3>
<p>A <strong>process</strong> (also called <strong>test_operation</strong>) is a type of test a product goes through:</p>
<ul>
<li>ICT (In-Circuit Test)</li>
<li>FCT (Functional Test)</li>
<li>EOL (End-of-Line Test)</li>
<li>FQC (Final Quality Check)</li>
<li>etc.</li>
</ul>
<p><strong>Critical</strong>: A product typically goes through MULTIPLE processes. Each process has its own yield metrics.</p>
<h3 id="operation-types-terminology">Operation Types (Terminology!)</h3>
<p>WATS uses different operation types depending on the workflow:</p>
<table>
<thead>
<tr>
<th>Term</th>
<th>Domain</th>
<th>Records</th>
<th>Used For</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test_operation</code></td>
<td>Report</td>
<td>UUT / UUTReport</td>
<td>Testing (yields, failures)</td>
</tr>
<tr>
<td><code>repair_operation</code></td>
<td>Report</td>
<td>UUR / UURReport</td>
<td>Repair logging (repair actions)</td>
</tr>
<tr>
<td><code>wip_operation</code></td>
<td>Production</td>
<td>WIP records</td>
<td>Production tracking only</td>
</tr>
</tbody>
</table>
<p><strong>Important</strong>: When users ask about "process" or "operation" for yield analysis, they almost always mean <code>test_operation</code>.</p>
<p>Only use <code>repair_operation</code> when specifically analyzing repair workflow (not yield).</p>
<hr />
<h2 id="process-name-matching">Process Name Matching</h2>
<h3 id="the-problem">The Problem</h3>
<p>Users often use imprecise process names:<br />
- "PCBA" instead of "PCBA test"<br />
- "board test" instead of "PCBA Test Station"<br />
- "fct" instead of "FCT Functional Test"</p>
<h3 id="how-to-handle">How to Handle</h3>
<ol>
<li><strong>Fuzzy matching</strong>: The agent tool attempts to match user input to actual process names</li>
<li><strong>Common aliases</strong>: Standard manufacturing abbreviations are recognized</li>
<li><strong>Suggestions</strong>: If no match found, suggest closest alternatives</li>
<li><strong>List processes</strong>: Use <code>perspective="by operation"</code> to see available processes</li>
</ol>
<h3 id="common-aliases">Common Aliases</h3>
<table>
<thead>
<tr>
<th>User Input</th>
<th>May Match</th>
</tr>
</thead>
<tbody>
<tr>
<td>"pcba", "board test"</td>
<td>PCBA test, PCBA Test, Board Test</td>
</tr>
<tr>
<td>"ict", "in-circuit"</td>
<td>ICT, ICT Test, In-Circuit Test</td>
</tr>
<tr>
<td>"fct", "functional"</td>
<td>FCT, FCT Test, Functional Test</td>
</tr>
<tr>
<td>"aoi", "optical"</td>
<td>AOI, AOI Test, Automated Optical Inspection</td>
</tr>
<tr>
<td>"eol", "end of line"</td>
<td>EOL, EOL Test, End of Line Test</td>
</tr>
<tr>
<td>"fqc", "final"</td>
<td>FQC, Final Quality Check</td>
</tr>
</tbody>
</table>
<h3 id="best-practice">Best Practice</h3>
<p>When in doubt, query available processes first:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># See all processes for a product</span>
<span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">perspective</span><span class="o">=</span><span class="s2">&quot;by operation&quot;</span>
<span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="the-mixed-process-problem-critical">The Mixed Process Problem (Critical!)</h2>
<h3 id="the-scenario">The Scenario</h3>
<p>Some customers send <strong>different test types to the same process</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">Proc</span><span class="nv">ess</span><span class="w"> </span><span class="s">&quot;Structural Tests&quot;</span><span class="w"> </span><span class="nv">receives</span><span class="p">:</span>
<span class="w">  </span><span class="err">-</span><span class="w"> </span><span class="no">AOI</span><span class="w"> </span><span class="kd">tests</span><span class="w"> </span><span class="p">(</span><span class="nv">sw_filename</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;aoi.exe&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="err">-</span><span class="w"> </span><span class="no">ICT</span><span class="w"> </span><span class="kd">tests</span><span class="w"> </span><span class="p">(</span><span class="nv">sw_filename</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ict.exe&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="why-this-causes-problems">Why This Causes Problems</h3>
<ol>
<li>Unit's first run (AOI) determines that unit as "tested"</li>
<li>Unit's second run (ICT) is seen as a "retest after pass"</li>
<li>ICT yields show <strong>0 units</strong> because AOI already "passed" those units!</li>
</ol>
<h3 id="symptoms">Symptoms</h3>
<table>
<thead>
<tr>
<th>Symptom</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>"ICT shows 0 units"</td>
<td>AOI ran first, ICT is treated as retest</td>
</tr>
<tr>
<td>"FPY doesn't make sense"</td>
<td>Mixed test types corrupt yield calculation</td>
</tr>
<tr>
<td>"Unit counts mismatch"</td>
<td>Different sw_filename = different "tests"</td>
</tr>
</tbody>
</table>
<h3 id="diagnosis">Diagnosis</h3>
<p>Look for <strong>different <code>sw_filename</code> values</strong> in the same process:</p>
<ul>
<li>If multiple sw_filename exist for one process ‚Üí Mixed process problem</li>
<li>Each sw_filename represents a different test type</li>
</ul>
<h3 id="agent-response">Agent Response</h3>
<p>When user reports 0 units for a process that should have data:</p>
<ol>
<li><strong>Check for mixed process</strong>: Query reports, look for different sw_filename</li>
<li><strong>Explain the issue</strong>: "This process receives multiple test types (AOI, ICT). The first test type determines units."</li>
<li><strong>Recommend solution</strong>: "Each test type should have its own process for accurate yield tracking."</li>
</ol>
<hr />
<h2 id="adaptive-time-filtering">Adaptive Time Filtering</h2>
<h3 id="the-problem-with-30-day-default">The Problem with 30-Day Default</h3>
<p>For <strong>high-volume production</strong>, 30 days can be too much:</p>
<table>
<thead>
<tr>
<th>Volume</th>
<th>Daily Units</th>
<th>30 Days</th>
<th>Risk</th>
</tr>
</thead>
<tbody>
<tr>
<td>Very High</td>
<td>&gt;100,000</td>
<td>&gt;3 million</td>
<td>API timeout</td>
</tr>
<tr>
<td>High</td>
<td>10K-100K</td>
<td>300K-3M</td>
<td>Slow, memory issues</td>
</tr>
<tr>
<td>Medium</td>
<td>1K-10K</td>
<td>30K-300K</td>
<td>OK</td>
</tr>
<tr>
<td>Low</td>
<td>&lt;1K</td>
<td>&lt;30K</td>
<td>May need more days</td>
</tr>
</tbody>
</table>
<h3 id="adaptive-time-filter">Adaptive Time Filter</h3>
<p>The tool can <strong>automatically adjust</strong> the date range based on volume:</p>
<div class="codehilite"><pre><span></span><code><span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;HIGH-VOLUME-PRODUCT&quot;</span><span class="p">,</span>
    <span class="n">adaptive_time</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Auto-adjust window</span>
<span class="p">))</span>
</code></pre></div>

<h3 id="how-it-works">How It Works</h3>
<ol>
<li>Start with small window (1 day)</li>
<li>Evaluate volume</li>
<li>Expand if insufficient data</li>
<li>Stop when target reached</li>
</ol>
<h3 id="when-to-use">When to Use</h3>
<ul>
<li>‚úÖ High-volume environments</li>
<li>‚úÖ Unknown production volume</li>
<li>‚úÖ General queries</li>
<li>‚ùå Specific date range needed</li>
</ul>
<hr />
<h2 id="yield-metrics-critical-knowledge">Yield Metrics (Critical Knowledge!)</h2>
<h3 id="the-process-context-rule">The Process Context Rule</h3>
<p><strong>Every yield question must be considered in the context of a specific process.</strong></p>
<p>‚ùå <strong>Ambiguous</strong>: "What's the yield for WIDGET-001?"<br />
‚úÖ <strong>Clear</strong>: "What's the FCT yield for WIDGET-001?"<br />
‚úÖ <strong>Clear</strong>: "What's the RTY for WIDGET-001?" (overall across all processes)</p>
<h3 id="unit-based-yield-fpy-spy-tpy-lpy">Unit-Based Yield (FPY, SPY, TPY, LPY)</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Name</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>FPY</td>
<td>First Pass Yield</td>
<td>% of units passed on Run 1</td>
</tr>
<tr>
<td>SPY</td>
<td>Second Pass Yield</td>
<td>% of units passed by Run 2</td>
</tr>
<tr>
<td>TPY</td>
<td>Third Pass Yield</td>
<td>% of units passed by Run 3</td>
</tr>
<tr>
<td>LPY</td>
<td>Last Pass Yield</td>
<td>% of units eventually passed</td>
</tr>
</tbody>
</table>
<p><strong>Relationship</strong>: FPY ‚â§ SPY ‚â§ TPY ‚â§ LPY</p>
<h3 id="report-based-yield-try">Report-Based Yield (TRY)</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Name</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>TRY</td>
<td>Test Report Yield</td>
<td>Passed reports √∑ All reports</td>
</tr>
</tbody>
</table>
<p><strong>Use TRY for</strong>: Station performance, fixture comparison, operator evaluation, repair line analysis.</p>
<h3 id="rolled-throughput-yield-rty">Rolled Throughput Yield (RTY)</h3>
<p><strong>RTY = FPY‚ÇÅ √ó FPY‚ÇÇ √ó ... √ó FPY‚Çô</strong></p>
<p>RTY represents the probability that a unit passes ALL processes on the first try.</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code>ICT FPY = 98%
FCT FPY = 95%
EOL FPY = 99%

RTY = 0.98 √ó 0.95 √ó 0.99 = 92.2%
</code></pre></div>

<p><strong>Use RTY for</strong>: Overall product quality assessment, comparing products across entire flow.</p>
<h3 id="the-unit-inclusion-rule">The Unit Inclusion Rule</h3>
<p><strong>A unit is included in yield calculations ONLY if its FIRST RUN matches the filter.</strong></p>
<p>If included, ALL runs for that unit are counted (even runs outside the filter).</p>
<p><strong>Implications</strong>:<br />
- Filtering by retest-only stations shows 0 units<br />
- Date filters apply to Run 1, not all runs<br />
- Solution for retest stations: Use TRY instead of FPY</p>
<h3 id="the-repair-line-problem">The Repair Line Problem</h3>
<p>Repair/retest stations never see Run 1 (they only handle failed units from main line).</p>
<p><strong>Result</strong>: Unit-based yield shows 0 units for repair stations.<br />
<strong>Solution</strong>: Use TRY (report-based yield) to evaluate repair station performance.</p>
<hr />
<h2 id="yield-over-time-temporal-analysis">Yield Over Time (Temporal Analysis)</h2>
<h3 id="date-range-defaults">Date Range Defaults</h3>
<p>WATS always assumes you want the <strong>most recent data</strong>:</p>
<ul>
<li>If <code>date_from</code> and <code>date_to</code> are not specified, WATS defaults to <strong>last 30 days</strong></li>
<li>This is the server-side default behavior</li>
<li>Use <code>days</code> parameter for simple "last N days" queries</li>
</ul>
<h3 id="time-based-perspectives">Time-Based Perspectives</h3>
<table>
<thead>
<tr>
<th>Perspective</th>
<th>Date Grouping</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>trend</code></td>
<td>DAY</td>
<td>General yield trend</td>
</tr>
<tr>
<td><code>daily</code></td>
<td>DAY</td>
<td>Day-by-day breakdown</td>
</tr>
<tr>
<td><code>weekly</code></td>
<td>WEEK</td>
<td>Week-by-week analysis</td>
</tr>
<tr>
<td><code>monthly</code></td>
<td>MONTH</td>
<td>Month-by-month trends</td>
</tr>
</tbody>
</table>
<h3 id="yield-trend-metrics">Yield Trend Metrics</h3>
<p>Yield trend describes <strong>change compared to the previous equally-sized period</strong>:</p>
<table>
<thead>
<tr>
<th>Analysis Period</th>
<th>Compared To</th>
</tr>
</thead>
<tbody>
<tr>
<td>Today</td>
<td>Yesterday</td>
</tr>
<tr>
<td>This week</td>
<td>Last week</td>
</tr>
<tr>
<td>This month</td>
<td>Last month</td>
</tr>
</tbody>
</table>
<p><strong>Use Case</strong>: Detecting improvement or degradation patterns in production quality.</p>
<h3 id="safe-period-aggregation-important">Safe Period Aggregation (Important!)</h3>
<p><strong>Key Rule</strong>: When fetching yield over periods, the <strong>first-pass-included rule</strong> applies.</p>
<p>This means:<br />
- Units are counted only in their first-run period<br />
- <strong>Periods can be safely summed</strong> without double-counting<br />
- Example: Sum Monday-Friday yields for weekly total</p>
<h3 id="date-grouping-options">Date Grouping Options</h3>
<p>For advanced use, specify <code>date_grouping</code> directly:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Groups By</th>
</tr>
</thead>
<tbody>
<tr>
<td>HOUR</td>
<td>Hour</td>
</tr>
<tr>
<td>DAY</td>
<td>Day</td>
</tr>
<tr>
<td>WEEK</td>
<td>Week</td>
</tr>
<tr>
<td>MONTH</td>
<td>Month</td>
</tr>
<tr>
<td>QUARTER</td>
<td>Quarter</td>
</tr>
<tr>
<td>YEAR</td>
<td>Year</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="top-runners">Top Runners</h2>
<h3 id="definition">Definition</h3>
<p><strong>Top runners</strong> = Products with the highest test volume (unit count or report count).</p>
<h3 id="the-per-process-rule">The Per-Process Rule</h3>
<p><strong>Volume must be considered PER PROCESS.</strong></p>
<p>A product might be a top runner in FCT but not in EOL:</p>
<table>
<thead>
<tr>
<th>Product</th>
<th>FCT Volume</th>
<th>EOL Volume</th>
</tr>
</thead>
<tbody>
<tr>
<td>WIDGET-A</td>
<td>10,000 ‚≠ê</td>
<td>5,000</td>
</tr>
<tr>
<td>WIDGET-B</td>
<td>8,000</td>
<td>12,000 ‚≠ê</td>
</tr>
</tbody>
</table>
<h3 id="finding-top-runners">Finding Top Runners</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Top runners for FCT process</span>
<span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">perspective</span><span class="o">=</span><span class="s2">&quot;by product&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>
<span class="c1"># Results sorted by unit_count shows top runners</span>
</code></pre></div>

<hr />
<h2 id="handling-ambiguous-questions">Handling Ambiguous Questions</h2>
<h3 id="question-whats-the-yield-for-widget-001">Question: "What's the yield for WIDGET-001?"</h3>
<p><strong>Best response approach</strong>:</p>
<ol>
<li><strong>Check if single process</strong>: Query with <code>part_number="WIDGET-001"</code> and <code>perspective="by operation"</code></li>
<li>If only ONE process: Answer with that process's yield</li>
<li>
<p>If MULTIPLE processes: Ask user to clarify</p>
</li>
<li>
<p><strong>Clarify with user</strong>:</p>
</li>
<li>"WIDGET-001 goes through 3 processes (ICT, FCT, EOL). Which process yield would you like?"</li>
<li>
<p>"Or would you like the RTY (Rolled Throughput Yield) across all processes?"</p>
</li>
<li>
<p><strong>Default suggestion</strong>: If user doesn't specify, show yield by operation so they can see all processes.</p>
</li>
</ol>
<h3 id="question-show-me-the-top-runners">Question: "Show me the top runners"</h3>
<p><strong>Best response approach</strong>:</p>
<ol>
<li>Ask for process context: "Top runners for which process? (e.g., FCT, EOL)"</li>
<li>Or show overall volume by product across all processes as starting point</li>
<li>Then drill down to specific process if needed</li>
</ol>
<hr />
<h2 id="unit-verification-rules">Unit Verification Rules</h2>
<h3 id="what-they-are">What They Are</h3>
<p>Rules that define which processes must pass for each product before it can ship.</p>
<h3 id="example-rule">Example Rule</h3>
<div class="codehilite"><pre><span></span><code><span class="n">Product</span><span class="o">:</span><span class="w"> </span><span class="n">WIDGET</span><span class="o">-</span><span class="mi">001</span>
<span class="n">Required</span><span class="w"> </span><span class="n">tests</span><span class="o">:</span><span class="w"> </span><span class="n">ICT</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">FCT</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">EOL</span>
</code></pre></div>

<h3 id="common-issue">Common Issue</h3>
<p>Many customers don't maintain verification rules, even though the API supports them.</p>
<h3 id="agent-opportunity">Agent Opportunity</h3>
<p>Analyze yield data to SUGGEST verification rules:</p>
<ol>
<li>Query: <code>part_number="WIDGET-001", perspective="by operation", days=90</code></li>
<li>Identify all processes with significant volume</li>
<li>Suggest: "Based on test data, WIDGET-001 should require: ICT ‚Üí FCT ‚Üí EOL"</li>
<li>Offer to create the rule (if agent has edit permissions)</li>
</ol>
<hr />
<h2 id="quick-reference-when-to-use-each-metric">Quick Reference: When to Use Each Metric</h2>
<table>
<thead>
<tr>
<th>Question Type</th>
<th>Recommended Metric</th>
</tr>
</thead>
<tbody>
<tr>
<td>Product quality (single process)</td>
<td>FPY, LPY</td>
</tr>
<tr>
<td>Product quality (overall)</td>
<td>RTY</td>
</tr>
<tr>
<td>Station performance</td>
<td>TRY</td>
</tr>
<tr>
<td>Fixture comparison</td>
<td>TRY</td>
</tr>
<tr>
<td>Operator performance</td>
<td>TRY</td>
</tr>
<tr>
<td>Repair line efficiency</td>
<td>TRY</td>
</tr>
<tr>
<td>Trend analysis</td>
<td>FPY or TRY (per context)</td>
</tr>
<tr>
<td>Top runners</td>
<td>Unit count by product (per process)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="checklist-for-yield-questions">Checklist for Yield Questions</h2>
<ol>
<li>‚òê Is the process/test_operation specified?</li>
<li>‚òê Is unit-based (FPY) or report-based (TRY) yield appropriate?</li>
<li>‚òê Are we dealing with a retest-only station? (Use TRY)</li>
<li>‚òê Is volume context needed? (Top runners = high volume)</li>
<li>‚òê Should RTY be calculated? (Overall quality across processes)</li>
</ol>
<hr />
<h2 id="api-tips">API Tips</h2>
<h3 id="discover-processes-for-a-product">Discover Processes for a Product</h3>
<div class="codehilite"><pre><span></span><code><span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">perspective</span><span class="o">=</span><span class="s2">&quot;by operation&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>
</code></pre></div>

<h3 id="find-top-runners-for-a-process">Find Top Runners for a Process</h3>
<div class="codehilite"><pre><span></span><code><span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">perspective</span><span class="o">=</span><span class="s2">&quot;by product&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>
<span class="c1"># Sort results by unit_count descending</span>
</code></pre></div>

<h3 id="get-rty-components">Get RTY Components</h3>
<p>Query each process individually and multiply FPYs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get all process yields</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">perspective</span><span class="o">=</span><span class="s2">&quot;by operation&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>

<span class="c1"># RTY = product of all FPY values</span>
<span class="n">rty</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
    <span class="n">rty</span> <span class="o">*=</span> <span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">first_pass_yield</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">rty</span> <span class="o">*=</span> <span class="mi">100</span>  <span class="c1"># Convert back to percentage</span>
</code></pre></div>

<hr />
<h2 id="dimensional-analysis-failure-mode-detection">Dimensional Analysis (Failure Mode Detection)</h2>
<h3 id="the-bridge-to-root-cause">The Bridge to Root Cause</h3>
<p>Between top-level yield analysis and detailed root cause investigation lies <strong>dimensional analysis</strong> - systematically comparing yields across different configurations to detect failure modes.</p>
<h3 id="what-is-dimensional-analysis">What is Dimensional Analysis?</h3>
<p>Query yield data with additional dimensions (grouping factors), then compare yields to identify which configurations correlate with low yield.</p>
<p><strong>Key Insight</strong>: If yield varies significantly across a dimension, that dimension is likely related to the failure mode.</p>
<h3 id="available-dimensions">Available Dimensions</h3>
<table>
<thead>
<tr>
<th>Dimension</th>
<th>What It Reveals</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stationName</code></td>
<td>Equipment issues (calibration, wear)</td>
</tr>
<tr>
<td><code>operator</code></td>
<td>Training/technique differences</td>
</tr>
<tr>
<td><code>fixtureId</code></td>
<td>Fixture wear or contamination</td>
</tr>
<tr>
<td><code>batchNumber</code></td>
<td>Component lot issues (supplier, incoming)</td>
</tr>
<tr>
<td><code>location</code></td>
<td>Environment/line differences</td>
</tr>
<tr>
<td><code>swFilename</code></td>
<td>Test program differences</td>
</tr>
<tr>
<td><code>swVersion</code></td>
<td>Test version differences</td>
</tr>
<tr>
<td><code>period</code></td>
<td>Drift over time</td>
</tr>
</tbody>
</table>
<h3 id="common-failure-mode-patterns">Common Failure Mode Patterns</h3>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Typical Cause</th>
<th>Investigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Station-specific</td>
<td>Equipment problem</td>
<td>Calibration, maintenance, environment</td>
</tr>
<tr>
<td>Batch-specific</td>
<td>Component defect</td>
<td>Incoming inspection, supplier quality</td>
</tr>
<tr>
<td>Operator-specific</td>
<td>Training gap</td>
<td>Standardize procedures, retrain</td>
</tr>
<tr>
<td>Fixture-specific</td>
<td>Fixture wear</td>
<td>Maintenance, contact cleaning</td>
</tr>
<tr>
<td>Time-based trend</td>
<td>Drift</td>
<td>Preventive maintenance, SPC</td>
</tr>
<tr>
<td>Software-specific</td>
<td>Test change</td>
<td>Version comparison, rollback</td>
</tr>
</tbody>
</table>
<h3 id="analysis-workflow">Analysis Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">DETECT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FCT yield dropped from 95% to 88%&quot;</span>
<span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">yield_tool</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">perspective</span><span class="o">=</span><span class="s">&quot;trend&quot;</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">DIAGNOSE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;What&#39;s causing it?&quot;</span>
<span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="kd">dim</span><span class="n">ensional_analysis_tool</span>
<span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Compare</span><span class="w"> </span><span class="n">yield</span><span class="w"> </span><span class="n">across</span><span class="w"> </span><span class="n">stations</span><span class="p">,</span><span class="w"> </span><span class="n">batches</span><span class="p">,</span><span class="w"> </span><span class="n">operators</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="mf">.</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">ISOLATE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Station-3 has 75% FPY, others have 94%&quot;</span>
<span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Found</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">mode</span><span class="err">!</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">ROOT</span><span class="w"> </span><span class="n">CAUSE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Why is Station-3 failing?&quot;</span>
<span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">test_step_analysis</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">failing</span><span class="w"> </span><span class="kr">step</span><span class="n">s</span>
<span class="w">   </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">measurement_tool</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">Cpk</span>
</code></pre></div>

<h3 id="example-finding-a-failure-mode">Example: Finding a Failure Mode</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Step 1: Notice yield problem</span>
<span class="n">yield_result</span> <span class="o">=</span> <span class="n">yield_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">YieldFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>
<span class="c1"># Result: FPY=88% (below target of 95%)</span>

<span class="c1"># Step 2: Dimensional analysis</span>
<span class="n">failure_modes</span> <span class="o">=</span> <span class="n">dimensional_analysis_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">FailureModeFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>
<span class="c1"># Result:</span>
<span class="c1">#   Station-3: FPY=75% (-13% vs baseline) CRITICAL</span>
<span class="c1">#   Batch-042: FPY=82% (-6% vs baseline) HIGH</span>
<span class="c1">#   All other dimensions: within normal range</span>

<span class="c1"># Step 3: Investigate Station-3 specifically</span>
<span class="n">station_3_steps</span> <span class="o">=</span> <span class="n">test_step_analysis_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;WIDGET-001&quot;</span><span class="p">,</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">station_name</span><span class="o">=</span><span class="s2">&quot;Station-3&quot;</span>
<span class="p">)</span>
<span class="c1"># Result: &quot;Voltage Test&quot; step has 25% failure rate</span>
</code></pre></div>

<h3 id="statistical-significance">Statistical Significance</h3>
<p>Not all yield variations are meaningful. The tool considers:</p>
<table>
<thead>
<tr>
<th>Factor</th>
<th>Weight</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Magnitude</strong></td>
<td>How much below baseline?</td>
</tr>
<tr>
<td><strong>Sample size</strong></td>
<td>More units = higher confidence</td>
</tr>
<tr>
<td><strong>Consistency</strong></td>
<td>Does it repeat over time?</td>
</tr>
</tbody>
</table>
<p><strong>Significance Levels:</strong><br />
- üî¥ CRITICAL: &gt;10% below baseline, high confidence<br />
- üü† HIGH: 5-10% below baseline<br />
- üü° MODERATE: 2-5% below baseline<br />
- ‚ö™ LOW: &lt;2% below baseline</p>
<h3 id="misc-info-as-dimensions">Misc Info as Dimensions</h3>
<p>WATS supports custom properties via <strong>misc_info</strong>. Common examples:</p>
<table>
<thead>
<tr>
<th>Misc Info</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>Component lot</td>
<td>Track specific component batches</td>
</tr>
<tr>
<td>Firmware version</td>
<td>Software-under-test version</td>
</tr>
<tr>
<td>Configuration</td>
<td>Product variants</td>
</tr>
<tr>
<td>Supplier</td>
<td>Supplier traceability</td>
</tr>
<tr>
<td>Chamber ID</td>
<td>Environmental chamber tracking</td>
</tr>
</tbody>
</table>
<p>If a failure mode correlates with misc_info values, it often points directly to the root cause (e.g., a specific component lot).</p>
<hr />
<h2 id="test-step-analysis-tsa">Test Step Analysis (TSA)</h2>
<h3 id="what-is-tsa">What is TSA?</h3>
<p>Test Step Analysis (TSA) provides step-by-step visibility into the test sequence. It shows statistics for each test step, enabling root cause identification and process capability assessment.</p>
<h3 id="position-in-analysis-workflow">Position in Analysis Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">Yield</span><span class="w">       </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Dimensional</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">TSA</span><span class="w"> </span><span class="o">/</span><span class="w">       </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Measurement</span><span class="w"> </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Step</span><span class="w">        </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Deep</span><span class="w"> </span><span class="n">Dive</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">             </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="p">(</span><span class="n">optional</span><span class="p">)</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">             </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">     </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span>
<span class="s">&quot;What&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">failing</span><span class="o">?</span><span class="s">&quot;   &quot;</span><span class="n">Where</span><span class="o">/</span><span class="kr">when</span><span class="o">?</span><span class="s">&quot;      &quot;</span><span class="nf">Which</span><span class="w"> </span><span class="n">step</span><span class="o">?</span><span class="s">&quot;        &quot;</span><span class="n">Why</span><span class="w"> </span><span class="n">exactly</span><span class="o">?</span><span class="s">&quot;</span>
</code></pre></div>

<h3 id="key-tsa-concepts">Key TSA Concepts</h3>
<h4 id="single-productprocess-analysis">Single Product/Process Analysis</h4>
<p><strong>TSA is designed for ONE product in ONE process at a time.</strong></p>
<ul>
<li>Different products have different test sequences</li>
<li>Different processes test different things</li>
<li>Mixing sequences leads to confusing merged results</li>
</ul>
<h4 id="data-integrity-check">Data Integrity Check</h4>
<p>Before analyzing, TSA checks for potential issues:</p>
<table>
<thead>
<tr>
<th>Check</th>
<th>Warning</th>
</tr>
</thead>
<tbody>
<tr>
<td>Multiple SW versions</td>
<td>Different test programs may have different sequences</td>
</tr>
<tr>
<td>Multiple revisions</td>
<td>Different product revisions may have different tests</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation</strong>: Filter to specific <code>sw_filename</code> or <code>revision</code> for clean analysis.</p>
<h4 id="sequence-merging-behavior">Sequence Merging Behavior</h4>
<p>When data includes multiple test sequences:</p>
<ol>
<li><strong>Identical step paths</strong> are merged (statistics combined)</li>
<li><strong>Different step paths</strong> are kept separate  </li>
<li><strong>Sample counts may vary</strong> per step (not necessarily a problem)</li>
</ol>
<p>This allows comparing related tests but can be confusing if unintended.</p>
<h3 id="tsa-statistics-explained">TSA Statistics Explained</h3>
<h4 id="step-failure-statistics">Step Failure Statistics</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Meaning</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>step_failed_count</code></td>
<td>Step reported failure</td>
<td>Medium</td>
</tr>
<tr>
<td><code>step_error_count</code></td>
<td>Step had an error</td>
<td>Medium</td>
</tr>
<tr>
<td><code>step_terminated_count</code></td>
<td>Test terminated at this step</td>
<td>Medium</td>
</tr>
<tr>
<td><code>step_caused_uut_failed</code></td>
<td><strong>Step CAUSED unit to fail</strong></td>
<td>üî¥ HIGH</td>
</tr>
<tr>
<td><code>step_caused_uut_error</code></td>
<td>Step caused unit error</td>
<td>HIGH</td>
</tr>
</tbody>
</table>
<p><strong>Critical distinction</strong>: A step can FAIL (report failure) without being the CAUSE of unit failure. The <code>step_caused_uut_*</code> fields identify root cause steps.</p>
<h4 id="process-capability-cpcpk">Process Capability (Cp/Cpk)</h4>
<p>For measurements, TSA provides process capability indices:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Definition</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cpk</strong></td>
<td>Process capability index</td>
<td>Actual capability (considers centering)</td>
</tr>
<tr>
<td><strong>Cp</strong></td>
<td>Process capability potential</td>
<td>Potential if perfectly centered</td>
</tr>
<tr>
<td><strong>Cp_lower</strong></td>
<td>Capability vs low limit</td>
<td>Lower spec margin</td>
</tr>
<tr>
<td><strong>Cp_upper</strong></td>
<td>Capability vs high limit</td>
<td>Upper spec margin</td>
</tr>
</tbody>
</table>
<h4 id="cpk-thresholds">Cpk Thresholds</h4>
<table>
<thead>
<tr>
<th>Cpk Value</th>
<th>Status</th>
<th>Action Required</th>
</tr>
</thead>
<tbody>
<tr>
<td>‚â• 1.33</td>
<td>‚úÖ CAPABLE</td>
<td>Process is good, monitor</td>
</tr>
<tr>
<td>1.0-1.33</td>
<td>‚ö†Ô∏è MARGINAL</td>
<td>Improvement needed, prioritize</td>
</tr>
<tr>
<td>0.67-1.0</td>
<td>‚ùå INCAPABLE</td>
<td>Action required, risk of failures</td>
</tr>
<tr>
<td>&lt; 0.67</td>
<td>üö® CRITICAL</td>
<td>URGENT - high defect rate expected</td>
</tr>
</tbody>
</table>
<p><strong>Industry Standard</strong>: Cpk ‚â• 1.33 ensures 3-sigma coverage on both sides.</p>
<h4 id="other-statistics">Other Statistics</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>avg</code>, <code>min</code>, <code>max</code></td>
<td>Measurement statistics</td>
</tr>
<tr>
<td><code>stdev</code></td>
<td>Standard deviation (process variation)</td>
</tr>
<tr>
<td><code>sigma_high_3</code>, <code>sigma_low_3</code></td>
<td>¬±3œÉ limits for control charts</td>
</tr>
<tr>
<td><code>step_time_avg</code>, <code>step_time_min</code>, <code>step_time_max</code></td>
<td>Timing statistics</td>
</tr>
</tbody>
</table>
<h3 id="analysis-priority">Analysis Priority</h3>
<p>When reviewing TSA results, investigate in this order:</p>
<h4 id="1-critical-steps-causing-unit-failures">1. üî¥ CRITICAL: Steps Causing Unit Failures</h4>
<p>Steps where <code>step_caused_uut_failed &gt; 0</code> are root causes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># These steps CAUSED units to fail - investigate first!</span>
<span class="n">critical_steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steps</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">step_caused_uut_failed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">critical_steps</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">step_caused_uut_failed</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<h4 id="2-cpk-concerns">2. ‚ö†Ô∏è Cpk Concerns</h4>
<p>Measurements with Cpk below threshold indicate capability issues:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Measurements with poor capability</span>
<span class="n">cpk_concerns</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steps</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">cpk</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">cpk</span> <span class="o">&lt;</span> <span class="mf">1.33</span><span class="p">]</span>
<span class="n">cpk_concerns</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cpk</span><span class="p">)</span>  <span class="c1"># Worst first</span>
</code></pre></div>

<h4 id="3-high-failure-rate-steps">3. High Failure Rate Steps</h4>
<p>Steps with high failure rates (may not be root cause):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># High failure rate but check if they cause unit failures</span>
<span class="n">high_fail</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steps</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">pass_rate</span> <span class="o">&lt;</span> <span class="mi">95</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">step_count</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span>
</code></pre></div>

<h3 id="common-tsa-workflows">Common TSA Workflows</h3>
<h4 id="finding-root-cause-of-failures">Finding Root Cause of Failures</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Step 1: Get step analysis</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">step_analysis_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">StepAnalysisInput</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCBA-001&quot;</span><span class="p">,</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>

<span class="c1"># Step 2: Check critical steps (caused unit failures)</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">critical_steps</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">caused_unit_fail</span><span class="si">}</span><span class="s2"> unit failures&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: If measurement, check capability</span>
<span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">cpk</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cpk: </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">cpk</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">cpk_status</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="process-capability-assessment">Process Capability Assessment</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get overall capability picture</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">overall_summary</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total measurements: </span><span class="si">{</span><span class="n">summary</span><span class="o">.</span><span class="n">total_measurements</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Cpk: </span><span class="si">{</span><span class="n">summary</span><span class="o">.</span><span class="n">avg_cpk</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Capable (‚â•1.33): </span><span class="si">{</span><span class="n">summary</span><span class="o">.</span><span class="n">capable_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Marginal (1.0-1.33): </span><span class="si">{</span><span class="n">summary</span><span class="o">.</span><span class="n">marginal_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Incapable (&lt;1.0): </span><span class="si">{</span><span class="n">summary</span><span class="o">.</span><span class="n">incapable_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="investigating-specific-step">Investigating Specific Step</h4>
<p>After identifying a problem step:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Deep dive on measurement</span>
<span class="n">measurement_result</span> <span class="o">=</span> <span class="n">measurement_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">MeasurementFilter</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCBA-001&quot;</span><span class="p">,</span>
    <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
    <span class="n">measurement_path</span><span class="o">=</span><span class="s2">&quot;Main/Voltage Test/Output&quot;</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">30</span>
<span class="p">))</span>
<span class="c1"># Get distribution, histogram, outliers...</span>
</code></pre></div>

<h3 id="tsa-vs-dimensional-analysis">TSA vs Dimensional Analysis</h3>
<table>
<thead>
<tr>
<th>TSA</th>
<th>Dimensional Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>WHICH step</strong> is failing</td>
<td><strong>WHERE/WHEN</strong> failures happen</td>
</tr>
<tr>
<td>Step-level statistics</td>
<td>Configuration comparisons</td>
</tr>
<tr>
<td>Process capability</td>
<td>Failure mode detection</td>
</tr>
<tr>
<td>Single product/process</td>
<td>Yield across dimensions</td>
</tr>
</tbody>
</table>
<p><strong>Use Together</strong>: Dimensional analysis finds the failure mode (e.g., "Station-3"), then TSA finds the specific step causing issues on that station.</p>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Always filter to single product + process</strong> for meaningful results</li>
<li><strong>Check data integrity</strong> - alert on multiple SW versions/revisions</li>
<li><strong>Focus on <code>step_caused_uut_failed</code></strong> - these are the true root causes</li>
<li><strong>Use Cpk thresholds</strong> - prioritize measurements below 1.33</li>
<li><strong>Sequence merging is OK</strong> if understood - different step counts may be expected</li>
</ol>
<hr />
<h2 id="process-capability-analysis-advanced">Process Capability Analysis (Advanced)</h2>
<p>Process Capability Analysis builds on TSA to provide deeper statistical assessment. Use this when TSA identifies measurements with Cpk concerns and you need to understand:</p>
<ol>
<li><strong>Is the process stable?</strong> (If not, Cpk is meaningless)</li>
<li><strong>How are failures affecting capability?</strong></li>
<li><strong>Are there hidden modes in the data?</strong></li>
</ol>
<h3 id="position-in-analysis-workflow_1">Position in Analysis Workflow</h3>
<div class="codehilite"><pre><span></span><code><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">     </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">Yield</span><span class="w">       </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Dimensional</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Step</span><span class="w">        </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="nf">Process</span><span class="w">      </span><span class="err">‚îÇ</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Measurement</span><span class="w"> </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Capability</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Deep</span><span class="w"> </span><span class="n">Dive</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">             </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="p">(</span><span class="n">optional</span><span class="p">)</span><span class="w">   </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="p">(</span><span class="n">TSA</span><span class="p">)</span><span class="w">       </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">Analysis</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">             </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">     </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">     </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span>
<span class="s">&quot;What&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">failing</span><span class="o">?</span><span class="s">&quot;   &quot;</span><span class="n">Where</span><span class="o">/</span><span class="kr">when</span><span class="o">?</span><span class="s">&quot;      &quot;</span><span class="nf">Which</span><span class="w"> </span><span class="n">step</span><span class="o">?</span><span class="s">&quot;     &quot;</span><span class="n">Is</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">stable</span><span class="o">?</span><span class="s">&quot;      &quot;</span><span class="n">Why</span><span class="w"> </span><span class="n">exactly</span><span class="o">?</span><span class="s">&quot;</span>
<span class="s">                                                          &quot;</span><span class="n">Cpk</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">Cpk_wof</span><span class="o">?</span><span class="s">&quot;</span>
</code></pre></div>

<h3 id="dual-cpk-analysis-critical">Dual Cpk Analysis (Critical!)</h3>
<p>WATS provides TWO Cpk datasets for each measurement:</p>
<table>
<thead>
<tr>
<th>Dataset</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cpk</strong></td>
<td>All Data</td>
<td>Includes ALL measurements including failures</td>
</tr>
<tr>
<td><strong>Cpk_wof</strong></td>
<td>Without Failures</td>
<td>Excludes failed measurements - shows "good" data</td>
</tr>
</tbody>
</table>
<h4 id="why-two-datasets">Why Two Datasets?</h4>
<div class="codehilite"><pre><span></span><code><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="nx">Cpk</span><span class="w"> </span><span class="p">(</span><span class="nx">All</span><span class="w"> </span><span class="nx">Data</span><span class="p">)</span><span class="w">         </span><span class="err">‚îÇ</span><span class="w"> </span><span class="nx">Shows</span><span class="w"> </span><span class="nx">ACTUAL</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="nx">performance</span><span class="w">                </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="nx">Cpk_wof</span><span class="w"> </span><span class="p">(</span><span class="nx">Without</span><span class="w"> </span><span class="nx">Fail</span><span class="p">)</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w"> </span><span class="nx">Shows</span><span class="w"> </span><span class="nx">POTENTIAL</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">failures</span><span class="w"> </span><span class="nx">addressed</span><span class="w">           </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
</code></pre></div>

<h4 id="interpreting-the-difference">Interpreting the Difference</h4>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Interpretation</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cpk ‚âà Cpk_wof</td>
<td>Process is stable, failures not distorting capability</td>
<td>Focus on reducing variation</td>
</tr>
<tr>
<td>Cpk &lt;&lt; Cpk_wof</td>
<td>Failures significantly impact capability</td>
<td><strong>Address failure root cause FIRST</strong></td>
</tr>
<tr>
<td>Cpk &gt;&gt; Cpk_wof</td>
<td>Unusual - failures catching bad units correctly</td>
<td>Verify limits are correct</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:<br />
- Cpk = 0.9, Cpk_wof = 1.5<br />
- Ratio = 1.67 (significant!)<br />
- <strong>Conclusion</strong>: Failures are severely impacting capability. Fix the failure mode first, and capability should improve to ~1.5.</p>
<h4 id="other-capability-metrics-_wof-variants">Other Capability Metrics (_wof variants)</h4>
<p>All these statistics have "without failure" variants:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>With Failures</th>
<th>Without Failures</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cpk</td>
<td><code>cpk</code></td>
<td><code>cpk_wof</code></td>
</tr>
<tr>
<td>Cp</td>
<td><code>cp</code></td>
<td><code>cp_wof</code></td>
</tr>
<tr>
<td>Average</td>
<td><code>avg</code></td>
<td><code>avg_wof</code></td>
</tr>
<tr>
<td>Std Dev</td>
<td><code>stdev</code></td>
<td><code>stdev_wof</code></td>
</tr>
<tr>
<td>Min/Max</td>
<td><code>min</code>, <code>max</code></td>
<td><code>min_wof</code>, <code>max_wof</code></td>
</tr>
<tr>
<td>œÉ Limits</td>
<td><code>sigma_high_3</code>, <code>sigma_low_3</code></td>
<td><code>sigma_high_3_wof</code>, <code>sigma_low_3_wof</code></td>
</tr>
</tbody>
</table>
<h3 id="stability-assessment-must-check-first">Stability Assessment (MUST CHECK FIRST!)</h3>
<p><strong>Before trusting ANY Cpk number, verify process stability.</strong></p>
<p>An unstable process makes Cpk meaningless - the number will change over time.</p>
<h4 id="what-makes-a-process-stable">What Makes a Process Stable?</h4>
<p>A stable process has:<br />
- ‚úÖ Consistent mean (no drift)<br />
- ‚úÖ Consistent variation (œÉ stays constant)<br />
- ‚úÖ No unusual patterns (trends, cycles, shifts)<br />
- ‚úÖ Random variation only (normal distribution)</p>
<h4 id="stability-red-flags">Stability Red Flags</h4>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Description</th>
<th>Detection</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Trend</strong></td>
<td>Mean drifting up or down over time</td>
<td>Compare early vs late data</td>
</tr>
<tr>
<td><strong>Shift</strong></td>
<td>Sudden mean change</td>
<td>Large mean difference between periods</td>
</tr>
<tr>
<td><strong>Outliers</strong></td>
<td>Data points beyond 3œÉ</td>
<td>Values outside control limits</td>
</tr>
<tr>
<td><strong>High Variance</strong></td>
<td>6œÉ spread &gt; spec range</td>
<td>Process spread exceeds tolerance</td>
</tr>
<tr>
<td><strong>Bimodal</strong></td>
<td>Two populations mixed</td>
<td>œÉ_wof much smaller than œÉ</td>
</tr>
</tbody>
</table>
<h4 id="stability-decision-flow">Stability Decision Flow</h4>
<div class="codehilite"><pre><span></span><code>                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ Check Stability ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ                             ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ STABLE  ‚îÇ                  ‚îÇ UNSTABLE  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                             ‚îÇ
              ‚îÇ                             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Cpk is meaningful ‚îÇ        ‚îÇ FIX STABILITY FIRST ‚îÇ
    ‚îÇ Focus on          ‚îÇ        ‚îÇ Cpk is unreliable   ‚îÇ
    ‚îÇ improvement       ‚îÇ        ‚îÇ Find special causes ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<h3 id="hidden-mode-detection">Hidden Mode Detection</h3>
<p>Beyond basic capability, look for these hidden issues:</p>
<h4 id="1-centering-issues-cp-cpk">1. Centering Issues (Cp &gt;&gt; Cpk)</h4>
<p>If Cp is much higher than Cpk, the process could be capable but is off-center:</p>
<div class="codehilite"><pre><span></span><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Example:                                    ‚îÇ
‚îÇ   Cp = 1.8 (good potential)                 ‚îÇ
‚îÇ   Cpk = 0.9 (poor actual)                   ‚îÇ
‚îÇ   Ratio = 2.0                               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ ‚Üí Process is off-center from spec midpoint  ‚îÇ
‚îÇ ‚Üí Centering adjustment could double Cpk!    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<h4 id="2-approaching-specification-limits">2. Approaching Specification Limits</h4>
<p>Check sigma margin to specification limits:</p>
<table>
<thead>
<tr>
<th>Sigma Margin</th>
<th>Risk Level</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>&gt; 3œÉ</td>
<td>Low</td>
<td>Process is well-centered</td>
</tr>
<tr>
<td>2-3œÉ</td>
<td>Medium</td>
<td>Monitor closely</td>
</tr>
<tr>
<td>&lt; 2œÉ</td>
<td>High</td>
<td>Failures likely, adjust process</td>
</tr>
</tbody>
</table>
<h4 id="3-bimodal-distribution">3. Bimodal Distribution</h4>
<p>Signs of two populations mixed:<br />
- œÉ_wof is much smaller than œÉ<br />
- Mean_wof differs significantly from Mean<br />
- Distribution may have two peaks</p>
<p><strong>Root Cause</strong>: Often a machine, operator, or component lot causing different behavior.</p>
<h4 id="4-high-variance-relative-to-specification">4. High Variance Relative to Specification</h4>
<p>Check if process spread fits within specification:</p>
<div class="codehilite"><pre><span></span><code><span class="k">Proc</span><span class="nv">ess</span><span class="w"> </span><span class="nv">Spread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="err">œÉ</span>
<span class="nf">Spec</span><span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Upper</span><span class="w"> </span><span class="nv">Limit</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Lower</span><span class="w"> </span><span class="nv">Limit</span>

<span class="nf">If</span><span class="w"> </span><span class="mi">6</span><span class="err">œÉ</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">Spec</span><span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nv">Process</span><span class="w"> </span><span class="nv">inherently</span><span class="w"> </span><span class="nv">incapable</span>
</code></pre></div>

<h3 id="improvement-priority-matrix">Improvement Priority Matrix</h3>
<p>Use this to prioritize improvement efforts:</p>
<table>
<thead>
<tr>
<th>Priority</th>
<th>Criteria</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>üî¥ <strong>CRITICAL</strong></td>
<td>Cpk &lt; 0.67 OR Process unstable</td>
<td>Immediate action</td>
</tr>
<tr>
<td>üü† <strong>HIGH</strong></td>
<td>Cpk &lt; 1.0 OR Approaching limits</td>
<td>Address soon</td>
</tr>
<tr>
<td>üü° <strong>MEDIUM</strong></td>
<td>1.0 ‚â§ Cpk &lt; 1.33 OR Centering issue</td>
<td>Plan improvement</td>
</tr>
<tr>
<td>üü¢ <strong>LOW</strong></td>
<td>Cpk ‚â• 1.33 AND Stable</td>
<td>Monitor only</td>
</tr>
</tbody>
</table>
<h3 id="dimensional-considerations">Dimensional Considerations</h3>
<p><strong>Important</strong>: For dimensional analysis within process capability:</p>
<ul>
<li>TSA returns aggregate statistics across ALL data</li>
<li>To analyze by dimension (station, operator, SW version), you must:</li>
<li>Filter the data to the specific dimension value</li>
<li>Re-run the analysis</li>
<li>Compare results across dimensions</li>
</ul>
<p><strong>Example workflow</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Compare capability across stations</span>
<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Station-1&quot;</span><span class="p">,</span> <span class="s2">&quot;Station-2&quot;</span><span class="p">,</span> <span class="s2">&quot;Station-3&quot;</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">capability_tool</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">ProcessCapabilityInput</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="s2">&quot;PCBA-001&quot;</span><span class="p">,</span>
        <span class="n">test_operation</span><span class="o">=</span><span class="s2">&quot;FCT&quot;</span><span class="p">,</span>
        <span class="n">station_name</span><span class="o">=</span><span class="n">station</span>  <span class="c1"># Filter to specific station</span>
    <span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">: Cpk=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">avg_cpk_all</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;Stable=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stable_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">measurements_analyzed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="process-capability-vs-tsa">Process Capability vs TSA</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>TSA</th>
<th>Process Capability</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scope</td>
<td>All steps overview</td>
<td>Detailed per measurement</td>
</tr>
<tr>
<td>Cpk Analysis</td>
<td>Basic (single value)</td>
<td>Dual (with/without failures)</td>
</tr>
<tr>
<td>Stability</td>
<td>Not checked</td>
<td>Full stability assessment</td>
</tr>
<tr>
<td>Hidden Modes</td>
<td>Not detected</td>
<td>Detects trends, outliers, etc.</td>
</tr>
<tr>
<td>When to Use</td>
<td>First pass analysis</td>
<td>Deep dive on concerns</td>
</tr>
</tbody>
</table>
<h3 id="best-practices_1">Best Practices</h3>
<ol>
<li><strong>Check stability BEFORE trusting Cpk</strong> - unstable processes have meaningless Cpk</li>
<li><strong>Compare Cpk vs Cpk_wof</strong> - significant difference means address failures first</li>
<li><strong>Look for centering issues</strong> - Cp &gt;&gt; Cpk means easy improvement available</li>
<li><strong>Check sigma margins</strong> - less than 2œÉ to limits is high risk</li>
<li><strong>For dimensions, make separate calls</strong> - aggregate data hides variation</li>
<li><strong>Prioritize by improvement priority</strong> - critical first, then high, etc.</li>
</ol>
<hr />
<h2 id="summary">Summary</h2>
<p>The most important things to remember:</p>
<ol>
<li><strong>Yield is per process</strong> - Always clarify which test operation</li>
<li><strong>RTY for overall quality</strong> - Multiply FPYs across all processes</li>
<li><strong>TRY for equipment/operator</strong> - Especially for retest stations</li>
<li><strong>Top runners are per process</strong> - Volume varies by test operation</li>
<li><strong>Unit Inclusion Rule</strong> - First run determines inclusion</li>
<li><strong>Dimensional analysis for failure modes</strong> - Compare yields across configurations</li>
<li><strong>TSA for root cause</strong> - Find which STEP is causing failures</li>
<li><strong>Process Capability for deep dive</strong> - Stability, dual Cpk, hidden modes</li>
<li><strong>Cpk vs Cpk_wof</strong> - Compare to understand failure impact</li>
<li><strong>Check stability first</strong> - Unstable process makes Cpk meaningless</li>
<li><strong>Cpk ‚â• 1.33 is capable</strong> - &lt;1.0 needs action, &lt;0.67 is critical</li>
<li><strong>step_caused_uut_failed is key</strong> - Identifies true root cause steps</li>
<li><strong>Follow the workflow</strong> - Yield ‚Üí Dimensions ‚Üí Steps ‚Üí Capability ‚Üí Measurements</li>
</ol>
</div>


<div class="doc-separator" id="reference-llm-converter-guide">
    <div class="doc-source">Source: docs/llm-converter-guide.md</div>
    <h1 id="llm-quick-reference-reportbuilder-for-pywats">LLM Quick Reference - ReportBuilder for pyWATS</h1>
<h2 id="for-llms-implementing-converters">For LLMs Implementing Converters</h2>
<p>This is your cheat sheet for creating pyWATS converters. <strong>You only need to customize the parsing logic</strong> - everything else is standard.</p>
<hr />
<h2 id="standard-converter-template">Standard Converter Template</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters.file_converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileConverter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">ConverterResult</span><span class="p">,</span> <span class="n">ValidationResult</span>
<span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YourConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Your converter description&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Your Converter Name&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;1.0.0&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">file_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;*.yourext&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConverterResult</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># STEP 1: Parse file (ONLY CUSTOM PART)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_file</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

            <span class="c1"># STEP 2: Create builder (STANDARD)</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span>
                <span class="n">part_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">],</span>
                <span class="n">serial_number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># STEP 3: Add steps (STANDARD)</span>
            <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
                    <span class="n">unit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
                    <span class="n">low_limit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;low_limit&quot;</span><span class="p">),</span>
                    <span class="n">high_limit</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_limit&quot;</span><span class="p">),</span>
                    <span class="n">group</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># STEP 4: Build (STANDARD)</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success_result</span><span class="p">(</span>
                <span class="n">report</span><span class="o">=</span><span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">error_result</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CUSTOMIZE THIS METHOD FOR YOUR FORMAT</span>

<span class="sd">        Must return:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;part_number&quot;: &quot;PN-001&quot;,</span>
<span class="sd">            &quot;serial_number&quot;: &quot;SN-001&quot;,</span>
<span class="sd">            &quot;tests&quot;: [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;name&quot;: &quot;Test Name&quot;,</span>
<span class="sd">                    &quot;value&quot;: 5.0,          # Can be: float, int, bool, str, list</span>
<span class="sd">                    &quot;unit&quot;: &quot;V&quot;,           # Optional</span>
<span class="sd">                    &quot;low_limit&quot;: 4.5,      # Optional</span>
<span class="sd">                    &quot;high_limit&quot;: 5.5,     # Optional</span>
<span class="sd">                    &quot;group&quot;: &quot;Power Tests&quot; # Optional (creates sequences)</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># YOUR PARSING LOGIC HERE</span>
        <span class="k">pass</span>
</code></pre></div>

<hr />
<h2 id="quick-add-step-reference">Quick Add Step Reference</h2>
<h3 id="basic-patterns">Basic Patterns</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Numeric test with limits</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>

<span class="c1"># Numeric test without limits (LOG only)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="mf">25.3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>

<span class="c1"># Boolean test</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Power OK&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># String test</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Serial Number&quot;</span><span class="p">,</span> <span class="s2">&quot;ABC123&quot;</span><span class="p">)</span>

<span class="c1"># Multi-value numeric</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Calibration&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mV&quot;</span><span class="p">)</span>

<span class="c1"># With grouping (creates sequence)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;VCC&quot;</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="type-inference-rules">Type Inference Rules</h3>
<table>
<thead>
<tr>
<th>Value Type</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>True</code> or <code>False</code></td>
<td>Boolean step</td>
</tr>
<tr>
<td><code>5.0</code> or <code>100</code></td>
<td>Numeric step</td>
</tr>
<tr>
<td><code>"ABC"</code></td>
<td>String step</td>
</tr>
<tr>
<td><code>[1.0, 2.0, 3.0]</code></td>
<td>Multi-numeric step</td>
</tr>
<tr>
<td><code>[True, False]</code></td>
<td>Multi-boolean step</td>
</tr>
<tr>
<td><code>["A", "B"]</code></td>
<td>Multi-string step</td>
</tr>
</tbody>
</table>
<h3 id="status-calculation">Status Calculation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># In range ‚Üí Pass (auto)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># Out of range ‚Üí Fail (auto)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># Manual override</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>  <span class="c1"># Force fail</span>
</code></pre></div>

<hr />
<h2 id="parsing-examples">Parsing Examples</h2>
<h3 id="csv-format">CSV Format</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># First row has header info</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pn&quot;</span><span class="p">,</span> <span class="s2">&quot;PN-UNKNOWN&quot;</span><span class="p">),</span>
                <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sn&quot;</span><span class="p">,</span> <span class="s2">&quot;SN-UNKNOWN&quot;</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;test_name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;low_limit&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;low_limit&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;high_limit&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_limit&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;part_number&quot;</span><span class="p">],</span> <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;serial_number&quot;</span><span class="p">],</span> <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="n">tests</span><span class="p">}</span>
</code></pre></div>

<h3 id="json-format">JSON Format</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;low_limit&quot;</span><span class="p">),</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_limit&quot;</span><span class="p">)</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pn&quot;</span><span class="p">],</span>
        <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sn&quot;</span><span class="p">],</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="n">tests</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="xml-format">XML Format</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//Test&quot;</span><span class="p">):</span>
        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
            <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;LowLimit&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HighLimit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HighLimit&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//PartNumber&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//SerialNumber&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="n">tests</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="tab-separated-text">Tab-Separated Text</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Header lines (KEY: VALUE)</span>
        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;SERIAL&#39;</span><span class="p">:</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;serial_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PART&#39;</span><span class="p">:</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;part_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Test lines (tab-separated)</span>
        <span class="k">elif</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;low_limit&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;high_limit&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;part_number&quot;</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">),</span> <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;serial_number&quot;</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">),</span> <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="n">tests</span><span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="common-mistakes-to-avoid">Common Mistakes to Avoid</h2>
<h3 id="dont-build-reports-manually">‚ùå DON'T: Build reports manually</h3>
<div class="codehilite"><pre><span></span><code><span class="n">report</span> <span class="o">=</span> <span class="n">UUTReport</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># Too many parameters, easy to mess up</span>
</code></pre></div>

<h3 id="do-use-reportbuilder">‚úÖ DO: Use ReportBuilder</h3>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">low_limit</span><span class="p">,</span> <span class="n">high_limit</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

<h3 id="dont-calculate-status-manually">‚ùå DON'T: Calculate status manually</h3>
<div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">low_limit</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">high_limit</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
</code></pre></div>

<h3 id="do-let-the-builder-calculate-it">‚úÖ DO: Let the builder calculate it</h3>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=</span><span class="n">low_limit</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="n">high_limit</span><span class="p">)</span>
<span class="c1"># Status calculated automatically</span>
</code></pre></div>

<h3 id="dont-manually-create-sequences">‚ùå DON'T: Manually create sequences</h3>
<div class="codehilite"><pre><span></span><code><span class="n">root</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_root_sequence_call</span><span class="p">()</span>
<span class="n">power_seq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">add_sequence_call</span><span class="p">(</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>
<span class="n">power_seq</span><span class="o">.</span><span class="n">add_numeric_step</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="do-use-group-parameter">‚úÖ DO: Use group parameter</h3>
<div class="codehilite"><pre><span></span><code><span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;VCC&quot;</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;VDD&quot;</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;Power Tests&quot;</span><span class="p">)</span>
<span class="c1"># Sequences created automatically</span>
</code></pre></div>

<hr />
<h2 id="validation-checklist">Validation Checklist</h2>
<p>Before submitting your converter code, verify:</p>
<ul>
<li>[ ] Uses <code>from pywats.tools import ReportBuilder</code></li>
<li>[ ] Only <code>_parse_file()</code> method contains custom logic</li>
<li>[ ] Returns dict with <code>part_number</code>, <code>serial_number</code>, <code>tests</code></li>
<li>[ ] Each test has <code>name</code> and <code>value</code> (minimum)</li>
<li>[ ] Uses <code>builder.add_step()</code> not manual <code>UUTReport</code> construction</li>
<li>[ ] Lets builder infer types, operators, status</li>
<li>[ ] Returns <code>ConverterResult.success_result(report=builder.build())</code></li>
<li>[ ] Has try/except with <code>ConverterResult.error_result()</code> on exception</li>
</ul>
<hr />
<h2 id="complete-minimal-example">Complete Minimal Example</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pywats.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportBuilder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters.file_converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileConverter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pywats_client.converters.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">ConverterResult</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MinimalConverter</span><span class="p">(</span><span class="n">FileConverter</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Minimal Converter&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;1.0.0&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">file_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;*.txt&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">ConverterSource</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConverterResult</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Parse</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pn</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">sn</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Build</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">ReportBuilder</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="c1"># Return</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">success_result</span><span class="p">(</span><span class="n">report</span><span class="o">=</span><span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConverterResult</span><span class="o">.</span><span class="n">error_result</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>

<p>That's it! <strong>Only 20 lines of actual code.</strong></p>
<hr />
<h2 id="need-help">Need Help?</h2>
<ul>
<li><strong>Documentation:</strong> See <code>docs/usage/REPORT_BUILDER.md</code></li>
<li><strong>Examples:</strong> See <code>examples/report/report_builder_examples.py</code></li>
<li><strong>Template:</strong> See <code>converters/simple_builder_converter.py</code></li>
</ul>
</div>

    
    <!-- Footer -->
    <hr>
    <p style="text-align: center; color: #999; font-size: 0.9em;">
        pyWATS Documentation &copy; Virinco AS<br>
        Generated on 2026-01-26
    </p>
</body>
</html>
